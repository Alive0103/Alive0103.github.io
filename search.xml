<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2024/09/21/NER/%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86/"/>
      <url>/2024/09/21/NER/%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>发展现状里面分为3点，持续学习、增量学习和终身学习的差别不大，可浓缩为1点，并由此可以引出类增量学习的概念，第2点为类增量问题中缓解灾难性遗忘的方法，第3点为传统NER和类增量NER;</p><p>存在的问题里面，应尽可能指出目前类增量NER存在的主要问题，以区别于其他NLP任务的类增量学习，因此，目前提出的部分问题可能并不适用，并缺乏了对少样本/零样本的讨论，也有部分问题存在因果联系，可考虑浓缩；</p><p>在描述本研究的理论方法时，重点描述为提出少样本条件下的类增量ner方法，点出解决上述问题中的具体哪一个问题；</p><p>在描述设计研究方法的思路时，给出在知识蒸馏基础上应用不同策略（L&amp;R、伪标签生成、合成数据增强）的思路，是从哪些角度考虑的，可以进一步缓解灾难性遗忘问题的，最好能找到一个套用人脑学习机制的思路，拔高一下主题。</p><p>标签解释学习也可以作为知识蒸馏的增强型策略</p><p>按照这个框架可以往里面填充内容了，related work组织文献时，注意前后文献引用时的内在逻辑，而不是简单的文献堆砌</p><p>一. 发展现状的修改</p><ol><li><p><strong>缩减持续学习、增量学习、终身学习的区别</strong>：</p><ul><li>可以将“持续学习”、“增量学习”和“终身学习”这三者的区别浓缩为一个更简洁的介绍。例如，描述它们在目标上都类似，即应对模型的逐步学习和更新，以此引出类增量学习的概念。将重点转向类增量学习的实际应用及其特殊性，如在NER任务中的重要性。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>类增量学习逐步取代了传统的持续学习和终身学习的概念，特别是在命名实体识别（NER）任务中，类增量学习适用于处理新实体类别的逐步引入和学习，而无需访问旧类别的数据。其目标是同时保持新旧类别的识别能力，避免灾难性遗忘问题。</p></blockquote></li><li><p><strong>缓解灾难性遗忘的方法</strong>：</p><ul><li>强调类增量问题中的关键挑战——灾难性遗忘。概述知识蒸馏、L&amp;R方法、伪标签生成等解决方案，简要说明各自的优势。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>类增量NER中的关键挑战是灾难性遗忘，现有的主要解决方案包括知识蒸馏、L&amp;R方法、伪标签生成等。知识蒸馏通过传递先前模型的知识来保持旧类别的识别能力，而L&amp;R方法则通过合成数据增强训练，进一步缓解灾难性遗忘。</p></blockquote></li><li><p><strong>传统NER与类增量NER的对比</strong>：</p><ul><li>对比传统NER和类增量NER模型，突出类增量NER中灾难性遗忘的问题及其特殊性，如类标记不完整、类别冲突等。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>与传统的NER模型不同，类增量NER需要逐步适应新的实体类别，但往往无法访问旧类别的数据。这导致了特定的挑战，如灾难性遗忘、类别间的混淆以及高昂的重新标注成本。</p></blockquote></li></ol><h1>1.发展现状</h1><h2 id="1-1类增量学习">1. 1类增量学习</h2><p>随着深度学习技术的飞速发展，传统的持续学习和增量学习方法逐渐暴露出其在实际应用中的局限性。尤其在命名实体识别（NER）任务中，模型需要能够适应不断变化的输入数据和新增的实体类别。持续学习通常依赖于在所有任务或类别上进行重新训练，这不仅计算资源消耗巨大，还可能导致模型在引入新知识时遗忘已学的旧知识，产生<strong>灾难性遗忘</strong>（Catastrophic Forgetting）。</p><p>为了解决这一问题，类增量学习（CIL）应运而生。类增量学习是逐步取代传统持续学习和增量学习的一种方法，尤其在NER任务中表现得尤为重要。其目标是使模型在接触新的实体类别时，能够在不访问旧类别数据的情况下，仍然保持对旧类别的识别能力。这种能力使得类增量学习能够在不断引入新类别或任务时，避免重新训练全模型，节省计算资源，并有效克服灾难性遗忘的问题。</p><h3 id="1-1-1-传统学习方式的比较">1.1.1 传统学习方式的比较</h3><ul><li><strong>持续学习（Continual Learning）</strong>：持续学习指的是模型逐渐学习多个任务而不丧失对先前任务的记忆。其核心挑战在于如何在添加新知识的同时，保持对旧任务性能的稳定。然而，持续学习难以有效解决灾难性遗忘，尤其在跨领域或跨类别任务中，模型的表现往往会显著下降。</li><li><strong>增量学习（Incremental Learning）</strong>：增量学习与持续学习相似，但强调在不断接触新数据时逐步学习和改进。这种学习方式特别适用于数据快速增长且不可重复使用的场景。然而，增量学习同样面临对旧类别的遗忘问题，特别是在任务序列较长时，模型会逐渐失去对早期任务的记忆。</li><li><strong>终身学习（Lifelong Learning）</strong>：终身学习的理念是希望模型在整个生命周期内能够积累知识并应用于未来任务。这种学习方式更关注长期的知识积累与迁移，但与持续学习和增量学习类似，灾难性遗忘仍然是核心难题。</li></ul><p>这些学习方式的共同挑战在于<strong>灾难性遗忘</strong>（Catastrophic Forgetting），即模型在学习新任务时会遗忘掉已经学习过的旧任务或类别。因此，类增量学习在此基础上提出了专门应对灾难性遗忘的方法，特别适合那些需要逐步引入新类别的任务，如命名实体识别（NER）。</p><h3 id="1-1-2-NER任务中的类增量学习">1.1.2 NER任务中的类增量学习</h3><p>命名实体识别任务是信息抽取中的重要任务之一。传统的NER模型通常假设所有实体类别在训练阶段都是已知的，然而在实际应用中，新的实体类别可能会随着时间的推移不断出现。例如，在军事领域、医疗领域等专门的领域中，不断出现新的实体类型，这要求NER模型具备在不访问旧数据的情况下学习新实体的能力。</p><p>类增量NER的出现正是为了解决这一需求。与传统NER不同，类增量NER需要模型能够有效学习新类别，同时尽可能保留对旧类别的记忆。在这种场景中，类增量学习不仅要求模型具有良好的泛化能力，还必须较好地解决灾难性遗忘问题。</p><h2 id="1-2-类增量学习中缓解灾难性遗忘的方法">1.2 类增量学习中缓解灾难性遗忘的方法</h2><p>在类增量学习中，灾难性遗忘是最主要的挑战之一。模型在学习新任务时，往往会逐渐遗忘掉之前学习过的任务，尤其在没有访问旧数据的情况下。这种现象在NER任务中尤为显著，因为实体类别的重叠和相似性使得模型容易在识别新实体时丧失对旧实体的区分能力。</p><p>为了解决这一问题，研究者提出了多种方法来缓解灾难性遗忘，主要包括以下几种方法：</p><ul><li><strong>知识蒸馏（Knowledge Distillation）</strong>：知识蒸馏通过让新模型在训练时学习旧模型的输出，从而保留旧模型对旧任务的知识。对于类增量NER任务，知识蒸馏可以在引入新实体类别时，确保模型不会遗忘之前学习过的类别。蒸馏的方法通常是在模型训练过程中引入额外的损失函数，使得新模型的输出与旧模型的输出尽可能接近，从而保持对旧类别的识别能力。</li><li><strong>合成数据增强（Synthetic Data Augmentation）</strong>：合成数据增强是一种通过生成新的数据样本来增强模型泛化能力的方法。通过生成未标注的上下文文本并将其加入训练数据，模型可以在不需要访问旧数据的情况下学习到新的类别。合成数据增强的优势在于可以通过生成的上下文重新构建数据集，从而实现数据的多样化和丰富化，缓解数据不平衡和数据量不足的问题。</li><li><strong>伪标签生成（Pseudo-labeling）</strong>：伪标签生成通过使用现有模型预测未标注数据中的实体类别，从而生成带有标签的数据进行训练。在类增量NER任务中，伪标签生成可以帮助模型扩展数据集，增强对新类别的学习能力。这一方法的核心思想是使用模型预测新的实体类别，产生“伪标签”，并将这些带有伪标签的数据加入训练集中。</li><li><strong>学习与回顾（Learn &amp; Review, L&amp;R）</strong>：L&amp;R方法通过让模型在学习新类别的同时，定期回顾旧类别，从而确保模型不会忘记旧任务。在类增量NER中，L&amp;R方法通过使用合成数据进行回顾训练，使得模型能够在新类别的学习过程中保持对旧类别的记忆。该方法被证明比单纯的知识蒸馏更加有效，尤其在数据不平衡的情况下，能够显著提高模型的性能。</li></ul><p>这些方法各有侧重，但其共同目标是通过各种技术手段缓解类增量学习中的灾难性遗忘问题，从而使模型在面对新任务时，仍然能够保留旧任务的知识。</p><h2 id="1-3-传统NER与类增量NER的对比">1.3 传统NER与类增量NER的对比</h2><p>传统NER模型在训练时，通常假设所有的实体类别在训练过程中都是已知的。模型一旦训练完成，便无法再扩展新类别，除非重新训练整个模型。然而，在实际应用中，特别是在动态变化的环境中，新的实体类别会不断出现，这对传统NER模型提出了极大的挑战。</p><ul><li><strong>传统NER的局限性</strong>：传统NER模型在处理新增实体类别时往往表现不佳，原因在于它们无法增量学习新类别。此外，传统NER在引入新类别时，需要访问之前的训练数据，这在许多实际场景中是不现实的（例如，隐私数据无法存储或共享）。</li><li><strong>类增量NER的优势</strong>：类增量NER模型能够在不访问旧数据的情况下引入新的实体类别，同时保持对旧类别的识别能力。它通过知识蒸馏、伪标签生成和合成数据增强等技术手段，确保模型能够逐步学习新的实体类别，同时减少灾难性遗忘问题。与传统NER相比，类增量NER更具适应性，尤其在需要频繁更新和扩展类别的任务中。</li><li><strong>灾难性遗忘问题的特异性</strong>：类增量NER中的灾难性遗忘问题比其他任务更加复杂，因为实体类别之间的相似性更高。新增类别往往与旧类别存在一定的重叠或相似之处，导致模型在学习新类别时容易遗忘旧类别。此外，实体类别的数量和多样性也给模型带来了更大的学习难度。</li></ul><p>可见，类增量NER模型相较于传统NER模型在动态、变化的任务环境下具有更强的适应能力，同时其面临的灾难性遗忘问题也更加复杂，这使得现有的解决方案仍有进一步优化的空间。</p><p>二. 存在问题部分的修改</p><ol><li><p><strong>专注类增量NER特有的问题</strong>：</p><ul><li>去掉一些并不适用的问题，如“高昂的重新标注成本”等问题在类增量NER中相对不突出。重点讨论当前类增量NER的主要挑战，如灾难性遗忘、标签不完整、类别间冲突等。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>类增量NER主要面临的问题包括：1）灾难性遗忘，即旧类别的知识在引入新类别后容易丢失；2）标签不完整，导致未标注的实体被错误分类为非实体；3）类别间的混淆，新旧类别之间的重叠使模型难以区分。</p></blockquote></li><li><p><strong>增加少样本/零样本讨论</strong>：</p><ul><li>增加少样本和零样本学习在类增量NER中的重要性，并指出其解决的具体问题。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>类增量NER中，少样本和零样本学习也是一大挑战，模型需要在数据极少甚至没有标注数据的情况下学习新类别。这为NER系统的泛化能力提出了更高的要求，现有方法往往难以兼顾这一点。</p></blockquote></li></ol><h1>2.存在的问题</h1><p>类增量命名实体识别（NER）是一项复杂的任务，面临着在不断引入新实体类别时的诸多独特挑战。随着新实体的持续出现，模型不仅需要灵活适应这些变化，还必须保持对已学类别的准确识别。以下将详细讨论该领域当前存在的主要问题，并探讨这些问题与其他自然语言处理（NLP）任务中类增量学习的差异。这些分析有助于更清晰地理解类增量NER所面临的特定需求与挑战。</p><h2 id="2-1-灾难性遗忘问题">2.1 <strong>灾难性遗忘问题</strong></h2><p>灾难性遗忘是类增量学习中最为典型和显著的问题，也是类增量NER必须重点解决的核心挑战。模型在学习新实体类别时，容易遗忘掉之前已经学过的类别，这是由于在增量学习过程中，模型权重会调整为适应新任务，而使旧任务的权重被覆盖。这种现象在NER任务中尤为明显，因为实体类别之间的边界较模糊，新类别可能与旧类别存在高度相似性或重叠。</p><p><strong>现有问题：</strong></p><ul><li>类增量NER中的灾难性遗忘不仅影响实体类别的识别准确性，还可能导致模型对未标注类别的错误预测。例如，模型在学习一个新的“炸弹”实体时，可能会误将之前学到的“导弹”实体标记为非实体。</li><li>灾难性遗忘不仅导致对旧类别的遗忘，还可能引发类别混淆问题。模型可能在新类别学习过程中，将相似的旧类别混淆，例如将“军舰”和“航天设备”错误地视为同一类别。</li><li>现有的方法（如知识蒸馏、数据增强等）在一定程度上缓解了灾难性遗忘，但它们仍然依赖于模型对数据分布的良好掌握，且在数据稀少的情况下（如少样本或零样本条件下），效果有限。</li></ul><p><strong>可能的解决方案：</strong></p><ul><li><strong>多任务学习策略</strong>：通过并行学习多个任务或实体类别，以减少类别间的混淆和灾难性遗忘。</li><li><strong>增强型知识蒸馏</strong>：在类增量NER中，结合标签解释学习等方法，进一步优化知识蒸馏的效果，确保旧类别知识不会轻易丢失。</li><li><strong>动态模型更新机制</strong>：动态更新模型权重，赋予不同类别不同的重要性，从而减少对旧类别知识的遗忘。</li></ul><h2 id="2-2-标签不完整问题">2.2 <strong>标签不完整问题</strong></h2><p>传统的方法依赖于大量的标注数据，但在实际场景中，完整标注数据的获取成本高昂，尤其是随着类别的不断扩展，标注的难度和代价也随之增加。在类增量NER任务中，模型通常只能访问部分实体类别的数据，导致数据集存在标签不完整的情况。</p><p><strong>现有问题：</strong></p><ul><li>标签不完整导致模型在训练过程中对未标注的实体类别缺乏了解，进而影响对新实体的识别。在类增量场景下，模型可能会将未见过的实体标记为非实体，导致模型泛化能力下降。</li><li>标签不完整也加剧了类别间的不平衡问题。新加入的类别通常数据较少，而旧类别的数据更多，这种不均衡使得模型在训练时更容易倾向于识别旧类别，从而导致对新类别的识别能力不足。</li></ul><p><strong>可能的解决方案：</strong></p><ul><li><strong>伪标签生成</strong>：通过在未标注的数据中生成伪标签，使模型能够在有限的标注数据基础上进一步扩展数据集，弥补标签不完整的缺陷。</li><li><strong>数据增强和合成数据</strong>：使用合成数据生成器生成更多样化的训练样本，帮助模型在标签不完整的情况下更好地捕捉新类别的特征。</li></ul><h2 id="2-3-类别不平衡和冲突问题">2.3 <strong>类别不平衡和冲突问题</strong></h2><p>J</p><p>随着新类别的加入，旧类别的数据量往往远多于新类别。而类别冲突问题则主要体现在不同类别之间可能存在重叠，导致模型在区分相似类别时出现困扰。</p><p><strong>现有问题：</strong></p><ul><li>类别不平衡容易导致模型偏向于预测频率较高的旧类别，而忽视新类别，特别是在新类别的数据非常少的情况下。模型会对大类别过拟合，而对小类别欠拟合。</li><li>类别冲突加剧了类别之间的混淆。例如，在军事领域，“导弹”和“炸弹”可能在文本中表现出相似的上下文，导致模型在识别时难以区分。</li><li>现有的NER模型通常假设类别之间是完全独立的，但在类增量学习中，类别之间往往有一定的关联性，模型需要具备区分相似类别的能力。</li></ul><p><strong>可能的解决方案：</strong></p><ul><li><strong>数据重采样和权重调整</strong>：通过对少数类进行过采样，或者对不同类别分配不同的权重，以缓解类别不平衡问题。</li><li><strong>类间对比学习</strong>：采用对比学习方法，帮助模型更好地理解相似类别之间的区别，减少类别冲突带来的影响。</li></ul><h2 id="2-4-少样本学习问题">2.4 <strong>少样本学习问题</strong></h2><p>模型在引入新的实体类别时，通常只有极少的数据，甚至没有任何标注数据。这种数据极少的情况在类增量学习中非常常见，尤其是对于不断扩展的实体类别集合，标注成本高昂且数据获取难度大。</p><p><strong>现有问题：</strong></p><ul><li>少样本问题导致模型无法有效地学习新实体类别的特征，这对于识别那些在训练中从未见过或见过很少样本的新实体来说，尤其困难。</li><li>现有的NER方法通常需要大量标注数据进行训练，因此在少样本或零样本条件下，传统的监督学习方法表现不佳。</li><li>类增量NER在这种情况下必须依赖于迁移学习或其他数据扩展技术，但这些技术在新类别的泛化能力上仍有局限。</li></ul><p><strong>可能的解决方案：</strong></p><ul><li><strong>基于迁移学习的少样本学习</strong>：通过迁移学习将旧类别的知识迁移到新类别上，从而实现少样本甚至零样本的NER任务。</li><li><strong>基于生成模型的合成数据</strong>：使用生成模型创建合成数据，尤其是针对少样本或零样本条件下的数据不足问题，增强模型的泛化能力。</li></ul><h2 id="2-5-过拟合问题">2.5 <strong>过拟合问题</strong></h2><p>在类增量NER任务中，过拟合问题常常由于数据不平衡、类别间相似性高等因素被进一步放大，模型在学习过程中可能会过度依赖特定的类别特征，导致在测试阶段的泛化能力下降。</p><p><strong>现有问题：</strong></p><ul><li>新类别数据量通常较少，而旧类别数据量较多，模型容易在旧类别上过拟合。特别是在类增量学习中，模型不断扩展类别，而每次新增的数据量非常有限，这使得模型容易学习到新类别的噪声特征，而忽略其一般化特征。</li><li>在标签不平衡或类别冲突较为明显的情况下，模型会更倾向于记住某些特定的类别特征，进而丧失对整体数据分布的把控。</li></ul><p><strong>可能的解决方案：</strong></p><ul><li><p><strong>正则化技术</strong>：通过引入额外的正则化项来限制模型的复杂性，避免过拟合。L2正则化和dropout技术在一定程度上可以缓解此问题。</p></li><li><p><strong>早停法</strong>：通过观察模型在验证集上的性能，尽早停止训练，避免模型在训练数据上过拟合。</p></li></ul><p>综上，类增量NER面临的主要挑战包括灾难性遗忘、标签不完整、类别不平衡、类别冲突、少样本学习以及模型过拟合等。这些问题在与其他NLP任务的类增量学习相比时显得更加复杂且独特，必须针对这些问题提出专门的解决方案。通过结合现有的技术（如知识蒸馏、伪标签生成、合成数据增强等）以及创新的模型设计，有望有效应对这些挑战，并在类增量NER中取得更好的结果。</p><p>三. 理论方法描述的修改</p><ol><li><p><strong>强调少样本条件下的类增量NER方法</strong>：</p><ul><li>重点描述本文提出的方法在少样本条件下如何应对类增量NER中的灾难性遗忘问题。清晰地指出哪一种方法解决了上面提到的哪一个具体问题。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>本研究提出了在少样本条件下有效的类增量NER方法，旨在解决以下问题：通过L&amp;R方法和知识蒸馏，缓解灾难性遗忘；通过伪标签生成和数据增强，提高对新类别的识别能力，即使在数据极少的情况下。</p></blockquote></li></ol><h1>3.理论背景</h1><h2 id="3-1-类增量NER背景与挑战">3.1 类增量NER背景与挑战</h2><p>随着信息提取任务在自然语言处理（NLP）中的重要性日益增加，命名实体识别（NER）任务作为信息抽取的核心任务之一，面临着越来越复杂的应用场景。在动态变化的环境中，如军事、医学或社交媒体等领域，新实体类别的不断涌现使得传统NER模型难以应对。传统的NER模型通常假设在训练阶段可以接触到所有实体类别的数据，而在部署后无法轻易适应新的类别，且会遗忘旧类别知识。这些限制在实际应用中显得尤为突出，特别是在标注数据有限的少样本条件下。</p><p>类增量学习通过逐步引入新类别的方式来克服这一局限，允许模型在学习新类别的同时保持对旧类别的认知。然而，类增量NER任务中最主要的挑战包括<strong>灾难性遗忘</strong>、<strong>标签不完整</strong>、<strong>类别不平衡</strong>和<strong>少样本/零样本学习问题</strong>。这些问题使得模型在逐步扩展新类别时，容易忘记旧类别或无法有效泛化新类别的特征。</p><h2 id="3-2-解决思路">3.2 解决思路</h2><p>本文旨在针对类增量NER中的上述挑战，提出一种基于少样本条件下的类增量NER模型训练方法。该方法通过结合知识蒸馏、伪标签生成、合成数据增强等技术手段，从各方面缓解灾难性遗忘问题，增强新类别的识别能力，特别是在少样本甚至零样本的情况下。具体解决方案如下：</p><ul><li><strong>灾难性遗忘</strong>：通过知识蒸馏，将旧类别知识转移到新模型中，确保在学习新类别时不丢失对旧类别的记忆。</li><li><strong>少样本学习</strong>：通过伪标签生成和合成数据增强，扩展少量的新类别样本，增加模型对新类别的泛化能力，特别是在数据稀缺或无法获取大量标注数据的场景中。</li><li><strong>标签不完整与类别不平衡</strong>：通过生成伪标签和合成数据，解决数据集中由于标签不完整或类别数据不平衡引发的偏差问题，使模型在面对不同类别时表现更加均衡。</li></ul><h2 id="3-3-理论框架">3.3 理论框架</h2><h3 id="3-3-1-少样本学习">3.3.1 少样本学习</h3><p>少样本学习（Few-shot Learning，FSL）是指在仅有极少数据样本的情况下，模型仍能够对新任务进行有效学习的能力。少样本学习的理论基础源于迁移学习和元学习，其目标是通过从已有任务中学习到的知识迁移或泛化到新的任务上，以减少对大量标注数据的需求。</p><p>在本文中，少样本学习的理论与类增量NER结合起来，主要目的是在引入新类别时，由于标注成本高、数据稀缺，模型能够通过少量样本或零样本数据学习到新实体类别的特征。同时，通过结合伪标签生成与数据增强的方法，扩展现有的训练数据，从而进一步提高模型在少样本条件下的泛化能力。</p><h3 id="3-3-2-知识蒸馏">3.3.2 知识蒸馏</h3><p>知识蒸馏（Knowledge Distillation）是一种将复杂模型（教师模型）的知识传递给更简单模型（学生模型）的方法。在类增量学习中，知识蒸馏的作用是通过将旧模型的知识传递到新模型，防止新模型在学习新类别时遗忘之前的类别知识。</p><p>在本文中，知识蒸馏被用于缓解类增量NER中的灾难性遗忘问题。通过对旧类别的知识进行蒸馏，使新模型能够在学习新类别时，仍然保持对旧类别的识别能力。这一过程通过引入额外的损失函数，强制新模型的输出与旧模型一致，从而减少旧类别的知识遗忘。特别是在少样本条件下，知识蒸馏不仅有助于保持旧类别的记忆，还能帮助模型更有效地利用新类别的有限数据。</p><p>针对<strong>灾难性遗忘问题</strong>，知识蒸馏是解决灾难性遗忘的核心方法之一，通过在模型训练时保留旧类别的知识，防止新类别学习时的知识覆盖；针对<strong>标签不完整问题</strong>，通过蒸馏旧类别的知识，模型在新数据缺少旧类别标签的情况下，也能维持对旧类别的较高识别能力。</p><h3 id="3-3-3-合成数据增强">3.3.3 合成数据增强</h3><p>合成数据增强（Synthetic Data Augmentation）是通过生成合成样本来扩展训练数据集的一种技术，通常用于应对数据稀缺和类别不平衡问题。合成数据增强通过训练生成模型（如LSTM或GPT）生成与原始数据分布类似的合成数据，并将其用于训练，以提高模型的泛化能力。</p><p>本文中合成数据增强主要用于少样本条件下的数据扩展和类别平衡。通过生成未标注的上下文或样本，模型可以在没有大量标注数据的情况下继续学习新类别的特征。这种方法不仅增加了新类别的样本数量，也使得模型对新类别的学习更加全面，进而减轻类别不平衡带来的影响。</p><p>针对<strong>类别不平衡问题</strong>，合成数据增强通过生成更多的新类别数据，弥补了数据不平衡的现象，使模型在训练时不会偏向旧类别；针对<strong>少样本学习问题</strong>，通过合成与新类别相关的上下文数据，模型可以在数据不足的情况下进行更充分的学习，提升对新类别的识别能力。</p><p>J——标签解释学习</p><h3 id="3-3-4-伪标签生成">3.3.4 伪标签生成</h3><p>伪标签生成（Pseudo-labeling）是一种半监督学习方法，常用于少样本学习中。其基本思路是利用现有模型预测未标注数据的标签，生成伪标签，并将这些带有伪标签的数据加入到训练集中，从而扩展数据集规模。</p><p>本文利用伪标签生成用于扩展少样本数据集，特别是在新实体类别数据稀缺的情况下。通过使用已训练模型预测未标注数据中的实体类别，将生成的伪标签与真实标注的数据混合使用，增强模型对新类别的泛化能力。这样可以有效缓解类增量NER中由于数据不足带来的问题。</p><p>针对<strong>少样本学习问题</strong>，伪标签生成通过在新类别上生成更多带伪标签的数据，扩大了数据集的规模，有效提高了模型在少样本条件下的学习能力；针对<strong>标签不完整问题</strong>，当新数据缺少部分实体类别的标注时，伪标签生成可以补全这些缺失的标签，从而提高模型的学习效果。</p><h3 id="3-3-5-学习与回顾（L-R）">3.3.5 学习与回顾（L&amp;R）</h3><p>通过模拟人类通过不断复习旧知识来加深记忆的机制，在每个增量学习阶段结束后，通过回顾旧类别的知识，帮助模型保持对旧类别的认知。在学习新类别数据之后，模型会在增强后的数据集上进行再次训练，以重新强化对旧类别的记忆。</p><p>学习与回顾（L&amp;R）策略不仅通过系统的复习和强化训练缓解了灾难性遗忘问题，还通过丰富的训练数据支持了少样本学习的有效性。这种结合使得模型在增量学习过程中更加灵活和稳健，能够在新旧类别之间实现良好的平衡。</p><h2 id="3-4-理论方法总结">3.4 理论方法总结</h2><p>本文提出了一种综合知识蒸馏、伪标签生成、合成数据增强和L&amp;R的类增量NER方法，重点解决类增量NER任务中的灾难性遗忘和少样本学习问题。</p><p>具体而言，模型在每个增量阶段的学习过程中，首先通过<strong>知识蒸馏</strong>保持对旧类别的认知，避免灾难性遗忘；然后使用<strong>伪标签生成</strong>来扩展少量的新类别数据，增加数据规模；最后，通过<strong>合成数据增强</strong>进一步增加数据集的多样性和数量，缓解类别不平衡及少样本问题。</p><h2 id="3-5-创新与贡献">3.5 创新与贡献</h2><p>本文将少样本学习与类增量NER任务中的灾难性遗忘问题结合，通过多种数据扩展和增强技术，提出了一种适用于少样本场景下的类增量NER解决方案。</p><p>相比于传统方法，本研究的模型在少样本和零样本条件下表现更为优越，解决了实际应用中常见的数据稀缺和标签不完整的问题，具有重要的实践价值。</p><p>四. 研究方法设计思路的修改</p><ol><li><p><strong>引入人脑学习机制的类比</strong>：</p><ul><li>增强设计思路的阐述，结合人脑学习机制，提升理论高度。通过说明不同策略如何从不同角度缓解灾难性遗忘，进一步提高该段内容的深度。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>我们的方法设计基于人脑的学习机制：知识蒸馏类似于人类在学习新信息时通过复习巩固旧知识，而伪标签生成和L&amp;R策略则像人类在新情境下通过联想和类比进行推理和归纳，从而提高对新知识的记忆和泛化能力。</p></blockquote></li><li><p><strong>解释各策略的作用</strong>：</p><ul><li>详细说明不同策略（L&amp;R、伪标签生成、数据增强）是如何从不同角度缓解灾难性遗忘问题的。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>我们在知识蒸馏的基础上，分别通过L&amp;R策略复习旧类别的知识，通过伪标签生成扩展少样本数据集，通过合成数据增强整体数据的丰富性。每种策略都从不同角度针对灾难性遗忘进行缓解，确保模型在引入新类别时保持对旧类别的认知。</p></blockquote></li></ol><h1>4. 研究方法设计思路</h1><p>通过结合<strong>人脑学习机制的类比</strong>，我们提出了一种基于<strong>少样本条件下的类增量NER方法</strong>。该方法的核心思想是从人类学习的过程汲取灵感，设计多种策略以缓解类增量学习中的<strong>灾难性遗忘</strong>、<strong>少样本学习</strong>、<strong>标签不完整</strong>及<strong>类别不平衡</strong>等问题。我们使用了<strong>知识蒸馏</strong>、<strong>伪标签生成</strong>、<strong>合成数据增强</strong>和**学习与回顾（L&amp;R）**策略，以确保模型在逐步引入新类别时，能够同时保留旧类别的知识，且在少样本条件下具备较好的泛化能力。</p><h2 id="4-1-人脑学习机制">4.1 <strong>人脑学习机制</strong></h2><p>人类学习新知识时通常依赖于复习旧知识、推理和联想，以及构建假设场景来提升记忆和理解能力。类比于此，我们的方法设计通过以下几个方面模拟了人脑学习的过程：</p><ul><li><strong>知识蒸馏</strong>：这一策略类似于人类在学习新知识时通过不断复习来巩固已学知识。通过知识蒸馏，我们将旧模型的知识传递给新模型，确保新模型在学习新类别的同时，不会遗忘旧类别。就像人类通过复习保持对旧知识的记忆一样，知识蒸馏使得模型在新旧类别的学习中达到平衡。</li><li><strong>伪标签生成</strong>：伪标签生成则类似于人类通过联想和推理在不完全信息的情况下进行推测。当人类面对不确定的情境时，往往通过联想和类比做出预测和判断。伪标签生成通过已训练模型预测未标注数据中的实体类别，扩展数据集，帮助模型在少样本或零样本条件下提升对新类别的识别能力。</li><li><strong>学习与回顾（L&amp;R）策略</strong>：L&amp;R策略模拟了人类通过反复回顾来提升记忆的过程。人类在学习新知识时，通常通过回顾之前学过的内容来增强记忆和理解。L&amp;R策略在训练过程中，通过回顾旧类别的知识，帮助模型保持对旧类别的认知，并确保新旧类别的平衡。</li></ul><p>本文提出了在<strong>少样本条件下的类增量NER方法</strong>，旨在解决类增量NER任务中的<strong>灾难性遗忘</strong>、<strong>少样本学习</strong>、<strong>标签不完整</strong>及<strong>类别不平衡</strong>等问题。我们的研究方法主要包括三个核心步骤：知识蒸馏（Knowledge Distillation）、伪标签生成（Pseudo-labeling）和合成数据增强（Synthetic Data Augmentation），并在这些方法的基础上结合**学习与回顾（Learn &amp; Review, L&amp;R）**框架，逐步构建类增量NER模型。</p><h2 id="4-2-框架设计">4.2 <strong>框架设计</strong></h2><p>为了验证我们所提出方法的有效性，本文使用了一个分步的增量学习框架。在每一阶段中，模型将逐步接触新的实体类别，并学习在少量标注数据或零样本情况下识别新类别。同时，在不访问旧类别数据的前提下，模型通过知识蒸馏、伪标签生成和合成数据增强技术，缓解对旧类别的遗忘。</p><p>核心思想是通过多步训练和逐步引入新类别，使模型具备类增量学习的能力，并能够在每次学习新类别时保持对旧类别的记忆能力，尤其在少样本条件下提升模型的泛化性能。</p><p>为了解决类增量NER任务中的核心问题，特别是灾难性遗忘和少样本学习，本研究设计了以下几种方法：</p><h3 id="4-2-1知识蒸馏">4.2.1<strong>知识蒸馏</strong></h3><p>知识蒸馏的核心作用是<strong>缓解灾难性遗忘</strong>。通过将旧模型对旧类别的知识蒸馏给新模型，使新模型能够在学习新类别的同时，保留对旧类别的记忆。蒸馏过程确保了新模型输出与旧模型在旧类别上的输出保持一致，从而避免了新知识覆盖旧知识的情况。通过这种方法，模型能够有效地在逐步引入新类别的过程中保留旧类别的识别能力。</p><p>训练过程中，旧模型的输出（即对旧类别的预测分布）被用作教师模型。新模型通过优化目标函数，使其在学习新类别的同时，保持输出与旧模型对旧类别的预测相一致。</p><p>==+图==</p><p>损失函数包含两部分：一是用于学习新类别的标准交叉熵损失，二是用于保持旧类别知识的蒸馏损失，后者通过缩小新旧模型在旧类别上的预测差异来实现。</p><p>对于每一个新类别的学习，模型的总损失函数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">w</mi></mrow></msub><mo>+</mo><mi>λ</mi><mo>⋅</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L=L_\mathrm{new}+\lambda\cdot L_\mathrm{distill}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">new</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">distill</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_\mathrm{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">new</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是针对新类别的标准交叉熵损失，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_\mathrm{distill}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">distill</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是针对旧类别知识的蒸馏损失，λ 是平衡这两者的系数。</p><p>通过知识蒸馏，模型可以有效保持旧模型对旧类别的识别能力，在学习新类的同时保留旧类的特性，可以很好地缓解由于安全性或存储问题使得数据对模型不可见导致的灾难性遗忘问题。</p><h3 id="4-2-2-合成数据增强">4.2.2 <strong>合成数据增强</strong></h3><p>合成数据增强通过生成与新类别相关的合成样本来解决<strong>类别不平衡和少样本学习问题</strong>。通过LSTM生成式模型生成与新类别相关的未标注上下文或样本，将这些合成数据添加到训练集中，使得模型能够接触到更多的新类别样本，从而平衡新旧类别的数据分布。这种方法类比于人类在理解新知识时，构建假设场景进行模拟学习，从而提升记忆和理解能力。</p><p>本文我们训练一个LSTM生成模型，旨在生成与新类别相关的未标注上下文或样本。通过训练LSTM模型，我们能够捕捉到数据集中的潜在模式，从而生成符合原始数据分布的合成文本。这些文本中包含与新类别相关的实体。而后将这些合成样本与真实标注数据和伪标签数据结合，形成增强后的训练集。最后使用包含合成数据的训练集，进一步训练当前模型，提高模型对新类别的适应能力。</p><p>首先，使用原始数据集进行LSTM模型的训练。通过大量的历史上下文数据，LSTM能够学习到不同实体类别的特征和相互关系。训练完成后，LSTM模型能够生成与新类别相关的文本。这些合成文本将包含新类别的实体，从而扩展模型的训练样本。</p><p>通过LSTM模型生成的未标注数据：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mtext>synthetic</mtext></msub><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mtext>synthetic</mtext></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_{\text{synthetic}}=\{(x_{\text{synthetic}})\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">synthetic</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">{(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">synthetic</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)}</span></span></span></span></span></p><p>在生成合成样本后，我们将这些合成数据与真实标注数据和伪标签数据结合，形成增强后的训练集：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>D</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><msub><mi>D</mi><mtext>labeled</mtext></msub><mo>∪</mo><msub><mi>D</mi><mtext>synthetic</mtext></msub></mrow><annotation encoding="application/x-tex">D^{\prime}=D_\text{labeled}\cup D_\text{synthetic}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">labeled</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">synthetic</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mtext>labeled</mtext></msub></mrow><annotation encoding="application/x-tex">D_\text{labeled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">labeled</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是真实标注数据集,$ D_\text{synthetic}$是生成的文本数据。</p><p>针对类别不平衡问题，合成数据增强通过生成更多的新类别样本，有效缓解了类别不平衡的问题。新类别的合成样本数量显著增加，使得模型在训练时不至于过于偏向于旧类别，确保每个类别都能得到足够的关注，这种平衡的训练数据分布促使模型能够更好地学习新类别的特征，提升对各类别的识别能力。</p><p>针对少样本学习问题，合成数据的生成为新类别提供了额外的样本支持。即使在标注数据稀缺的情况下，生成的合成样本依然能够帮助模型学习到新类别的有效特征。通过构建与新类别相关的上下文数据，模型能够在数据不足的情况下进行更充分的学习，提升对新类别的识别能力。这一过程类似于人类在理解新知识时，通过构建假设场景进行模拟学习，从而增强记忆和理解能力。</p><p>J——标签解释学习</p><h3 id="4-2-3-伪标签生成">4.2.3 <strong>伪标签生成</strong></h3><p>伪标签生成通过预测未标注数据中的实体类别并为其生成伪标签，扩大数据集规模。模型会使用前一阶段训练好的模型来预测新类别数据的伪标签，并将这些伪标签数据与少量标注数据混合，作为当前阶段的训练集。这种方法特别适用于少样本或零样本的场景，类似于人类通过联想和推理进行推测，伪标签生成为模型提供了额外的数据资源，扩展了训练集规模。</p><p>针对新类别的少量标注数据，首先使用前一阶段的模型$ M_{k-1}$预测未标注数据中的潜在实体，并生成伪标签。给定输入数据 x，模型预测的伪标签 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span> 可以表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">o</mi></mrow></msub><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo stretchy="false">)</mo><mo>∣</mo><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><msub><mi>M</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">D_{\mathrm{pseudo}}=\{(x,\hat{y})\mid\hat{y}=M_{k-1}(x)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pseudo</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)}</span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mtext>pseudo</mtext></msub></mrow><annotation encoding="application/x-tex">D_\text{pseudo}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">pseudo</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>是伪标签数据，包含了未标注样本及其对应的伪标签。</p><p>将伪标签数据与真实标注数据结合，形成增强版的训练集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">D^{\prime\prime}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span>。训练模型时，使用伪标签扩展数据集，提升模型对新类别的识别能力。</p><p>然后结合标注数据集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mtext>labeled</mtext></msub></mrow><annotation encoding="application/x-tex">D_\text{labeled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">labeled</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>D</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>=</mo><msub><mi>D</mi><mtext>labeled</mtext></msub><mo>∪</mo><msub><mi>D</mi><mtext>pseudo</mtext></msub></mrow><annotation encoding="application/x-tex">D^{\prime\prime}=D_{\text{labeled}}\cup D_{\text{pseudo}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">labeled</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">pseudo</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>使用增强后的数据集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">D^{\prime\prime}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span>训练新的模型 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">M_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，使得模型能够接触到新类别的多种表示方式。</p><p>在训练过程中，损失函数应同时考虑真实标注数据和伪标签数据的贡献。损失函数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>+</mo><mi>α</mi><msub><mi>L</mi><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">o</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L=L_{\mathrm{labeled}}+\alpha L_{\mathrm{pseudo}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">labeled</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pseudo</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_{\mathrm{labeled}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">labeled</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是针对真实标注数据的损失，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">o</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_{\mathrm{pseudo}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pseudo</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>是针对伪标签数据的损失,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>为超参数，确保模型不仅从标注数据中学习，还能从生成的伪标签中获取有价值的信息。</p><p>伪标签生成通过生成额外的伪标注数据，极大扩展了可供训练的数据集，帮助模型在数据稀缺的情况下学习新类别的特征。这种方法使得即使在少量标注样本的情况下，模型也能获得更多的训练数据，提升对新类别的识别能力。同时有效填补了数据集中未标注部分，确保模型在学习新类别时能够更全面地学习到不同的特征。这种填补使得模型可以在有限的标注数据下，更好地捕捉新类别的多样性。</p><h3 id="4-2-4-学习与回顾">4.2.4 <strong>学习与回顾</strong></h3><p>L&amp;R策略通过模仿人类的复习过程，基于<strong>回顾旧知识</strong>的增量学习策略。在每一阶段的学习过程中，模型不仅学习新类别的数据，通过定期回顾旧类别的数据或知识进行“复习”。这种策略通过在回顾阶段使用合成数据和伪标签数据，帮助模型保持对旧类别的记忆，确保模型在引入新类别时仍然能够正确识别旧类别。在本文中，L&amp;R策略与知识蒸馏、伪标签生成和合成数据增强相结合，提升了模型对新类别和旧类别的适应能力。</p><p>模型训练可以分为两个阶段：</p><p>1.<strong>学习阶段</strong>：模型首先在当前阶段的新类别数据上进行训练，并通过知识蒸馏学习旧类别的知识。训练目标是使模型尽可能准确地学习新类别，并通过引入<strong>蒸馏损失函数</strong>来保持对旧类别的记忆。</p><p>学习阶段的损失函数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msub><mo>=</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">w</mi></mrow></msub><mo>+</mo><mi>λ</mi><mo>⋅</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_\mathrm{total}=L_\mathrm{new}+\lambda\cdot L_\mathrm{distill}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">total</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">new</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">distill</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_\mathrm{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">new</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示新类别的交叉熵损失，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_\mathrm{distill}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">distill</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示旧模型（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">M_{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>）与当前模型（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">M_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>）之间的蒸馏损失，λ是平衡新知识学习与旧知识保留的权重。</p><p>2.<strong>回顾阶段</strong>：在学习完新类别后，L&amp;R策略通过合成数据增强和伪标签生成，构建一个更为丰富的训练集，帮助模型复习旧类别的知识。</p><p>增强的数据集包括两部分：合成数据和伪标签数据。通过LSTM生成模型生成的未标注上下文合成数据，使得模型在接触到新类别的同时，也能重新接触到旧类别的上下文信息。同时使用现有模型预测的未标注数据，生成带有伪标签的旧类别数据，扩大旧类别数据集规模。</p><p>回顾阶段的损失函数为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">w</mi></mrow></msub><mo>=</mo><msub><mi>L</mi><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>+</mo><mi>α</mi><mo>⋅</mo><msub><mi>L</mi><mtext>distill-old</mtext></msub></mrow><annotation encoding="application/x-tex">L_{\mathrm{review}}=L_{\mathrm{augmented}}+\alpha\cdot L_{\text{distill-old}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">review</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">augmented</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">distill-old</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mtext>augmented</mtext></msub></mrow><annotation encoding="application/x-tex">L_{\text{augmented}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">augmented</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>在增强数据集（合成数据+伪标签数据）上计算的损失，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mtext>distill-old</mtext></msub></mrow><annotation encoding="application/x-tex">L_{\text{distill-old}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">distill-old</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是基于旧类别的蒸馏损失，α是权衡回顾损失和蒸馏损失的超参数。</p><p>通过回顾旧知识，模拟人类的学习行为，不仅依赖于知识蒸馏，还通过直接复习旧类别的数据，主动学习强化对旧类别的记忆，并减少新类别学习过程中旧知识的丢失。</p><h2 id="4-3-创新点">4.3 <strong>创新点</strong></h2><p>本文的方法设计通过模拟人脑的学习机制，主要从两方面解决类增量NER中的主要问题。具体的设计思路和创新点包括：</p><ol><li><strong>从不同角度缓解灾难性遗忘</strong>：</li></ol><ul><li><strong>知识蒸馏</strong>通过传递旧类别的知识，有效防止新知识覆盖旧知识，确保模型在学习新类别时，不会遗忘旧类别。</li><li><strong>L&amp;R策略</strong>通过复习旧类别知识，进一步强化模型对旧类别的记忆，避免模型在增量学习过程中丧失对旧类别的识别能力。</li></ul><ol start="2"><li><strong>提升少样本学习的泛化能力</strong>：</li></ol><ul><li><strong>伪标签生成</strong>通过在少样本条件下生成伪标注数据，扩展了新类别的数据集，帮助模型在标注数据不足的情况下，提升对新类别的学习效果。</li><li><strong>合成数据增强</strong>则通过生成更多的合成样本，有效缓解了类别不平衡和少样本问题，使模型能够接触到更多的训练数据，提升对新类别的泛化能力。</li></ul><p>本研究的<strong>创新点</strong>在于通过结合多种策略，模拟人类的学习与记忆机制，有效解决了类增量NER中的灾难性遗忘和少样本问题。这种方法不仅从理论上提升了模型对新旧类别的平衡能力，在实践中也展现出较强的适应性，能够在数据稀缺的情况下保持对新类别的良好学习效果。</p><p>五.实验设计</p><ol><li><p><strong>标签解释学习作为增强策略</strong>：</p><ul><li>在标签解释学习部分，强调其与知识蒸馏的结合，作为增强型策略应用于类增量NER。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>标签解释学习可以作为知识蒸馏的增强策略，通过使用标签的语义进行迁移学习，使模型能够更好地理解和区分新类别。</p></blockquote></li></ol><p>六. 文献引用的逻辑组织</p><ol><li><p><strong>调整文献引用的顺序和逻辑</strong>：</p><ul><li>文献引用部分需要根据实际论述的逻辑顺序进行重新组织，避免文献堆砌，确保每一篇文献的引用都能够自然引出后续的论点和讨论。</li></ul><p><strong>修改示例</strong>：</p><blockquote><p>相关工作引用部分，可以按照知识蒸馏、L&amp;R、伪标签生成、数据增强等方法的提出与演进顺序组织文献，确保逻辑连贯。</p></blockquote></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaWeb学习笔记</title>
      <link href="/2024/09/14/JAVA/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/09/14/JAVA/JavaWeb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1>HTML</h1>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter13/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter13/index/</url>
      
        <content type="html"><![CDATA[<h1>总体技术体系梳理</h1><p><img src="./images/img001.png" alt="images"></p><p><a href="../chapter11/index.html">上一章</a> <a href="../index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/index/</url>
      
        <content type="html"><![CDATA[<h1>JavaWeb教程目录</h1><p><a href="chapter01/index.html">第一章 Web开发概述</a></p><p><a href="chapter02/index.html">第二章 HTML&amp;CSS</a></p><p><a href="chapter03/index.html">第三章 JavaScript</a></p><p><a href="chapter04/index.html">第四章 Vue.js</a></p><p><a href="bookstore01/index.html">书城项目第一阶段</a></p><p><a href="chapter05/index.html">第五章 Tomcat</a></p><p><a href="chapter06/index.html">第六章 HTTP</a></p><p><a href="chapter07/index.html">第七章 Servlet</a></p><p><a href="bookstore02/index.html">书城项目第二阶段</a></p><p><a href="chapter08/index.html">第八章 Thymeleaf</a></p><p><a href="bookstore03/index.html">书城项目第三阶段</a></p><p><a href="chapter09/index.html">第九章 会话控制</a></p><p><a href="bookstore04/index.html">书城项目第四阶段</a></p><p><a href="chapter10/index.html">第十章 Filter</a></p><p><a href="bookstore05/index.html">书城项目第五阶段</a></p><p><a href="chapter11/index.html">第十一章 Listener</a></p><p><a href="chapter12/index.html">第十二章 axios Ajax</a></p><p><a href="bookstore06/index.html">书城项目第六阶段</a></p><p><a href="../index.html">返回上一级目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/index/</url>
      
        <content type="html"><![CDATA[<!doctype html><html><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><title>index</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }.mac-os-11 { --title-bar-height:28px; }html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }iframe { margin: auto; }a.url { word-break: break-all; }a:active, a:hover { outline: 0px; }.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }#write.first-line-indent p { text-indent: 2em; }#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }#write.first-line-indent li { margin-left: 2em; }.for-image #write { padding-left: 8px; padding-right: 8px; }body.typora-export { padding-left: 30px; padding-right: 30px; }.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }.typora-export .task-list-item input { pointer-events: none; }@media screen and (max-width: 500px) {  body.typora-export { padding-left: 0px; padding-right: 0px; }  #write { padding-left: 20px; padding-right: 20px; }  .CodeMirror-sizer { margin-left: 0px !important; }  .CodeMirror-gutters { display: none !important; }}#write li > figure:last-child { margin-bottom: 0.5rem; }#write ol, #write ul { position: relative; }img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }button, input, select, textarea { color: inherit; font: inherit; }input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }*, ::after, ::before { box-sizing: border-box; }#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }p { line-height: inherit; }h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }p { orphans: 4; }h1 { font-size: 2rem; }h2 { font-size: 1.8rem; }h3 { font-size: 1.6rem; }h4 { font-size: 1.4rem; }h5 { font-size: 1.2rem; }h6 { font-size: 1rem; }.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }.hidden { display: none; }.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }a { cursor: pointer; }sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }figure > table { margin: 0px; }tr { break-inside: avoid; break-after: auto; }thead { display: table-header-group; }table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }table.md-table td { min-width: 32px; }.CodeMirror-gutters { border-right: 0px; background-color: inherit; }.CodeMirror-linenumber { user-select: none; }.CodeMirror { text-align: left; }.CodeMirror-placeholder { opacity: 0.3; }.CodeMirror pre { padding: 0px 4px; }.CodeMirror-lines { padding: 0px; }div.hr:focus { cursor: none; }#write pre { white-space: pre-wrap; }#write.fences-no-line-wrapping pre { white-space: pre; }#write pre.ty-contain-cm { white-space: normal; }.CodeMirror-gutters { margin-right: 4px; }.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }#write .md-fences.mock-cm { white-space: pre-wrap; }.md-fences.md-fences-with-lineno { padding-left: 0px; }#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }.CodeMirror-line, twitterwidget { break-inside: avoid; }.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }.footnotes + .footnotes { margin-top: 0px; }.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }li div { padding-top: 0px; }blockquote { margin: 1rem 0px; }li .mathjax-block, li p { margin: 0.5rem 0px; }li blockquote { margin: 1rem 0px; }li { margin: 0px; position: relative; }blockquote > :last-child { margin-bottom: 0px; }blockquote > :first-child, li > :first-child { margin-top: 0px; }.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }#write .footnote-line { white-space: pre-wrap; }@media print {  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }  .typora-export * { -webkit-print-color-adjust: exact; }  .typora-export #write { break-after: avoid; }  .typora-export #write::after { height: 0px; }  .is-mac table { break-inside: avoid; }}.footnote-line { margin-top: 0.714em; font-size: 0.7em; }a img, img a { cursor: pointer; }pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }p > .md-image:only-child { display: inline-block; width: 100%; }#write .MathJax_Display { margin: 0.8em 0px 0px; }.md-math-block { width: 100%; }.md-math-block:not(:empty)::after { display: none; }.MathJax_ref { fill: currentcolor; }[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }.md-task-list-item { position: relative; list-style-type: none; }.task-list-item.md-task-list-item { padding-left: 0px; }.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }.math { font-size: 1rem; }.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }.md-toc-content { position: relative; margin-left: 0px; }.md-toc-content::after, .md-toc::after { display: none; }.md-toc-item { display: block; color: rgb(65, 131, 196); }.md-toc-item a { text-decoration: none; }.md-toc-inner:hover { text-decoration: underline; }.md-toc-inner { display: inline-block; cursor: pointer; }.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }.md-toc-h2 .md-toc-inner { margin-left: 2em; }.md-toc-h3 .md-toc-inner { margin-left: 4em; }.md-toc-h4 .md-toc-inner { margin-left: 6em; }.md-toc-h5 .md-toc-inner { margin-left: 8em; }.md-toc-h6 .md-toc-inner { margin-left: 10em; }@media screen and (max-width: 48em) {  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }  .md-toc-h4 .md-toc-inner { margin-left: 5em; }  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }  .md-toc-h6 .md-toc-inner { margin-left: 8em; }}a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }.footnote-line a:not(.reversefootnote) { color: inherit; }.md-attr { display: none; }.md-fn-count::after { content: "."; }code, pre, samp, tt { font-family: var(--monospace); }kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }code { text-align: left; vertical-align: initial; }a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }.md-inline-math .MathJax_SVG .noError { display: none !important; }.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }.MathJax_SVG * { transition: none 0s ease 0s; }.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }.md-diagram-panel > svg { max-width: 100%; }[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }[lang="mermaid"] .node text { font-size: 1rem; }table tr th { border-bottom: 0px; }video { max-width: 100%; display: block; margin: 0px auto; }iframe { max-width: 100%; width: 100%; border: none; }.highlight td, .highlight tr { border: 0px; }mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }@media print {  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }}.md-diagram-panel .messageText { stroke: none !important; }.md-diagram-panel .start-state { fill: var(--node-fill); }.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }:root {    --side-bar-bg-color: #fafafa;    --control-text-color: #777;}@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);/* open-sans-regular - latin-ext_latin */  /* open-sans-italic - latin-ext_latin */    /* open-sans-700 - latin-ext_latin */    /* open-sans-700italic - latin-ext_latin */  html {    font-size: 16px;}body {    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;    color: rgb(51, 51, 51);    line-height: 1.6;}#write {    max-width: 860px;  margin: 0 auto;  padding: 30px;    padding-bottom: 100px;}@media only screen and (min-width: 1400px) {#write {max-width: 1024px;}}@media only screen and (min-width: 1800px) {#write {max-width: 1200px;}}#write > ul:first-child,#write > ol:first-child{    margin-top: 30px;}a {    color: #4183C4;}h1,h2,h3,h4,h5,h6 {    position: relative;    margin-top: 1rem;    margin-bottom: 1rem;    font-weight: bold;    line-height: 1.4;    cursor: text;}h1:hover a.anchor,h2:hover a.anchor,h3:hover a.anchor,h4:hover a.anchor,h5:hover a.anchor,h6:hover a.anchor {    text-decoration: none;}h1 tt,h1 code {    font-size: inherit;}h2 tt,h2 code {    font-size: inherit;}h3 tt,h3 code {    font-size: inherit;}h4 tt,h4 code {    font-size: inherit;}h5 tt,h5 code {    font-size: inherit;}h6 tt,h6 code {    font-size: inherit;}h1 {    font-size: 2.25em;    line-height: 1.2;    border-bottom: 1px solid #eee;}h2 {    font-size: 1.75em;    line-height: 1.225;    border-bottom: 1px solid #eee;}/*@media print {    .typora-export h1,    .typora-export h2 {        border-bottom: none;        padding-bottom: initial;    }    .typora-export h1::after,    .typora-export h2::after {        content: "";        display: block;        height: 100px;        margin-top: -96px;        border-top: 1px solid #eee;    }}*/h3 {    font-size: 1.5em;    line-height: 1.43;}h4 {    font-size: 1.25em;}h5 {    font-size: 1em;}h6 {   font-size: 1em;    color: #777;}p,blockquote,ul,ol,dl,table{    margin: 0.8em 0;}li>ol,li>ul {    margin: 0 0;}hr {    height: 2px;    padding: 0;    margin: 16px 0;    background-color: #e7e7e7;    border: 0 none;    overflow: hidden;    box-sizing: content-box;}li p.first {    display: inline-block;}ul,ol {    padding-left: 30px;}ul:first-child,ol:first-child {    margin-top: 0;}ul:last-child,ol:last-child {    margin-bottom: 0;}blockquote {    border-left: 4px solid #dfe2e5;    padding: 0 15px;    color: #777777;}blockquote blockquote {    padding-right: 0;}table {    padding: 0;    word-break: initial;}table tr {    border-top: 1px solid #dfe2e5;    margin: 0;    padding: 0;}table tr:nth-child(2n),thead {    background-color: #f8f8f8;}table th {    font-weight: bold;    border: 1px solid #dfe2e5;    border-bottom: 0;    margin: 0;    padding: 6px 13px;}table td {    border: 1px solid #dfe2e5;    margin: 0;    padding: 6px 13px;}table th:first-child,table td:first-child {    margin-top: 0;}table th:last-child,table td:last-child {    margin-bottom: 0;}.CodeMirror-lines {    padding-left: 4px;}.code-tooltip {    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);    border-top: 1px solid #eef2f2;}.md-fences,code,tt {    border: 1px solid #e7eaed;    background-color: #f8f8f8;    border-radius: 3px;    padding: 0;    padding: 2px 4px 0px 4px;    font-size: 0.9em;}code {    background-color: #f3f4f4;    padding: 0 2px 0 2px;}.md-fences {    margin-bottom: 15px;    margin-top: 15px;    padding-top: 8px;    padding-bottom: 6px;}.md-task-list-item > input {  margin-left: -1.3em;}@media print {    html {        font-size: 13px;    }    table,    pre {        page-break-inside: avoid;    }    pre {        word-wrap: break-word;    }}.md-fences {background-color: #f8f8f8;}#write pre.md-meta-block {padding: 1rem;    font-size: 85%;    line-height: 1.45;    background-color: #f7f7f7;    border: 0;    border-radius: 3px;    color: #777777;    margin-top: 0 !important;}.mathjax-block>.code-tooltip {bottom: .375rem;}.md-mathjax-midline {    background: #fafafa;}#write>h3.md-focus:before{left: -1.5625rem;top: .375rem;}#write>h4.md-focus:before{left: -1.5625rem;top: .285714286rem;}#write>h5.md-focus:before{left: -1.5625rem;top: .285714286rem;}#write>h6.md-focus:before{left: -1.5625rem;top: .285714286rem;}.md-image>.md-meta {    /*border: 1px solid #ddd;*/    border-radius: 3px;    padding: 2px 0px 0px 4px;    font-size: 0.9em;    color: inherit;}.md-tag {    color: #a7a7a7;    opacity: 1;}.md-toc {     margin-top:20px;    padding-bottom:20px;}.sidebar-tabs {    border-bottom: none;}#typora-quick-open {    border: 1px solid #ddd;    background-color: #f8f8f8;}#typora-quick-open-item {    background-color: #FAFAFA;    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;    border-style: solid;    border-width: 1px;}/** focus mode */.on-focus-mode blockquote {    border-left-color: rgba(85, 85, 85, 0.12);}header, .context-menu, .megamenu-content, footer{    font-family: "Segoe UI", "Arial", sans-serif;}.file-node-content:hover .file-node-icon,.file-node-content:hover .file-node-open-state{    visibility: visible;}.mac-seamless-mode #typora-sidebar {    background-color: #fafafa;    background-color: var(--side-bar-bg-color);}.md-lang {    color: #b4654d;}.html-for-mac .context-menu {    --item-hover-bg-color: #E6F0FE;}#md-notification .btn {    border: 0;}.dropdown-menu .divider {    border-color: #e5e5e5;}.ty-preferences .window-content {    background-color: #fafafa;}.ty-preferences .nav-group-item.active {    color: white;    background: #999;}</style></head><body class='typora-export os-windows'><div id='write'  class=''><h1><a name="javaweb教程目录" class="md-header-anchor"></a><span>JavaWeb教程目录</span></h1><p><a href='chapter01/index.html'><span>第一章 Web开发概述</span></a></p><p><a href='chapter02/index.html'><span>第二章 HTML&amp;CSS</span></a></p><p><a href='chapter03/index.html'><span>第三章 JavaScript</span></a></p><p><a href='chapter04/index.html'><span>第四章 Vue.js</span></a></p><p><a href='bookstore01/index.html'><span>书城项目第一阶段</span></a></p><p><a href='chapter05/index.html'><span>第五章 Tomcat</span></a></p><p><a href='chapter06/index.html'><span>第六章 HTTP</span></a></p><p><a href='chapter07/index.html'><span>第七章 Servlet</span></a></p><p><a href='bookstore02/index.html'><span>书城项目第二阶段</span></a></p><p><a href='chapter08/index.html'><span>第八章 Thymeleaf</span></a></p><p><a href='bookstore03/index.html'><span>书城项目第三阶段</span></a></p><p><a href='chapter09/index.html'><span>第九章 会话控制</span></a></p><p><a href='bookstore04/index.html'><span>书城项目第四阶段</span></a></p><p><a href='chapter10/index.html'><span>第十章 Filter</span></a></p><p><a href='bookstore05/index.html'><span>书城项目第五阶段</span></a></p><p><a href='chapter11/index.html'><span>第十一章 Listener</span></a></p><p><a href='chapter12/index.html'><span>第十二章 axios Ajax</span></a></p><p><a href='bookstore06/index.html'><span>书城项目第六阶段</span></a></p><p>&nbsp;</p><p><a href='../index.html'><span>返回上一级目录</span></a></p></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 Axios基本用法</h1><h2 id="0、在前端页面引入开发环境">0、在前端页面引入开发环境</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/demo/static/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/demo/static/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1、发送普通请求参数">1、发送普通请求参数</h2><h3 id="①前端代码">①前端代码</h3><p>HTML标签：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;commonParam&quot;</span>&gt;</span>普通请求参数<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>Vue+axios代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;&#125;,</span><br><span class="line">    <span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;commonParam&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">axios</span>(&#123;</span><br><span class="line">                <span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>:<span class="string">&quot;/demo/AjaxServlet?method=commonParam&quot;</span>,</span><br><span class="line">                <span class="string">&quot;params&quot;</span>:&#123;</span><br><span class="line">                    <span class="string">&quot;userName&quot;</span>:<span class="string">&quot;tom&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;userPwd&quot;</span>:<span class="string">&quot;123456&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果：所有请求参数都被放到URL地址后面了，哪怕我们现在用的是POST请求方式。</p><p><img src="./images/img007.png" alt="./images"></p><h3 id="②后端代码">②后端代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">commonParam</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userPwd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userPwd&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;userName = &quot;</span> + userName);</span><br><span class="line">        System.out.println(<span class="string">&quot;userPwd = &quot;</span> + userPwd);</span><br><span class="line"></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;服务器端返回普通文本字符串作为响应&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>P.S.：由于我们不需要Thymeleaf了，所以ModelBaseServlet可以跳过ViewBaseServlet直接继承HttpServlet。</p></blockquote><p><img src="./images/img006.png" alt="./images"></p><h3 id="③axios程序接收到的响应对象结构">③axios程序接收到的响应对象结构</h3><p><img src="./images/img011.png" alt="./images"></p><table><thead><tr><th>属性名</th><th>作用</th></tr></thead><tbody><tr><td>config</td><td>调用axios(config对象)方法时传入的JSON对象</td></tr><tr><td>data</td><td>服务器端返回的响应体数据</td></tr><tr><td>headers</td><td>响应消息头</td></tr><tr><td>request</td><td>原生JavaScript执行Ajax操作时使用的XMLHttpRequest</td></tr><tr><td>status</td><td>响应状态码</td></tr><tr><td>statusText</td><td>响应状态码的说明文本</td></tr></tbody></table><h3 id="④服务器端处理请求失败后">④服务器端处理请求失败后</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;     <span class="comment">// catch()服务器端处理请求出错后，会调用</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);         <span class="comment">// error就是出错时服务器端返回的响应数据</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">response</span>);        <span class="comment">// 在服务器端处理请求失败后，获取axios封装的JSON格式的响应数据对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">response</span>.<span class="property">status</span>); <span class="comment">// 在服务器端处理请求失败后，获取响应状态码</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">response</span>.<span class="property">statusText</span>); <span class="comment">// 在服务器端处理请求失败后，获取响应状态说明文本</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">response</span>.<span class="property">data</span>);   <span class="comment">// 在服务器端处理请求失败后，获取响应体数据</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在给catch()函数传入的回调函数中，error对象封装了服务器端处理请求失败后相应的错误信息。其中，axios封装的响应数据对象，是error对象的response属性。response属性对象的结构如下图所示：</p><p><img src="./images/img012.png" alt="./images"></p><p>可以看到，response对象的结构还是和then()函数传入的回调函数中的response是一样的：</p><p><img src="./images/img013.png" alt="./images"></p><blockquote><p>回调函数：开发人员声明，但是调用时交给系统来调用。像单击响应函数、then()、catch()里面传入的都是回调函数。回调函数是相对于普通函数来说的，普通函数就是开发人员自己声明，自己调用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">sum</span>(<span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result=&quot;</span>+result);</span><br></pre></td></tr></table></figure></blockquote><h2 id="2、发送请求体JSON">2、发送请求体JSON</h2><h3 id="①前端代码-2">①前端代码</h3><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;requestBodyJSON&quot;</span>&gt;</span>请求体JSON<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue+axios代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;requestBodyJSON&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">axios</span>(&#123;</span><br><span class="line">            <span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:<span class="string">&quot;/demo/AjaxServlet?method=requestBodyJSON&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;stuId&quot;</span>: <span class="number">55</span>,</span><br><span class="line">                <span class="string">&quot;stuName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">                <span class="string">&quot;subjectList&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;subjectName&quot;</span>: <span class="string">&quot;java&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;subjectScore&quot;</span>: <span class="number">50.55</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;subjectName&quot;</span>: <span class="string">&quot;php&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;subjectScore&quot;</span>: <span class="number">30.26</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;teacherMap&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;one&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;teacherName&quot;</span>:<span class="string">&quot;tom&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;tearcherAge&quot;</span>:<span class="number">23</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;two&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;teacherName&quot;</span>:<span class="string">&quot;jerry&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;tearcherAge&quot;</span>:<span class="number">31</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;school&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;schoolId&quot;</span>: <span class="number">23</span>,</span><br><span class="line">                    <span class="string">&quot;schoolName&quot;</span>: <span class="string">&quot;atguigu&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src="./images/img008.png" alt="./images"></p><blockquote><p>P.S.：Chrome浏览器中将『请求负载』显示为英文：『Request Payload』。</p></blockquote><h3 id="②后端代码-2">②后端代码</h3><h4 id="1-加入Gson包">[1]加入Gson包</h4><p>Gson是Google研发的一款非常优秀的<span style="color:blue;font-weight:bold;">JSON数据解析和生成工具</span>，它可以帮助我们将数据在JSON字符串和Java对象之间互相转换。</p><p><img src="./images/img009.png" alt="./images"></p><h4 id="2-Servlet代码">[2]Servlet代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">requestBodyJSON</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.由于请求体数据有可能很大，所以Servlet标准在设计API的时候要求我们通过输入流来读取</span></span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> request.getReader();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建StringBuilder对象来累加存储从请求体中读取到的每一行</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.声明临时变量</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bufferStr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.循环读取</span></span><br><span class="line">    <span class="keyword">while</span>((bufferStr = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        builder.append(bufferStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.关闭流</span></span><br><span class="line">    reader.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.累加的结果就是整个请求体</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">requestBody</span> <span class="operator">=</span> builder.toString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.创建Gson对象用于解析JSON字符串</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.将JSON字符串还原为Java对象</span></span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> gson.fromJson(requestBody, Student.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;student = &quot;</span> + student);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;requestBody = &quot;</span> + requestBody);</span><br><span class="line"></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(<span class="string">&quot;服务器端返回普通文本字符串作为响应&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>P.S.：看着很麻烦是吧？别担心，将来我们有了<span style="color:blue;font-weight:bold;">SpringMVC</span>之后，一个<span style="color:blue;font-weight:bold;">@RequestBody</span>注解就能够搞定，非常方便！</p></blockquote><h2 id="3、服务器端返回JSON数据">3、服务器端返回JSON数据</h2><h3 id="①前端代码-3">①前端代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>:<span class="string">&quot;/demo/AjaxServlet?method=responseBodyJSON&quot;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>then()中获取到的response在控制台打印效果如下：我们需要通过data属性获取响应体数据</p><p><img src="./images/img010.png" alt="./images"></p><h3 id="②后端代码-3">②后端代码</h3><h4 id="1-加入Gson包-2">[1]加入Gson包</h4><p>仍然需要Gson支持，不用多说</p><p><img src="./images/img009.png" alt="./images"></p><h4 id="2-Servlet代码-2">[2]Servlet代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">responseBodyJSON</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.准备数据对象</span></span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setStuId(<span class="number">10</span>);</span><br><span class="line">    student.setStuName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">    student.setSchool(<span class="keyword">new</span> <span class="title class_">School</span>(<span class="number">11</span>,<span class="string">&quot;atguigu&quot;</span>));</span><br><span class="line">    student.setSubjectList(Arrays.asList(<span class="keyword">new</span> <span class="title class_">Subject</span>(<span class="string">&quot;java&quot;</span>, <span class="number">95.5</span>), <span class="keyword">new</span> <span class="title class_">Subject</span>(<span class="string">&quot;php&quot;</span>, <span class="number">93.3</span>)));</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Teacher&gt; teacherMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    teacherMap.put(<span class="string">&quot;t1&quot;</span>, <span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;lili&quot;</span>, <span class="number">25</span>));</span><br><span class="line">    teacherMap.put(<span class="string">&quot;t2&quot;</span>, <span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;mary&quot;</span>, <span class="number">26</span>));</span><br><span class="line">    teacherMap.put(<span class="string">&quot;t3&quot;</span>, <span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;katty&quot;</span>, <span class="number">27</span>));</span><br><span class="line"></span><br><span class="line">    student.setTeacherMap(teacherMap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建Gson对象</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.将Java对象转换为JSON对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> gson.toJson(student);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.设置响应体的内容类型</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 Ajax概述</h1><h2 id="1、服务器端渲染">1、服务器端渲染</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="2、Ajax渲染（局部更新）">2、Ajax渲染（局部更新）</h2><p><img src="./images/img002.png" alt="./images"></p><h2 id="3、前后端分离">3、前后端分离</h2><p>彻底舍弃服务器端渲染，数据全部通过Ajax方式以JSON格式来传递。</p><h2 id="4、同步与异步">4、同步与异步</h2><p>Ajax本身就是Asynchronous JavaScript And XML的缩写，直译为：异步的JavaScript和XML。在实际应用中Ajax指的是：<span style="color:blue;font-weight:bold;">不刷新浏览器窗口</span>，<span style="color:blue;font-weight:bold;">不做页面跳转</span>，<span style="color:blue;font-weight:bold;">局部更新页面内容</span>的技术。</p><p><span style="color:blue;font-weight:bold;">『同步』</span>和<span style="color:blue;font-weight:bold;">『异步』</span>是一对相对的概念，那么什么是同步，什么是异步呢？</p><h3 id="①同步">①同步</h3><p>多个操作<span style="color:blue;font-weight:bold;">按顺序执行</span>，前面的操作没有完成，后面的操作就必须<span style="color:blue;font-weight:bold;">等待</span>。所以同步操作通常是<span style="color:blue;font-weight:bold;">串行</span>的。</p><p><img src="./images/img003.png" alt="./images"></p><h3 id="②异步">②异步</h3><p>多个操作相继开始<span style="color:blue;font-weight:bold;">并发执行</span>，即使开始的先后顺序不同，但是由于它们各自是<span style="color:blue;font-weight:bold;">在自己独立的进程或线程中</span>完成，所以<span style="color:blue;font-weight:bold;">互不干扰</span>，<span style="color:blue;font-weight:bold;">谁也<span style="color:red;font-weight:bold;">不用等</span>谁</span>。</p><p><img src="./images/img004.png" alt="./images"></p><h2 id="5、Axios简介">5、Axios简介</h2><p>使用原生的JavaScript程序执行Ajax极其繁琐，所以一定要使用框架来完成。而Axios就是目前最流行的前端Ajax框架。</p><p><a href="http://www.axios-js.com/">Axios官网</a></p><p><img src="./images/img005.png" alt="./images"></p><p>使用Axios和使用Vue一样，导入对应的*.js文件即可。官方提供的script标签引入方式为：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们可以把这个axios.min.js文件下载下来保存到本地来使用。</p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter12/index/</url>
      
        <content type="html"><![CDATA[<h1>第十二章 Axios Ajax</h1><p><a href="verse01.html">第一节 Ajax概述</a></p><p><a href="verse02.html">第二节 Axios基本用法</a></p><p><a href="../chapter11/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter13/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse01/</url>
      
        <content type="html"><![CDATA[<h1>第一节 观察者模式</h1><p>二十三种设计模式之一：</p><p><img src="./images/img001.png" alt="images"></p><ul><li>观察者：监控『被观察者』的行为，一旦发现『被观察者』触发了事件，就会调用事先准备好的方法执行操作。</li><li>被观察者：『被观察者』一旦触发了被监控的事件，就会被『观察者』发现。</li></ul><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/index/</url>
      
        <content type="html"><![CDATA[<h1>第十一章 监听器</h1><p><a href="verse01.html">第一节 观察者模式</a></p><p><a href="verse02.html">第二节 监听器简介</a></p><p><a href="verse03.html">第三节 ServletContextListener</a></p><p><a href="../chapter10/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter12/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 监听器简介</h1><h2 id="1、概念">1、概念</h2><p>监听器：专门用于对其他对象身上发生的事件或状态改变进行监听和相应处理的对象，当被监视的对象发生情况时，立即采取相应的行动。<br><span style="color:blue;font-weight:bold;">Servlet监听器</span>：Servlet规范中定义的一种特殊类，它用于监听Web应用程序中的ServletContext，HttpSession 和HttpServletRequest等域对象的创建与销毁事件，以及监听这些域对象中的属性发生修改的事件。</p><h2 id="2、分类">2、分类</h2><p><img src="./images/img002.png" alt="./images"></p><ul><li>域对象监听器</li><li>域对象的属性域监听器</li><li>Session域中数据的监听器</li></ul><h2 id="3、监听器列表">3、监听器列表</h2><h3 id="①ServletContextListener">①ServletContextListener</h3><p>作用：监听ServletContext对象的创建与销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>contextInitialized(ServletContextEvent sce)</td><td>ServletContext创建时调用</td></tr><tr><td>contextDestroyed(ServletContextEvent sce)</td><td>ServletContext销毁时调用</td></tr></tbody></table><p>ServletContextEvent对象代表从ServletContext对象身上捕获到的事件，通过这个事件对象我们可以获取到ServletContext对象。</p><h3 id="②HttpSessionListener">②HttpSessionListener</h3><p>作用：监听HttpSession对象的创建与销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>sessionCreated(HttpSessionEvent hse)</td><td>HttpSession对象创建时调用</td></tr><tr><td>sessionDestroyed(HttpSessionEvent hse)</td><td>HttpSession对象销毁时调用</td></tr></tbody></table><p>HttpSessionEvent对象代表从HttpSession对象身上捕获到的事件，通过这个事件对象我们可以获取到触发事件的HttpSession对象。</p><h3 id="③ServletRequestListener">③ServletRequestListener</h3><p>作用：监听ServletRequest对象的创建与销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>requestInitialized(ServletRequestEvent sre)</td><td>ServletRequest对象创建时调用</td></tr><tr><td>requestDestroyed(ServletRequestEvent sre)</td><td>ServletRequest对象销毁时调用</td></tr></tbody></table><p>ServletRequestEvent对象代表从HttpServletRequest对象身上捕获到的事件，通过这个事件对象我们可以获取到触发事件的HttpServletRequest对象。另外还有一个方法可以获取到当前Web应用的ServletContext对象。</p><h3 id="④ServletContextAttributeListener">④ServletContextAttributeListener</h3><p>作用：监听ServletContext中属性的创建、修改和销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>attributeAdded(ServletContextAttributeEvent scab)</td><td>向ServletContext中添加属性时调用</td></tr><tr><td>attributeRemoved(ServletContextAttributeEvent scab)</td><td>从ServletContext中移除属性时调用</td></tr><tr><td>attributeReplaced(ServletContextAttributeEvent scab)</td><td>当ServletContext中的属性被修改时调用</td></tr></tbody></table><p>ServletContextAttributeEvent对象代表属性变化事件，它包含的方法如下：</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>getName()</td><td>获取修改或添加的属性名</td></tr><tr><td>getValue()</td><td>获取被修改或添加的属性值</td></tr><tr><td>getServletContext()</td><td>获取ServletContext对象</td></tr></tbody></table><h3 id="⑤HttpSessionAttributeListener">⑤HttpSessionAttributeListener</h3><p>作用：监听HttpSession中属性的创建、修改和销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>attributeAdded(HttpSessionBindingEvent se)</td><td>向HttpSession中添加属性时调用</td></tr><tr><td>attributeRemoved(HttpSessionBindingEvent se)</td><td>从HttpSession中移除属性时调用</td></tr><tr><td>attributeReplaced(HttpSessionBindingEvent se)</td><td>当HttpSession中的属性被修改时调用</td></tr></tbody></table><p>HttpSessionBindingEvent对象代表属性变化事件，它包含的方法如下：</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>getName()</td><td>获取修改或添加的属性名</td></tr><tr><td>getValue()</td><td>获取被修改或添加的属性值</td></tr><tr><td>getSession()</td><td>获取触发事件的HttpSession对象</td></tr></tbody></table><h3 id="⑥ServletRequestAttributeListener">⑥ServletRequestAttributeListener</h3><p>作用：监听ServletRequest中属性的创建、修改和销毁</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>attributeAdded(ServletRequestAttributeEvent srae)</td><td>向ServletRequest中添加属性时调用</td></tr><tr><td>attributeRemoved(ServletRequestAttributeEvent srae)</td><td>从ServletRequest中移除属性时调用</td></tr><tr><td>attributeReplaced(ServletRequestAttributeEvent srae)</td><td>当ServletRequest中的属性被修改时调用</td></tr></tbody></table><p>ServletRequestAttributeEvent对象代表属性变化事件，它包含的方法如下：</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>getName()</td><td>获取修改或添加的属性名</td></tr><tr><td>getValue()</td><td>获取被修改或添加的属性值</td></tr><tr><td>getServletRequest ()</td><td>获取触发事件的ServletRequest对象</td></tr></tbody></table><h3 id="⑦HttpSessionBindingListener">⑦HttpSessionBindingListener</h3><p>作用：监听某个对象在Session域中的创建与移除</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>valueBound(HttpSessionBindingEvent event)</td><td>该类的实例被放到Session域中时调用</td></tr><tr><td>valueUnbound(HttpSessionBindingEvent event)</td><td>该类的实例从Session中移除时调用</td></tr></tbody></table><p>HttpSessionBindingEvent对象代表属性变化事件，它包含的方法如下：</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>getName()</td><td>获取当前事件涉及的属性名</td></tr><tr><td>getValue()</td><td>获取当前事件涉及的属性值</td></tr><tr><td>getSession()</td><td>获取触发事件的HttpSession对象</td></tr></tbody></table><h3 id="⑧HttpSessionActivationListener">⑧HttpSessionActivationListener</h3><p>作用：监听某个对象在Session中的序列化与反序列化。</p><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>sessionWillPassivate(HttpSessionEvent se)</td><td>该类实例和Session一起钝化到硬盘时调用</td></tr><tr><td>sessionDidActivate(HttpSessionEvent se)</td><td>该类实例和Session一起活化到内存时调用</td></tr></tbody></table><p>HttpSessionEvent对象代表事件对象，通过getSession()方法获取事件涉及的HttpSession对象。</p><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter11/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 ServletContextListener</h1><h2 id="1、实用性">1、实用性</h2><p>将来学习SpringMVC的时候，会用到一个ContextLoaderListener，这个监听器就实现了ServletContextListener接口，表示对ServletContext对象本身的生命周期进行监控。</p><h2 id="2、具体用法">2、具体用法</h2><h3 id="①创建监听器类">①创建监听器类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtguiguListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(</span></span><br><span class="line"><span class="params">            // Event对象代表本次事件，通过这个对象可以获取ServletContext对象本身</span></span><br><span class="line"><span class="params">            ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello，我是ServletContext，我出生了！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> sce.getServletContext();</span><br><span class="line">        System.out.println(<span class="string">&quot;servletContext = &quot;</span> + servletContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello，我是ServletContext，我打算去休息一会儿！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②注册监听器">②注册监听器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 每一个listener标签对应一个监听器配置，若有多个监听器，则配置多个listener标签即可 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置监听器指定全类名即可 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.atguigu.listener.AtguiguListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><p>事件触发过程中控制台日志的打印：</p><blockquote><p>Connected to server<br>[2021-03-20 04:23:20,982] Artifact pro10-listener:war exploded: Artifact is being deployed, please wait…<br>三月 20, 2021 4:23:21 下午 org.apache.catalina.deploy.WebXml setVersion<br>警告: Unknown version string [4.0]. Default version will be used.<br>Hello，我是ServletContext，我出生了！<br>servletContext = org.apache.catalina.core.ApplicationContextFacade@6a66017e<br>[2021-03-20 04:23:21,426] Artifact pro10-listener:war exploded: Artifact is deployed successfully<br>[2021-03-20 04:23:21,426] Artifact pro10-listener:war exploded: Deploy took 444 milliseconds<br>三月 20, 2021 4:23:30 下午 org.apache.catalina.startup.HostConfig deployDirectory<br>信息: Deploying web application directory D:\software\apache-tomcat-7.0.57\webapps\manager<br>三月 20, 2021 4:23:31 下午 org.apache.catalina.startup.HostConfig deployDirectory<br>信息: Deployment of web application directory D:\software\apache-tomcat-7.0.57\webapps\manager has finished in 124 ms<br>[2021-03-20 04:24:06,422] Artifact pro10-listener:war exploded: Artifact is being deployed, please wait…<br>Hello，我是ServletContext，我打算去休息一会儿！<br>Hello，我是ServletContext，我出生了！<br>servletContext = org.apache.catalina.core.ApplicationContextFacade@2a55374c<br>[2021-03-20 04:24:07,115] Artifact pro10-listener:war exploded: Artifact is deployed successfully<br>[2021-03-20 04:24:07,115] Artifact pro10-listener:war exploded: Deploy took 694 milliseconds</p></blockquote><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/index/</url>
      
        <content type="html"><![CDATA[<h1>第十章 过滤器</h1><p><a href="verse01.html">第一节 过滤器简介</a></p><p><a href="verse02.html">第二节 HelloWorld</a></p><p><a href="verse03.html">第三节 过滤器生命周期</a></p><p><a href="verse04.html">第四节 过滤器匹配规则</a></p><p><a href="verse05.html">第五节 过滤器链</a></p><p><a href="../chapter09/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter11/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 HelloWorld</h1><h2 id="1、思路">1、思路</h2><p><img src="./images/img003.png" alt="./images"></p><h2 id="2、操作步骤">2、操作步骤</h2><h3 id="①准备工作">①准备工作</h3><ul><li>创建module</li><li>加入Thymeleaf环境</li><li>完成首页访问功能</li><li>创建Target01Servlet以及target01.html</li><li>创建SpecialServlet以及special.html</li></ul><h3 id="②创建Filter">②创建Filter</h3><h4 id="1-创建Target01Filter类">[1]创建Target01Filter类</h4><ul><li>要点1：实现javax.servlet.Filter接口</li><li>要点2：在doFilter()方法中执行过滤</li><li>要点3：如果满足过滤条件使用 chain.doFilter(request, response);放行</li><li>要点4：如果不满足过滤条件转发或重定向请求<ul><li>附带问题：Thymeleaf模板渲染。这里我们选择的解决办法是跳转到一个Servlet，由Servlet负责执行模板渲染返回页面。</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target01Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.打印一句话表明Filter执行了</span></span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器执行：Target01Filter&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.检查是否满足过滤条件</span></span><br><span class="line">        <span class="comment">// 人为设定一个过滤条件：请求参数message是否等于monster</span></span><br><span class="line">        <span class="comment">// 等于：放行</span></span><br><span class="line">        <span class="comment">// 不等于：将请求跳转到另外一个页面</span></span><br><span class="line">        <span class="comment">// ①获取请求参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;message&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②检查请求参数是否等于monster</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;monster&quot;</span>.equals(message)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ③执行放行</span></span><br><span class="line">            <span class="comment">// FilterChain对象代表过滤器链</span></span><br><span class="line">            <span class="comment">// chain.doFilter(request, response)方法效果：将请求放行到下一个Filter，</span></span><br><span class="line">            <span class="comment">// 如果当前Filter已经是最后一个Filter了，那么就将请求放行到原本要访问的目标资源</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ④跳转页面</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/SpecialServlet?method=toSpecialPage&quot;</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-配置Target01Filter类">[2]配置Target01Filter类</h4><blockquote><p>这一步也可以叫『注册』。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Target01Filter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Filter的友好名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target01Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Filter的全类名，便于Servlet容器创建Filter对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.atguigu.filter.filter.Target01Filter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Filter要拦截的目标资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定这个mapping对应的Filter名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target01Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过请求地址模式来设置要拦截的资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Target01Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 过滤器生命周期</h1><h2 id="1、回顾Servlet生命周期">1、回顾Servlet生命周期</h2><p><a href="http://heavy_code_industry.gitee.io/code_heavy_industry/pro001-javaweb/lecture/chapter07/verse03.html">Servlet生命周期</a></p><h2 id="2、Filter生命周期">2、Filter生命周期</h2><p>和Servlet生命周期类比，Filter生命周期的关键区别是：<span style="color:blue;font-weight:bold;">在Web应用启动时创建对象</span></p><table><thead><tr><th>生命周期阶段</th><th>执行时机</th><th>执行次数</th></tr></thead><tbody><tr><td>创建对象</td><td>Web应用启动时</td><td>一次</td></tr><tr><td>初始化</td><td>创建对象后</td><td>一次</td></tr><tr><td>拦截请求</td><td>接收到匹配的请求</td><td>多次</td></tr><tr><td>销毁</td><td>Web应用卸载前</td><td>一次</td></tr></tbody></table><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 过滤器匹配规则</h1><p>本节要探讨的是在filter-mapping中如何将Filter同它要拦截的资源关联起来。</p><h2 id="1、精确匹配">1、精确匹配</h2><p>指定被拦截资源的完整路径：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Filter要拦截的目标资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定这个mapping对应的Filter名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target01Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过请求地址模式来设置要拦截的资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Target01Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、模糊匹配">2、模糊匹配</h2><p>相比较精确匹配，使用模糊匹配可以让我们创建一个Filter就能够覆盖很多目标资源，不必专门为每一个目标资源都创建Filter，提高开发效率。</p><h3 id="①前杠后星">①前杠后星</h3><p>在我们配置了url-pattern为/user/*之后，请求地址只要是/user开头的那么就会被匹配。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target02Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模糊匹配：前杠后星 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        /user/Target02Servlet</span></span><br><span class="line"><span class="comment">        /user/Target03Servlet</span></span><br><span class="line"><span class="comment">        /user/Target04Servlet</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/user/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">极端情况：/*匹配所有请求</span></p><h3 id="②前星后缀">②前星后缀</h3><p>下面我们使用png图片来测试后缀拦截的效果，并不是只能拦截png扩展名。</p><h4 id="1-创建一组img标签">[1]创建一组img标签</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img017.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img018.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img019.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img020.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img024.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/./images/img025.png&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-创建Filter">[2]创建Filter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target04Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.atguigu.filter.filter.Target04Filter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target04Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.png<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③前杠后缀，星号在中间">③前杠后缀，星号在中间</h3><p>配置方式如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*.png<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure><p>按照这个配置启动Web应用时会抛出异常：</p><blockquote><p>java.lang.IllegalArgumentException: Invalid <url-pattern> /*.png in filter mapping</p></blockquote><p><span style="color:blue;font-weight:bold;">结论：这么配是<span style="color:red;font-weight:bold;">不允许</span>的！</span></p><h2 id="3、匹配Servlet名称-了解">3、匹配Servlet名称[了解]</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Target05Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据Servlet名称匹配 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Target01Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 过滤器简介</h1><h2 id="1、通过类比了解过滤器作用">1、通过类比了解过滤器作用</h2><h3 id="①坐地铁">①坐地铁</h3><p><img src="./images/img001.png" alt="./images"></p><h3 id="②登录检查">②登录检查</h3><p><img src="./images/img002.png" alt="./images"></p><h2 id="2、过滤器的三要素">2、过滤器的三要素</h2><h3 id="①拦截">①拦截</h3><p>过滤器之所以能够对请求进行预处理，关键是对请求进行拦截，把请求拦截下来才能够做后续的操作。而且对于一个具体的过滤器，它必须明确它要拦截的请求，而不是所有请求都拦截。</p><h3 id="②过滤">②过滤</h3><p>根据业务功能实际的需求，看看在把请求拦截到之后，需要做什么检查或什么操作，写对应的代码即可。</p><h3 id="③放行">③放行</h3><p>过滤器完成自己的任务或者是检测到当前请求符合过滤规则，那么可以将请求放行。所谓放行，就是让请求继续去访问它原本要访问的资源。</p><blockquote><p>友情提示：将来学习SpringMVC时，会学习SpringMVC中的『拦截器』，同样具备三要素。</p></blockquote><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter10/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 过滤器链</h1><h2 id="1、概念">1、概念</h2><ul><li>多个Filter的<span style="color:blue;font-weight:bold;">拦截范围</span>如果存在<span style="color:blue;font-weight:bold;">重合部分</span>，那么这些Filter会形成<span style="color:blue;font-weight:bold;">Filter链</span>。</li><li>浏览器请求重合部分对应的目标资源时，会<span style="color:blue;font-weight:bold;">依次经过</span>Filter链中的每一个Filter。</li><li>Filter链中每一个Filter执行的<span style="color:blue;font-weight:bold;">顺序是由web.xml中filter-mapping配置的顺序决定</span>的。</li></ul><p><img src="./images/img004.png" alt="./images"></p><h2 id="2、测试">2、测试</h2><h3 id="①准备工作">①准备工作</h3><p>创建超链接访问一个普通的Servlet即可。</p><h3 id="②创建多个Filter拦截Servlet">②创建多个Filter拦截Servlet</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TargetChain03Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Target05Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TargetChain02Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Target05Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TargetChain01Filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Target05Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>控制台打印效果：</p><blockquote><p>过滤器执行：Target03Filter[模糊匹配 前杠后星 /*]<br>测试Filter链：TargetChain03Filter<br>测试Filter链：TargetChain02Filter<br>测试Filter链：TargetChain01Filter</p></blockquote><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 Cookie的工作机制</h1><h2 id="1、HTTP协议和会话控制">1、HTTP协议和会话控制</h2><p>HTTP协议本身是无状态的。单靠HTTP协议本身无法判断一个请求来自于哪一个浏览器，所以也就没法识别用户的身份状态。</p><p><img src="./images/img004.png" alt="./images"></p><h2 id="2、Cookie介绍">2、Cookie介绍</h2><h3 id="①本质">①本质</h3><ul><li>在浏览器端临时存储数据</li><li>键值对</li><li>键和值都是字符串类型</li><li>数据量很小</li></ul><h3 id="②Cookie在浏览器和服务器之间的传递">②Cookie在浏览器和服务器之间的传递</h3><h4 id="1-没有Cookie的状态">[1]没有Cookie的状态</h4><p>在服务器端没有创建Cookie并返回的情况下，浏览器端不会保存Cookie信息。双方在请求和响应的过程中也不会携带Cookie的数据。</p><h4 id="2-创建Cookie对象并返回">[2]创建Cookie对象并返回</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建Cookie对象</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;cookie-message&quot;</span>, <span class="string">&quot;hello-cookie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.将Cookie对象添加到响应中</span></span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.返回响应</span></span><br><span class="line">processTemplate(<span class="string">&quot;page-target&quot;</span>, request, response);</span><br></pre></td></tr></table></figure><h4 id="3-服务器端返回Cookie的响应消息头">[3]服务器端返回Cookie的响应消息头</h4><p><img src="./images/img005.png" alt="./images"></p><h4 id="4-浏览器拿到Cookie之后">[4]浏览器拿到Cookie之后</h4><p>浏览器拿到Cookie之后，以后的每一个请求都会携带Cookie信息。</p><p><img src="./images/img006.png" alt="./images"></p><h4 id="5-服务器端读取Cookie的信息">[5]服务器端读取Cookie的信息</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.通过request对象获取Cookie的数组</span></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.遍历数组</span></span><br><span class="line"><span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cookie.getName() = &quot;</span> + cookie.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;cookie.getValue() = &quot;</span> + cookie.getValue());</span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③Cookie时效性">③Cookie时效性</h3><h4 id="1-理论">[1]理论</h4><ul><li>会话级Cookie<ul><li>服务器端并没有明确指定Cookie的存在时间</li><li>在浏览器端，Cookie数据存在于内存中</li><li>只要浏览器还开着，Cookie数据就一直都在</li><li>浏览器关闭，内存中的Cookie数据就会被释放</li></ul></li><li>持久化Cookie<ul><li>服务器端明确设置了Cookie的存在时间</li><li>在浏览器端，Cookie数据会被保存到硬盘上</li><li>Cookie在硬盘上存在的时间根据服务器端限定的时间来管控，不受浏览器关闭的影响</li><li>持久化Cookie到达了预设的时间会被释放</li></ul></li></ul><p>服务器端返回Cookie时附带过期时间的响应消息头如下：</p><p><img src="./images/img007.png" alt="./images"></p><p>服务器通知浏览器删除Cookie时的响应消息头如下：</p><p><img src="./images/img009.png" alt="./images"></p><h4 id="2-代码">[2]代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ※给Cookie设置过期时间</span></span><br><span class="line"><span class="comment">// 正数：Cookie的过期时间，以秒为单位</span></span><br><span class="line"><span class="comment">// 负数：表示这个Cookie是会话级的Cookie，浏览器关闭时释放</span></span><br><span class="line"><span class="comment">// 0：通知浏览器立即删除这个Cookie</span></span><br><span class="line">cookie.setMaxAge(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><h4 id="3-会话和持久化Cookie对比">[3]会话和持久化Cookie对比</h4><p><img src="./images/img008.png" alt="./images"></p><h3 id="④Cookie的domain和path">④Cookie的domain和path</h3><p>上网时间长了，本地会保存很多Cookie。对浏览器来说，访问互联网资源时不能每次都把所有Cookie带上。浏览器会使用Cookie的domain和path属性值来和当前访问的地址进行比较，从而决定是否携带这个Cookie。</p><p><img src="./images/img010.png" alt="./images"></p><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 提出问题与解决方案核心代码</h1><h2 id="1、提出问题">1、提出问题</h2><p><img src="./images/img001.png" alt="./images"></p><p>保持用户登录状态，背后的底层逻辑是：服务器在接收到用户请求的时候，有办法判断这个请求来自于之前的某一个用户。所以保持登录状态，本质上是保持<span style="color:blue;font-weight:bold;">『会话状态』</span></p><h2 id="2、解决方案">2、解决方案</h2><h3 id="①结论">①结论</h3><p>使用HttpSession对象，将数据存入<span style="color:blue;font-weight:bold;">会话域</span>就能保持会话状态。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">session.setAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br></pre></td></tr></table></figure><h3 id="②demo体验">②demo体验</h3><h4 id="1-准备环境">[1]准备环境</h4><p>参考<a href="pro08-cookie-and-session.zip">会话控制demo原始纯净版</a></p><h4 id="2-创建将数据存入会话域的Servlet">[2]创建将数据存入会话域的Servlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.通过request对象获取session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.设置数据名称和数据的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> <span class="string">&quot;sessionHelloAttrName&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">attrValue</span> <span class="operator">=</span> <span class="string">&quot;sessionHelloAttrValue&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.将数据存入会话域</span></span><br><span class="line">        session.setAttribute(attrName, attrValue);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.渲染视图</span></span><br><span class="line">        processTemplate(<span class="string">&quot;page-target&quot;</span>, request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-在其他页面从会话域取出数据">[3]在其他页面从会话域取出数据</h4><p><img src="./images/img002.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#strings.isEmpty(session.sessionHelloAttrName)&#125;&quot;</span>&gt;</span></span><br><span class="line">    没有从会话域获取到数据</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(session.sessionHelloAttrName)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>从会话域读取到：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.sessionHelloAttrName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-操作效果">[4]操作效果</h4><p><img src="./images/img003.png" alt="./images"></p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 Session的工作机制</h1><h2 id="1、文字描述">1、文字描述</h2><p>前提：浏览器正常访问服务器</p><ul><li>服务器端没调用request.getSession()方法：什么都不会发生</li><li>服务器端调用了request.getSession()方法<ul><li>服务器端检查当前请求中是否携带了JSESSIONID的Cookie<ul><li>有：根据JSESSIONID在服务器端查找对应的HttpSession对象<ul><li>能找到：将找到的HttpSession对象作为request.getSession()方法的返回值返回</li><li>找不到：服务器端新建一个HttpSession对象作为request.getSession()方法的返回值返回</li></ul></li><li>无：服务器端新建一个HttpSession对象作为request.getSession()方法的返回值返回</li></ul></li></ul></li></ul><h2 id="2、流程图描述">2、流程图描述</h2><p><img src="./images/img011.png" alt="./images"></p><h2 id="3、代码验证">3、代码验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.调用request对象的方法尝试获取HttpSession对象</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.调用HttpSession对象的isNew()方法</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">wetherNew</span> <span class="operator">=</span> session.isNew();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.打印HttpSession对象是否为新对象</span></span><br><span class="line">System.out.println(<span class="string">&quot;wetherNew = &quot;</span> + (wetherNew?<span class="string">&quot;HttpSession对象是新的&quot;</span>:<span class="string">&quot;HttpSession对象是旧的&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.调用HttpSession对象的getId()方法</span></span><br><span class="line"><span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> session.getId();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.打印JSESSIONID的值</span></span><br><span class="line">System.out.println(<span class="string">&quot;JSESSIONID = &quot;</span> + id);</span><br></pre></td></tr></table></figure><h2 id="4、时效性">4、时效性</h2><h3 id="①为什么Session要设置时限">①为什么Session要设置时限</h3><p>用户量很大之后，Session对象相应的也要创建很多。如果一味创建不释放，那么服务器端的内存迟早要被耗尽。</p><h3 id="②设置时限的难点">②设置时限的难点</h3><p>从服务器端的角度，很难精确得知类似浏览器关闭的动作。而且即使浏览器一直没有关闭，也不代表用户仍然在使用。</p><h3 id="③服务器端给Session对象设置最大闲置时间">③服务器端给Session对象设置最大闲置时间</h3><ul><li>默认值：1800秒</li></ul><p><img src="./images/img012.png" alt="./images"></p><p>最大闲置时间生效的机制如下：</p><p><img src="./images/img013.png" alt="./images"></p><h3 id="④代码验证">④代码验证</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ※测试时效性</span></span><br><span class="line"><span class="comment">// 获取默认的最大闲置时间</span></span><br><span class="line"><span class="type">int</span> <span class="variable">maxInactiveIntervalSecond</span> <span class="operator">=</span> session.getMaxInactiveInterval();</span><br><span class="line">System.out.println(<span class="string">&quot;maxInactiveIntervalSecond = &quot;</span> + maxInactiveIntervalSecond);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置默认的最大闲置时间</span></span><br><span class="line">session.setMaxInactiveInterval(<span class="number">15</span>);</span><br></pre></td></tr></table></figure><h3 id="⑤强制Session立即失效">⑤强制Session立即失效</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.invalidate();</span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter09/index/</url>
      
        <content type="html"><![CDATA[<h1>第九章 会话控制</h1><p><a href="verse01.html">第一节 提出问题与解决方案核心代码</a></p><p><a href="verse02.html">第二节 Cookie的工作机制</a></p><p><a href="verse03.html">第三节 Session的工作机制</a></p><p><a href="../chapter08/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter10/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse09/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse09/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第九节 基本语法：${}中的表达式本质是OGNL</h1><h2 id="1、OGNL">1、OGNL</h2><p>OGNL：Object-Graph Navigation Language对象-图 导航语言</p><h2 id="2、对象图">2、对象图</h2><p>从根对象触发，通过特定的语法，逐层访问对象的各种属性。</p><p><img src="./images/img024.png" alt="./images"></p><h2 id="3、OGNL语法">3、OGNL语法</h2><h3 id="①起点">①起点</h3><p>在Thymeleaf环境下，${}中的表达式可以从下列元素开始：</p><ul><li>访问属性域的起点<ul><li>请求域属性名</li><li>session</li><li>application</li></ul></li><li>param</li><li>内置对象<ul><li>#request</li><li>#session</li><li>#lists</li><li>#strings</li></ul></li></ul><h3 id="②属性访问语法">②属性访问语法</h3><ul><li>访问对象属性：使用getXxx()、setXxx()方法定义的属性<ul><li>对象.属性名</li></ul></li><li>访问List集合或数组<ul><li>集合或数组[下标]</li></ul></li><li>访问Map集合<ul><li>Map集合.key</li><li>Map集合[‘key’]</li></ul></li></ul><p><a href="verse08.html">上一节</a> <a href="index.html">回目录</a> <a href="verse10.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse11/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse11/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十一节 基本语法：包含其他模板文件</h1><h2 id="1、应用场景">1、应用场景</h2><p>抽取各个页面的公共部分：</p><p><img src="./images/img026.png" alt="./images"></p><h2 id="2、创建页面的代码片段">2、创建页面的代码片段</h2><p>使用th:fragment来给这个片段命名：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>被抽取出来的头部内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、包含到有需要的页面">3、包含到有需要的页面</h2><table><thead><tr><th>语法</th><th>效果</th></tr></thead><tbody><tr><td>th:insert</td><td>把目标的代码片段整个插入到当前标签内部</td></tr><tr><td>th:replace</td><td>用目标的代码替换当前标签</td></tr><tr><td>th:include</td><td>把目标的代码片段去除最外层标签，然后再插入到当前标签内部</td></tr></tbody></table><p>页面代码举例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 代码片段所在页面的逻辑视图 :: 代码片段的名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;badBoy&quot;</span> <span class="attr">th:insert</span>=<span class="string">&quot;segment :: header&quot;</span>&gt;</span></span><br><span class="line">    div标签的原始内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;worseBoy&quot;</span> <span class="attr">th:replace</span>=<span class="string">&quot;segment :: header&quot;</span>&gt;</span></span><br><span class="line">    div标签的原始内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;worstBoy&quot;</span> <span class="attr">th:include</span>=<span class="string">&quot;segment :: header&quot;</span>&gt;</span></span><br><span class="line">    div标签的原始内容</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse10.html">上一节</a> <a href="index.html">回目录</a> <a href="verse12.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse12/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse12/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>加餐 最凝练的CRUD</h1><h2 id="1、建模">1、建模</h2><h3 id="①物理建模">①物理建模</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `<span class="keyword">view</span><span class="operator">-</span>demo`<span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line">USE `<span class="keyword">view</span><span class="operator">-</span>demo`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_soldier(</span><br><span class="line">    soldier_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    soldier_name <span class="type">CHAR</span>(<span class="number">100</span>),</span><br><span class="line">    soldier_weapon <span class="type">CHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="②逻辑建模">②逻辑建模</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Soldier</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer soldierId;</span><br><span class="line">    <span class="keyword">private</span> String soldierName;</span><br><span class="line">    <span class="keyword">private</span> String soldierWeapon;</span><br></pre></td></tr></table></figure><h2 id="2、总体架构">2、总体架构</h2><p><img src="./images/img027.png" alt="./images"></p><h2 id="3、搭建持久化层所需环境">3、搭建持久化层所需环境</h2><h3 id="①导入jar包">①导入jar包</h3><blockquote><p>commons-dbutils-1.6.jar<br>druid-1.1.9.jar<br>hamcrest-core-1.3.jar<br>junit-4.12.jar<br>mysql-connector-java-5.1.37-bin.jar</p></blockquote><h3 id="②创建jdbc-properties">②创建jdbc.properties</h3><p>维护基本连接信息</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://192.168.198.100:3306/view-demo</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">atguigu</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="attr">maxWait</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure><h3 id="③创建JDBCUtils工具类">③创建JDBCUtils工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数据源对象设置为静态属性，保证大对象的单一实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建一个用于存储外部属性文件信息的Properties对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用当前类的类加载器加载外部属性文件：jdbc.properties</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> JDBCUtil.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.将外部属性文件jdbc.properties中的数据加载到properties对象中</span></span><br><span class="line">            properties.load(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.创建数据源对象</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从数据源中获取数据库连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据库连接对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = dataSource.getConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放数据库连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection 要执行释放操作的连接对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">releaseConnection</span><span class="params">(Connection connection)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试能否正常连接数据库：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtil.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;connection = &quot;</span> + connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④BaseDao">④BaseDao</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseDao</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用的增删改方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtil.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count = queryRunner.update(connection, sql, param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtil.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询单个对象的通用方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtil.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">T</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bean = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtil.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询集合对象的通用方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getBeanList</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtil.getConnection();</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; beanList = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            beanList = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtil.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> beanList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、搭建表述层所需环境">4、搭建表述层所需环境</h2><p>本质上就是Thymeleaf所需要的环境</p><h3 id="①导入jar包-2">①导入jar包</h3><blockquote><p>attoparser-2.0.5.RELEASE.jar<br>javassist-3.20.0-GA.jar<br>log4j-1.2.15.jar<br>ognl-3.1.26.jar<br>slf4j-api-1.7.25.jar<br>slf4j-log4j12-1.7.25.jar<br>thymeleaf-3.0.12.RELEASE.jar<br>unbescape-1.1.6.RELEASE.jar</p></blockquote><h3 id="②创建ViewBaseServlet">②创建ViewBaseServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.WebContext;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ServletContextTemplateResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, getServletContext());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③配置web-xml">③配置web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在上下文参数中配置视图前缀和视图后缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/view/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④创建view目录">④创建view目录</h3><p><img src="./images/img028.png" alt="./images"></p><h2 id="5、功能清单">5、功能清单</h2><ul><li>显示首页：浏览器通过index.html访问首页Servlet，然后再解析对应的模板视图</li><li>显示列表：在首页点击超链接，跳转到目标页面把所有士兵的信息列表显示出来</li><li>删除信息：在列表上点击删除超链接，执行信息的删除操作</li><li>新增信息：<ul><li>在列表页面点击超链接跳转到新增士兵信息的表单页面</li><li>在新增信息的表单页面点击提交按钮执行保存</li></ul></li><li>更新信息：<ul><li>在列表上点击更新超链接，跳转到更新士兵信息的表单页面：表单回显</li><li>在更新信息的表单页面点击提交按钮执行更新</li></ul></li></ul><h2 id="6、显示首页">6、显示首页</h2><h3 id="①目标">①目标</h3><p>浏览器访问index.html，通过首页Servlet，渲染视图，显示首页。</p><h3 id="②思路">②思路</h3><p><img src="./images/img029.png" alt="./images"></p><h3 id="③代码">③代码</h3><h4 id="1-创建PortalServlet">[1]创建PortalServlet</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>PortalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.demo.servlet.PortalServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>PortalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/index.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Servlet代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PortalServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;portal&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-创建portal-html">[2]创建portal.html</h4><p><img src="./images/img030.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>士兵信息管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/SoldierServlet?method=showList&#125;&quot;</span>&gt;</span>显示士兵信息列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="7、显示列表">7、显示列表</h2><h3 id="①目标-2">①目标</h3><p>在目标页面显示所有士兵信息，士兵信息是从数据库查询出来的</p><h3 id="②思路-2">②思路</h3><p><img src="./images/img031.png" alt="./images"></p><h3 id="③代码-2">③代码</h3><h4 id="1-ModelBaseServlet">[1]ModelBaseServlet</h4><p>创建这个基类的原因是：我们希望每一个模块能够对应同一个Servlet，这个模块所需要调用的所有方法都集中在同一个Servlet中。如果没有这个ModelBaseServlet基类，我们doGet()、doPost()方法可以用来处理请求，这样一来，每一个方法都需要专门创建一个Servlet（就好比咱们之前的LoginServlet、RegisterServlet其实都应该合并为UserServlet）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在doGet()方法中调用doPost()方法，这样就可以在doPost()方法中集中处理所有请求</span></span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.从请求参数中获取method对应的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;method&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过反射调用method对应的方法</span></span><br><span class="line">        <span class="comment">// ①获取Class对象</span></span><br><span class="line">        Class&lt;? <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span>&gt; clazz = <span class="built_in">this</span>.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ②获取method对应的Method对象</span></span><br><span class="line">            <span class="type">Method</span> <span class="variable">methodObject</span> <span class="operator">=</span> clazz.getDeclaredMethod(method, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ③打开访问权限</span></span><br><span class="line">            methodObject.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ④通过Method对象调用目标方法</span></span><br><span class="line">            methodObject.invoke(<span class="built_in">this</span>, request, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-SoldierDao-selectSoldierList">[2]SoldierDao.selectSoldierList()</h4><p><img src="./images/img032.png" alt="./images"></p><p><img src="./images/img033.png" alt="./images"></p><p>接口方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SoldierDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Soldier&gt; <span class="title function_">selectSoldierList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现类方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoldierDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span>&lt;Soldier&gt; <span class="keyword">implements</span> <span class="title class_">SoldierDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Soldier&gt; <span class="title function_">selectSoldierList</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select soldier_id soldierId,soldier_name soldierName,soldier_weapon soldierWeapon from t_soldier&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> getBeanList(Soldier.class, sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-SoldierService-getSoldierList">[3]SoldierService.getSoldierList()</h4><p><img src="./images/img034.png" alt="./images"></p><p>接口方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SoldierService</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Soldier&gt; <span class="title function_">getSoldierList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现类方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoldierServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SoldierService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SoldierDao</span> <span class="variable">soldierDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SoldierDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Soldier&gt; <span class="title function_">getSoldierList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Soldier&gt; soldierList = soldierDao.selectSoldierList();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> soldierList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-SoldierServlet-showList">[4]SoldierServlet.showList()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">showList</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.调用Service方法获取集合数据</span></span><br><span class="line">    List&lt;Soldier&gt; soldierList = soldierService.getSoldierList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.将集合数据存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;soldierList&quot;</span>, soldierList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.渲染视图（在渲染的过程中，已经包含了转发）</span></span><br><span class="line">    processTemplate(<span class="string">&quot;list&quot;</span>, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8、删除功能">8、删除功能</h2><h3 id="①目标-3">①目标</h3><p>点击页面上的超链接，把数据库表中的记录删除。</p><h3 id="②思路-3">②思路</h3><h4 id="1-先不考虑后续">[1]先不考虑后续</h4><p><img src="./images/img035.png" alt="./images"></p><h4 id="2-加上后续返回响应页面">[2]加上后续返回响应页面</h4><p><img src="./images/img038.png" alt="./images"></p><h3 id="③代码-3">③代码</h3><h4 id="1-完成删除超链接">[1]完成删除超链接</h4><p><img src="./images/img036.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/SoldierServlet(soldierId=$&#123;soldier.soldierId&#125;,method=&#x27;remove&#x27;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>关于@{地址}附加请求参数的语法格式：</p><ul><li>只有一个请求参数：@{地址(请求参数名=普通字符串)}或@{地址(请求参数名=${需要解析的表达式})}</li><li>多个请求参数：@{地址(名=值,名=值)}</li></ul><p>官方文档中的说明如下：</p><p><img src="./images/img037.png" alt="./images"></p><h4 id="2-Servlet方法">[2]Servlet方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取士兵信息的id值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.调用Service方法执行删除操作</span></span><br><span class="line">    soldierService.remove(soldierId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.后续……</span></span><br><span class="line">    <span class="comment">// 方案一：还是直接前往list.html，需要重新查询soldierList数据，代码重复</span></span><br><span class="line">    <span class="comment">// 1.调用Service方法获取集合数据</span></span><br><span class="line">    <span class="comment">// List&lt;Soldier&gt; soldierList = soldierService.getSoldierList();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.将集合数据存入请求域</span></span><br><span class="line">    <span class="comment">// request.setAttribute(&quot;soldierList&quot;, soldierList);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// processTemplate(&quot;list&quot;, request, response);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方案二：直接调用隔壁的showList()</span></span><br><span class="line">    <span class="comment">// 也能实现需求，但是总感觉这样调用方法破坏了程序的结构</span></span><br><span class="line">    <span class="comment">// showList(request, response);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方案三：通过请求转发的方式间接调用showList()方法</span></span><br><span class="line">    <span class="comment">// request.getRequestDispatcher(&quot;/SoldierServlet?method=showList&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方案四：通过请求重定向的方式间接调用showList()方法</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/SoldierServlet?method=showList&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Service方法">[3]Service方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(String soldierId)</span> &#123;</span><br><span class="line">    soldierDao.delete(soldierId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-Dao方法">[4]Dao方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String soldierId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from t_soldier where soldier_id=?&quot;</span>;</span><br><span class="line"></span><br><span class="line">    update(sql, soldierId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9、前往新增信息的表单页面">9、前往新增信息的表单页面</h2><h3 id="①创建超链接">①创建超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/SoldierServlet?method=toAddPage&#125;&quot;</span>&gt;</span>前往新增页面<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Servlet">②Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toAddPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    processTemplate(<span class="string">&quot;add-page&quot;</span>, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③创建表单页面">③创建表单页面</h3><p><img src="./images/img039.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/SoldierServlet&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;saveSoldier&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    士兵姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;soldierName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    士兵武器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;soldierWeapon&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="10、执行保存">10、执行保存</h2><h3 id="①目标-4">①目标</h3><p>提交表单后，将表单数据封装为Soldier对象，然后将Soldier对象保存到数据库。</p><h3 id="②思路-4">②思路</h3><p><img src="./images/img040.png" alt="./images"></p><h3 id="③代码-4">③代码</h3><h4 id="1-Servlet方法">[1]Servlet方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">saveSoldier</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.获取请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierName&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierWeapon</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierWeapon&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.创建Soldier对象</span></span><br><span class="line">    <span class="type">Soldier</span> <span class="variable">soldier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Soldier</span>(<span class="literal">null</span>, soldierName, soldierWeapon);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用Service方法</span></span><br><span class="line">    soldierService.saveSoldier(soldier);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.重定向请求</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/SoldierServlet?method=showList&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Service方法">[2]Service方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSoldier</span><span class="params">(Soldier soldier)</span> &#123;</span><br><span class="line"></span><br><span class="line">    soldierDao.insertSoldier(soldier);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Dao方法">[3]Dao方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertSoldier</span><span class="params">(Soldier soldier)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_soldier(soldier_name,soldier_weapon) values(?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    update(sql, soldier.getSoldierName(), soldier.getSoldierWeapon());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11、前往修改信息的表单页面">11、前往修改信息的表单页面</h2><p><img src="./images/img041.png" alt="./images"></p><h3 id="①创建超链接-2">①创建超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/SoldierServlet(soldierId=$&#123;soldier.soldierId&#125;,method=toEditPage)&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Servlet方法">②Servlet方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toEditPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数获取soldierId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据soldierId查询Soldier对象</span></span><br><span class="line">    <span class="type">Soldier</span> <span class="variable">soldier</span> <span class="operator">=</span> soldierService.getSoldierById(soldierId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.将Soldier对象存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;soldier&quot;</span>, soldier);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.前往更新的表单页面</span></span><br><span class="line">    processTemplate(<span class="string">&quot;edit-page&quot;</span>, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③Service方法">③Service方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Soldier <span class="title function_">getSoldierById</span><span class="params">(String soldierId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> soldierDao.selectSoldierByPrimaryKey(soldierId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④Dao方法">④Dao方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Soldier <span class="title function_">selectSoldierByPrimaryKey</span><span class="params">(String soldierId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select soldier_id soldierId,soldier_name soldierName,soldier_weapon soldierWeapon from t_soldier where soldier_id=?&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> getBean(Soldier.class, sql, soldierId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑤表单页面">⑤表单页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/SoldierServlet&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;updateSoldier&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;soldierId&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;soldier.soldierId&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    士兵姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;soldierName&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;soldier.soldierName&#125;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    士兵武器：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;soldierWeapon&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;soldier.soldierWeapon&#125;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="12、执行更新">12、执行更新</h2><p><img src="./images/img042.png" alt="./images"></p><h3 id="①Servlet方法">①Servlet方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">updateSoldier</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierIdOrigin</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierId&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">soldierId</span> <span class="operator">=</span> Integer.parseInt(soldierIdOrigin);</span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierName&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">soldierWeapon</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;soldierWeapon&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.封装对象</span></span><br><span class="line">    <span class="type">Soldier</span> <span class="variable">soldier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Soldier</span>(soldierId, soldierName, soldierWeapon);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用Service方法执行更新</span></span><br><span class="line">    soldierService.updateSoldier(soldier);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.重定向请求</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/SoldierServlet?method=showList&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②Service方法">②Service方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSoldier</span><span class="params">(Soldier soldier)</span> &#123;</span><br><span class="line"></span><br><span class="line">    soldierDao.updateSoldier(soldier);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③Dao方法">③Dao方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSoldier</span><span class="params">(Soldier soldier)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_soldier set soldier_name=?,soldier_weapon=? where soldier_id=?&quot;</span>;</span><br><span class="line">    update(sql, soldier.getSoldierName(), soldier.getSoldierWeapon(), soldier.getSoldierId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13、请求字符集设置">13、请求字符集设置</h2><ul><li>设置请求体字符集需要调用request.setCharacterEncoding(“UTF-8”);</li><li>request.setCharacterEncoding(“UTF-8”);要求在所有request.getParameter()前面</li><li>在执行子类Servlet方法时，其实都是先调用父类ModelBaseServlet的doPost()方法</li><li>doPost()方法中包含获取method请求参数的操作</li><li>所以最前面的request.getParameter()在doPost()方法中</li><li>所以request.setCharacterEncoding(“UTF-8”);要放在doPost()方法的request.getParameter()前面</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0.在所有request.getParameter()前面设置解析请求体的字符集</span></span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取method对应的数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;method&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ……</span></span><br></pre></td></tr></table></figure><p><a href="verse11.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse10/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse10/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十节 基本语法：分支与迭代</h1><h2 id="1、分支">1、分支</h2><h3 id="①if和unless">①if和unless</h3><p>让标记了th:if、th:unless的标签根据条件决定是否显示。</p><p>示例的实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer empId;</span><br><span class="line">    <span class="keyword">private</span> String empName;</span><br><span class="line">    <span class="keyword">private</span> Double empSalary;</span><br></pre></td></tr></table></figure><p>示例的Servlet代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.创建ArrayList对象并填充</span></span><br><span class="line">    List&lt;Employee&gt; employeeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    employeeList.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;tom&quot;</span>, <span class="number">500.00</span>));</span><br><span class="line">    employeeList.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">2</span>, <span class="string">&quot;jerry&quot;</span>, <span class="number">600.00</span>));</span><br><span class="line">    employeeList.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">3</span>, <span class="string">&quot;harry&quot;</span>, <span class="number">700.00</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.将集合数据存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;employeeList&quot;</span>, employeeList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用父类方法渲染视图</span></span><br><span class="line">    <span class="built_in">super</span>.processTemplate(<span class="string">&quot;list&quot;</span>, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>示例的HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工工资<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>抱歉！没有查询到你搜索的数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>有数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>有数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>if配合not关键词和unless配合原表达式效果是一样的，看自己的喜好。</p><h3 id="②switch">②switch</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>测试switch<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.memberLevel&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;level-1&quot;</span>&gt;</span>银牌会员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;level-2&quot;</span>&gt;</span>金牌会员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;level-3&quot;</span>&gt;</span>白金会员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;level-4&quot;</span>&gt;</span>钻石会员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、迭代">2、迭代</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>测试each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工工资<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>抱歉！没有查询到你搜索的数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历出来的每一个元素的名字 : $&#123;要遍历的集合&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee : $&#123;employeeList&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empId&#125;&quot;</span>&gt;</span>empId<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empName&#125;&quot;</span>&gt;</span>empName<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empSalary&#125;&quot;</span>&gt;</span>empSalary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在迭代过程中，可以参考下面的说明使用迭代状态：</p><p><img src="./images/img025.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>测试each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>员工工资<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>迭代状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>抱歉！没有查询到你搜索的数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(employeeList)&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历出来的每一个元素的名字 : $&#123;要遍历的集合&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee,empStatus : $&#123;employeeList&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empId&#125;&quot;</span>&gt;</span>empId<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empName&#125;&quot;</span>&gt;</span>empName<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.empSalary&#125;&quot;</span>&gt;</span>empSalary<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;empStatus.count&#125;&quot;</span>&gt;</span>count<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse09.html">上一节</a> <a href="index.html">回目录</a> <a href="verse11.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse07/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse07/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第七节 基本语法：获取请求参数</h1><p>具体来说，我们这里探讨的是在页面上（模板页面）获取请求参数。底层机制是：</p><p><img src="./images/img020.png" alt="./images"></p><h2 id="1、一个名字一个值">1、一个名字一个值</h2><p>页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;param.username&#125;&quot;</span>&gt;</span>这里替换为请求参数的值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面显示效果：</p><p><img src="./images/img015.png" alt="./images"></p><h2 id="2、一个名字多个值">2、一个名字多个值</h2><p>页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;param.team&#125;&quot;</span>&gt;</span>这里替换为请求参数的值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面显示效果：</p><p><img src="./images/img016.png" alt="./images"></p><p>如果想要精确获取某一个值，可以使用数组下标。页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;param.team[0]&#125;&quot;</span>&gt;</span>这里替换为请求参数的值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;param.team[1]&#125;&quot;</span>&gt;</span>这里替换为请求参数的值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面显示效果：</p><p><img src="./images/img017.png" alt="./images"></p><p><a href="verse06.html">上一节</a> <a href="index.html">回目录</a> <a href="verse08.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse06/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse06/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第六节 基本语法：访问域对象</h1><h2 id="1、域对象">1、域对象</h2><h3 id="①请求域">①请求域</h3><p>在请求转发的场景下，我们可以借助HttpServletRequest对象内部给我们提供的存储空间，帮助我们携带数据，把数据发送给转发的目标资源。</p><p>请求域：HttpServletRequest对象内部给我们提供的存储空间</p><p><img src="./images/img012.png" alt="./images"></p><h3 id="②会话域">②会话域</h3><p><img src="./images/img013.png" alt="./images"></p><h3 id="③应用域">③应用域</h3><p><img src="./images/img014.png" alt="./images"></p><blockquote><p>PS：在我们使用的视图是JSP的时候，域对象有4个</p><ul><li>pageContext</li><li>request：请求域</li><li>session：会话域</li><li>application：应用域</li></ul><p>所以在JSP的使用背景下，我们可以说域对象有4个，现在使用Thymeleaf了，没有pageContext。</p></blockquote><h2 id="2、在Servlet中将数据存入属性域">2、在Servlet中将数据存入属性域</h2><h3 id="①操作请求域">①操作请求域</h3><p>Servlet中代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">requestAttrName</span> <span class="operator">=</span> <span class="string">&quot;helloRequestAttr&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">requestAttrValue</span> <span class="operator">=</span> <span class="string">&quot;helloRequestAttr-VALUE&quot;</span>;</span><br><span class="line"></span><br><span class="line">request.setAttribute(requestAttrName, requestAttrValue);</span><br></pre></td></tr></table></figure><p>Thymeleaf表达式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;helloRequestAttr&#125;&quot;</span>&gt;</span>request field value<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②操作会话域">②操作会话域</h3><p>Servlet中代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ①通过request对象获取session对象</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ②存入数据</span></span><br><span class="line">session.setAttribute(<span class="string">&quot;helloSessionAttr&quot;</span>, <span class="string">&quot;helloSessionAttr-VALUE&quot;</span>);</span><br></pre></td></tr></table></figure><p>Thymeleaf表达式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.helloSessionAttr&#125;&quot;</span>&gt;</span>这里显示会话域数据<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③操作应用域">③操作应用域</h3><p>Servlet中代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ①通过调用父类的方法获取ServletContext对象</span></span><br><span class="line"><span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> getServletContext();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ②存入数据</span></span><br><span class="line">servletContext.setAttribute(<span class="string">&quot;helloAppAttr&quot;</span>, <span class="string">&quot;helloAppAttr-VALUE&quot;</span>);</span><br></pre></td></tr></table></figure><p>Thymeleaf表达式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;application.helloAppAttr&#125;&quot;</span>&gt;</span>这里显示应用域数据<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse05.html">上一节</a> <a href="index.html">回目录</a> <a href="verse07.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse08/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse08/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第八节 基本语法：内置对象</h1><h2 id="1、概念">1、概念</h2><p>所谓内置对象其实就是在表达式中<span style="color:blue;font-weight:bold;">可以直接使用</span>的对象。</p><h2 id="2、基本内置对象">2、基本内置对象</h2><p><img src="./images/img021.png" alt="./images"></p><p>用法举例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>表达式的基本内置对象<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#request.getClass().getName()&#125;&quot;</span>&gt;</span>这里显示#request对象的全类名<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#request.getContextPath()&#125;&quot;</span>&gt;</span>调用#request对象的getContextPath()方法<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#request.getAttribute(&#x27;helloRequestAttr&#x27;)&#125;&quot;</span>&gt;</span>调用#request对象的getAttribute()方法，读取属性域<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>基本思路：</p><ul><li>如果不清楚这个对象有哪些方法可以使用，那么就通过getClass().getName()获取全类名，再回到Java环境查看这个对象有哪些方法</li><li>内置对象的方法可以直接调用</li><li>调用方法时需要传参的也可以直接传入参数</li></ul><h2 id="3、公共内置对象">3、公共内置对象</h2><p><img src="./images/img022.png" alt="./images"></p><p>Servlet中将List集合数据存入请求域：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">&quot;aNotEmptyList&quot;</span>, Arrays.asList(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;ccc&quot;</span>));</span><br><span class="line">request.setAttribute(<span class="string">&quot;anEmptyList&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br></pre></td></tr></table></figure><p>页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>#list对象isEmpty方法判断集合整体是否为空aNotEmptyList：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#lists.isEmpty(aNotEmptyList)&#125;&quot;</span>&gt;</span>测试#lists<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>#list对象isEmpty方法判断集合整体是否为空anEmptyList：<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#lists.isEmpty(anEmptyList)&#125;&quot;</span>&gt;</span>测试#lists<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>公共内置对象对应的源码位置：</p><p><img src="./images/img023.png" alt="./images"></p><p><a href="verse07.html">上一节</a> <a href="index.html">回目录</a> <a href="verse09.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 基本语法：表达式语法</h1><h2 id="1、修改标签文本值">1、修改标签文本值</h2><p>代码示例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;标签体新值&quot;</span>&gt;</span>标签体原始值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="①th-text作用">①th:text作用</h3><ul><li>不经过服务器解析，直接用浏览器打开HTML文件，看到的是『标签体原始值』</li><li>经过服务器解析，Thymeleaf引擎根据th:text属性指定的『标签体新值』去<span style="color:blue;font-weight:bold;">替换</span>『标签体原始值』</li></ul><h3 id="②字面量">②字面量</h3><p>『字面量』是一个经常会遇到的概念，我们可以对照『变量』来理解它的含义。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a是变量，100是字面量</span></span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;a = &quot;</span> + a);</span><br></pre></td></tr></table></figure><ul><li>变量：变量名字符串本身不是它的值，它指向的才是它的值</li><li>字面量：它就是字面上的含义，我们从『字面』上看到的直接就是它的值</li></ul><p>现在我们在th:text属性中使用的就是『字面量』，它<span style="color:blue;font-weight:bold;">不指代任何其他值</span>。</p><h2 id="2、修改指定属性值">2、修改指定属性值</h2><p>代码示例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;文本框新值&quot;</span> <span class="attr">value</span>=<span class="string">&quot;文本框旧值&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>语法：任何HTML标签原有的属性，前面加上『th:』就都可以通过Thymeleaf来设定新值。</p><h2 id="3、解析URL地址">3、解析URL地址</h2><h3 id="①基本语法">①基本语法</h3><p>代码示例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;@&#123;/aaa/bbb/ccc&#125;&quot;</span>&gt;</span>标签体原始值<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>经过解析后得到：</p><blockquote><p>/view/aaa/bbb/ccc</p></blockquote><p>所以@{}的作用是<span style="color:blue;font-weight:bold;">在字符串前附加『上下文路径』</span></p><blockquote><p>这个语法的好处是：实际开发过程中，项目在不同环境部署时，Web应用的名字有可能发生变化。所以上下文路径不能写死。而通过@{}动态获取上下文路径后，不管怎么变都不怕啦！</p></blockquote><h3 id="②首页使用URL地址解析">②首页使用URL地址解析</h3><p><img src="./images/img018.png" alt="./images"></p><p>如果我们直接访问index.html本身，那么index.html是不需要通过Servlet，当然也不经过模板引擎，所以index.html上的Thymeleaf的任何表达式都不会被解析。</p><p>解决办法：通过Servlet访问index.html，这样就可以让模板引擎渲染页面了：</p><p><img src="./images/img019.png" alt="./images"></p><blockquote><p>进一步的好处：</p><p>通过上面的例子我们看到，所有和业务功能相关的请求都能够确保它们通过Servlet来处理，这样就方便我们统一对这些请求进行特定规则的限定。</p></blockquote><h3 id="③给URL地址后面附加请求参数">③给URL地址后面附加请求参数</h3><p>参照官方文档说明：</p><p><img src="./images/img037.png" alt="./images"></p><h2 id="4、直接执行表达式">4、直接执行表达式</h2><p>Servlet代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">&quot;reqAttrName&quot;</span>, <span class="string">&quot;&lt;span&gt;hello-value&lt;/span&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p>页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>有转义效果：[[$&#123;reqAttrName&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>无转义效果：[($&#123;reqAttrName&#125;)]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>执行效果：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>有转义效果：<span class="symbol">&amp;lt;</span>span<span class="symbol">&amp;gt;</span>hello-value<span class="symbol">&amp;lt;</span>/span<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>无转义效果：<span class="tag">&lt;<span class="name">span</span>&gt;</span>hello-value<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a> <a href="verse06.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse04/</url>
      
        <content type="html"><![CDATA[<h1>第四节 基本语法：th名称空间</h1><p><img src="./images/img011.png" alt="images"></p><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 在服务器端引入Thymeleaf环境</h1><h2 id="1、加入jar包">1、加入jar包</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="2、配置上下文参数">2、配置上下文参数</h2><p><img src="./images/img006.png" alt="./images"></p><p><img src="./images/img007.png" alt="./images"></p><p>物理视图=视图前缀+逻辑视图+视图后缀</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在上下文参数中配置视图前缀和视图后缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/view/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p>说明：param-value中设置的前缀、后缀的值不是必须叫这个名字，可以根据实际情况和需求进行修改。</p><blockquote><p>为什么要放在WEB-INF目录下？</p><p>原因：WEB-INF目录不允许浏览器直接访问，所以我们的视图模板文件放在这个目录下，是一种保护。以免外界可以随意访问视图模板文件。</p><p>访问WEB-INF目录下的页面，都必须通过Servlet转发过来，简单说就是：不经过Servlet访问不了。</p><p>这样就方便我们在Servlet中检查当前用户是否有权限访问。</p><p>那放在WEB-INF目录下之后，重定向进不去怎么办？</p><p>重定向到Servlet，再通过Servlet转发到WEB-INF下。</p></blockquote><h2 id="3、创建Servlet基类">3、创建Servlet基类</h2><p>这个类大家直接<span style="color:blue;font-weight:bold;">复制粘贴</span>即可，将来使用框架后，这些代码都将被取代。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.WebContext;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ServletContextTemplateResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, getServletContext());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、HelloWorld">4、HelloWorld</h2><h3 id="①创建index-html">①创建index.html</h3><p><img src="./images/img008.png" alt="./images"></p><h3 id="②在index-html编写超链接">②在index.html编写超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/view/TestThymeleafServlet&quot;</span>&gt;</span>初步测试Thymeleaf<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③创建Servlet">③创建Servlet</h3><p><img src="./images/img009.png" alt="./images"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>TestThymeleafServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.thymeleaf.servlet.TestThymeleafServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>TestThymeleafServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/TestThymeleafServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④修改Servlet继承的父类">④修改Servlet继承的父类</h3><p><img src="./images/img010.png" alt="./images"></p><h3 id="⑤在doGet-方法中跳转到Thymeleaf页面">⑤在doGet()方法中跳转到Thymeleaf页面</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.声明当前请求要前往的视图名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.调用ViewBaseServlet父类中的解析视图模板的方法</span></span><br><span class="line">    <span class="built_in">super</span>.processTemplate(viewName, request, response);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑥Thymeleaf页面">⑥Thymeleaf页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在html标签内加入Thymeleaf名称空间的声明 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 在p标签的基础上，使用Thymeleaf的表达式，解析了一个URL地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;@&#123;&#x27;/aaa/bbb/ccc&#x27;&#125;&quot;</span>&gt;</span>Thymeleaf将在这里显示一个解析出来的URL地址<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 Thymeleaf简介</h1><h2 id="1、Thymeleaf的同行">1、Thymeleaf的同行</h2><p>JSP、Freemarker、Velocity等等，它们有一个共同的名字：<span style="color:blue;font-weight:bold;">服务器端模板技术</span>。</p><h2 id="2、Thymeleaf官方文档中的介绍">2、Thymeleaf官方文档中的介绍</h2><p><a href="https://www.thymeleaf.org/">官网地址</a></p><p><a href="Thymeleaf-3.0.11.pdf">官方文档</a></p><blockquote><p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text. The main goal of Thymeleaf is to provide an elegant and highly-maintainable way of creating templates. To achieve this, it builds on the concept of Natural Templates to inject its logic into template files in a way that doesn’t affect the template from being used as a design prototype. This improves communication of design and bridges the gap between design and development teams. Thymeleaf has also been designed from the beginning with Web Standards in mind – especially HTML5 – allowing you to create fully validating templates if that is a need for you.</p></blockquote><h2 id="3、Thymeleaf优势">3、Thymeleaf优势</h2><ul><li><p>SpringBoot官方推荐使用的视图模板技术，和SpringBoot完美整合。</p></li><li><p>不经过服务器运算仍然可以直接查看原始值，对前端工程师更友好。</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hello&#125;&quot;</span>&gt;</span>Original Value<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、物理视图和逻辑视图">4、物理视图和逻辑视图</h2><h3 id="①物理视图">①物理视图</h3><p>在Servlet中，将请求转发到一个HTML页面文件时，使用的完整的转发路径就是<span style="color:blue;font-weight:bold;">物理视图</span>。<img src="./images/img005.png" alt="./images"></p><blockquote><p>/pages/user/login_success.html</p></blockquote><p>如果我们把所有的HTML页面都放在某个统一的目录下，那么转发地址就会呈现出明显的规律：</p><blockquote><p>/pages/user/login.html<br>/pages/user/login_success.html<br>/pages/user/regist.html<br>/pages/user/regist_success.html</p><p>……</p></blockquote><p>路径的开头都是：/pages/user/</p><p>路径的结尾都是：.html</p><p>所以，路径开头的部分我们称之为<span style="color:blue;font-weight:bold;">视图前缀</span>，路径结尾的部分我们称之为<span style="color:blue;font-weight:bold;">视图后缀</span>。</p><h3 id="②逻辑视图">②逻辑视图</h3><p>物理视图=视图前缀+逻辑视图+视图后缀</p><p>上面的例子中：</p><table><thead><tr><th>视图前缀</th><th>逻辑视图</th><th>视图后缀</th><th>物理视图</th></tr></thead><tbody><tr><td>/pages/user/</td><td>login</td><td>.html</td><td>/pages/user/login.html</td></tr><tr><td>/pages/user/</td><td>login_success</td><td>.html</td><td>/pages/user/login_success.html</td></tr></tbody></table><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 MVC</h1><h2 id="1、提出问题">1、提出问题</h2><p><img src="./images/img002.png" alt="./images"></p><p>我们对HTML的新的期待：既能够正常显示页面，又能在页面中包含动态数据部分。而动态数据单靠HTML本身是无法做到的，所以此时我们需要引入服务器端动态视图模板技术。</p><h2 id="2、从三层结构到MVC">2、从三层结构到MVC</h2><h3 id="①MVC概念">①MVC概念</h3><p>M：Model模型</p><p>V：View视图</p><p>C：Controller控制器</p><p>MVC是在表述层开发中运用的一种设计理念。主张把<span style="color:blue;font-weight:bold;">封装数据的『模型』</span>、<span style="color:blue;font-weight:bold;">显示用户界面的『视图』</span>、<span style="color:blue;font-weight:bold;">协调调度的『控制器』</span>分开。</p><p>好处：</p><ul><li>进一步实现各个组件之间的解耦</li><li>让各个组件可以单独维护</li><li>将视图分离出来以后，我们后端工程师和前端工程师的对接更方便</li></ul><h3 id="②MVC和三层架构之间关系">②MVC和三层架构之间关系</h3><p><img src="./images/img003.png" alt="./images"></p><h2 id="3、前后端工程师对接方式">3、前后端工程师对接方式</h2><ul><li>服务器端渲染：前端工程师把前端页面一整套做好交给后端工程师</li><li>前后端分离：开会商量JSON格式，然后分头开发。在后端程序尚不可用时，前端工程师会使用Mock.js生成假数据使用，在后端程序可用后再连接实际后端程序获取真实数据。</li></ul><p><a href="http://heavy_code_industry.gitee.io/code_heavy_industry/pro000-dev-story/chapter05/content.html">查看详细内容</a></p><p><img src="./images/img004.png" alt="./images"></p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter08/index/</url>
      
        <content type="html"><![CDATA[<h1>第八章 Thymeleaf</h1><p><a href="verse01.html">第一节 MVC</a></p><p><a href="verse02.html">第二节 Thymeleaf简介</a></p><p><a href="verse03.html">第三节 在服务器端引入Thymeleaf环境</a></p><p><a href="verse04.html">第四节 基本语法：th名称空间</a></p><p><a href="verse05.html">第五节 基本语法：表达式语法</a></p><p><a href="verse06.html">第六节 基本语法：访问域对象</a></p><p><a href="verse07.html">第七节 基本语法：获取请求参数</a></p><p><a href="verse08.html">第八节 基本语法：内置对象</a></p><p><a href="verse09.html">第九节 基本语法：${}中的表达式本质是OGNL</a></p><p><a href="verse10.html">第十节 基本语法：分支与迭代</a></p><p><a href="verse11.html">第十一节 基本语法：包含其他模板文件</a></p><p><a href="verse12.html">第十二节 加餐：CRUD练习</a></p><p><a href="../chapter07/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter09/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse08/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse08/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第八节 请求转发和重定向</h1><h2 id="1、接力">1、接力</h2><p>发一个请求给Servlet，接力棒就传递到了Servlet手中。而绝大部分情况下，Servlet不能独自完成一切，需要把接力棒继续传递下去，此时我们就需要请求的<span style="color:blue;font-weight:bold;">『转发』</span>或<span style="color:blue;font-weight:bold;">『重定向』</span>。</p><h2 id="2、转发">2、转发</h2><p>本质：<span style="color:blue;font-weight:bold;">转交</span></p><p>完整定义：在请求的处理过程中，Servlet完成了自己的任务，需要把请求<span style="color:blue;font-weight:bold;">转交给下一个资源</span>继续处理。</p><p><img src="./images/img033.png" alt="./images"></p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">&quot;/fruit/apple/red/sweet/big.html&quot;</span>).forward(request, response);</span><br></pre></td></tr></table></figure><p>类比：</p><table><thead><tr><th>代码</th><th>类比</th></tr></thead><tbody><tr><td>request</td><td>小货车</td></tr><tr><td>getRequestDispatcher(“转发地址”)</td><td>告诉司机要去哪</td></tr><tr><td>forward(request, response)</td><td>出发</td></tr></tbody></table><p>关键：由于转发操作的核心部分是<span style="color:blue;font-weight:bold;">在服务器端完成</span>的，所以浏览器感知不到，整个过程中浏览器<span style="color:blue;font-weight:bold;">只发送一次请求</span>。</p><p><img src="./images/img036.png" alt="./images"></p><h2 id="3、重定向">3、重定向</h2><p>本质：<span style="color:blue;font-weight:bold;">一种特殊的响应</span></p><p>完整定义：在请求的处理过程中，Servlet完成了自己的任务，然后以一个<span style="color:blue;font-weight:bold;">响应</span>的方式告诉浏览器：“要完成这个任务还需要你另外<span style="color:blue;font-weight:bold;">再访问下一个资源</span>”。</p><p><img src="./images/img034.png" alt="./images"></p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">&quot;/app/fruit/apple/red/sweet/big.html&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="./images/img035.png" alt="./images"></p><p>关键：由于重定向操作的核心部分是<span style="color:blue;font-weight:bold;">在浏览器端完成</span>的，所以整个过程中浏览器<span style="color:blue;font-weight:bold;">共发送两次请求</span>。</p><h2 id="4、对比">4、对比</h2><table><thead><tr><th>转发</th><th>重定向</th></tr></thead><tbody><tr><td><span style="color:blue;font-weight:bold;">一次请求</span></td><td><span style="color:blue;font-weight:bold;">两次请求</span></td></tr><tr><td>浏览器地址栏显示的是第一个资源的地址</td><td>浏览器地址栏显示的是第二个资源的地址</td></tr><tr><td>全程使用的是同一个request对象</td><td>全程使用的是不同的request对象</td></tr><tr><td>在服务器端完成</td><td>在浏览器端完成</td></tr><tr><td>目标资源地址由服务器解析</td><td>目标资源地址由浏览器解析</td></tr><tr><td>目标资源可以在WEB-INF目录下</td><td>目标资源不能在WEB-INF目录下</td></tr><tr><td>目标资源仅限于本应用内部</td><td>目标资源可以是外部资源</td></tr></tbody></table><h2 id="5、转发和重定向的应用场景">5、转发和重定向的应用场景</h2><p>可以简单的判断：能用转发的先用转发，如果转发不行，再使用重定向。</p><ul><li>需要通过同一个request对象把数据携带到目标资源：只能用转发</li><li>如果希望前往下一个资源之后，浏览器刷新访问的是第二个资源：只能用重定向</li></ul><p><a href="verse07.html">上一节</a> <a href="index.html">回目录</a> <a href="verse09.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse09/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse09/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第九节 获取请求参数</h1><h2 id="1、请求参数的概念">1、请求参数的概念</h2><p>浏览器在给服务器发送请求的同时，携带的参数数据。</p><h2 id="2、浏览器端发送请求参数的基本形式">2、浏览器端发送请求参数的基本形式</h2><ul><li>URL地址后面附着的请求参数</li></ul><blockquote><p>/orange/CharacterServlet?username=汤姆</p></blockquote><ul><li>表单</li><li>Ajax请求（将来会学到）</li></ul><h2 id="3、服务器端对请求参数的封装">3、服务器端对请求参数的封装</h2><p>总体上来说，服务器端将请求参数封装为<span style="color:blue;font-weight:bold;">Map&lt;String, String[]&gt;</span>。</p><ul><li>键：请求参数的名字</li><li>值：请求参数的值组成的数组</li></ul><h2 id="4、获取请求参数的方法">4、获取请求参数的方法</h2><table><thead><tr><th>方法名</th><th>返回值类型</th></tr></thead><tbody><tr><td>request.getParameterMap()</td><td>Map&lt;String, String[]&gt;</td></tr><tr><td>request.getParameter(“请求参数的名字”)</td><td>String</td></tr><tr><td>request.getParameterValues(“请求参数的名字”)</td><td>String []</td></tr><tr><td>request.getParameterNames()</td><td>Enumeration&lt;String&gt;</td></tr></tbody></table><h2 id="5、测试">5、测试</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试请求参数的表单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/orange/ParamServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 单行文本框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- input标签配合type=&quot;text&quot;属性生成单行文本框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name属性定义的是请求参数的名字 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果设置了value属性，那么这个值就是单行文本框的默认值 --&gt;</span></span><br><span class="line">    个性签名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;signal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;单行文本框的默认值&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 密码框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- input标签配合type=&quot;password&quot;属性生成密码框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用户在密码框中填写的内容不会被一明文形式显示 --&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;secret&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 单选框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- input标签配合type=&quot;radio&quot;属性生成单选框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name属性一致的radio会被浏览器识别为同一组单选框，同一组内只能选择一个 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 提交表单后，真正发送给服务器的是name属性和value属性的值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用checked=&quot;checked&quot;属性设置默认被选中 --&gt;</span></span><br><span class="line">    请选择你最喜欢的季节：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;spring&quot;</span> /&gt;</span>春天</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;summer&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>夏天</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;autumn&quot;</span> /&gt;</span>秋天</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;winter&quot;</span> /&gt;</span>冬天</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    你最喜欢的动物是：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tiger&quot;</span> /&gt;</span>路虎</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;horse&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>宝马</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cheetah&quot;</span> /&gt;</span>捷豹</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 多选框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- input标签和type=&quot;checkbox&quot;配合生成多选框 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多选框被用户选择多个并提交表单后会产生『一个名字携带多个值』的情况 --&gt;</span></span><br><span class="line">    你最喜欢的球队是：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Brazil&quot;</span>/&gt;</span>巴西</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;German&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span>德国</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;France&quot;</span>/&gt;</span>法国</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;China&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span>中国</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Italian&quot;</span>/&gt;</span>意大利</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 下拉列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用select标签定义下拉列表整体，在select标签内设置name属性 --&gt;</span></span><br><span class="line">    你最喜欢的运动是：</span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;sport&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用option属性定义下拉列表的列表项 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用option标签的value属性设置提交给服务器的值，在option标签的标签体中设置给用户看的值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;swimming&quot;</span>&gt;</span>游泳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;running&quot;</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 使用option标签的selected=&quot;selected&quot;属性设置这个列表项默认被选中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shooting&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>射击<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;skating&quot;</span>&gt;</span>溜冰<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表单隐藏域 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- input标签和type=&quot;hidden&quot;配合生成表单隐藏域 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表单隐藏域在页面上不会有任何显示，用来保存要提交到服务器但是又不想让用户看到的数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;234654745&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 多行文本框 --&gt;</span></span><br><span class="line">    自我介绍：<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>多行文本框的默认值<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 普通按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>&gt;</span>普通按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 重置按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>重置按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表单提交按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Java代码">②Java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取包含全部请求参数的Map</span></span><br><span class="line">    Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历这个包含全部请求参数的Map</span></span><br><span class="line">    Set&lt;String&gt; keySet = parameterMap.keySet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line"></span><br><span class="line">        String[] values = parameterMap.get(key);</span><br><span class="line"></span><br><span class="line">        System.out.println(key + <span class="string">&quot;=&quot;</span> + Arrays.asList(values));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据请求参数名称获取指定的请求参数值</span></span><br><span class="line">    <span class="comment">// getParameter()方法：获取单选框的请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">season</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;season&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;season = &quot;</span> + season);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParameter()方法：获取多选框的请求参数</span></span><br><span class="line">    <span class="comment">// 只能获取到多个值中的第一个</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">team</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;team&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;team = &quot;</span> + team);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParameterValues()方法：取单选框的请求参数</span></span><br><span class="line">    String[] seasons = request.getParameterValues(<span class="string">&quot;season&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;Arrays.asList(seasons) = &quot;</span> + Arrays.asList(seasons));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getParameterValues()方法：取多选框的请求参数</span></span><br><span class="line">    String[] teams = request.getParameterValues(<span class="string">&quot;team&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;Arrays.asList(teams) = &quot;</span> + Arrays.asList(teams));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse08.html">上一节</a> <a href="index.html">回目录</a> <a href="verse10.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse10/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse10/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十节 请求响应设置字符集</h1><h2 id="1、请求">1、请求</h2><h3 id="①GET请求">①GET请求</h3><h4 id="1-设置之前">[1]设置之前</h4><p>发送请求参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/orange/CharacterServlet?username=汤姆&quot;</span>&gt;</span>测试请求字符集设置：GET请求<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接收到的数据：</p><blockquote><p>username = ?±¤?§?</p></blockquote><h4 id="2-设置方式">[2]设置方式</h4><p><img src="./images/img037.png" alt="./images"></p><p>在server.xml第71行的Connector标签中增加URIEncoding属性：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br></pre></td></tr></table></figure><p>重启Tomcat实例即可。再重新测试的结果是：</p><blockquote><p>username = 汤姆</p></blockquote><h3 id="②POST请求">②POST请求</h3><h4 id="1-设置之前-2">[1]设置之前</h4><p>发送请求参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试请求字符集设置：POST请求 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/orange/CharacterServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接收到的数据：</p><blockquote><p>username = ???</p></blockquote><h4 id="2-设置方式-2">[2]设置方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用request对象设置字符集</span></span><br><span class="line">request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取请求参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;username = &quot;</span> + username);</span><br></pre></td></tr></table></figure><p>接收到的数据：</p><blockquote><p>username = 林志玲</p></blockquote><h4 id="3-需要注意的问题">[3]需要注意的问题</h4><p>不能在设置字符集之前获取请求参数！下面是错误的<span style="color:blue;font-weight:bold;">示范</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取请求参数（先获取请求参数会导致设置字符集失效）</span></span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用request对象设置字符集</span></span><br><span class="line">request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;username = &quot;</span> + username);</span><br></pre></td></tr></table></figure><h2 id="2、响应">2、响应</h2><h3 id="①设置之前">①设置之前</h3><p>服务器端代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"></span><br><span class="line">writer.write(<span class="string">&quot;志玲姐姐你好！&quot;</span>);</span><br></pre></td></tr></table></figure><p>浏览器显示：</p><blockquote><p>???</p></blockquote><h3 id="②设置方式一">②设置方式一</h3><p>编码字符集和解码字符集一致</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置服务器端的编码字符集</span></span><br><span class="line">response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"></span><br><span class="line">writer.write(<span class="string">&quot;&lt;!DOCTYPE html&gt;                  &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;html&gt;                           &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;head&gt;                           &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;!-- 设置浏览器端的解码字符集 --&gt;&quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;    &lt;meta charset=&#x27;UTF-8&#x27;&gt;       &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;    &lt;title&gt;Title&lt;/title&gt;         &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;/head&gt;                          &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;body&gt;                           &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;p&gt;志玲姐姐你好！&lt;/p&gt;            &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;/body&gt;                          &quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;/html&gt;                          &quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="③设置方式二">③设置方式二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="④需要注意的问题">④需要注意的问题</h3><p>response.getWriter()不能出现在设置字符集操作的前面（两种方式都不行）。</p><p><a href="verse09.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse05/</url>
      
        <content type="html"><![CDATA[<h1>第五节 使用IDEA创建Servlet</h1><p><img src="./images/img022.png" alt="./images"></p><p><img src="./images/img023.png" alt="./images"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- IDEA会自动生成servlet标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>QuickServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.servlet.QuickServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 我们自己补充servlet-mapping标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>QuickServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/QuickServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>IDEA生成的Servlet自动继承了HttpServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是测试代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;doPost method processed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;doGet method processed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/app/QuickServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>发送GET请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/app/QuickServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>发送POST请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a> <a href="verse06.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse06/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse06/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第六节 Servlet 继承关系[了解]</h1><h2 id="1、提出问题">1、提出问题</h2><ul><li>为什么IDEA创建Servlet之后不再<span style="color:blue;font-weight:bold;">实现Servlet接口</span>而是<span style="color:blue;font-weight:bold;">继承HttpServlet类</span>？</li><li><span style="color:blue;font-weight:bold;">Servlet接口</span>和<span style="color:blue;font-weight:bold;">HttpServlet类</span>有什么关系？</li><li><span style="color:blue;font-weight:bold;">doXxx()方法</span>和<span style="color:blue;font-weight:bold;">service()方法</span>有什么关系？</li></ul><h2 id="2、类型关系">2、类型关系</h2><p><img src="./images/img024.png" alt="./images"></p><h2 id="3、方法关系">3、方法关系</h2><p><img src="./images/img025.png" alt="./images"></p><p><a href="verse05.html">上一节</a> <a href="index.html">回目录</a> <a href="verse07.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse07/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse07/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第七节 动态Web工程内编写路径</h1><h2 id="1、为什么要写路径？">1、为什么要写路径？</h2><p><img src="./images/img026.gif" alt="./images"></p><ul><li>整个系统要根据功能拆分成许许多多<span style="color:blue;font-weight:bold;">独立</span>的<span style="color:blue;font-weight:bold;">资源</span></li><li>资源之间既要完成自身的功能又要和其他资源<span style="color:blue;font-weight:bold;">配合</span></li><li>写路径就是为了从一个资源<span style="color:blue;font-weight:bold;">跳转</span>到下一个资源</li></ul><h2 id="2、为什么写路径这事有点复杂？">2、为什么写路径这事有点复杂？</h2><h3 id="①先开发再部署">①先开发再部署</h3><p><img src="./images/img026.png" alt="./images"></p><ul><li><span style="color:blue;font-weight:bold;">工程目录</span>：我们写代码的地方，但是在服务器上运行的不是这个。</li><li><span style="color:blue;font-weight:bold;">部署目录</span>：经过Java源文件<span style="color:blue;font-weight:bold;">编译</span>和<span style="color:blue;font-weight:bold;">目录重组</span>后，IDEA就替我们准备好了可以在服务器上运行的部署目录。</li><li><span style="color:blue;font-weight:bold;">区别</span>：因为从工程目录到部署目录经过了<span style="color:blue;font-weight:bold;">目录重组</span>，所以它们的目录结构是<span style="color:blue;font-weight:bold;">不同</span>的。</li><li><span style="color:blue;font-weight:bold;">基准</span>：用户通过浏览器访问服务器，而服务器上运行的是部署目录，所以写路径的时候<span style="color:blue;font-weight:bold;">参考部署目录</span>而不是工程目录。</li><li><span style="color:blue;font-weight:bold;">对应关系</span>：<span style="color:blue;font-weight:bold;">工程目录下的web目录对应部署目录的根目录</span>，同时部署目录的根目录也是路径中的<span style="color:blue;font-weight:bold;">Web应用根目录</span>。</li></ul><p><img src="./images/img028.png" alt="./images"></p><h3 id="②路径的各个组成部分">②路径的各个组成部分</h3><p>从最前面一直到Web应用名称这里都是固定写法，到资源名这里要看具体是什么资源。</p><p><img src="./images/img027.png" alt="./images"></p><h4 id="1-具体文件">[1]具体文件</h4><p>我们写代码的时候都是在工程目录下操作，所以参照工程目录来说最方便。按照工程目录的目录结构来说，从web目录开始按照实际目录结构写就好了（不包括web目录本身）。</p><p><img src="./images/img029.png" alt="./images"></p><h4 id="2-Servlet">[2]Servlet</h4><p>访问Servlet的路径是我们在web.xml中配置的，大家可能注意到了，url-pattern里面的路径我们也是<span style="color:blue;font-weight:bold;">斜杠开头</span>的，但是这个开头的斜杠代表<span style="color:blue;font-weight:bold;">Web应用根目录</span>。</p><p><img src="./images/img030.png" alt="./images"></p><p>同样是开头的斜杠，超链接路径中的开头斜杠代表服务器根目录，Servlet地址开头的斜杠，代表Web应用根目录，怎么记呢？请看下面的准则：</p><h2 id="3、准则">3、准则</h2><blockquote><p>用通俗的大白话来解释：一个路径由谁来解析，其实就是这个路径是谁来用。</p></blockquote><table><thead><tr><th>路径类型</th><th>解析方式</th></tr></thead><tbody><tr><td>由浏览器解析的路径</td><td>开头斜杠代表服务器根目录</td></tr><tr><td>由服务器解析的路径</td><td>开头斜杠代表Web应用根目录</td></tr></tbody></table><p><img src="./images/img031.png" alt="./images"></p><p>那么具体来说，哪些路径是浏览器解析的，哪些路径是服务器解析的呢？</p><ul><li>浏览器解析的路径举例：<ul><li>所有HTML标签中的路径</li><li>重定向过程中指定的路径</li></ul></li><li>服务器解析的路径举例：<ul><li>所有web.xml中配置的路径</li><li>请求转发过程中指定的路径</li></ul></li></ul><h2 id="4、写路径的步骤">4、写路径的步骤</h2><p><img src="./images/img032.png" alt="./images"></p><h2 id="5、动态获取上下文路径">5、动态获取上下文路径</h2><h3 id="①上下文路径的概念">①上下文路径的概念</h3><p>上下文路径（context path）=/Web应用名称</p><h3 id="②动态获取">②动态获取</h3><p>由于项目部署的时候，上下文路径是可以变化的，所以写死有可能发生错误。此时我们通过request对象动态获取上下文路径就不用担心这个问题了。调用下面这个方法，每一次获取的都是当前环境下实际的上下文路径的值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getContextPath()</span><br></pre></td></tr></table></figure><blockquote><p>如果本节让你感觉很复杂，建议你放慢节奏，尝试下面的步骤：</p><ul><li>第一步：先弄清楚每个『名词概念』，清楚的知道我们提到的每一个名词指的是什么。</li><li>第二步：弄清楚底层运行原理，其实就是工程目录和部署目录的区别。</li><li>第三步：按照我们介绍的步骤一步一步慢慢写，写一步想一想，弄清楚各个部分的对应关系。</li></ul></blockquote><p><a href="verse06.html">上一节</a> <a href="index.html">回目录</a> <a href="verse08.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h2 id="第四节-ServletConfig和ServletContext">第四节 ServletConfig和ServletContext</h2><h2 id="1、类比">1、类比</h2><p><img src="./images/img019.png" alt="./images"></p><h2 id="2、ServletConfig接口">2、ServletConfig接口</h2><h3 id="①接口概览">①接口概览</h3><p><img src="./images/img020.png" alt="./images"></p><h3 id="②接口方法介绍">②接口方法介绍</h3><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>getServletName()</td><td>获取&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;定义的Servlet名称</td></tr><tr><td><span style="color:blue;font-weight:bold;">getServletContext()</span></td><td>获取ServletContext对象</td></tr><tr><td>getInitParameter()</td><td>获取配置Servlet时设置的『初始化参数』，根据名字获取值</td></tr><tr><td>getInitParameterNames()</td><td>获取所有初始化参数名组成的Enumeration对象</td></tr></tbody></table><h3 id="③初始化参数举例">③初始化参数举例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Servlet本身 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全类名太长，给Servlet设置一个简短名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet的全类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置初始化参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>goodMan<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>me<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet启动顺序 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④体验">④体验</h3><p>在HelloServlet中增加代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明一个成员变量，用来接收init()方法传入的servletConfig对象</span></span><br><span class="line">    <span class="keyword">private</span> ServletConfig servletConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我来了！HelloServlet对象创建！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;HelloServlet对象初始化&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Tomcat调用init()方法时传入的servletConfig对象赋值给成员变量</span></span><br><span class="line">        <span class="built_in">this</span>.servletConfig = servletConfig;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回成员变量servletConfig，方便使用</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.servletConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 控制台打印，证明这个方法被调用了</span></span><br><span class="line">        System.out.println(<span class="string">&quot;我是HelloServlet，我执行了！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回响应字符串</span></span><br><span class="line">        <span class="comment">// 1、获取能够返回响应数据的字符流对象</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、向字符流对象写入数据</span></span><br><span class="line">        writer.write(<span class="string">&quot;Hello,I am Servlet&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// =============分割线===============</span></span><br><span class="line">        <span class="comment">// 测试ServletConfig对象的使用</span></span><br><span class="line">        <span class="comment">// 1.获取ServletConfig对象：在init()方法中完成</span></span><br><span class="line">        System.out.println(<span class="string">&quot;servletConfig = &quot;</span> + servletConfig.getClass().getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过servletConfig对象获取ServletContext对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.servletConfig.getServletContext();</span><br><span class="line">        System.out.println(<span class="string">&quot;servletContext = &quot;</span> + servletContext.getClass().getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.通过servletConfig对象获取初始化参数</span></span><br><span class="line">        Enumeration&lt;String&gt; enumeration = <span class="built_in">this</span>.servletConfig.getInitParameterNames();</span><br><span class="line">        <span class="keyword">while</span> (enumeration.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> enumeration.nextElement();</span><br><span class="line">            System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.servletConfig.getInitParameter(name);</span><br><span class="line">            System.out.println(<span class="string">&quot;value = &quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HelloServlet对象即将销毁，现在执行清理操作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印效果：</p><blockquote><p>我是HelloServlet，我执行了！<br>servletConfig = org.apache.catalina.core.StandardWrapperFacade<br>servletContext = org.apache.catalina.core.ApplicationContextFacade<br>name = goodMan<br>value = me</p></blockquote><p>引申：</p><ul><li>广义Servlet：javax.servlet包下的一系列接口定义的一组<span style="color:blue;font-weight:bold;">Web开发标准</span>。遵循这一套标准，不同的Servlet容器提供了不同的实现。</li><li>狭义Servlet：javax.servlet.Servlet接口和它的实现类，也就是实际开发时使用的具体的Servlet。</li></ul><p>Servlet标准和JDBC标准对比：</p><table><thead><tr><th>Servlet标准</th><th>JDBC标准</th></tr></thead><tbody><tr><td>javax.servlet包下的一系列接口</td><td>javax.sql包下的一系列接口</td></tr><tr><td>Servlet容器厂商提供的具体实现类</td><td>数据库厂商提供的实现类（数据库驱动）</td></tr></tbody></table><p>同样都体现了<span style="color:blue;font-weight:bold;">面向接口编程</span>的思想，同时也体现了<span style="color:blue;font-weight:bold;">解耦</span>的思想：只要接口不变，下层方法有任何变化，都不会影响上层方法。</p><p><img src="./images/img021.png" alt="./images"></p><h2 id="3、ServletContext接口">3、ServletContext接口</h2><h3 id="①简介">①简介</h3><ul><li>代表：整个Web应用</li><li>是否单例：是</li><li>典型的功能：<ul><li>获取某个资源的真实路径：getRealPath()</li><li>获取整个Web应用级别的初始化参数：getInitParameter()</li><li>作为Web应用范围的域对象<ul><li>存入数据：setAttribute()</li><li>取出数据：getAttribute()</li></ul></li></ul></li></ul><h3 id="②体验">②体验</h3><h4 id="1-配置Web应用级别的初始化参数">[1]配置Web应用级别的初始化参数</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Web应用的初始化参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>handsomeMan<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>alsoMe<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-获取参数">[2]获取参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">handsomeMan</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;handsomeMan&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;handsomeMan = &quot;</span> + handsomeMan);</span><br></pre></td></tr></table></figure><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 Servlet HelloWorld</h1><h2 id="1、HelloWorld分析">1、HelloWorld分析</h2><h3 id="①目标">①目标</h3><p>在页面上点击超链接，由Servlet处理这个请求，并返回一个响应字符串：Hello,I am Servlet</p><h3 id="②思路">②思路</h3><p><img src="./images/img006.png" alt="./images"></p><h2 id="2、具体操作">2、具体操作</h2><h3 id="①第一步：创建动态Web-module">①第一步：创建动态Web module</h3><p><img src="./images/img007.png" alt="./images"></p><h3 id="②第二步：创建超链接">②第二步：创建超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- /Web应用地址/Servlet地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/app/helloServlet&quot;</span>&gt;</span>Servlet Hello World<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③第三步：创建HelloServlet的Java类">③第三步：创建HelloServlet的Java类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 控制台打印，证明这个方法被调用了</span></span><br><span class="line">        System.out.println(<span class="string">&quot;我是HelloServlet，我执行了！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回响应字符串</span></span><br><span class="line">        <span class="comment">// 1、获取能够返回响应数据的字符流对象</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、向字符流对象写入数据</span></span><br><span class="line">        writer.write(<span class="string">&quot;Hello,I am Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④第四步：配置HelloServlet">④第四步：配置HelloServlet</h3><p>配置文件位置：WEB-INF/web.xml</p><p><img src="./images/img008.png" alt="./images"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Servlet本身 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全类名太长，给Servlet设置一个简短名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet的全类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将Servlet和访问地址关联起来 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/helloServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">『虚拟路径』</span>：Servlet并<span style="color:blue;font-weight:bold;">不是</span>文件系统中<span style="color:blue;font-weight:bold;">实际存在</span>的<span style="color:blue;font-weight:bold;">目录或文件</span>，所以为了方便浏览器访问，我们创建了<span style="color:blue;font-weight:bold;">虚拟</span>出来的路径来访问它。</p><h3 id="⑤小结">⑤小结</h3><ul><li>需求：在浏览器上点超链接能够访问Java程序</li></ul><p><img src="./images/img009.png" alt="./images"></p><h2 id="3、梳理概念">3、梳理概念</h2><h3 id="①原生Tomcat">①原生Tomcat</h3><p><img src="./images/img010.png" alt="./images"></p><h3 id="②IDEA中的Tomcat实例">②IDEA中的Tomcat实例</h3><p><img src="./images/img011.png" alt="./images"></p><h3 id="③IDEA中的Web工程">③IDEA中的Web工程</h3><p><img src="./images/img012.png" alt="./images"></p><h3 id="④根据Web工程生成的war包">④根据Web工程生成的war包</h3><p><img src="./images/img013.png" alt="./images"></p><h3 id="⑤Web工程中的资源">⑤Web工程中的资源</h3><h4 id="1-静态资源">[1]静态资源</h4><ul><li>HTML文件</li><li>CSS文件</li><li>JavaScript文件</li><li>图片文件</li></ul><h4 id="2-动态资源">[2]动态资源</h4><ul><li>Servlet</li></ul><h3 id="⑥访问资源的地址">⑥访问资源的地址</h3><h4 id="1-静态资源-2">[1]静态资源</h4><blockquote><p>/Web应用名称/静态资源本身的路径</p></blockquote><h4 id="2-动态资源-2">[2]动态资源</h4><blockquote><p>/Web应用名称/虚拟路径</p></blockquote><h3 id="⑦Web应用名称">⑦Web应用名称</h3><p><img src="./images/img014.png" alt="./images"></p><h3 id="⑧总体的逻辑结构">⑧总体的逻辑结构</h3><p><img src="./images/img015.png" alt="./images"></p><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 Servlet 生命周期</h1><h2 id="1、从Servlet接口说起">1、从Servlet接口说起</h2><p><img src="./images/img016.png" alt="./images"></p><h2 id="2、Servlet创建对象的时机">2、Servlet创建对象的时机</h2><h3 id="①验证方式">①验证方式</h3><p>在HelloServlet的构造器中执行控制台打印</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HelloServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;我来了！HelloServlet对象创建！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②打印结果">②打印结果</h3><blockquote><p>我来了！HelloServlet对象创建！<br>我是HelloServlet，我执行了！<br>我是HelloServlet，我执行了！<br>我是HelloServlet，我执行了！<br>我是HelloServlet，我执行了！<br>我是HelloServlet，我执行了！<br>我是HelloServlet，我执行了！</p></blockquote><h3 id="③结论">③结论</h3><ul><li>默认情况下：Servlet在<span style="color:blue;font-weight:bold;">第一次接收到请求</span>的时候才创建对象</li><li>创建对象后，所有的URL地址匹配的请求都由这同一个对象来处理</li><li>Tomcat中，每一个请求会被分配一个线程来处理，所以可以说：Servlet是<span style="color:blue;font-weight:bold;">单实例，多线程</span>方式运行的。</li><li>既然Servlet是多线程方式运行，所以有线程安全方面的可能性，所以不能在处理请求的方法中修改公共属性。</li></ul><h3 id="④修改Servlet创建对象的时机">④修改Servlet创建对象的时机</h3><p>修改web.xml中Servlet的配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Servlet本身 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全类名太长，给Servlet设置一个简短名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet的全类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet启动顺序 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果：Web应用启动的时候创建Servlet对象</p><p><img src="./images/img017.png" alt="./images"></p><p>友情提示：将来配置SpringMVC的时候会看到这样的配置。</p><h2 id="3、其他环节">3、其他环节</h2><p><img src="./images/img018.png" alt="./images"></p><h2 id="4、Servlet容器">4、Servlet容器</h2><h3 id="①容器">①容器</h3><p>在开发使用的各种技术中，经常会有很多对象会放在容器中。</p><h3 id="②容器提供的功能">②容器提供的功能</h3><p>容器会管理内部对象的整个生命周期。对象在容器中才能够正常的工作，得到来自容器的全方位的支持。</p><ul><li>创建对象</li><li>初始化</li><li>工作</li><li>清理</li></ul><h3 id="③容器本身也是对象">③容器本身也是对象</h3><ul><li>特点1：往往是非常大的对象</li><li>特点2：通常的单例的</li></ul><h3 id="④典型Servlet容器产品举例">④典型Servlet容器产品举例</h3><ul><li>Tomcat</li><li>jetty</li><li>jboss</li><li>Weblogic</li><li>WebSphere</li><li>glassfish</li></ul><h2 id="5、总结">5、总结</h2><table><thead><tr><th>名称</th><th>时机</th><th>次数</th></tr></thead><tbody><tr><td>创建对象</td><td>默认情况：接收到第一次请求<br />修改启动顺序后：Web应用启动过程中</td><td>一次</td></tr><tr><td>初始化操作</td><td>创建对象之后</td><td>一次</td></tr><tr><td>处理请求</td><td>接收到请求</td><td>多次</td></tr><tr><td>销毁操作</td><td>Web应用卸载之前</td><td>一次</td></tr></tbody></table><blockquote><p>小提示：</p><p>我们学习任何一章的知识，通常都包括两类：</p><ul><li>现在用得上的——优先级高</li><li>以后才用的——优先级低</li></ul><p>生命周期部分就属于以后才用的知识。</p></blockquote><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 Servlet概述</h1><h2 id="1、Servlet名字">1、Servlet名字</h2><p>Servlet=Server+applet</p><p>Server：服务器</p><p>applet：小程序</p><p>Servlet含义是服务器端的小程序</p><h2 id="2、Servlet在整个Web应用中起到的作用">2、Servlet在整个Web应用中起到的作用</h2><h3 id="①生活中的例子">①生活中的例子</h3><p><img src="./images/img001.png" alt="./images"></p><h3 id="②对应Web应用">②对应Web应用</h3><p><img src="./images/img002.png" alt="./images"></p><h3 id="③具体细节">③具体细节</h3><p><img src="./images/img003.png" alt="./images"></p><h3 id="④Servlet扮演角色">④Servlet扮演角色</h3><p><img src="./images/img004.png" alt="./images"></p><p>在整个Web应用中，Servlet主要负责处理请求、协调调度功能。我们可以把Servlet称为Web应用中的<span style="color:blue;font-weight:bold;">『控制器』</span></p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter07/index/</url>
      
        <content type="html"><![CDATA[<h1>第七章 Servlet</h1><p><a href="verse01.html">第一节 Servlet概述 [理论]</a></p><p><a href="verse02.html">第二节 Servlet HelloWorld [操作]</a></p><p><a href="verse03.html">第三节 Servlet 生命周期 [理论]</a></p><p><a href="verse04.html">第四节 ServletConfig和ServletContext [操作]</a></p><p><a href="verse05.html">第五节 使用IDEA创建Servlet [操作]</a></p><p><a href="verse06.html">第六节 继承关系 [理论]</a></p><p><a href="verse07.html">第七节 动态Web工程内编写路径 [操作]</a></p><p><a href="verse08.html">第八节 请求转发和重定向 [操作]</a></p><p><a href="verse09.html">第九节 获取请求参数 [操作]</a></p><p><a href="verse10.html">第十节 请求响应设置字符集 [操作]</a></p><p><a href="../chapter06/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter08/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter06/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter06/index/</url>
      
        <content type="html"><![CDATA[<h1>第六章 HTTP协议</h1><h2 id="1、介绍">1、介绍</h2><p>HTTP：<span style="color:blue;font-weight:bold;">H</span>yper <span style="color:blue;font-weight:bold;">T</span>ext <span style="color:blue;font-weight:bold;">T</span>ransfer <span style="color:blue;font-weight:bold;">P</span>rotocol超文本传输协议。HTTP最大的作用就是确定了请求和响应数据的格式。浏览器发送给服务器的数据：请求报文；服务器返回给浏览器的数据：响应报文。</p><h2 id="2、请求报文">2、请求报文</h2><h3 id="①在开发者工具中浏览报文源码">①在开发者工具中浏览报文源码</h3><p><img src="./images/img001.png" alt="./images"></p><h3 id="②请求报文的三个部分">②请求报文的三个部分</h3><p><img src="./images/img002.png" alt="./images"></p><h3 id="③请求行">③请求行</h3><p>作用：展示当前请求的最基本信息</p><blockquote><p>POST /dynamic/target.jsp HTTP/1.1</p></blockquote><ul><li>请求方式</li><li>访问地址</li><li>HTTP协议的版本</li></ul><h3 id="④请求消息头">④请求消息头</h3><p>作用：通过具体的参数对本次请求进行详细的说明</p><p>格式：键值对，键和值之间使用冒号隔开</p><p>相对比较重要的请求消息头：</p><table><thead><tr><th>名称</th><th>功能</th></tr></thead><tbody><tr><td>Host</td><td>服务器的主机地址</td></tr><tr><td>Accept</td><td>声明当前请求能够接受的『媒体类型』</td></tr><tr><td>Referer</td><td>当前请求来源页面的地址</td></tr><tr><td>Content-Length</td><td>请求体内容的长度</td></tr><tr><td>Content-Type</td><td>请求体的内容类型，这一项的具体值是媒体类型中的某一种</td></tr><tr><td>Cookie</td><td>浏览器访问服务器时携带的Cookie数据</td></tr></tbody></table><h3 id="⑤请求体">⑤请求体</h3><p>作用：作为请求的主体，发送数据给服务器。具体来说其实就是POST请求方式下的请求参数。</p><p>格式：</p><h4 id="1-form-data">[1]form data</h4><p>含义：当前请求体是一个表单提交的请求参数。</p><p><img src="./images/img003.png" alt="./images"></p><p>查看源码后，发现格式如下：</p><blockquote><p>username=tom&amp;password=123456</p></blockquote><ul><li>每一组请求参数是一个键值对</li><li>键和值中间是等号</li><li>键值对之间是&amp;号</li></ul><h4 id="2-Request-Payload">[2]Request Payload</h4><p>含义：整个请求体以某种特定格式来组织数据，例如JSON格式。</p><p><img src="./images/img005.png" alt="./images"></p><h2 id="3、请求方式">3、请求方式</h2><h3 id="①HTTP协议已定义的请求方式">①HTTP协议已定义的请求方式</h3><p>HTTP1.1中共定义了八种请求方式：</p><ul><li><span style="color:red;font-weight:bold;">GET</span>：从服务器端获取数据</li><li><span style="color:red;font-weight:bold;">POST</span>：将数据保存到服务器端</li><li><span style="color:blue;font-weight:bold;">PUT</span>：命令服务器对数据执行更新</li><li><span style="color:blue;font-weight:bold;">DELETE</span>：命令服务器删除数据</li><li>HEAD</li><li>CONNECT</li><li>OPTIONS</li><li>TRACE</li></ul><h3 id="②GET请求">②GET请求</h3><ul><li>特征1：没有请求体</li><li>特征2：请求参数附着在URL地址后面</li><li>特征3：请求参数在浏览器地址栏能够直接被看到，存在安全隐患</li><li>特征4：在URL地址后面携带请求参数，数据容量非常有限。如果数据量大，那么超出容量的数据会丢失</li><li>特征5：从报文角度分析，请求参数是在请求行中携带的，因为访问地址在请求行</li></ul><h3 id="③POST请求">③POST请求</h3><ul><li>特征1：有请求体</li><li>特征2：请求参数放在请求体中</li><li>特征3：请求体发送数据的空间没有限制</li><li>特征4：可以发送各种不同类型的数据</li><li>特征5：从报文角度分析，请求参数是在请求体中携带的</li><li>特征6：由于请求参数是放在请求体中，所以浏览器地址栏看不到</li></ul><h2 id="4、媒体类型">4、媒体类型</h2><h3 id="①HTTP协议中的MIME类型">①HTTP协议中的MIME类型</h3><p>Multipurpose Internet Mail Extensions</p><h3 id="②用途">②用途</h3><p>为了让用户通过浏览器和服务器端交互的过程中有更好、更丰富的体验，HTTP协议需要支持丰富的数据类型。</p><h3 id="③MIME类型定义参考">③MIME类型定义参考</h3><p>我们可以通过查看Tomcat解压目录下conf/web.xml配置文件，了解HTTP协议中定义的MIME类型。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extension</span>&gt;</span>mp4<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>video/mp4<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extension</span>&gt;</span>doc<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>application/msword<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extension</span>&gt;</span>json<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>application/json<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extension</span>&gt;</span>html<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>从上面的例子中可以看出：MIME的基本格式是</p><blockquote><p>大类/具体类型</p></blockquote><p>MIME类型在HTTP报文中对应的是内容类型：Content-type</p><h2 id="5、响应报文">5、响应报文</h2><p><img src="./images/img007.png" alt="./images"></p><h3 id="①响应状态行">①响应状态行</h3><blockquote><p>HTTP/1.1 200 OK</p></blockquote><ul><li>HTTP协议版本</li><li><span style="color:blue;font-weight:bold;">响应状态码</span></li><li>响应状态的说明文字</li></ul><h3 id="②响应消息头">②响应消息头</h3><ul><li>响应体的说明书。</li><li>服务器端对浏览器端设置数据，例如：服务器端返回Cookie信息。</li></ul><table><thead><tr><th>名称</th><th>功能</th></tr></thead><tbody><tr><td>Content-Type</td><td>响应体的内容类型</td></tr><tr><td>Content-Length</td><td>响应体的内容长度</td></tr><tr><td>Set-Cookie</td><td>服务器返回新的Cookie信息给浏览器</td></tr><tr><td>location</td><td>在<span style="color:blue;font-weight:bold;">重定向</span>的情况下，告诉浏览器访问下一个资源的地址</td></tr></tbody></table><h3 id="③响应体">③响应体</h3><p>服务器返回的数据主体，有可能是各种数据类型。</p><ul><li>HTML页面</li><li>图片</li><li>视频</li><li>以下载形式返回的文件</li><li>CSS文件</li><li>JavaScript文件</li></ul><h3 id="④响应状态码">④响应状态码</h3><p>作用：以编码的形式告诉浏览器当前请求处理的结果</p><table><thead><tr><th>状态码</th><th>含义</th></tr></thead><tbody><tr><td>200</td><td>服务器成功处理了当前请求，成功返回响应</td></tr><tr><td>302</td><td>重定向</td></tr><tr><td>400</td><td>[SpringMVC特定环境]请求参数问题</td></tr><tr><td>403</td><td>没有权限</td></tr><tr><td>404</td><td>找不到目标资源</td></tr><tr><td>405</td><td>请求方式和服务器端对应的处理方式不一致</td></tr><tr><td>406</td><td>[SpringMVC特定环境]请求扩展名和实际返回的响应体类型不一致</td></tr><tr><td>50X</td><td>服务器端内部错误，通常都是服务器端抛异常了</td></tr></tbody></table><p>404产生的具体原因：</p><ul><li>访问地址写错了，确实是没有这个资源</li><li>访问了WEB-INF目录下的资源</li><li>Web应用启动的时候，控制台已经抛出异常，导致整个Web应用不可用，访问任何资源都是404</li><li>服务器端缓存</li></ul><p><a href="../chapter05/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter07/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse06/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse06/</url>
      
        <content type="html"><![CDATA[<h1>第六节 导入别人的web module</h1><p>如果你想把老师发给你的module导入自己的project中运行起来，可以参考下面的操作：</p><blockquote><p>做下面操作前，需要把要导入的module复制到project目录下。</p></blockquote><p><img src="./images/img049.png" alt="./images"></p><p><img src="./images/img050.png" alt="./images"></p><p><img src="./images/img051.png" alt="./images"></p><p><img src="./images/img052.png" alt="./images"></p><p><img src="./images/img053.png" alt="./images"></p><p><img src="./images/img054.png" alt="./images"></p><p><img src="./images/img055.png" alt="./images"></p><p><img src="./images/img056.png" alt="./images"></p><p><img src="./images/img057.png" alt="./images"></p><p><img src="./images/img058.png" alt="./images"></p><p><a href="verse05.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 在IDEA中重新部署运行</h1><h2 id="1、为什么需要重新部署？">1、为什么需要重新部署？</h2><p>对于已经运行过的Web项目，如果我们增加了目录和文件，那么部署目录有可能不会自动同步过来，从而造成实际运行的效果和我们期望的不同。</p><p>如下图中，我们在工程目录已经新增了./images目录和两个图片：</p><p><img src="./images/img042.png" alt="./images"></p><p>但是在部署目录并没有出现：</p><p><img src="./images/img043.png" alt="./images"></p><p>哪怕我们执行了重新部署也没有起作用。</p><h2 id="2、如何重新部署？">2、如何重新部署？</h2><h3 id="①清理部署目录">①清理部署目录</h3><p><img src="./images/img044.png" alt="./images"></p><p><img src="./images/img045.png" alt="./images"></p><h3 id="②构建">②构建</h3><p><img src="./images/img046.png" alt="./images"></p><h3 id="③效果">③效果</h3><p><img src="./images/img047.png" alt="./images"></p><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a> <a href="verse06.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 Tomcat的部署和启动</h1><h2 id="1、Tomcat扮演的角色">1、Tomcat扮演的角色</h2><h3 id="①对外：Web服务器">①对外：Web服务器</h3><p><img src="./images/img006.png" alt="./images"></p><h3 id="②对内：Servlet容器">②对内：Servlet容器</h3><p><img src="./images/img007.png" alt="./images"></p><h2 id="2、部署">2、部署</h2><h3 id="①前提">①前提</h3><p>Tomcat本身是一个Java程序，所以当前系统中必须正确配置了JAVA_HOME环境变量。我们可以通过下面的命令检测：</p><blockquote><p>C:\Users\Administrator&gt;<span style="color:blue;font-weight:bold;">java -version</span><br>java version “1.8.0_141”<br>Java™ SE Runtime Environment (build 1.8.0_141-b15)<br>Java HotSpot™ 64-Bit Server VM (build 25.141-b15, mixed mode)</p><p>C:\Users\Administrator&gt;<span style="color:blue;font-weight:bold;">echo %JAVA_HOME%</span><br>D:\software\Java</p><p>C:\Users\Administrator&gt;<span style="color:blue;font-weight:bold;">echo %PATH%</span><br>D:\software\xftp;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0;D:\software\Java\bin;D:\software\apache-maven-3.5.4\bin;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;</p></blockquote><h3 id="②解压">②解压</h3><p>将Tomcat压缩包解压到一个<span style="color:blue;font-weight:bold;">非中文无空格</span>的目录下。</p><p><img src="./images/img008.png" alt="./images"></p><p><img src="./images/img009.png" alt="./images"></p><h3 id="③Tomcat目录结构">③Tomcat目录结构</h3><p><img src="./images/img010.png" alt="./images"></p><h3 id="④启动Tomcat并访问首页">④启动Tomcat并访问首页</h3><p>启动Tomcat：运行Tomcat解压后根目录下\bin\startup.bat即可，例如：</p><blockquote><p>D:\software\apache-tomcat-7.0.79\bin\startup.bat</p></blockquote><p><img src="./images/img014.png" alt="./images"></p><p>如果需要停止Tomcat，则运行shutdown.bat程序，例如：</p><blockquote><p>D:\software\apache-tomcat-7.0.79\bin\shutdown.bat</p></blockquote><p>小提示：将来我们在IDEA中启动Tomcat，如果IDEA卡死强关，Tomcat不会正常退出。下次再启动Tomcat会因为残留进程仍然占用8080端口，导致新的进程无法启动。此时可以使用shutdown.bat结束残留进程。</p><h3 id="⑤部署一个war包并启动Tomcat">⑤部署一个war包并启动Tomcat</h3><p><img src="./images/img011.png" alt="./images"></p><p>在Tomcat启动过程中，会打印启动日志，其中我们能看到hello.war被部署的日志信息：</p><blockquote><p>信息: Deployment of web application archive D:\software\apache-tomcat-7.0.79\webapps\hello.war has finished in 1,150 ms</p></blockquote><p>此时，我们回到webapps目录，能看到hello.war被解压了：</p><p><img src="./images/img012.png" alt="./images"></p><h3 id="⑥访问刚才部署的Web应用">⑥访问刚才部署的Web应用</h3><p><img src="./images/img013.png" alt="./images"></p><h3 id="⑦关于Tomcat端口号">⑦关于Tomcat端口号</h3><p><img src="./images/img015.png" alt="./images"></p><p>配置文件节选：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"><span class="comment">&lt;!-- 第22行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">&quot;8005&quot;</span> <span class="attr">shutdown</span>=<span class="string">&quot;SHUTDOWN&quot;</span>&gt;</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">&lt;!-- 第71行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br><span class="line">……</span><br><span class="line"><span class="comment">&lt;!-- 第93行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8009&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>三个位置共定义了3个端口号，Tomcat启动后，这个三个端口号都会被占用。</p><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 创建动态Web工程并部署运行</h1><h2 id="1、第一步">1、第一步</h2><p>创建empty project</p><h2 id="2、第二步">2、第二步</h2><p>以下操作基于IDEA2018.3</p><p><img src="./images/img041.png" alt="./images"></p><p>创建动态Web工程：</p><p><img src="./images/img023.png" alt="./images"></p><p><img src="./images/img024.png" alt="./images"></p><p>创建好的工程如下所示：</p><p><img src="./images/img025.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">注意</span>：src目录应该是蓝色的，web目录的图标上有个蓝色的圆点。</p><h2 id="3、动态Web工程目录结构介绍">3、动态Web工程目录结构介绍</h2><table><thead><tr><th>目录或文件名</th><th>功能</th></tr></thead><tbody><tr><td>src目录</td><td>存放Java源文件</td></tr><tr><td>web目录</td><td>存放Web开发相关资源</td></tr><tr><td>web/WEB-INF目录</td><td>存放web.xml文件、classes目录、lib目录</td></tr><tr><td>web/WEB-INF/web.xml文件</td><td>别名：部署描述符deployment descriptor<br />作用：Web工程的核心配置文件</td></tr><tr><td>web/WEB-INF/classes目录</td><td>存放编译得到的*.class字节码文件</td></tr><tr><td>web/WEB-INF/lib目录</td><td>存放第三方jar包</td></tr></tbody></table><h2 id="4、创建用来部署Web工程的Tomcat实例">4、创建用来部署Web工程的Tomcat实例</h2><p><img src="./images/img026.png" alt="./images"></p><p><img src="./images/img027.png" alt="./images"></p><p><img src="./images/img028.png" alt="./images"></p><p><img src="./images/img029.png" alt="./images"></p><p>通常我们会觉得现在这个Application context太长了，改简短一些会更方便。</p><p><img src="./images/img030.png" alt="./images"></p><p><img src="./images/img031.png" alt="./images"></p><p>创建好的效果如下：</p><p><img src="./images/img032.png" alt="./images"></p><h2 id="5、编写简单的测试代码">5、编写简单的测试代码</h2><h3 id="①Java代码">①Java代码</h3><p><img src="./images/img033.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;年少不知软饭香&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②JSP代码">②JSP代码</h3><p><img src="./images/img034.png" alt="./images"></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=<span class="keyword">new</span> <span class="title class_">Hello</span>().getMessage() %&gt;</span><br></pre></td></tr></table></figure><h3 id="③启动专门为这个工程创建的Tomcat实例">③启动专门为这个工程创建的Tomcat实例</h3><p><img src="./images/img035.png" alt="./images"></p><h3 id="④错误提示">④错误提示</h3><p><img src="./images/img036.png" alt="./images"></p><p>提示信息的含义：未指定编译结果的保存目录。</p><p>错误原因：</p><ul><li>父工程只是一个empty project</li><li>当前模块继承父工程的编译输出路径</li></ul><p>为了解决这个问题我们可以在父工程中设置输出路径：</p><p><img src="./images/img038.png" alt="./images"></p><p><img src="./images/img037.png" alt="./images"></p><p><img src="./images/img039.png" alt="./images"></p><p><img src="./images/img040.png" alt="./images"></p><h2 id="6、IDEA运行程序时界面布局">6、IDEA运行程序时界面布局</h2><p><img src="./images/img048.png" alt="./images"></p><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse03/</url>
      
        <content type="html"><![CDATA[<h1>第三节 在IDEA中关联Tomcat</h1><p><img src="./images/img016.png" alt="./images"></p><p><img src="./images/img017.png" alt="./images"></p><p><img src="./images/img018.png" alt="./images"></p><p><img src="./images/img019.png" alt="./images"></p><p><img src="./images/img020.png" alt="./images"></p><p><img src="./images/img021.png" alt="./images"></p><p><img src="./images/img022.png" alt="./images"></p><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 配置文件</h1><h2 id="1、配置">1、配置</h2><h3 id="①设置">①设置</h3><p>所谓设置其实就是通过修改一个一个的<span style="color:blue;font-weight:bold;">参数</span>，告诉<span style="color:blue;font-weight:bold;">应用软件</span>它该<span style="color:blue;font-weight:bold;">怎么工作</span>。</p><p><img src="./images/img001.png" alt="./images"></p><h3 id="②配置">②配置</h3><p>本质上配置和设置是一样的，只是对象和形式不同：</p><table><thead><tr><th> </th><th>配置</th><th>设置</th></tr></thead><tbody><tr><td>对象</td><td>开发中使用的应用程序或框架</td><td>应用软件</td></tr><tr><td>形式</td><td>特定格式的配置文件</td><td>应用软件的友好界面</td></tr></tbody></table><h2 id="2、配置文件">2、配置文件</h2><h3 id="①XML">①XML</h3><p>先来个例子：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置SpringMVC前端控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 在初始化参数中指定SpringMVC配置文件位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 设置当前Servlet创建对象的时机是在Web应用启动时 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- url-pattern配置斜杠表示匹配所有请求 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 两种可选的配置方式：</span></span><br><span class="line"><span class="comment">                1、斜杠开头：/</span></span><br><span class="line"><span class="comment">                2、包含星号：*.atguigu</span></span><br><span class="line"><span class="comment">             不允许的配置方式：前面有斜杠，中间有星号</span></span><br><span class="line"><span class="comment">                /*.app</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-名词解释">[1]名词解释</h4><p>XML是e<span style="color:blue;font-weight:bold;">X</span>tensible <span style="color:blue;font-weight:bold;">M</span>arkup <span style="color:blue;font-weight:bold;">L</span>anguage的缩写，翻译过来就是<span style="color:blue;font-weight:bold;">可扩展标记语言</span>。所以很明显，XML和HTML一样都是标记语言，也就是说它们的基本语法都是标签。</p><h4 id="2-可扩展">[2]可扩展</h4><p><span style="color:blue;font-weight:bold;">可扩展</span>三个字<span style="color:blue;font-weight:bold;">表面上</span>的意思是XML允许<span style="color:blue;font-weight:bold;">自定义格式</span>。但是别美，这<span style="color:blue;font-weight:bold;">不代表</span>你<span style="color:blue;font-weight:bold;">可以随便写</span>。</p><p><img src="./images/img002.png" alt="./images"></p><p>在XML基本语法规范的基础上，你使用的那些第三方应用程序、框架会通过设计<span style="color:blue;font-weight:bold;">『XML约束』</span>的方式<span style="color:blue;font-weight:bold;">『强制规定』</span>配置文件中可以写什么和怎么写，规定之外的都不可以写。</p><p>XML基本语法这个知识点的定位是：我们不需要从零开始，从头到尾的一行一行编写XML文档，而是在第三方应用程序、框架<span style="color:blue;font-weight:bold;">已提供的配置文件</span>的基础上<span style="color:blue;font-weight:bold;">修改</span>。要改成什么样取决于你的需求，而怎么改取决于<span style="color:blue;font-weight:bold;">XML基本语法</span>和<span style="color:blue;font-weight:bold;">具体的XML约束</span>。</p><h4 id="3-XML基本语法">[3]XML基本语法</h4><ul><li>XML声明</li></ul><p>这部分基本上就是固定格式，大家知道就好</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>根标签</li></ul><p>根标签有且只能有一个。</p><ul><li>标签关闭<ul><li>双标签：开始标签和结束标签必须成对出现。</li><li>单标签：单标签在标签内关闭。</li></ul></li><li>标签嵌套<ul><li>可以嵌套，但是不能交叉嵌套。</li></ul></li><li>注释不能嵌套</li><li>标签名、属性名建议使用小写字母</li><li>属性<ul><li>属性必须有值</li><li>属性值必须加引号，单双都行</li></ul></li></ul><p>看到这里大家一定会发现XML的基本语法和HTML的基本语法简直如出一辙。其实这不是偶然的，XML基本语法+HTML约束=HTML语法。在逻辑上HTML确实是XML的子集。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>从HTML4.01版本的文档类型声明中可以看出，这里使用的DTD类型的XML约束。也就是说<a href="http://www.w3.org/TR/html4/loose.dtd%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%AE%9A%E4%B9%89%E4%BA%86HTML%E6%96%87%E6%A1%A3%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%86%99%E5%93%AA%E4%BA%9B%E6%A0%87%E7%AD%BE%EF%BC%8C%E6%A0%87%E7%AD%BE%E5%86%85%E5%8F%AF%E4%BB%A5%E5%86%99%E5%93%AA%E4%BA%9B%E5%B1%9E%E6%80%A7%EF%BC%8C%E6%9F%90%E4%B8%AA%E6%A0%87%E7%AD%BE%E5%8F%AF%E4%BB%A5%E6%9C%89%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E5%AD%90%E6%A0%87%E7%AD%BE%E3%80%82">http://www.w3.org/TR/html4/loose.dtd这个文件定义了HTML文档中可以写哪些标签，标签内可以写哪些属性，某个标签可以有什么样的子标签。</a></p><h4 id="4-XML约束">[4]XML约束</h4><p>将来我们主要就是根据XML约束中的规定来编写XML配置文件。而XML约束主要包括DTD和Schema两种。如果XML配置文件使用的是DTD，那么对我们几乎没有影响。如果是Schema约束，需要我们稍微参与一点点。</p><ul><li>DTD</li></ul><p>将来在IDEA中有代码提示的协助，在DTD文档的约束下进行配置非常简单。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % fontstyle</span><br><span class="line"> &quot;TT | I | B | U | S | STRIKE | BIG | SMALL&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % phrase &quot;EM | STRONG | DFN | CODE |</span><br><span class="line">                   SAMP | KBD | VAR | CITE | ABBR | ACRONYM&quot; &gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % special</span><br><span class="line">   &quot;A | IMG | APPLET | OBJECT | FONT | BASEFONT | BR | SCRIPT |</span><br><span class="line">    MAP | Q | SUB | SUP | SPAN | BDO | IFRAME&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % formctrl &quot;INPUT | SELECT | TEXTAREA | LABEL | BUTTON&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- %inline; covers inline or &quot;text-level&quot; elements --&gt;</span><br><span class="line">&lt;!ENTITY % inline &quot;#PCDATA | %fontstyle; | %phrase; | %special; | %formctrl;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ELEMENT (%fontstyle;|%phrase;) - - (%inline;)*&gt;</span><br><span class="line">&lt;!ATTLIST (%fontstyle;|%phrase;)</span><br><span class="line">  %attrs;                              -- %coreattrs, %i18n, %events --</span><br><span class="line">  &gt;</span><br></pre></td></tr></table></figure><ul><li>Schema</li></ul><p>我们将来使用SSM框架中的Spring、SpringMVC框架时，会涉及到一点点对Schema约束的设置。不过不必紧张，有IDEA的支持操作会非常简单，我们现在只需要理解基本概念即可。</p><p>首先我们要理解一个概念：<span style="color:blue;font-weight:bold;">『名称空间』</span>，英文：name space</p><p><img src="./images/img003.png" alt="./images"></p><p>Schema约束要求我们一个XML文档中，所有标签，所有属性都必须在约束中有明确的定义。</p><p>下面我们以web.xml的约束声明为例来做个说明：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>属性名</th><th>作用</th></tr></thead><tbody><tr><td>xmlns</td><td>指出当前XML文档约束规则的名称空间在哪里<br />我们就是通过这个属性来引用一个具体的名称空间</td></tr><tr><td>xmlns:xsi</td><td>指出xmlns这个属性是在哪个约束文档中被定义的</td></tr><tr><td>xsi:schemaLocation</td><td>语法格式：在xsi名称空间下引用schemaLocation属性<br />配置含义：指定当前XML文档中所用到的约束文档本身的文件的地址</td></tr></tbody></table><p>xmlns和xsi:schemaLocation对应关系如下图：</p><p><img src="./images/img004.png" alt="./images"></p><p>引入多个名称空间的例子如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.crud.component&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img005.png" alt="./images"></p><p>看到这么复杂，这么长的名称空间字符串，我们会觉得很担心，根本记不住。但是其实不需要记，在IDEA中编写配置文件时，IDEA会协助我们导入，会有提示。我们<span style="color:blue;font-weight:bold;">理解各个部分的含义能够调整</span>即可。</p><h3 id="②属性文件">②属性文件</h3><p>以properties作为扩展名的文件。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">atguigu.jdbc.url</span>=<span class="string">jdbc:mysql://192.168.198.100:3306/mybatis1026</span></span><br><span class="line"><span class="attr">atguigu.jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">atguigu.jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">atguigu.jdbc.password</span>=<span class="string">atguigu</span></span><br></pre></td></tr></table></figure><ul><li>由键值对组成</li><li>键和值之间的符号是等号</li><li>每一行都必须顶格写，前面不能有空格之类的其他符号</li></ul><p>也有人叫资源文件。</p><h3 id="③其他形式">③其他形式</h3><p>YAML语言的配置文件：在SpringBoot中使用。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">fc</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">mydb</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.41.100:3306/spring_boot?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">atguigu</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mybatis-mapper/*Mapper.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu.function.compute.mapper:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><p>JSON格式的配置文件：一般是前端使用。</p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter05/index/</url>
      
        <content type="html"><![CDATA[<h1>第五章 Tomcat</h1><p><a href="verse01.html">第一节 配置文件</a></p><p><a href="verse02.html">第二节 Tomcat的部署和启动</a></p><p><a href="verse03.html">第三节 在IDEA中关联Tomcat</a></p><p><a href="verse04.html">第四节 创建动态Web工程并部署运行</a></p><p><a href="verse05.html">第五节 在IDEA中重新部署运行</a></p><p><a href="verse06.html">第六节 导入别人的web module</a></p><p><a href="../chapter04/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter06/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse12/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse12/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十二节 Vue对象生命周期</h1><h2 id="1、概念">1、概念</h2><p>在我们各种语言的编程领域中，<span style="color:blue;font-weight:bold;">『生命周期』</span>都是一个非常常见的概念。一个对象从创建、初始化、工作再到释放、清理和销毁，会经历很多环节的演变。比如我们在JavaSE阶段学习过线程的生命周期，今天学习Vue对象的生命周期，将来还要学习Servlet、Filter等Web组件的生命周期。</p><h2 id="2、Vue对象的生命周期">2、Vue对象的生命周期</h2><p><img src="./images/img008.png" alt="./images"></p><h2 id="3、生命周期钩子函数">3、生命周期钩子函数</h2><p>Vue允许我们在特定的生命周期环节中通过钩子函数来加入我们的代码。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeValue&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>:<span class="string">&quot;hello&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;changeValue&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&quot;new hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.实例创建之前</span></span><br><span class="line"><span class="string">&quot;beforeCreate&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeCreate:&quot;</span>+<span class="variable language_">this</span>.<span class="property">message</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.实例创建完成</span></span><br><span class="line"><span class="string">&quot;created&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;created:&quot;</span>+<span class="variable language_">this</span>.<span class="property">message</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.数据挂载前</span></span><br><span class="line"><span class="string">&quot;beforeMount&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeMount:&quot;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerText</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.数据已经挂载</span></span><br><span class="line"><span class="string">&quot;mounted&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mounted:&quot;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerText</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.数据更新前</span></span><br><span class="line"><span class="string">&quot;beforeUpdate&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeUpdate:&quot;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerText</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.数据更新之后</span></span><br><span class="line"><span class="string">&quot;updated&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;updated:&quot;</span>+<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerText</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse11.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse10/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse10/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十节 Vue.js基本语法：简化写法</h1><h2 id="1、v-bind的简化写法">1、v-bind的简化写法</h2><p>正常写法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-bind:value</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>简化以后：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、v-on的简化写法">2、v-on的简化写法</h2><p>正常写法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;sayHello&quot;</span>&gt;</span>SayHello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>简化以后：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sayHello&quot;</span>&gt;</span>SayHello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse09.html">上一节</a> <a href="index.html">回目录</a> <a href="verse11.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse09/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse09/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第九节 Vue.js基本语法：侦听属性</h1><h2 id="1、提出需求">1、提出需求</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>尊姓：&#123;&#123;firstName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>大名：&#123;&#123;lastName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">尊姓：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">大名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>全名：&#123;&#123;fullName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在上面代码的基础上，我们希望firstName或lastName属性发生变化时，修改fullName属性。此时需要对firstName或lastName属性进行<span style="color:blue;font-weight:bold;">『侦听』</span>。</p><p>具体来说，所谓<span style="color:blue;font-weight:bold;">『侦听』</span>就是对message属性进行监控，当firstName或lastName属性的值发生变化时，调用我们准备好的函数。</p><h2 id="2、Vue代码">2、Vue代码</h2><p>在watch属性中声明对firstName和lastName属性进行<span style="color:blue;font-weight:bold;">『侦听』</span>的函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;jim&quot;</span>,</span><br><span class="line"><span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;green&quot;</span>,</span><br><span class="line"><span class="string">&quot;fullName&quot;</span>:<span class="string">&quot;jim green&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;watch&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;firstName&quot;</span>:<span class="keyword">function</span>(<span class="params">inputValue</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">fullName</span> = inputValue + <span class="string">&quot; &quot;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span>;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;lastName&quot;</span>:<span class="keyword">function</span>(<span class="params">inputValue</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">fullName</span> = <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&quot; &quot;</span> + inputValue;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse08.html">上一节</a> <a href="index.html">回目录</a> <a href="verse10.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse11/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse11/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第十一节 练习</h1><h2 id="1、功能效果演示">1、功能效果演示</h2><p><img src="./images/img009.png" alt="./images"></p><h2 id="2、任务拆解">2、任务拆解</h2><ul><li>第一步：显示表格</li><li>第二步：显示四个文本框</li><li>第三步：创建一个p标签用来显示用户在文本框中实时输入的内容</li><li>第四步：点击添加记录按钮实现记录的添加</li></ul><h2 id="3、第一步：显示表格">3、第一步：显示表格</h2><h3 id="①HTML标签">①HTML标签</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;appTable&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>专业<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;employee in employeeList&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empId&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empName&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empAge&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empSubject&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> appTable = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>: <span class="string">&quot;#appTable&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;employeeList&quot;</span>: [&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>: <span class="number">11</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>: <span class="string">&quot;java&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>: <span class="string">&quot;jerry&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>: <span class="number">22</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>: <span class="string">&quot;php&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">3</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>: <span class="string">&quot;peter&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>: <span class="number">33</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>: <span class="string">&quot;python&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4、第二步：显示四个文本框">4、第二步：显示四个文本框</h2><h3 id="①HTML标签-2">①HTML标签</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 四个文本框、显示收集到的文本框数据的p标签、按钮这三个部分需要共享数据，所以要放在同一个app中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;appDiv&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第一部分：四个文本框 --&gt;</span></span><br><span class="line">编号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empId&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empName&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empAge&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">专业：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empSubject&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二部分：显示收集到的文本框数据的p标签 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第三部分：按钮 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码-2">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> appDiv = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appDiv&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="comment">// 初始值设置空字符串即可</span></span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>测试是否正确的方式是：在控制台尝试修改Vue对象的数据属性值：</p><p><img src="./images/img010.png" alt="./images"></p><h2 id="5、第三步：创建一个p标签">5、第三步：创建一个p标签</h2><p>HTML标签：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 四个文本框、显示收集到的文本框数据的p标签、按钮这三个部分需要共享数据，所以要放在同一个app中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;appDiv&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第一部分：四个文本框 --&gt;</span></span><br><span class="line">编号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入编号&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入姓名&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入年龄&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">专业：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empSubject&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入专业&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二部分：显示收集到的文本框数据的p标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;empId&#125;&#125; &#123;&#123;empName&#125;&#125; &#123;&#123;empAge&#125;&#125; &#123;&#123;empSubject&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第三部分：按钮 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6、第四步：点击添加记录按钮">6、第四步：点击添加记录按钮</h2><h3 id="①第一小步：给按钮设置事件驱动">①第一小步：给按钮设置事件驱动</h3><h4 id="1-HTML标签">[1]HTML标签</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 四个文本框、显示收集到的文本框数据的p标签、按钮这三个部分需要共享数据，所以要放在同一个app中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;appDiv&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第一部分：四个文本框 --&gt;</span></span><br><span class="line">编号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入编号&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入姓名&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empAge&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入年龄&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">专业：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;empSubject&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入专业&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二部分：显示收集到的文本框数据的p标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;empId&#125;&#125; &#123;&#123;empName&#125;&#125; &#123;&#123;empAge&#125;&#125; &#123;&#123;empSubject&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第三部分：按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;addRecord&quot;</span>&gt;</span>添加记录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-Vue代码">[2]Vue代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> appDiv = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appDiv&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="comment">// 初始值设置空字符串即可</span></span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;addRecord&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我点击了那个按钮……&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="./images/img011.png" alt="./images"></p><h3 id="②第二小步：打印一下文本框输入的数据">②第二小步：打印一下文本框输入的数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> appDiv = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appDiv&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="comment">// 初始值设置空字符串即可</span></span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;addRecord&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我点击了那个按钮……&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empId</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empName</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empAge</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empSubject</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="./images/img012.png" alt="./images"></p><h3 id="③第三小步：将收集到的数据添加到表格中">③第三小步：将收集到的数据添加到表格中</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;addRecord&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确认单击事件是否绑定成功</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我点击了那个按钮……&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确认是否能够正确收集到文本框数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empId</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empName</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empAge</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">empSubject</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将收集到的文本框数据封装为一个对象</span></span><br><span class="line"><span class="keyword">var</span> employee = &#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="variable language_">this</span>.<span class="property">empId</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="variable language_">this</span>.<span class="property">empName</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="variable language_">this</span>.<span class="property">empAge</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="variable language_">this</span>.<span class="property">empSubject</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将上面的对象压入表格数据的employeeList数组</span></span><br><span class="line">appTable.<span class="property">employeeList</span>.<span class="title function_">push</span>(employee);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="./images/img013.png" alt="./images"></p><p><a href="verse10.html">上一节</a> <a href="index.html">回目录</a> <a href="verse12.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse06/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse06/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第六节 Vue.js基本语法：条件渲染</h1><p>根据Vue对象中，数据属性的值来判断是否对HTML页面内容进行渲染。</p><h2 id="1、v-if">1、v-if</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>if<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/./images/one.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;!flag&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/./images/two.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;flag&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2、v-if和v-else">2、v-if和v-else</h2><h3 id="①HTML代码-2">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app02&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>if/else<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/./images/one.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-else</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/./images/two.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码-2">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app02 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app02&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;flag&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3、v-show">3、v-show</h2><h3 id="①HTML代码-3">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app03&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>v-show<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/./images/mi.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码-3">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app03 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app03&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;flag&quot;</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse05.html">上一节</a> <a href="index.html">回目录</a> <a href="verse07.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse08/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse08/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第八节 Vue.js基本语法：事件驱动</h1><h2 id="1、demo：字符串顺序反转">1、demo：字符串顺序反转</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- v-on:事件类型=&quot;事件响应函数的函数名&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;reverseMessage&quot;</span>&gt;</span>Click me,reverse message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>:<span class="string">&quot;Hello Vue!&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;reverseMessage&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">message</span> = <span class="variable language_">this</span>.<span class="property">message</span>.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2、demo：获取鼠标移动时的坐标信息">2、demo：获取鼠标移动时的坐标信息</h2><h3 id="①HTML代码-2">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;area&quot;</span> <span class="attr">v-on:mousemove</span>=<span class="string">&quot;recordPosition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;showPosition&quot;</span>&gt;</span>&#123;&#123;position&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码-2">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;position&quot;</span>:<span class="string">&quot;暂时没有获取到鼠标的位置信息&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;recordPosition&quot;</span>:<span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">position</span> = event.<span class="property">clientX</span> + <span class="string">&quot; &quot;</span> + event.<span class="property">clientY</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse07.html">上一节</a> <a href="index.html">回目录</a> <a href="verse09.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse07/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse07/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第七节 Vue.js基本语法：列表渲染</h1><h2 id="1、迭代一个简单的数组">1、迭代一个简单的数组</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app01&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用v-for语法遍历数组 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- v-for的值是语法格式是：引用数组元素的变量名 in Vue对象中的数组属性名 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在文本标签体中使用&#123;&#123;引用数组元素的变量名&#125;&#125;渲染每一个数组元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;fruit in fruitList&quot;</span>&gt;</span>&#123;&#123;fruit&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app01 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app01&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;fruitList&quot;</span>: [</span><br><span class="line"><span class="string">&quot;apple&quot;</span>,</span><br><span class="line"><span class="string">&quot;banana&quot;</span>,</span><br><span class="line"><span class="string">&quot;orange&quot;</span>,</span><br><span class="line"><span class="string">&quot;grape&quot;</span>,</span><br><span class="line"><span class="string">&quot;dragonfruit&quot;</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2、迭代一个对象数组">2、迭代一个对象数组</h2><h3 id="①HTML代码-2">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>专业<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;employee in employeeList&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empId&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empName&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empAge&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;employee.empSubject&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码-2">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;employeeList&quot;</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="number">11</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;tom&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="number">111</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;java&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="number">22</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;jerry&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="number">222</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;php&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;empId&quot;</span>:<span class="number">33</span>,</span><br><span class="line"><span class="string">&quot;empName&quot;</span>:<span class="string">&quot;bob&quot;</span>,</span><br><span class="line"><span class="string">&quot;empAge&quot;</span>:<span class="number">333</span>,</span><br><span class="line"><span class="string">&quot;empSubject&quot;</span>:<span class="string">&quot;python&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse06.html">上一节</a> <a href="index.html">回目录</a> <a href="verse08.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 Vue.js基本语法：双向数据绑定</h1><h2 id="1、提出问题">1、提出问题</h2><p><img src="./images/img006.png" alt="./images"></p><p>而使用了双向绑定后，就可以实现：页面上数据被修改后，Vue对象中的数据属性也跟着被修改。</p><h2 id="2、demo">2、demo</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- v-bind:属性名 效果是从Vue对象渲染到页面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- v-model:属性名 效果不仅是从Vue对象渲染到页面，而且能够在页面上数据修改后反向修改Vue对象中的数据属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;vueValue&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;vueValue&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Vue对象，挂载#app这个div标签</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;vueValue&quot;</span>:<span class="string">&quot;太阳当空照&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="③页面效果">③页面效果</h3><p>p标签内的数据能够和文本框中的数据实现同步修改：</p><p><img src="./images/img007.png" alt="./images"></p><h2 id="3、去除前后空格">3、去除前后空格</h2><h3 id="①-value可以省略">①:value可以省略</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;vueValue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②-trim修饰符">②.trim修饰符</h3><p>实际开发中，要考虑到用户在输入数据时，有可能会包含前后空格。而这些前后的空格对我们程序运行来说都是干扰因素，要去掉。在v-model后面加上.trim修饰符即可实现。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;vueValue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>Vue会帮助我们在文本框失去焦点时自动去除前后空格。</p><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a> <a href="verse06.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 Vue.js基本语法：绑定元素属性</h1><h2 id="1、基本语法">1、基本语法</h2><p>v-bind:HTML标签的原始属性名</p><h2 id="2、demo">2、demo</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- v-bind:value表示将value属性交给Vue来进行管理，也就是绑定到Vue对象 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- vueValue是一个用来渲染属性值的表达式，相当于标签体中加&#123;&#123;&#125;&#125;的表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-bind:value</span>=<span class="string">&quot;vueValue&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 同样的表达式，在标签体内通过&#123;&#123;&#125;&#125;告诉Vue这里需要渲染； --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在HTML标签的属性中，通过v-bind:属性名=&quot;表达式&quot;的方式告诉Vue这里要渲染 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;vueValue&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Vue对象，挂载#app这个div标签</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;vueValue&quot;</span>:<span class="string">&quot;太阳当空照&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3、小结">3、小结</h2><p>本质上，v-bind:属性名=&quot;表达式&quot;它们都是<span style="color:blue;font-weight:bold;">用Vue对象来渲染页面</span>。只不过：</p><ul><li>文本标签体：使用形式</li><li>属性：使用v-bind:属性名=&quot;表达式&quot;形式</li></ul><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 Vue.js基本语法：声明式渲染</h1><h2 id="1、概念">1、概念</h2><h3 id="①声明式">①声明式</h3><p><span style="color:blue;font-weight:bold;">『声明式』</span>是相对于<span style="color:blue;font-weight:bold;">『编程式』</span>而言的。</p><ul><li>声明式：告诉框架做什么，具体操作由框架完成</li><li>编程式：自己编写代码完成具体操作</li></ul><h3 id="②渲染">②渲染</h3><p><img src="./images/img003.png" alt="./images"></p><p>上图含义解释：</p><ul><li>蓝色方框：HTML标签</li><li>红色圆形：动态、尚未确定的数据</li><li>蓝色圆形：经过程序运算以后，计算得到的具体的，可以直接在页面上显示的数据、</li><li>渲染：程序计算动态数据得到具体数据的过程</li></ul><h2 id="2、demo">2、demo</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用&#123;&#123;&#125;&#125;格式，指定要被渲染的数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②vue代码">②vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建一个JSON对象，作为new Vue时要使用的参数</span></span><br><span class="line"><span class="keyword">var</span> argumentJson = &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// el用于指定Vue对象要关联的HTML元素。el就是element的缩写</span></span><br><span class="line"><span class="comment">// 通过id属性值指定HTML元素时，语法格式是：#id</span></span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// data属性设置了Vue对象中保存的数据</span></span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>:<span class="string">&quot;Hello Vue!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建Vue对象，传入上面准备好的参数</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(argumentJson);</span><br></pre></td></tr></table></figure><p><img src="./images/img004.png" alt="./images"></p><h2 id="3、查看声明式渲染的响应式效果">3、查看声明式渲染的响应式效果</h2><p><img src="./images/img005.png" alt="./images"></p><p>通过验证Vue对象的『响应式』效果，我们看到Vue对象和页面上的HTML标签确实是始终保持着关联的关系，同时看到Vue在背后确实是做了大量的工作。</p><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 准备Vue.js环境</h1><h2 id="1、开发中的最佳实践">1、开发中的最佳实践</h2><p>『最佳实践』是实际开发中，针对特定问题提炼出来的最好的解决方案。把『最佳实践』抽取出来，封装到各自编程语言的程序包中，就是框架的基础。</p><ul><li>Java语言的程序包：jar包</li><li>JavaScript语言的程序包：外部js文件</li></ul><p>对于Java程序来说，框架=jar包+配置文件。对于Vue来说，导入<span style="color:blue;font-weight:bold;">Vue的外部js文件</span>就能够使用Vue框架了。</p><h2 id="2、Vue框架的js文件获取">2、Vue框架的js文件获取</h2><p>官网提供的下载地址：<a href="https://cdn.jsdelivr.net/npm/vue/dist/vue.js">https://cdn.jsdelivr.net/npm/vue/dist/vue.js</a></p><h2 id="3、本地创建vue-js文件">3、本地创建vue.js文件</h2><p>第一步：在HBuilderX中创建工程</p><p>第二步：在工程目录下创建script目录用来存放vue.js文件</p><p>第三步：创建空vue.js文件</p><p><img src="./images/img001.png" alt="./images"></p><p>第四步：将官网提供的vue.js文件的内容复制粘贴到本地vue.js文件中</p><h2 id="4、创建HTML文档并引入vue-js">4、创建HTML文档并引入vue.js</h2><p><img src="./images/img002.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/pro03-vue/script/vue.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/index/</url>
      
        <content type="html"><![CDATA[<h1>第四章 Vue.js</h1><p><a href="verse01.html">第一节 Vue.js简介</a></p><p><a href="verse02.html">第二节 准备Vue.js环境</a></p><p><a href="verse03.html">第三节 Vue.js基本语法：声明式渲染</a></p><p><a href="verse04.html">第四节 Vue.js基本语法：绑定元素属性</a></p><p><a href="verse05.html">第五节 Vue.js基本语法：双向数据绑定</a></p><p><a href="verse06.html">第六节 Vue.js基本语法：条件渲染</a></p><p><a href="verse07.html">第七节 Vue.js基本语法：列表渲染</a></p><p><a href="verse08.html">第八节 Vue.js基本语法：事件驱动</a></p><p><a href="verse09.html">第九节 Vue.js基本语法：侦听属性</a></p><p><a href="verse10.html">第十节 Vue.js基本语法：简化写法</a></p><p><a href="verse11.html">第十一节 练习</a></p><p><a href="verse12.html">第十二节 Vue对象生命周期</a></p><p><a href="../chapter03/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter05/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter04/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 Vue.js简介</h1><h2 id="1、框架">1、框架</h2><p>任何编程语言在最初的时候都是没有框架的，后来随着在实际开发过程中不断总结<span style="color:blue;font-weight:bold;">『经验』</span>，积累<span style="color:blue;font-weight:bold;">『最佳实践』</span>，慢慢的人们发现很多<span style="color:blue;font-weight:bold;">『特定场景』</span>下的<span style="color:blue;font-weight:bold;">『特定问题』</span>总是可以<span style="color:blue;font-weight:bold;">『套用固定解决方案』</span>。</p><p>于是有人把成熟的<span style="color:blue;font-weight:bold;">『固定解决方案』</span>收集起来，整合在一起，就成了<span style="color:blue;font-weight:bold;">『框架』</span>。</p><p>在使用框架的过程中，我们往往只需要告诉框架<span style="color:blue;font-weight:bold;">『做什么（声明）』</span>，而不需要关心框架<span style="color:blue;font-weight:bold;">『怎么做（编程）』</span>。</p><p>对于Java程序来说，我们使用框架就是导入那些封装了<span style="color:blue;font-weight:bold;">『固定解决方案』</span>的jar包，然后通过<span style="color:blue;font-weight:bold;">『配置文件』</span>告诉框架做什么，就能够大大简化编码，提高开发效率。我们使用过的junit其实就是一款单元测试框架。</p><p>而对于JavaScript程序来说，我们使用框架就是导入那些封装了<span style="color:blue;font-weight:bold;">『固定解决方案』</span>的<span style="color:blue;font-weight:bold;">『js文件』</span>，然后在框架的基础上编码。</p><blockquote><p>用洗衣服来类比框架：</p><p>典型应用场景：洗衣服</p><p>输入数据：衣服、洗衣液、水</p><p>不使用框架：手洗</p><p>使用框架：使用洗衣机，对人来说，只需要按键，具体操作是洗衣机完成的。人只是告诉洗衣机做什么，具体的操作是洗衣机完成的。</p></blockquote><p>实际开发中使用框架时，我们也主要是告诉框架要做什么，具体操作是框架完成的。</p><h2 id="2、Vue-js">2、Vue.js</h2><h3 id="①Vue-js的作者">①Vue.js的作者</h3><p>在为AngularJS工作之后，Vue的作者<span style="color:blue;font-weight:bold;">尤雨溪</span>开Vue.js。他声称自己的思路是提取Angular中自己喜欢的部分，构建出一款相当轻量的框架。</p><p><img src="./images/img001.jpg" alt="./images"></p><p>Vue最早发布于2014年2月。作者在Hacker News、Echo JS与 Reddit的JavaScript版块发布了最早的版本。一天之内，Vue 就登上了这三个网站的首页。</p><p>Vue是Github上最受欢迎的开源项目之一。同时，在JavaScript框架/函数库中， Vue所获得的星标数已超过React，并高于Backbone.js、Angular 2、jQuery等项目。</p><h3 id="②Vue-js的官网介绍">②Vue.js的官网介绍</h3><p>Vue (读音 /vjuː/，类似于<strong>view</strong>) 是一套用于构建用户界面的<strong>渐进式框架</strong>。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与<a href="https://cn.vuejs.org/v2/guide/single-file-components.html">现代化的工具链</a>以及各种<a href="https://github.com/vuejs/awesome-vue#libraries--plugins">支持类库</a>结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p><p><a href="https://cn.vuejs.org/">Vue.js官网网址</a></p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 DOM</h1><h2 id="1、概念">1、概念</h2><h3 id="①名词解释">①名词解释</h3><p>DOM是<span style="color:blue;font-weight:bold;">D</span>ocument <span style="color:blue;font-weight:bold;">O</span>bject  <span style="color:blue;font-weight:bold;">M</span>odel的缩写，意思是<span style="color:blue;font-weight:bold;">『文档对象模型』</span>——将HTML文档抽象成模型，再封装成对象方便用程序操作。</p><p>这是一种非常常用的编程思想：将现实世界的事物抽象成模型，这样就非常容易使用对象来量化的描述现实事物，从而把生活中的问题转化成一个程序问题，最终实现用应用软件协助解决现实问题。而在这其中<span style="color:blue;font-weight:bold;">『模型』</span>就是那个连通现实世界和代码世界的桥梁。</p><h3 id="②DOM树">②DOM树</h3><p>浏览器把HTML文档从服务器上下载下来之后就开始按照<span style="color:blue;font-weight:bold;">『从上到下』</span>的顺序<span style="color:blue;font-weight:bold;">『读取HTML标签』</span>。每一个标签都会被封装成一个<span style="color:blue;font-weight:bold;">『对象』</span>。</p><p>而第一个读取到的肯定是根标签html，然后是它的子标签head，再然后是head标签里的子标签……所以从html标签开始，整个文档中的所有标签都会根据它们之间的<span style="color:blue;font-weight:bold;">『父子关系』</span>被放到一个<span style="color:blue;font-weight:bold;">『树形结构』</span>的对象中。</p><p><img src="./images/img003.png" alt="./images"></p><p>这个包含了所有标签对象的整个树形结构对象就是JavaScript中的一个<span style="color:blue;font-weight:bold;">可以直接使用的内置对象</span>：<span style="color:blue;font-weight:bold;">document</span>。</p><p>例如，下面的标签结构：</p><p><img src="./images/img004.png" alt="./images"></p><p>会被解析为：</p><p><img src="./images/img005.png" alt="./images"></p><h2 id="2、具体概念">2、具体概念</h2><h3 id="①各个组成部分的类型">①各个组成部分的类型</h3><p>整个文档中的一切都可以看做Node。各个具体组成部分的具体类型可以看做Node类型的子类。</p><blockquote><p>其实严格来说，JavaScript并不支持真正意义上的『继承』，这里我们借用Java中的『继承』概念，从逻辑上来帮助我们理解各个类型之间的关系。</p></blockquote><table><thead><tr><th>组成部分</th><th>节点类型</th><th>具体类型</th></tr></thead><tbody><tr><td>整个文档</td><td>文档节点</td><td>Document</td></tr><tr><td>HTML标签</td><td>元素节点</td><td>Element</td></tr><tr><td>HTML标签内的文本</td><td>文本节点</td><td>Text</td></tr><tr><td>HTML标签内的属性</td><td>属性节点</td><td>Attr</td></tr><tr><td>注释</td><td>注释节点</td><td>Comment</td></tr></tbody></table><h3 id="②父子关系">②父子关系</h3><p><img src="./images/img006.png" alt="./images"></p><h3 id="③先辈后代关系">③先辈后代关系</h3><p><img src="./images/img007.png" alt="./images"></p><h2 id="3、DOM操作">3、DOM操作</h2><p>由于实际开发时基本上都是使用JavaScript的各种框架来操作，而框架中的操作方式和我们现在看到的原生操作完全不同，所以下面罗列的API仅供参考，不做要求。</p><h3 id="①在整个文档范围内查询元素节点">①在整个文档范围内查询元素节点</h3><table><thead><tr><th>功能</th><th>API</th><th>返回值</th></tr></thead><tbody><tr><td>根据id值查询</td><td>document.getElementById(“id值”)</td><td>一个具体的元素节</td></tr><tr><td>根据标签名查询</td><td>document.getElementsByTagName(“标签名”)</td><td>元素节点数组</td></tr><tr><td>根据name属性值查询</td><td>document.getElementsByName(“name值”)</td><td>元素节点数组</td></tr></tbody></table><h3 id="②在具体元素节点范围内查找子节点">②在具体元素节点范围内查找子节点</h3><table><thead><tr><th>功能</th><th>API</th><th>返回值</th></tr></thead><tbody><tr><td>查找全部子节点</td><td>element.childNodes<br />【W3C考虑换行，IE≤8不考虑】</td><td>节点数组</td></tr><tr><td>查找第一个子节点</td><td>element.firstChild<br />【W3C考虑换行，IE≤8不考虑】</td><td>节点对象</td></tr><tr><td>查找最后一个子节点</td><td>element.lastChild<br />【W3C考虑换行，IE≤8不考虑】</td><td>节点对象</td></tr></tbody></table><h3 id="③查找指定元素节点的父节点">③查找指定元素节点的父节点</h3><table><thead><tr><th>功能</th><th>API</th><th>返回值</th></tr></thead><tbody><tr><td>查找指定元素节点的父节点</td><td>element.parentNode</td><td>节点对象</td></tr></tbody></table><h3 id="④查找指定元素节点的兄弟节点">④查找指定元素节点的兄弟节点</h3><table><thead><tr><th>功能</th><th>API</th><th>返回值</th></tr></thead><tbody><tr><td>查找前一个兄弟节点</td><td>node.previousSibling<br />【W3C考虑换行，IE≤8不考虑】</td><td>节点对象</td></tr><tr><td>查找后一个兄弟节点</td><td>node.nextSibling<br />【W3C考虑换行，IE≤8不考虑】</td><td>节点对象</td></tr></tbody></table><h3 id="⑤属性操作">⑤属性操作</h3><table><thead><tr><th>需求</th><th>操作方式</th></tr></thead><tbody><tr><td>读取属性值</td><td>元素对象.属性名</td></tr><tr><td>修改属性值</td><td>元素对象.属性名=新的属性值</td></tr></tbody></table><h3 id="⑥文本操作">⑥文本操作</h3><table><thead><tr><th>需求</th><th>操作方式</th></tr></thead><tbody><tr><td>读取文本值</td><td>element.firstChild.nodeValue</td></tr><tr><td>修改文本值</td><td>element.firstChild.nodeValue=新文本值</td></tr></tbody></table><h3 id="⑦DOM增删改操作">⑦DOM增删改操作</h3><table><thead><tr><th>API</th><th>功能</th></tr></thead><tbody><tr><td>document.createElement(“标签名”)</td><td>创建元素节点并返回，但不会自动添加到文档中</td></tr><tr><td>document.createTextNode(“文本值”)</td><td>创建文本节点并返回，但不会自动添加到文档中</td></tr><tr><td>element.appendChild(ele)</td><td>将ele添加到element所有子节点后面</td></tr><tr><td>parentEle.insertBefore(newEle,targetEle)</td><td>将newEle插入到targetEle前面</td></tr><tr><td>parentEle.replaceChild(newEle, oldEle)</td><td>用新节点替换原有的旧子节点</td></tr><tr><td>parentEle.removeChild(childNode)</td><td>删除指定的子节点</td></tr><tr><td>element.innerHTML</td><td>读写HTML代码</td></tr></tbody></table><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 JavaScript事件驱动</h1><p><img src="./images/img002.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-id">#eventArea</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css"><span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用div作为鼠标移动区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;eventArea&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在p标签内显示鼠标坐标 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;showData&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 根据id找到div标签对应的元素对象</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> divEle = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;eventArea&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 根据id找到p标签对应的元素对象</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> pEle = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;showData&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 声明事件响应函数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">whenMouseMove</span>(<span class="params">event</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">pEle.<span class="property">innerText</span> = event.<span class="property">clientX</span> + <span class="string">&quot; &quot;</span> + event.<span class="property">clientY</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 将事件响应函数赋值给对应的事件属性</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// onmousemove表示在鼠标移动的时候</span></span></span><br><span class="line"><span class="language-javascript">divEle.<span class="property">onmousemove</span> = whenMouseMove;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下面是简化的代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;eventArea&quot;</span>).<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">event</span>)&#123;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;showData&quot;</span>).<span class="property">innerText</span> = event.<span class="property">clientX</span> + <span class="string">&quot; &quot;</span> + event.<span class="property">clientY</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 HelloWorld</h1><h2 id="1、功能效果图">1、功能效果图</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="2、代码实现">2、代码实现</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>HelloWorld<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在HTML代码中定义一个按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;helloBtn&quot;</span>&gt;</span>SayHello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在script标签中编写JavaScript代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// document对象代表整个HTML文档</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// document对象调用getElementById()方法表示根据id查找对应的元素对象</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> btnElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;helloBtn&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 给按钮元素对象绑定单击响应函数</span></span></span><br><span class="line"><span class="language-javascript">btnElement.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 弹出警告框</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;hello&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 JavaScript基本语法</h1><h2 id="1、JavaScript代码嵌入方式">1、JavaScript代码嵌入方式</h2><h3 id="①HTML文档内">①HTML文档内</h3><ul><li>JavaScript代码要写在script标签内</li><li>script标签可以写在文档内的任意位置</li><li>为了能够方便查询或操作HTML标签（元素）script标签可以写在body标签后面</li></ul><p>可以参考简化版的HelloWorld</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在HBuilderX中，script标签通过打字“sc”两个字母就可以直接完整生成 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 下面是同样实现HelloWorld功能的简化版代码</span></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;helloBtn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;Hello simple&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②引入外部JavaScript文档">②引入外部JavaScript文档</h3><p>在script标签内通过src属性指定外部xxx.js文件的路径即可。但是要注意以下两点：</p><ul><li>引用外部JavaScript文件的script标签里面不能写JavaScript代码</li><li>先引入，再使用</li><li>script标签不能写成单标签</li></ul><p><img src="./images/img008.png" alt="./images"></p><p>引入方式如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用script标签的src属性引用外部JavaScript文件，和Java中的import语句类似 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引用外部JavaScript文件的script标签里面不能写JavaScript代码 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引用外部JavaScript文件的script标签不能改成单标签 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 外部JavaScript文件一定要先引入再使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/pro02-JavaScript/scripts/outter.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 调用外部JavaScript文件中声明的方法</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">showMessage</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、声明和使用变量">2、声明和使用变量</h2><h3 id="①JavaScript数据类型">①JavaScript数据类型</h3><ul><li><p>基本数据类型</p><ul><li><p>数值型：JavaScript不区分整数、小数</p></li><li><p>字符串：JavaScript不区分字符、字符串；单引号、双引号意思一样。</p></li><li><p>布尔型：true、false</p><p>在JavaScript中，其他类型和布尔类型的自动转换。</p><p>true：非零的数值，非空字符串，非空对象</p><p>false：零，空字符串，null，undefined</p><p>例如：&quot;false&quot;放在if判断中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;false&quot;是一个非空字符串，直接放在if判断中会被当作『真』处理</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;false&quot;</span>)&#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;true&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>引用类型</p><ul><li>所有new出来的对象</li><li>用[]声明的数组</li><li>用{}声明的对象</li></ul></li></ul><h3 id="②变量">②变量</h3><ul><li><p>关键字：var</p></li><li><p>数据类型：JavaScript变量可以接收任意类型的数据</p></li><li><p>标识符：严格区分大小写</p></li><li><p>变量使用规则</p><ul><li><p>如果使用了一个没有声明的变量，那么会在运行时报错</p><p>Uncaught ReferenceError: b is not defined</p></li><li><p>如果声明一个变量没有初始化，那么这个变量的值就是undefined</p></li></ul></li></ul><h2 id="3、函数">3、函数</h2><h3 id="①内置函数">①内置函数</h3><p>内置函数：系统已经声明好了可以直接使用的函数。</p><h4 id="1-弹出警告框">[1]弹出警告框</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;警告框内容&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="2-弹出确认框">[2]弹出确认框</h4><p>用户点击『确定』返回true，点击『取消』返回false</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="title function_">confirm</span>(<span class="string">&quot;老板，你真的不加个钟吗？&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(result) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老板点了确定，表示要加钟&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老板点了确定，表示不加钟&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-在控制台打印日志">[3]在控制台打印日志</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;日志内容&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="./images/img009.png" alt="./images"></p><h3 id="②声明函数">②声明函数</h3><p>写法1：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写法2：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>写法2可以这样解读：声明一个函数，相当于创建了一个『函数对象』，将这个对象的『引用』赋值给变量total。最后加的分号不是给函数声明加的，而是给整体的赋值语句加的分号。</p><h3 id="③调用函数">③调用函数</h3><p>JavaScript中函数本身就是一种对象，函数名就是这个<span style="color:blue;font-weight:bold;">『对象』</span>的<span style="color:blue;font-weight:bold;">『引用』</span>。而调用函数的格式是：<span style="color:blue;font-weight:bold;">函数引用()</span>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">sum</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result=&quot;</span>+result);</span><br></pre></td></tr></table></figure><p>或：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> totalResult = <span class="title function_">total</span>(<span class="number">3</span>,<span class="number">6</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;totalResult=&quot;</span>+totalResult);</span><br></pre></td></tr></table></figure><h2 id="4、对象">4、对象</h2><p>JavaScript中没有『类』的概念，对于系统内置的对象可以直接创建使用。</p><h3 id="①使用new关键字创建对象">①使用new关键字创建对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">var</span> obj01 = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给对象设置属性和属性值</span></span><br><span class="line">obj01.<span class="property">stuName</span> = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">obj01.<span class="property">stuAge</span> = <span class="number">20</span>;</span><br><span class="line">obj01.<span class="property">stuSubject</span> = <span class="string">&quot;java&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在控制台输出对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj01);</span><br></pre></td></tr></table></figure><h3 id="②使用-创建对象">②使用{}创建对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">var</span> obj02 = &#123;</span><br><span class="line"><span class="string">&quot;soldierName&quot;</span>:<span class="string">&quot;john&quot;</span>,</span><br><span class="line"><span class="string">&quot;soldierAge&quot;</span>:<span class="number">35</span>,</span><br><span class="line"><span class="string">&quot;soldierWeapon&quot;</span>:<span class="string">&quot;gun&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在控制台输出对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj02);</span><br></pre></td></tr></table></figure><h3 id="③给对象设置函数属性">③给对象设置函数属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">var</span> obj01 = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给对象设置属性和属性值</span></span><br><span class="line">obj01.<span class="property">stuName</span> = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">obj01.<span class="property">stuAge</span> = <span class="number">20</span>;</span><br><span class="line">obj01.<span class="property">stuSubject</span> = <span class="string">&quot;java&quot;</span>;</span><br><span class="line"></span><br><span class="line">obj01.<span class="property">study</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">stuName</span> + <span class="string">&quot; is studying&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在控制台输出对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj01);</span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line">obj01.<span class="title function_">study</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">var</span> obj02 = &#123;</span><br><span class="line"><span class="string">&quot;soldierName&quot;</span>:<span class="string">&quot;john&quot;</span>,</span><br><span class="line"><span class="string">&quot;soldierAge&quot;</span>:<span class="number">35</span>,</span><br><span class="line"><span class="string">&quot;soldierWeapon&quot;</span>:<span class="string">&quot;gun&quot;</span>,</span><br><span class="line"><span class="string">&quot;soldierShoot&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">soldierName</span> + <span class="string">&quot; is using &quot;</span> + <span class="variable language_">this</span>.<span class="property">soldierWeapon</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在控制台输出对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj02);</span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line">obj02.<span class="title function_">soldierShoot</span>();</span><br></pre></td></tr></table></figure><h3 id="④this关键字">④this关键字</h3><p>this关键字只有两种情况：</p><ul><li>在函数外面：this关键字指向window对象（代表当前浏览器窗口）</li><li>在函数里面：this关键字指向调用函数的对象</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接打印this</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数中的this</span></span><br><span class="line"><span class="comment">// 1.声明函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建对象</span></span><br><span class="line"><span class="keyword">var</span> obj01 = &#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;tom&quot;</span>,</span><br><span class="line"><span class="string">&quot;getName&quot;</span>:getName</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj02 = &#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;jerry&quot;</span>,</span><br><span class="line"><span class="string">&quot;getName&quot;</span>:getName</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.调用函数</span></span><br><span class="line">obj01.<span class="title function_">getName</span>();</span><br><span class="line">obj02.<span class="title function_">getName</span>();</span><br></pre></td></tr></table></figure><h2 id="5、数组">5、数组</h2><h3 id="①使用new关键字创建数组">①使用new关键字创建数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建数组对象</span></span><br><span class="line"><span class="keyword">var</span> arr01 = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.压入数据</span></span><br><span class="line">arr01.<span class="title function_">push</span>(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">arr01.<span class="title function_">push</span>(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">arr01.<span class="title function_">push</span>(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">arr01.<span class="title function_">push</span>(<span class="string">&quot;grape&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.遍历数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr01.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr01[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.数组元素反序</span></span><br><span class="line">arr01.<span class="title function_">reverse</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr01.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr01[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.数组元素拼接成字符串</span></span><br><span class="line"><span class="keyword">var</span> arrStr = arr01.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arrStr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.字符串拆分成数组</span></span><br><span class="line"><span class="keyword">var</span> arr02 = arrStr.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr02.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr02[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.弹出数组中最后一个元素</span></span><br><span class="line"><span class="keyword">var</span> ele = arr01.<span class="title function_">pop</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ele);</span><br></pre></td></tr></table></figure><h3 id="②使用-创建数组">②使用[]创建数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8.使用[]创建数组</span></span><br><span class="line"><span class="keyword">var</span> arr03 = [<span class="string">&quot;cat&quot;</span>,<span class="string">&quot;dog&quot;</span>,<span class="string">&quot;tiger&quot;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr03);</span><br></pre></td></tr></table></figure><h2 id="6、JSON">6、JSON</h2><h3 id="①JSON格式的用途">①JSON格式的用途</h3><p>在开发中凡是涉及到<span style="color:blue;font-weight:bold;">『跨平台数据传输』</span>，JSON格式一定是首选。</p><h3 id="②JSON格式的说明">②JSON格式的说明</h3><ul><li>JSON数据两端要么是<span style="color:blue;font-weight:bold;">{}</span>，要么是<span style="color:blue;font-weight:bold;">[]</span></li><li><span style="color:blue;font-weight:bold;">{}</span>定义JSON对象</li><li><span style="color:blue;font-weight:bold;">[]</span>定义JSON数组</li><li>JSON对象的格式是：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>key<span class="punctuation">:</span>value<span class="punctuation">,</span>key<span class="punctuation">:</span>value<span class="punctuation">,</span>...<span class="punctuation">,</span>key<span class="punctuation">:</span>value<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>JOSN数组的格式是：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span>value<span class="punctuation">,</span>value<span class="punctuation">,</span>...<span class="punctuation">,</span>value<span class="punctuation">]</span></span><br></pre></td></tr></table></figure><ul><li>key的类型固定是字符串</li><li>value的类型可以是：<ul><li>基本数据类型</li><li>引用类型：JSON对象或JSON数组</li></ul></li></ul><p>正因为JSON格式中value部分还可以继续使用JSON对象或JSON数组，所以JSON格式是可以<span style="color:blue;font-weight:bold;">『多层嵌套』</span>的，所以JSON格式不论多么复杂的数据类型都可以表达。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stuId&quot;</span><span class="punctuation">:</span><span class="number">556</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;stuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;carl&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;school&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;schoolId&quot;</span><span class="punctuation">:</span><span class="number">339</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;schoolName&quot;</span><span class="punctuation">:</span><span class="string">&quot;atguigu&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;subjectList&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;subjectName&quot;</span><span class="punctuation">:</span><span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;subjectScore&quot;</span><span class="punctuation">:</span><span class="number">50</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;subjectName&quot;</span><span class="punctuation">:</span><span class="string">&quot;PHP&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;subjectScore&quot;</span><span class="punctuation">:</span><span class="number">35</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;subjectName&quot;</span><span class="punctuation">:</span><span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;subjectScore&quot;</span><span class="punctuation">:</span><span class="number">24</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;teacherMap&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;aaa&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;teacherName&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;teacherAge&quot;</span><span class="punctuation">:</span><span class="number">20</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;bbb&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;teacherName&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangsanfeng&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;teacherAge&quot;</span><span class="punctuation">:</span><span class="number">108</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ccc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;teacherName&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangwuji&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;teacherAge&quot;</span><span class="punctuation">:</span><span class="number">25</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="③JSON对象和JSON字符串互转">③JSON对象和JSON字符串互转</h3><h4 id="1-JSON对象转JSON字符串">[1]JSON对象转JSON字符串</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonObj = &#123;<span class="string">&quot;stuName&quot;</span>:<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;stuAge&quot;</span>:<span class="number">20</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> jsonStr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(jsonObj);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> jsonObj); <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> jsonStr); <span class="comment">// string</span></span><br></pre></td></tr></table></figure><h4 id="2-JSON字符串转JSON对象">[2]JSON字符串转JSON对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jsonObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsonObj); <span class="comment">// &#123;stuName: &quot;tom&quot;, stuAge: 20&#125;</span></span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 JavaScript简介</h1><h2 id="1、起源">1、起源</h2><p>在<span style="color:blue;font-weight:bold;">1995</span>年时，由<span style="color:blue;font-weight:bold;">Netscape</span>公司的<span style="color:blue;font-weight:bold;">Brendan Eich</span>，在网景导航者浏览器上首次设计实现而成。Netscape在最初将其脚本语言命名为LiveScript，因为Netscape与Sun合作，网景公司管理层希望它外观看起来像Java，因此取名为JavaScript。</p><h2 id="2、特性">2、特性</h2><h3 id="①脚本语言">①脚本语言</h3><p>JavaScript是一种解释型的脚本语言。不同于C、C++、Java等语言先编译后执行,JavaScript不会产生编译出来的字节码文件，而是在程序的运行过程中对源文件逐行进行解释。</p><h3 id="②基于对象">②基于对象</h3><p>JavaScript是一种基于对象的脚本语言，它不仅可以创建对象，也能使用现有的对象。但是面向对象的三大特性：『封装』、『继承』、『多态』中，JavaScript能够实现封装，可以模拟继承，不支持多态，所以它不是一门面向对象的编程语言。</p><h3 id="③弱类型">③弱类型</h3><p>JavaScript中也有明确的数据类型，但是声明一个变量后它可以接收任何类型的数据，并且会在程序执行过程中根据上下文自动转换类型。</p><h3 id="④事件驱动">④事件驱动</h3><p>JavaScript是一种采用事件驱动的脚本语言，它不需要经过Web服务器就可以对用户的输入做出响应。</p><h3 id="⑤跨平台性">⑤跨平台性</h3><p>JavaScript脚本语言不依赖于操作系统，仅需要浏览器的支持。因此一个JavaScript脚本在编写后可以带到任意机器上使用，前提是机器上的浏览器支持JavaScript脚本语言。目前JavaScript已被大多数的浏览器所支持。</p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter03/index/</url>
      
        <content type="html"><![CDATA[<h1>第三章 JavaScript</h1><p><a href="verse01.html">第一节 JavaScript简介</a></p><p><a href="verse02.html">第二节 HelloWorld</a></p><p><a href="verse03.html">第三节 JavaScript基本语法</a></p><p><a href="verse04.html">第四节 DOM</a></p><p><a href="verse05.html">第五节  JavaScript事件驱动</a></p><p><a href="../chapter02/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter04/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 使用HTML表单收集数据</h1><h2 id="1、什么是表单">1、什么是表单</h2><p>在项目开发过程中，凡是需要用户填写的信息都需要用到表单。</p><p><img src="./images/img032.png" alt="./images"></p><h2 id="2、form标签">2、form标签</h2><p>在HTML中我们使用form标签来定义一个表单。而对于form标签来说有两个最重要的属性：action和method。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/aaa/pro01-HTML/page05-form-target.html&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="①action属性">①action属性</h3><p>用户在表单里填写的信息需要发送到服务器端，对于Java项目来说就是交给Java代码来处理。那么在页面上我们就必须正确填写服务器端的能够接收表单数据的地址。</p><p>这个地址要写在form标签的action属性中。但是现在暂时我们还没有服务器端环境，所以先借用一个HTML页面来当作服务器端地址使用。</p><h3 id="②method属性">②method属性</h3><p>『method』这个单词的意思是『方式、方法』，在form标签中method属性用来定义提交表单的<span style="color:blue;font-weight:bold;">『请求方式』</span>。method属性只有两个可选值：get或post，没有极特殊情况的话使用post即可。</p><blockquote><p>什么是<span style="color:blue;font-weight:bold;">『请求方式』</span>？</p><p>浏览器和服务器之间在互相通信时有大量的<span style="color:blue;font-weight:bold;">『数据』</span>需要传输。但是不论是浏览器还是服务器都有很多不同厂商提供的不同产品。</p><p>常见的浏览器有：</p><ul><li>Chrome</li><li>Firefox</li><li>Safari</li><li>Opera</li><li>Edge</li></ul><p>常见的Java服务器有：</p><ul><li>Tomcat</li><li>Weblogic</li><li>WebSphere</li><li>Glassfish</li><li>Jetty</li></ul><p>这么多不同厂商各自开发的应用程序怎么能保证它们彼此之间传输的<span style="color:blue;font-weight:bold;">『数据』</span>能够被对方正确理解呢？</p><p>很简单，我们给这些数据设定<span style="color:blue;font-weight:bold;">『格式』</span>，发送端按照格式发送数据，接收端按照格式解析数据，这样就能够实现数据的<span style="color:blue;font-weight:bold;">『跨平台传输』</span>了。</p><p>而这里定义的<span style="color:blue;font-weight:bold;">『数据格式』</span>就是应用程序之间的<span style="color:blue;font-weight:bold;">『通信协议』</span>。</p><p>在JavaSE阶段的网络编程章节我们接触过TCP/IP、UDP这样的协议，而我们现在使用的<span style="color:blue;font-weight:bold;">『HTTP协议』</span>的底层就是TCP/IP协议。</p><p>HTTP1.1中共定义了八种请求方式：</p><ul><li>GET</li><li>POST</li><li>PUT</li><li>DELETE</li><li>HEAD</li><li>CONNECT</li><li>OPTIONS</li><li>TRACE</li></ul><p>但是在HTML标签中，点击超链接是GET方式的请求，提交一个表单可以通过form标签的method属性指定GET或POST请求，其他请求方式无法通过HTML标签实现。除了GET、POST之外的其他请求方式暂时我们不需要涉及（到我们学习SpringMVC时会用到PUT和DELETE）。至于<span style="color:blue;font-weight:bold;">GET请求和POST请求的区别</span>我们会在讲HTTP协议的时候详细介绍，现在大家可以从表面现象来观察一下。</p></blockquote><h2 id="3、name和value">3、name和value</h2><p>在用户使用一个软件系统时，需要一次性提交很多数据是非常正常的现象。我们肯定不能要求用户一个数据一个数据的提交，而肯定是所有数据填好后一起提交。那就带来一个问题，服务器怎么从众多数据中识别出来收货人、所在地区、详细地址、手机号码……？</p><p>很简单，<span style="color:blue;font-weight:bold;">给每个数据都起一个『名字』</span>，发送数据时用<span style="color:blue;font-weight:bold;">『名字』</span>携带对应的数据，接收数据时通过<span style="color:blue;font-weight:bold;">『名字』</span>获取对应的数据。</p><p>在各个具体的表单标签中，我们通过<span style="color:blue;font-weight:bold;">『name属性』</span>来给数据起<span style="color:blue;font-weight:bold;">『名字』</span>，通过<span style="color:blue;font-weight:bold;">『value属性』</span>来保存要发送给服务器的<span style="color:blue;font-weight:bold;">『值』</span>。</p><p>但是名字和值之间既有可能是<span style="color:blue;font-weight:bold;">『一个名字对应一个值』</span>，也有可能是<span style="color:blue;font-weight:bold;">『一个名字对应多个值』</span>。</p><p>这么看来这样的关系很像我们Java中的Map，而事实上在服务器端就是使用Map类型来接收请求参数的。具体的是类型是：<span style="color:blue;font-weight:bold;">Map&lt;String,String[]&gt;</span>。</p><p>name属性就是Map的键，value属性就是Map的值。</p><p>有了上面介绍的基础知识，下面我们就可以来看具体的表单标签了。</p><h2 id="4、单行文本框">4、单行文本框</h2><h3 id="①代码">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">个性签名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;signal&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②显示效果">②显示效果</h3><p><img src="./images/img033.png" alt="./images"></p><h2 id="5、密码框">5、密码框</h2><h3 id="①代码-2">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;secret&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②显示效果-2">②显示效果</h3><p><img src="./images/img034.png" alt="./images"></p><h2 id="6、单选框">6、单选框</h2><h3 id="①代码-3">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">你最喜欢的季节是：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;spring&quot;</span> /&gt;</span>春天</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;summer&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>夏天</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;autumn&quot;</span> /&gt;</span>秋天</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;winter&quot;</span> /&gt;</span>冬天</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">你最喜欢的动物是：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tiger&quot;</span> /&gt;</span>路虎</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;horse&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>宝马</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cheetah&quot;</span> /&gt;</span>捷豹</span><br></pre></td></tr></table></figure><h3 id="②效果">②效果</h3><p><img src="./images/img035.png" alt="./images"></p><h3 id="③说明">③说明</h3><ul><li>name属性相同的radio为一组，组内互斥</li><li>当用户选择了一个radio并提交表单，这个radio的name属性和value属性组成一个键值对发送给服务器</li><li>设置checked=&quot;checked&quot;属性设置默认被选中的radio</li></ul><h2 id="7、多选框">7、多选框</h2><h3 id="①代码-4">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">你最喜欢的球队是：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Brazil&quot;</span>/&gt;</span>巴西</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;German&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span>德国</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;France&quot;</span>/&gt;</span>法国</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;China&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>/&gt;</span>中国</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;team&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Italian&quot;</span>/&gt;</span>意大利</span><br></pre></td></tr></table></figure><h3 id="②效果-2">②效果</h3><p><img src="./images/img036.png" alt="./images"></p><h2 id="8、下拉列表">8、下拉列表</h2><h3 id="①代码-5">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">你喜欢的运动是：</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;interesting&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;swimming&quot;</span>&gt;</span>游泳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;running&quot;</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shooting&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>射击<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;skating&quot;</span>&gt;</span>溜冰<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②效果-3">②效果</h3><p><img src="./images/img037.png" alt="./images"></p><h3 id="③说明-2">③说明</h3><ul><li>下拉列表用到了两种标签，其中select标签用来定义下拉列表，而option标签设置列表项。</li><li>name属性在select标签中设置。</li><li>value属性在option标签中设置。</li><li>option标签的标签体是显示出来给用户看的，提交到服务器的是value属性的值。</li><li>通过在option标签中设置selected=&quot;selected&quot;属性实现默认选中的效果。</li></ul><h2 id="9、按钮">9、按钮</h2><h3 id="①代码-6">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>&gt;</span>普通按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>重置按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②效果-4">②效果</h3><p><img src="./images/img038.png" alt="./images"></p><h3 id="③说明-3">③说明</h3><table><thead><tr><th>类型</th><th>功能</th></tr></thead><tbody><tr><td>普通按钮</td><td>点击后无效果，需要通过JavaScript绑定单击响应函数</td></tr><tr><td>重置按钮</td><td>点击后将表单内的所有表单项都恢复为默认值</td></tr><tr><td>提交按钮</td><td>点击后提交表单</td></tr></tbody></table><h2 id="10、表单隐藏域">10、表单隐藏域</h2><h3 id="①代码-7">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2233&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②说明">②说明</h3><p>通过表单隐藏域设置的表单项不会显示到页面上，用户看不到。但是提交表单时会一起被提交。用来设置一些需要和表单一起提交但是不希望用户看到的数据，例如：用户id等等。</p><h2 id="11、多行文本框">11、多行文本框</h2><h3 id="①代码-8">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">自我介绍：<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;desc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②效果-5">②效果</h3><p><img src="./images/img039.png" alt="./images"></p><h3 id="③说明-4">③说明</h3><p>textarea没有value属性，如果要设置默认值需要写在开始和结束标签之间。</p><p>上一节 <a href="index.html">回目录</a> <a href="verse06.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse06/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse06/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第六节 CSS的简单应用</h1><h2 id="1、CSS效果示例">1、CSS效果示例</h2><p><a href="demo/sample00.html" target="_blank">未使用CSS样式</a></p><p><a href="demo/sample01.html" target="_blank">使用第一套CSS样式</a></p><p><a href="demo/sample02.html" target="_blank">使用第二套CSS样式</a></p><p><a href="demo/sample03.html" target="_blank">使用第三套CSS样式</a></p><p><a href="demo/sample04.html" target="_blank">使用第四套CSS样式</a></p><h2 id="2、设置CSS样式的三种方式">2、设置CSS样式的三种方式</h2><h3 id="①在HTML标签内设置">①在HTML标签内设置</h3><p>仅对当前标签有效</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px; height: 100px;&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img040.png" alt="./images"></p><h3 id="②在head标签内设置">②在head标签内设置</h3><p>对当前页面有效</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.one</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: lightgreen;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px; height: 100px;&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img041.png" alt="./images"></p><h3 id="③引入外部CSS样式文件">③引入外部CSS样式文件</h3><h4 id="1-创建CSS文件">[1]创建CSS文件</h4><p><img src="./images/img042.png" alt="./images"></p><h4 id="2-编辑CSS文件">[2]编辑CSS文件</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.two</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-引入外部CSS文件">[3]引入外部CSS文件</h4><p>在需要使用这个CSS文件的HTML页面的head标签内加入：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/aaa/pro01-HTML/style/example.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>于是下面HTML代码的显示效果是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img043.png" alt="./images"></p><h2 id="3、CSS代码语法">3、CSS代码语法</h2><ul><li>CSS样式由选择器和声明组成，而声明又由属性和值组成。</li><li>属性和值之间用冒号隔开。</li><li>多条声明之间用分号隔开。</li><li>使用/* … */声明注释。</li></ul><p><img src="./images/img046.png" alt="./images"></p><h2 id="4、CSS选择器">4、CSS选择器</h2><h3 id="①标签选择器">①标签选择器</h3><p>HTML代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">p</span>&gt;Hello, this is <span class="selector-tag">a</span> <span class="selector-tag">p</span> tag.&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">p</span>&gt;Hello, this is <span class="selector-tag">a</span> <span class="selector-tag">p</span> tag.&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">p</span>&gt;Hello, this is <span class="selector-tag">a</span> <span class="selector-tag">p</span> tag.&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">p</span>&gt;Hello, this is <span class="selector-tag">a</span> <span class="selector-tag">p</span> tag.&lt;/<span class="selector-tag">p</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">p</span>&gt;Hello, this is <span class="selector-tag">a</span> <span class="selector-tag">p</span> tag.&lt;/<span class="selector-tag">p</span>&gt;</span><br></pre></td></tr></table></figure><p>CSS代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/img044.png" alt="./images"></p><h3 id="②id选择器">②id选择器</h3><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, this is a p tag.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, this is a p tag.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;special&quot;</span>&gt;</span>Hello, this is a p tag.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, this is a p tag.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, this is a p tag.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#special</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: aqua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/img045.png" alt="./images"></p><h3 id="③类选择器">③类选择器</h3><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.one</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: lightgreen;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./images/img041.png" alt="./images"></p><p><a href="verse05.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节  使用HTML展示文章</h1><p>以文章的组织形式展示数据是HTML最基本的功能了，网页上显示的文章在没有做任何CSS样式设定的情况下如下图所示：</p><p><img src="./images/img005.png" alt="./images"></p><p>本节我们要学习的HTML标签如下表：</p><table><thead><tr><th>标签名称</th><th>功能</th></tr></thead><tbody><tr><td>h1~h6</td><td>1级标题~6级标题</td></tr><tr><td>p</td><td>段落</td></tr><tr><td>a</td><td>超链接</td></tr><tr><td>ul/li</td><td>无序列表</td></tr><tr><td>img</td><td>图片</td></tr><tr><td>div</td><td>定义一个前后有换行的块</td></tr><tr><td>span</td><td>定义一个前后无换行的块</td></tr></tbody></table><p>为了方便编写代码，我们在IDEA中创建一个静态Web工程来操作：</p><p><img src="./images/img006.png" alt="./images"></p><h2 id="1、标题标签">1、标题标签</h2><h3 id="①代码">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是一级标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是二级标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这是三级标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>这是四级标题<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span>&gt;</span>这是五级标题<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>这是六级标题<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②页面显示效果">②页面显示效果</h3><p><img src="./images/img007.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">注意</span>：标题标签前后有换行。</p><h2 id="2、段落标签">2、段落标签</h2><h3 id="①代码-2">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>There is clearly a need for CSS to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②页面显示效果-2">②页面显示效果</h3><p><img src="./images/img008.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">注意</span>：段落标签前后有换行。</p><blockquote><p>元素element  开始标签+属性+文本+结束标签称之为一个元素</p></blockquote><h2 id="3、超链接">3、超链接</h2><h3 id="①代码-3">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;page02-anchor-target.html&quot;</span>&gt;</span>点我跳转到下一个页面<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②页面显示效果-3">②页面显示效果</h3><p><img src="./images/img009.png" alt="./images"></p><p>点击后跳转到href属性指定的页面</p><h2 id="4、路径">4、路径</h2><p>在我们整个Web开发技术体系中，『路径』是一个贯穿始终的重要概念。凡是需要获取另外一个资源的时候都需要用到路径。要想理解路径这个概念，我们首先要认识一个概念：『文件系统』。</p><h3 id="①文件系统">①文件系统</h3><p>我们写代码的时候通常都是在Windows系统来操作，而一个项目开发完成后想要让所有人都能够访问到就必须『部署』到服务器上，也叫『发布』。而服务器通常是Linux系统。</p><p>Windows系统和Linux系统的文件系统有很大差别，为了让我们编写的代码不会因为从Windows系统部署到了Linux系统而出现故障，实际开发时不允许使用<span style="color:blue;font-weight:bold;">物理路径</span>。</p><blockquote><p>物理路径举例：</p><p>D:\aaa\pro01-HTML\page01-article-tag.html</p><p>D:\aaa\pro01-HTML\page02-anchor-target.html</p></blockquote><p>幸运的是不管是Windows系统还是Linux系统环境下，目录结构都是<span style="color:blue;font-weight:bold;">树形结构</span>，编写路径的规则是一样的。</p><p><img src="./images/img010.png" alt="./images"></p><p>所以我们<span style="color:blue;font-weight:bold;">以项目的树形目录结构为依据</span>来编写路径就不用担心操作系统平台发生变化之后路径错误的问题了。有了这个大前提，我们具体编写路径时有两种具体写法：</p><ul><li>相对路径</li><li>绝对路径（建议使用）</li></ul><h3 id="②相对路径">②相对路径</h3><p><span style="color:blue;font-weight:bold;">相对路径都是以<span style="color:red;font-weight:bold;">『当前位置』</span>为基准</span>来编写的。假设我们现在正在浏览a页面，想在a页面内通过超链接跳转到z页面。</p><p><img src="./images/img011.png" alt="./images"></p><p>那么按照相对路径的规则，我们现在所在的位置是a.html所在的b目录：</p><p><img src="./images/img012.png" alt="./images"></p><p>z.html并不在b目录下，所以我们要从b目录出发，向上走，进入b的父目录——c目录：</p><p><img src="./images/img013.png" alt="./images"></p><p>c目录还是不行，继续向上走，进入c的父目录——d目录：</p><p><img src="./images/img014.png" alt="./images"></p><p>在从d目录向下经过两级子目录——e目录、f目录才能找到z.html：</p><p><img src="./images/img015.png" alt="./images"></p><p>所以整个路径的写法是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../../e/f/z.html&quot;</span>&gt;</span>To z.html<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以看到使用相对路径有可能会很繁琐，而且在后面我们结合了在服务器上运行的Java程序后，相对路径的基准是有可能发生变化的，所以<span style="color:blue;font-weight:bold;">不建议使用相对路径</span>。</p><h3 id="③绝对路径">③绝对路径</h3><h4 id="1-通过IDEA服务器打开HTML文件">[1]通过IDEA服务器打开HTML文件</h4><p>测试绝对路径的前提是通过IDEA的内置服务器访问我们编写的HTML页面——这样访问地址的组成结构才能和我们以后在服务器上运行的Java程序一致。</p><p><img src="./images/img016.png" alt="./images"></p><p><img src="./images/img017.png" alt="./images"></p><h4 id="2-服务器访问地址的组成">[2]服务器访问地址的组成</h4><p><img src="./images/img018.png" alt="./images"></p><h4 id="3-绝对路径的写法">[3]绝对路径的写法</h4><p>绝对路径要求必须是以<span style="color:blue;font-weight:bold;">『正斜线』</span>开头。这个开头的正斜线在整个服务器访问地址中对应的位置如下图所示：</p><p><img src="./images/img019.png" alt="./images"></p><p>这里标注出的这个位置代表的是<span style="color:blue;font-weight:bold;">『服务器根目录』</span>，从这里开始我们就是在服务器的内部查找一个具体的Web应用。</p><p>所以我们编写绝对路径时就从这个位置开始，<span style="color:blue;font-weight:bold;">按照目录结构找到目标文件</span>即可。拿前面相对路径中的例子来说，我们想在a.html页面中通过超链接访问z.html。此时路径从正斜线开始，和a.html自身所在位置没有任何关系：</p><p><img src="./images/img020.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/d/e/f/z.html&quot;</span>&gt;</span>To z.html<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-具体例子">[4]具体例子</h4><p>编写超链接访问下面的页面：</p><p><img src="./images/img021.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/aaa/pro01-HTML/animal/cat/miao.html&quot;</span>&gt;</span>Cat Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-小结">[5]小结</h4><p>为了和我们后面学习的内容和正确的编码方式保持一致，建议大家从现在开始就使用绝对路径。</p><h2 id="5、换行">5、换行</h2><h3 id="①代码-4">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">We would like to see as much CSS1 as possible. CSS2 should be limited to widely-supported elements only. The css Zen Garden is about functional, practical CSS and not the latest bleeding-edge tricks viewable by 2% of the browsing public. <span class="tag">&lt;<span class="name">br</span>/&gt;</span>The only real requirement we have is that your CSS validates.</span><br></pre></td></tr></table></figure><h3 id="②页面显示效果-4">②页面显示效果</h3><p><img src="./images/img022.png" alt="./images"></p><h2 id="6、无序列表">6、无序列表</h2><h3 id="①代码-5">①代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Apple<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Banana<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Grape<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②页面显示效果-5">②页面显示效果</h3><p><img src="./images/img023.png" alt="./images"></p><h2 id="7、图片">7、图片</h2><h3 id="①准备图片文件">①准备图片文件</h3><p><img src="./images/img025.png" alt="./images"></p><h3 id="②代码">②代码</h3><p>src属性用来指定图片文件的路径，这里同样按我们前面说的使用<span style="color:blue;font-weight:bold;">『绝对路径』</span>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/aaa/pro01-HTML/./images/mi.jpg&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③页面显示效果">③页面显示效果</h3><p><img src="./images/img024.png" alt="./images"></p><h2 id="8、块">8、块</h2><p><span style="color:blue;font-weight:bold;">『块』</span>并不是为了显示文章内容的，而是为了方便结合CSS对页面进行布局。块有两种，div是前后有换行的块，span是前后没有换行的块。</p><p>把下面代码粘贴到HTML文件中查看他们的区别：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px;height: 100px;&quot;</span>&gt;</span>This is a div block<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px;height: 100px;&quot;</span>&gt;</span>This is a div block<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px;height: 100px;&quot;</span>&gt;</span>This is a span block<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid black;width: 100px;height: 100px;&quot;</span>&gt;</span>This is a span block<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面显示效果为：</p><p><img src="./images/img026.png" alt="./images"></p><h2 id="9、HTML实体">9、HTML实体</h2><p>在HTML文件中，&lt;、&gt;等等这样的符号已经被赋予了特定含义，不会作为符号本身显示到页面上，此时如果我们想使用符号本身怎么办呢？那就是使用HTML实体来转义。</p><p><img src="./images/img027.png" alt="./images"></p><p>资料来源：<a href="https://www.w3school.com.cn/html/html_entities.asp">W3School</a></p><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> 下一节</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 使用HTML表格展示数据</h1><h2 id="1、页面显示效果">1、页面显示效果</h2><p><img src="./images/img028.png" alt="./images"></p><h2 id="2、HTML代码">2、HTML代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用table标签定义表格 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用tr标签定义表格的行 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用th标签定义表头，表头有字体加粗效果 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>属性<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>级别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>忍村<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用td标签定义单元格 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>漩涡鸣人<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>风<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>下忍<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>木叶<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>宇智波佐助<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>雷&amp;火<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>下忍<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>木叶<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>我爱罗<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>沙<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>影<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>砂隐村<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果只有上面的代码，页面显示效果是：</p><p><img src="./images/img029.png" alt="./images"></p><p>没有表格边框。想要显示好看的表格边框可以把下面的style标签代码复制粘贴到head标签里：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">table</span>,<span class="selector-tag">th</span>,<span class="selector-tag">td</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-collapse</span>: collapse;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS还没讲，不必在意语法细节，整体照搬即可。</p><p><img src="./images/img028.png" alt="./images"></p><h2 id="3、合并单元格">3、合并单元格</h2><h3 id="①横向合并">①横向合并</h3><p>使用colspan属性将两个横向相邻的单元格跨列合并：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>宇智波佐助<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>雷&amp;火<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>下忍<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img030.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">注意</span>：<span style="color:blue;font-weight:bold;">『被合并』</span>的单元格要删掉。</p><h3 id="②纵向合并">②纵向合并</h3><p>使用rowspan属性将两个纵向相邻的单元格跨行合并：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>宇智波佐助<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>雷&amp;火<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>下忍<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>我爱罗<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>影<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>砂隐村<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img031.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">注意</span>：<span style="color:blue;font-weight:bold;">『被合并』</span>的单元格要删掉。</p><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 HTML简介</h1><h2 id="1、名词解释">1、名词解释</h2><p>HTML是<span style="color:blue;font-weight:bold;">H</span>yper <span style="color:blue;font-weight:bold;">T</span>ext <span style="color:blue;font-weight:bold;">M</span>arkup <span style="color:blue;font-weight:bold;">L</span>anguage的缩写。意思是<span style="color:blue;font-weight:bold;">『超文本标记语言』</span>。</p><h2 id="2、超文本">2、超文本</h2><p>HTML文件本质上是文本文件，而普通的文本文件只能显示字符。但是HTML技术则通过HTML标签把其他网页、图片、音频、视频等各种多媒体资源引入到当前网页中，让网页有了非常丰富的呈现方式，这就是超文本的含义——本身是文本，但是呈现出来的最终效果超越了文本。</p><p><img src="./images/img003.png" alt="./images"></p><h2 id="3、标记语言">3、标记语言</h2><p>说HTML是一种『标记语言』是因为它不是向Java这样的『编程语言』，因为它是由一系列『标签』组成的，没有常量、变量、流程控制、异常处理、IO等等这些功能。HTML很简单，每个标签都有它固定的含义和确定的页面显示效果。</p><p>标签是通过一组尖括号+标签名的方式来定义的：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>HTML is a very popular fore-end technology.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个例子中使用了一个p标签来定义一个段落，&lt;p&gt;叫<span style="color:blue;font-weight:bold;">『开始标签』</span>，&lt;/p&gt;叫<span style="color:blue;font-weight:bold;">『结束标签』</span>。开始标签和结束标签一起构成了一个完整的标签。开始标签和结束标签之间的部分叫<span style="color:blue;font-weight:bold;">『文本标签体』</span>，也简称<span style="color:blue;font-weight:bold;">『标签体』</span>。</p><p>有的时候标签里还带有<span style="color:blue;font-weight:bold;">『属性』</span>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.xxx.com&quot;</span>&gt;</span>show detail<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>href=&quot;<a href="http://www.xxx.com">http://www.xxx.com</a>&quot;就是属性，href是<span style="color:blue;font-weight:bold;">『属性名』</span>，&quot;<a href="http://www.xxx.com">http://www.xxx.com</a>&quot;是<span style="color:blue;font-weight:bold;">『属性值』</span>。</p><p>还有一种标签是<span style="color:blue;font-weight:bold;">『单标签』</span>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、HelloWorld">4、HelloWorld</h2><p><img src="./images/img004.png" alt="./images"></p><h2 id="5、HTML文件结构">5、HTML文件结构</h2><h3 id="①文档类型声明">①文档类型声明</h3><p>HTML文件中第一行的内容，用来告诉浏览器当前HTML文档的基本信息，其中最重要的就是当前HTML文档遵循的语 法标准。这里我们只需要知道HTML有4和5这两个大的版本，HTML4版本的文档类型声明是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>HTML5版本的文档类型声明是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>现在主流的技术选型都是使用HTML5，之前的版本基本不用了。</p><p>历史上HTML的各个版本：</p><table><thead><tr><th>版本名称</th><th>年份</th></tr></thead><tbody><tr><td>HTML</td><td>1991</td></tr><tr><td>HTML+</td><td>1993</td></tr><tr><td>HTML2.0</td><td>1995</td></tr><tr><td>HTML3.2</td><td>1997</td></tr><tr><td>HTML4.01</td><td>1999</td></tr><tr><td>XHTML1.0</td><td>2000</td></tr><tr><td>HTML5</td><td>2012</td></tr><tr><td>XHTML5</td><td>2013</td></tr></tbody></table><h3 id="②根标签">②根标签</h3><p>html标签是整个文档的根标签，所有其他标签都必须放在html标签里面。上面的文档类型不能当做普通标签看待。</p><blockquote><p>所谓『根』其实是『树根』的意思。在一个树形结构中，根节点只能有一个。</p></blockquote><h3 id="③头部">③头部</h3><p>head标签用于定义文档的头部，其他头部元素都放在head标签里。头部元素包括title标签、script标签、style标签、link标签、meta标签等等。</p><h3 id="④主体">④主体</h3><p>body标签定义网页的主体内容，在浏览器窗口内显示的内容都定义到body标签内。</p><h3 id="⑤注释">⑤注释</h3><p>HTML注释的写法是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注释内容 --&gt;</span></span><br></pre></td></tr></table></figure><p>注释的内容不会显示到浏览器窗口内，是开发人员用来对代码内容进行解释说明。</p><h2 id="6、HTML语法规则">6、HTML语法规则</h2><ul><li>根标签有且只能有一个</li><li>无论是双标签还是单标签都必须正确关闭</li><li>标签可以嵌套但不能交叉嵌套</li><li>注释不能嵌套</li><li>属性必须有值，值必须加引号，单引号或双引号均可</li><li>标签名不区分大小写但建议使用小写</li></ul><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 单一架构回顾</h1><p>我们从现在的JavaWeb阶段到后面学习SSM框架阶段都是在学习单一架构项目开发的技术。而在JavaWeb阶段由于重点是探讨如何实现Web开发，所以必须学习一部分前端开发的技术。本节就是让大家明确我们现在要学习的内容在整个架构体系中处于什么位置。</p><h2 id="1、单一架构技术体系">1、单一架构技术体系</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="2、视图层">2、视图层</h2><p>严格来说视图分成两层：</p><ul><li>前端技术：HTML/CSS/JavaScript</li><li>服务器端页面模板技术：Thymeleaf</li></ul><p>其中HTML、CSS、JavaScript都是工作在浏览器上的，所以它们都属于前端技术。而Thymeleaf是在服务器上把动态内容计算出具体数据，所以严格来说Thymeleaf是后端技术。</p><p><img src="./images/img002.png" alt="./images"></p><blockquote><p>这里大家会有个疑问：为什么在『视图』这个地方已经有HTML、CSS、JavaScript这些前端技术了，能够生成用户可以操作的界面，那为什么还需要Thymeleaf这样一个后端技术呢？</p><p>简单来说原因是Thymeleaf=HTML+动态数据，而HTML不支持动态数据，这部分需要借助Thymeleaf来完成。</p><p>更进一步的细节咱们讲到那再说啦！</p></blockquote><h2 id="3、Web2-0">3、Web2.0</h2><p>Web2.0是相对于更早的网页开发规范而提出的新规范。Web2.0规范之前的网页开发并没有明确的将HTML、CSS、JavaScript代码分开，而是互相之间纠缠在一起，导致代码维护困难，开发效率很低。</p><blockquote><p>在开发中我们把这样彼此纠缠、互相影响的现象称为『耦合』。而把耦合在一起的东西拆解开，让他们彼此独立出来称为『解耦』。各个组成部分独立完成自己负责的功能，和其他模块无关称为『内聚』。</p><p>将来大家经常会听到一句话：软件开发提倡『 高内聚，低耦合』。</p><p>一个软件项目只有做到了高内聚、低耦合才能算得上结构严谨，模块化程度高，有利于开发和维护。</p></blockquote><p>所以Web2.0规范主张将网页代码分成下面三个部分：</p><ul><li>结构：由HTML实现，负责管理网页的内容。将来网页上不管是静态还是动态的数据都是填写到HTML的标签里。</li><li>表现：由CSS实现，负责管理网页内容的表现形式。比如：颜色、尺寸、位置、层级等等。也就是给数据穿上一身漂亮的衣服。</li><li>行为：由JavaScript实现，负责实现网页的动态交互效果。比如：轮播图、表单验证、鼠标滑过显示下拉菜单、鼠标滑过改变背景颜色等等。</li></ul><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/index/</url>
      
        <content type="html"><![CDATA[<h1>第二章 HTML&amp;CSS</h1><p><a href="verse01.html">第一节 单一架构回顾</a></p><p><a href="verse02.html">第二节 HTML简介</a></p><p><a href="verse03.html">第三节  使用HTML展示文章</a></p><p>第四节 使用HTML表格展示数据 暂停</p><p><a href="verse05.html">第五节 使用HTML表单收集数据</a></p><p><a href="verse06.html">第六节 CSS的简单应用</a></p><p><a href="../chapter01/index.html">上一章</a> <a href="../index.html">回目录</a> <a href="../chapter03/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample02/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" ><head><meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /><meta name="author" content="Dave Shea" /><meta name="keywords" content="design, css, cascading, style, sheets, xhtml, graphic design, w3c, web standards, visual, display" /><meta name="description" content="A demonstration of what can be accomplished visually through CSS-based design." /><meta name="robots" content="all" /><title>css Zen Garden: The Beauty in CSS Design</title><!-- to correct the unsightly Flash of Unstyled Content. http://www.bluerobot.com/web/css/fouc.asp --><script type="text/javascript"></script><link rel="stylesheet" type="text/css" href="css2/basic.css" /><!-- <link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico" /> --><!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="zengarden.xml" /> --></head><!--This xhtml document is marked up to provide the designer with the maximum possible flexibility.There are more classes and extraneous tags than needed, and in a real world situation, it's morelikely that it would be much leaner.However, I think we can all agree that even given that, we're still better off than if this had beenbuilt with tables.--><body id="css-zen-garden"><div id="container"><div id="intro"><div id="pageHeader"><h1><span>css Zen Garden</span></h1><h2><span>The Beauty of <acronym title="Cascading Style Sheets">CSS</acronym> Design</span></h2></div><div id="quickSummary"><p class="p1"><span>A demonstration of what can be accomplished visually through <acronym title="Cascading Style Sheets">CSS</acronym>-based design. Select any style sheet from the list to load it into this page.</span></p><p class="p2"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a></span></p></div><div id="preamble"><h3><span>The Road to Enlightenment</span></h3><p class="p1"><span>Littering a dark and dreary road lay the past relics of browser-specific tags, incompatible <acronym title="Document Object Model">DOM</acronym>s, and broken <acronym title="Cascading Style Sheets">CSS</acronym> support.</span></p><p class="p2"><span>Today, we must clear the mind of past practices. Web enlightenment has been achieved thanks to the tireless efforts of folk like the <acronym title="World Wide Web Consortium">W3C</acronym>, <acronym title="Web Standards Project">WaSP</acronym> and the major browser creators.</span></p><p class="p3"><span>The css Zen Garden invites you to relax and meditate on the important lessons of the masters. Begin to see with clarity. Learn to use the (yet to be) time-honored techniques in new and invigorating fashion. Become one with the web.</span></p></div></div><div id="supportingText"><div id="explanation"><h3><span>So What is This About?</span></h3><p class="p1"><span>There is clearly a need for <acronym title="Cascading Style Sheets">CSS</acronym> to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.</span></p><p class="p2"><span><acronym title="Cascading Style Sheets">CSS</acronym> allows complete and total control over the style of a hypertext document. The only way this can be illustrated in a way that gets people excited is by demonstrating what it can truly be, once the reins are placed in the hands of those able to create beauty from structure. To date, most examples of neat tricks and hacks have been demonstrated by structurists and coders. Designers have yet to make their mark. This needs to change.</span></p></div><div id="participation"><h3><span>Participation</span></h3><p class="p1"><span>Graphic artists only please. You are modifying this page, so strong <acronym title="Cascading Style Sheets">CSS</acronym> skills are necessary, but the example files are commented well enough that even <acronym title="Cascading Style Sheets">CSS</acronym> novices can use them as starting points. Please see the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources"><acronym title="Cascading Style Sheets">CSS</acronym> Resource Guide</a> for advanced tutorials and tips on working with <acronym title="Cascading Style Sheets">CSS</acronym>.</span></p><p class="p2"><span>You may modify the style sheet in any way you wish, but not the <acronym title="HyperText Markup Language">HTML</acronym>. This may seem daunting at first if you&#8217;ve never worked this way before, but follow the listed links to learn more, and use the sample files as a guide.</span></p><p class="p3"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a> to work on a copy locally. Once you have completed your masterpiece (and please, don&#8217;t submit half-finished work) upload your .css file to a web server under your control. <a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Use the contact form to send us your CSS file">Send us a link</a> to the file and if we choose to use it, we will spider the associated images. Final submissions will be placed on our server.</span></p></div><div id="benefits"><h3><span>Benefits</span></h3><p class="p1"><span>Why participate? For recognition, inspiration, and a resource we can all refer to when making the case for <acronym title="Cascading Style Sheets">CSS</acronym>-based design. This is sorely needed, even today. More and more major sites are taking the leap, but not enough have. One day this gallery will be a historical curiosity; that day is not today.</span></p></div><div id="requirements"><h3><span>Requirements</span></h3><p class="p1"><span>We would like to see as much <acronym title="Cascading Style Sheets, version 1">CSS1</acronym> as possible. <acronym title="Cascading Style Sheets, version 2">CSS2</acronym> should be limited to widely-supported elements only. The css Zen Garden is about functional, practical <acronym title="Cascading Style Sheets">CSS</acronym> and not the latest bleeding-edge tricks viewable by 2% of the browsing public. The only real requirement we have is that your <acronym title="Cascading Style Sheets">CSS</acronym> validates.</span></p><p class="p2"><span>Unfortunately, designing this way highlights the flaws in the various implementations of <acronym title="Cascading Style Sheets">CSS</acronym>. Different browsers display differently, even completely valid <acronym title="Cascading Style Sheets">CSS</acronym> at times, and this becomes maddening when a fix for one leads to breakage in another. View the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources">Resources</a> page for information on some of the fixes available. Full browser compliance is still sometimes a pipe dream, and we do not expect you to come up with pixel-perfect code across every platform. But do test in as many as you can. If your design doesn&#8217;t work in at least IE5+/Win and Mozilla (run by over 90% of the population), chances are we won&#8217;t accept it.</span></p><p class="p3"><span>We ask that you submit original artwork. Please respect copyright laws. Please keep objectionable material to a minimum; tasteful nudity is acceptable, outright pornography will be rejected.</span></p><p class="p4"><span>This is a learning exercise as well as a demonstration. You retain full copyright on your graphics (with limited exceptions, see <a href="../www.mezzoblue.com/zengarden/submit/guidelines/default.htm">submission guidelines</a>), but we ask you release your <acronym title="Cascading Style Sheets">CSS</acronym> under a Creative Commons license identical to the <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View the Zen Garden's license information.">one on this site</a> so that others may learn from your work.</span></p><p class="p5"><span>Bandwidth graciously donated by <a href="../www.dreamfirestudios.com/default.htm">DreamFire Studios</a>. Now available: <a href="../www.amazon.com/exec/obidos/asin/0321303474/mezzoblue-20/default.htm">Zen Garden, the book</a>.</span>&nbsp;</p></div><div id="footer"><a href="../validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a> &nbsp; <a href="../jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a> &nbsp; <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View details of the license of this site, courtesy of Creative Commons.">cc</a> &nbsp;<a href="../www.contentquality.com/mynewtester/cynthia.exe@url1=http_3a_252f_252fcsszengarden.com_252f" title="Check the accessibility of this site according to U.S. Section 508">508</a> &nbsp;<a href="../mezzoblue.com/zengarden/faq/#aaa" title="Check the accessibility of this site according to Web Content Accessibility Guidelines 1.0">aaa</a></div></div><div id="linkList"><div id="linkList2"><div id="lselect"><h3 class="select"><span>Select a Design:</span></h3><ul><li><a href="@cssfile=_2f202_2f202.css&page=0.htm" title="AccessKey: a" accesskey="a">Retro Theater</a> by <a href="../space-sheeps.info/default.htm" class="c">Eric Rog&eacute;</a></li><li><a href="@cssfile=_2f201_2f201.css&page=0.htm" title="AccessKey: b" accesskey="b">Lily Pond</a> by <a href="../www.tulips4rose.com/default.htm" class="c">Rose Thorogood</a></li><li><a href="@cssfile=_2f200_2f200.css&page=0.htm" title="AccessKey: c" accesskey="c">Icicle Outback</a> by <a href="../www.timovirtanen.com/default.htm" class="c">Timo Virtanen</a></li><li><a href="@cssfile=_2f199_2f199.css&page=0.htm" title="AccessKey: d" accesskey="d">Zen Army</a> by <a href="../www.niceguy.com/default.htm" class="c">Carl Desmond</a></li><li><a href="@cssfile=_2f198_2f198.css&page=0.htm" title="AccessKey: e" accesskey="e">The Original</a> by <a href="../www.bluejam.com/default.htm" class="c">Joachim Shotter</a></li><li><a href="@cssfile=_2f197_2f197.css&page=0.htm" title="AccessKey: f" accesskey="f">Floral Touch</a> by <a href="../www.jahmasta.com/default.htm" class="c">Jadas Jimmy</a></li><li><a href="@cssfile=_2f196_2f196.css&page=0.htm" title="AccessKey: g" accesskey="g">Elegance in Simplicity</a> by <a href="../www.manisheriar.com/blog/default.htm" class="c">Mani Sheriar</a></li><li><a href="@cssfile=_2f195_2f195.css&page=0.htm" title="AccessKey: h" accesskey="h">Dazzling Beauty</a> by <a href="../blog.denysri.com/default.htm" class="c">Deny Sri Supriyono</a></li></ul></div><div id="larchives"><h3 class="archives"><span>Archives:</span></h3><ul><li><a href="@cssfile=_2f175_2f175.css&page=1.htm" title="View next set of designs. AccessKey: n" accesskey="n"><span class="accesskey">n</span>ext designs &raquo;</a></li><li><a href="../www.mezzoblue.com/zengarden/alldesigns/default.htm" title="View every submission to the Zen Garden. AccessKey: w" accesskey="w">Vie<span class="accesskey">w</span> All Designs</a></li></ul></div><div id="lresources"><h3 class="resources"><span>Resources:</span></h3><ul><li><a href="175/175.css" title="View the source CSS file for the currently-viewed design, AccessKey: v" accesskey="v"><span class="accesskey">V</span>iew This Design&#8217;s <acronym title="Cascading Style Sheets">CSS</acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="Links to great sites with information on using CSS. AccessKey: r" accesskey="r"><acronym title="Cascading Style Sheets">CSS</acronym> <span class="accesskey">R</span>esources</a></li><li><a href="../www.mezzoblue.com/zengarden/faq/default.htm" title="A list of Frequently Asked Questions about the Zen Garden. AccessKey: q" accesskey="q"><acronym title="Frequently Asked Questions">FA<span class="accesskey">Q</span></acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Send in your own CSS file. AccessKey: s" accesskey="s"><span class="accesskey">S</span>ubmit a Design</a></li><li><a href="../www.mezzoblue.com/zengarden/translations/default.htm" title="View translated versions of this page. AccessKey: t" accesskey="t"><span class="accesskey">T</span>ranslations</a></li></ul></div></div></div></div><!-- These extra divs/spans may be used as catch-alls to add extra imagery. --><div id="extraDiv1"><span></span></div><div id="extraDiv2"><span></span></div><div id="extraDiv3"><span></span></div><div id="extraDiv4"><span></span></div><div id="extraDiv5"><span></span></div><div id="extraDiv6"><span></span></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample04/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" ><head><meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /><meta name="author" content="Dave Shea" /><meta name="keywords" content="design, css, cascading, style, sheets, xhtml, graphic design, w3c, web standards, visual, display" /><meta name="description" content="A demonstration of what can be accomplished visually through CSS-based design." /><meta name="robots" content="all" /><title>css Zen Garden: The Beauty in CSS Design</title><!-- to correct the unsightly Flash of Unstyled Content. http://www.bluerobot.com/web/css/fouc.asp --><script type="text/javascript"></script><link rel="stylesheet" type="text/css" href="css4/basic.css" /><!-- <link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico" /> --><!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="zengarden.xml" /> --></head><!--This xhtml document is marked up to provide the designer with the maximum possible flexibility.There are more classes and extraneous tags than needed, and in a real world situation, it's morelikely that it would be much leaner.However, I think we can all agree that even given that, we're still better off than if this had beenbuilt with tables.--><body id="css-zen-garden"><div id="container"><div id="intro"><div id="pageHeader"><h1><span>css Zen Garden</span></h1><h2><span>The Beauty of <acronym title="Cascading Style Sheets">CSS</acronym> Design</span></h2></div><div id="quickSummary"><p class="p1"><span>A demonstration of what can be accomplished visually through <acronym title="Cascading Style Sheets">CSS</acronym>-based design. Select any style sheet from the list to load it into this page.</span></p><p class="p2"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a></span></p></div><div id="preamble"><h3><span>The Road to Enlightenment</span></h3><p class="p1"><span>Littering a dark and dreary road lay the past relics of browser-specific tags, incompatible <acronym title="Document Object Model">DOM</acronym>s, and broken <acronym title="Cascading Style Sheets">CSS</acronym> support.</span></p><p class="p2"><span>Today, we must clear the mind of past practices. Web enlightenment has been achieved thanks to the tireless efforts of folk like the <acronym title="World Wide Web Consortium">W3C</acronym>, <acronym title="Web Standards Project">WaSP</acronym> and the major browser creators.</span></p><p class="p3"><span>The css Zen Garden invites you to relax and meditate on the important lessons of the masters. Begin to see with clarity. Learn to use the (yet to be) time-honored techniques in new and invigorating fashion. Become one with the web.</span></p></div></div><div id="supportingText"><div id="explanation"><h3><span>So What is This About?</span></h3><p class="p1"><span>There is clearly a need for <acronym title="Cascading Style Sheets">CSS</acronym> to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.</span></p><p class="p2"><span><acronym title="Cascading Style Sheets">CSS</acronym> allows complete and total control over the style of a hypertext document. The only way this can be illustrated in a way that gets people excited is by demonstrating what it can truly be, once the reins are placed in the hands of those able to create beauty from structure. To date, most examples of neat tricks and hacks have been demonstrated by structurists and coders. Designers have yet to make their mark. This needs to change.</span></p></div><div id="participation"><h3><span>Participation</span></h3><p class="p1"><span>Graphic artists only please. You are modifying this page, so strong <acronym title="Cascading Style Sheets">CSS</acronym> skills are necessary, but the example files are commented well enough that even <acronym title="Cascading Style Sheets">CSS</acronym> novices can use them as starting points. Please see the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources"><acronym title="Cascading Style Sheets">CSS</acronym> Resource Guide</a> for advanced tutorials and tips on working with <acronym title="Cascading Style Sheets">CSS</acronym>.</span></p><p class="p2"><span>You may modify the style sheet in any way you wish, but not the <acronym title="HyperText Markup Language">HTML</acronym>. This may seem daunting at first if you&#8217;ve never worked this way before, but follow the listed links to learn more, and use the sample files as a guide.</span></p><p class="p3"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a> to work on a copy locally. Once you have completed your masterpiece (and please, don&#8217;t submit half-finished work) upload your .css file to a web server under your control. <a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Use the contact form to send us your CSS file">Send us a link</a> to the file and if we choose to use it, we will spider the associated images. Final submissions will be placed on our server.</span></p></div><div id="benefits"><h3><span>Benefits</span></h3><p class="p1"><span>Why participate? For recognition, inspiration, and a resource we can all refer to when making the case for <acronym title="Cascading Style Sheets">CSS</acronym>-based design. This is sorely needed, even today. More and more major sites are taking the leap, but not enough have. One day this gallery will be a historical curiosity; that day is not today.</span></p></div><div id="requirements"><h3><span>Requirements</span></h3><p class="p1"><span>We would like to see as much <acronym title="Cascading Style Sheets, version 1">CSS1</acronym> as possible. <acronym title="Cascading Style Sheets, version 2">CSS2</acronym> should be limited to widely-supported elements only. The css Zen Garden is about functional, practical <acronym title="Cascading Style Sheets">CSS</acronym> and not the latest bleeding-edge tricks viewable by 2% of the browsing public. The only real requirement we have is that your <acronym title="Cascading Style Sheets">CSS</acronym> validates.</span></p><p class="p2"><span>Unfortunately, designing this way highlights the flaws in the various implementations of <acronym title="Cascading Style Sheets">CSS</acronym>. Different browsers display differently, even completely valid <acronym title="Cascading Style Sheets">CSS</acronym> at times, and this becomes maddening when a fix for one leads to breakage in another. View the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources">Resources</a> page for information on some of the fixes available. Full browser compliance is still sometimes a pipe dream, and we do not expect you to come up with pixel-perfect code across every platform. But do test in as many as you can. If your design doesn&#8217;t work in at least IE5+/Win and Mozilla (run by over 90% of the population), chances are we won&#8217;t accept it.</span></p><p class="p3"><span>We ask that you submit original artwork. Please respect copyright laws. Please keep objectionable material to a minimum; tasteful nudity is acceptable, outright pornography will be rejected.</span></p><p class="p4"><span>This is a learning exercise as well as a demonstration. You retain full copyright on your graphics (with limited exceptions, see <a href="../www.mezzoblue.com/zengarden/submit/guidelines/default.htm">submission guidelines</a>), but we ask you release your <acronym title="Cascading Style Sheets">CSS</acronym> under a Creative Commons license identical to the <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View the Zen Garden's license information.">one on this site</a> so that others may learn from your work.</span></p><p class="p5"><span>Bandwidth graciously donated by <a href="../www.dreamfirestudios.com/default.htm">DreamFire Studios</a>. Now available: <a href="../www.amazon.com/exec/obidos/asin/0321303474/mezzoblue-20/default.htm">Zen Garden, the book</a>.</span>&nbsp;</p></div><div id="footer"><a href="../validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a> &nbsp; <a href="../jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a> &nbsp; <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View details of the license of this site, courtesy of Creative Commons.">cc</a> &nbsp;<a href="../www.contentquality.com/mynewtester/cynthia.exe@url1=http_3a_252f_252fcsszengarden.com_252f" title="Check the accessibility of this site according to U.S. Section 508">508</a> &nbsp;<a href="../mezzoblue.com/zengarden/faq/#aaa" title="Check the accessibility of this site according to Web Content Accessibility Guidelines 1.0">aaa</a></div></div><div id="linkList"><div id="linkList2"><div id="lselect"><h3 class="select"><span>Select a Design:</span></h3><ul><li><a href="@cssfile=_2f202_2f202.css&page=0.htm" title="AccessKey: a" accesskey="a">Retro Theater</a> by <a href="../space-sheeps.info/default.htm" class="c">Eric Rog&eacute;</a></li><li><a href="@cssfile=_2f201_2f201.css&page=0.htm" title="AccessKey: b" accesskey="b">Lily Pond</a> by <a href="../www.tulips4rose.com/default.htm" class="c">Rose Thorogood</a></li><li><a href="@cssfile=_2f200_2f200.css&page=0.htm" title="AccessKey: c" accesskey="c">Icicle Outback</a> by <a href="../www.timovirtanen.com/default.htm" class="c">Timo Virtanen</a></li><li><a href="@cssfile=_2f199_2f199.css&page=0.htm" title="AccessKey: d" accesskey="d">Zen Army</a> by <a href="../www.niceguy.com/default.htm" class="c">Carl Desmond</a></li><li><a href="@cssfile=_2f198_2f198.css&page=0.htm" title="AccessKey: e" accesskey="e">The Original</a> by <a href="../www.bluejam.com/default.htm" class="c">Joachim Shotter</a></li><li><a href="@cssfile=_2f197_2f197.css&page=0.htm" title="AccessKey: f" accesskey="f">Floral Touch</a> by <a href="../www.jahmasta.com/default.htm" class="c">Jadas Jimmy</a></li><li><a href="@cssfile=_2f196_2f196.css&page=0.htm" title="AccessKey: g" accesskey="g">Elegance in Simplicity</a> by <a href="../www.manisheriar.com/blog/default.htm" class="c">Mani Sheriar</a></li><li><a href="@cssfile=_2f195_2f195.css&page=0.htm" title="AccessKey: h" accesskey="h">Dazzling Beauty</a> by <a href="../blog.denysri.com/default.htm" class="c">Deny Sri Supriyono</a></li></ul></div><div id="larchives"><h3 class="archives"><span>Archives:</span></h3><ul><li><a href="@cssfile=_2f175_2f175.css&page=1.htm" title="View next set of designs. AccessKey: n" accesskey="n"><span class="accesskey">n</span>ext designs &raquo;</a></li><li><a href="../www.mezzoblue.com/zengarden/alldesigns/default.htm" title="View every submission to the Zen Garden. AccessKey: w" accesskey="w">Vie<span class="accesskey">w</span> All Designs</a></li></ul></div><div id="lresources"><h3 class="resources"><span>Resources:</span></h3><ul><li><a href="175/175.css" title="View the source CSS file for the currently-viewed design, AccessKey: v" accesskey="v"><span class="accesskey">V</span>iew This Design&#8217;s <acronym title="Cascading Style Sheets">CSS</acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="Links to great sites with information on using CSS. AccessKey: r" accesskey="r"><acronym title="Cascading Style Sheets">CSS</acronym> <span class="accesskey">R</span>esources</a></li><li><a href="../www.mezzoblue.com/zengarden/faq/default.htm" title="A list of Frequently Asked Questions about the Zen Garden. AccessKey: q" accesskey="q"><acronym title="Frequently Asked Questions">FA<span class="accesskey">Q</span></acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Send in your own CSS file. AccessKey: s" accesskey="s"><span class="accesskey">S</span>ubmit a Design</a></li><li><a href="../www.mezzoblue.com/zengarden/translations/default.htm" title="View translated versions of this page. AccessKey: t" accesskey="t"><span class="accesskey">T</span>ranslations</a></li></ul></div></div></div></div><!-- These extra divs/spans may be used as catch-alls to add extra imagery. --><div id="extraDiv1"><span></span></div><div id="extraDiv2"><span></span></div><div id="extraDiv3"><span></span></div><div id="extraDiv4"><span></span></div><div id="extraDiv5"><span></span></div><div id="extraDiv6"><span></span></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample03/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" ><head><meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /><meta name="author" content="Dave Shea" /><meta name="keywords" content="design, css, cascading, style, sheets, xhtml, graphic design, w3c, web standards, visual, display" /><meta name="description" content="A demonstration of what can be accomplished visually through CSS-based design." /><meta name="robots" content="all" /><title>css Zen Garden: The Beauty in CSS Design</title><!-- to correct the unsightly Flash of Unstyled Content. http://www.bluerobot.com/web/css/fouc.asp --><script type="text/javascript"></script><link rel="stylesheet" type="text/css" href="css3/basic.css" /><!-- <link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico" /> --><!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="zengarden.xml" /> --></head><!--This xhtml document is marked up to provide the designer with the maximum possible flexibility.There are more classes and extraneous tags than needed, and in a real world situation, it's morelikely that it would be much leaner.However, I think we can all agree that even given that, we're still better off than if this had beenbuilt with tables.--><body id="css-zen-garden"><div id="container"><div id="intro"><div id="pageHeader"><h1><span>css Zen Garden</span></h1><h2><span>The Beauty of <acronym title="Cascading Style Sheets">CSS</acronym> Design</span></h2></div><div id="quickSummary"><p class="p1"><span>A demonstration of what can be accomplished visually through <acronym title="Cascading Style Sheets">CSS</acronym>-based design. Select any style sheet from the list to load it into this page.</span></p><p class="p2"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a></span></p></div><div id="preamble"><h3><span>The Road to Enlightenment</span></h3><p class="p1"><span>Littering a dark and dreary road lay the past relics of browser-specific tags, incompatible <acronym title="Document Object Model">DOM</acronym>s, and broken <acronym title="Cascading Style Sheets">CSS</acronym> support.</span></p><p class="p2"><span>Today, we must clear the mind of past practices. Web enlightenment has been achieved thanks to the tireless efforts of folk like the <acronym title="World Wide Web Consortium">W3C</acronym>, <acronym title="Web Standards Project">WaSP</acronym> and the major browser creators.</span></p><p class="p3"><span>The css Zen Garden invites you to relax and meditate on the important lessons of the masters. Begin to see with clarity. Learn to use the (yet to be) time-honored techniques in new and invigorating fashion. Become one with the web.</span></p></div></div><div id="supportingText"><div id="explanation"><h3><span>So What is This About?</span></h3><p class="p1"><span>There is clearly a need for <acronym title="Cascading Style Sheets">CSS</acronym> to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.</span></p><p class="p2"><span><acronym title="Cascading Style Sheets">CSS</acronym> allows complete and total control over the style of a hypertext document. The only way this can be illustrated in a way that gets people excited is by demonstrating what it can truly be, once the reins are placed in the hands of those able to create beauty from structure. To date, most examples of neat tricks and hacks have been demonstrated by structurists and coders. Designers have yet to make their mark. This needs to change.</span></p></div><div id="participation"><h3><span>Participation</span></h3><p class="p1"><span>Graphic artists only please. You are modifying this page, so strong <acronym title="Cascading Style Sheets">CSS</acronym> skills are necessary, but the example files are commented well enough that even <acronym title="Cascading Style Sheets">CSS</acronym> novices can use them as starting points. Please see the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources"><acronym title="Cascading Style Sheets">CSS</acronym> Resource Guide</a> for advanced tutorials and tips on working with <acronym title="Cascading Style Sheets">CSS</acronym>.</span></p><p class="p2"><span>You may modify the style sheet in any way you wish, but not the <acronym title="HyperText Markup Language">HTML</acronym>. This may seem daunting at first if you&#8217;ve never worked this way before, but follow the listed links to learn more, and use the sample files as a guide.</span></p><p class="p3"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a> to work on a copy locally. Once you have completed your masterpiece (and please, don&#8217;t submit half-finished work) upload your .css file to a web server under your control. <a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Use the contact form to send us your CSS file">Send us a link</a> to the file and if we choose to use it, we will spider the associated images. Final submissions will be placed on our server.</span></p></div><div id="benefits"><h3><span>Benefits</span></h3><p class="p1"><span>Why participate? For recognition, inspiration, and a resource we can all refer to when making the case for <acronym title="Cascading Style Sheets">CSS</acronym>-based design. This is sorely needed, even today. More and more major sites are taking the leap, but not enough have. One day this gallery will be a historical curiosity; that day is not today.</span></p></div><div id="requirements"><h3><span>Requirements</span></h3><p class="p1"><span>We would like to see as much <acronym title="Cascading Style Sheets, version 1">CSS1</acronym> as possible. <acronym title="Cascading Style Sheets, version 2">CSS2</acronym> should be limited to widely-supported elements only. The css Zen Garden is about functional, practical <acronym title="Cascading Style Sheets">CSS</acronym> and not the latest bleeding-edge tricks viewable by 2% of the browsing public. The only real requirement we have is that your <acronym title="Cascading Style Sheets">CSS</acronym> validates.</span></p><p class="p2"><span>Unfortunately, designing this way highlights the flaws in the various implementations of <acronym title="Cascading Style Sheets">CSS</acronym>. Different browsers display differently, even completely valid <acronym title="Cascading Style Sheets">CSS</acronym> at times, and this becomes maddening when a fix for one leads to breakage in another. View the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources">Resources</a> page for information on some of the fixes available. Full browser compliance is still sometimes a pipe dream, and we do not expect you to come up with pixel-perfect code across every platform. But do test in as many as you can. If your design doesn&#8217;t work in at least IE5+/Win and Mozilla (run by over 90% of the population), chances are we won&#8217;t accept it.</span></p><p class="p3"><span>We ask that you submit original artwork. Please respect copyright laws. Please keep objectionable material to a minimum; tasteful nudity is acceptable, outright pornography will be rejected.</span></p><p class="p4"><span>This is a learning exercise as well as a demonstration. You retain full copyright on your graphics (with limited exceptions, see <a href="../www.mezzoblue.com/zengarden/submit/guidelines/default.htm">submission guidelines</a>), but we ask you release your <acronym title="Cascading Style Sheets">CSS</acronym> under a Creative Commons license identical to the <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View the Zen Garden's license information.">one on this site</a> so that others may learn from your work.</span></p><p class="p5"><span>Bandwidth graciously donated by <a href="../www.dreamfirestudios.com/default.htm">DreamFire Studios</a>. Now available: <a href="../www.amazon.com/exec/obidos/asin/0321303474/mezzoblue-20/default.htm">Zen Garden, the book</a>.</span>&nbsp;</p></div><div id="footer"><a href="../validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a> &nbsp; <a href="../jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a> &nbsp; <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View details of the license of this site, courtesy of Creative Commons.">cc</a> &nbsp;<a href="../www.contentquality.com/mynewtester/cynthia.exe@url1=http_3a_252f_252fcsszengarden.com_252f" title="Check the accessibility of this site according to U.S. Section 508">508</a> &nbsp;<a href="../mezzoblue.com/zengarden/faq/#aaa" title="Check the accessibility of this site according to Web Content Accessibility Guidelines 1.0">aaa</a></div></div><div id="linkList"><div id="linkList2"><div id="lselect"><h3 class="select"><span>Select a Design:</span></h3><ul><li><a href="@cssfile=_2f202_2f202.css&page=0.htm" title="AccessKey: a" accesskey="a">Retro Theater</a> by <a href="../space-sheeps.info/default.htm" class="c">Eric Rog&eacute;</a></li><li><a href="@cssfile=_2f201_2f201.css&page=0.htm" title="AccessKey: b" accesskey="b">Lily Pond</a> by <a href="../www.tulips4rose.com/default.htm" class="c">Rose Thorogood</a></li><li><a href="@cssfile=_2f200_2f200.css&page=0.htm" title="AccessKey: c" accesskey="c">Icicle Outback</a> by <a href="../www.timovirtanen.com/default.htm" class="c">Timo Virtanen</a></li><li><a href="@cssfile=_2f199_2f199.css&page=0.htm" title="AccessKey: d" accesskey="d">Zen Army</a> by <a href="../www.niceguy.com/default.htm" class="c">Carl Desmond</a></li><li><a href="@cssfile=_2f198_2f198.css&page=0.htm" title="AccessKey: e" accesskey="e">The Original</a> by <a href="../www.bluejam.com/default.htm" class="c">Joachim Shotter</a></li><li><a href="@cssfile=_2f197_2f197.css&page=0.htm" title="AccessKey: f" accesskey="f">Floral Touch</a> by <a href="../www.jahmasta.com/default.htm" class="c">Jadas Jimmy</a></li><li><a href="@cssfile=_2f196_2f196.css&page=0.htm" title="AccessKey: g" accesskey="g">Elegance in Simplicity</a> by <a href="../www.manisheriar.com/blog/default.htm" class="c">Mani Sheriar</a></li><li><a href="@cssfile=_2f195_2f195.css&page=0.htm" title="AccessKey: h" accesskey="h">Dazzling Beauty</a> by <a href="../blog.denysri.com/default.htm" class="c">Deny Sri Supriyono</a></li></ul></div><div id="larchives"><h3 class="archives"><span>Archives:</span></h3><ul><li><a href="@cssfile=_2f175_2f175.css&page=1.htm" title="View next set of designs. AccessKey: n" accesskey="n"><span class="accesskey">n</span>ext designs &raquo;</a></li><li><a href="../www.mezzoblue.com/zengarden/alldesigns/default.htm" title="View every submission to the Zen Garden. AccessKey: w" accesskey="w">Vie<span class="accesskey">w</span> All Designs</a></li></ul></div><div id="lresources"><h3 class="resources"><span>Resources:</span></h3><ul><li><a href="175/175.css" title="View the source CSS file for the currently-viewed design, AccessKey: v" accesskey="v"><span class="accesskey">V</span>iew This Design&#8217;s <acronym title="Cascading Style Sheets">CSS</acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="Links to great sites with information on using CSS. AccessKey: r" accesskey="r"><acronym title="Cascading Style Sheets">CSS</acronym> <span class="accesskey">R</span>esources</a></li><li><a href="../www.mezzoblue.com/zengarden/faq/default.htm" title="A list of Frequently Asked Questions about the Zen Garden. AccessKey: q" accesskey="q"><acronym title="Frequently Asked Questions">FA<span class="accesskey">Q</span></acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Send in your own CSS file. AccessKey: s" accesskey="s"><span class="accesskey">S</span>ubmit a Design</a></li><li><a href="../www.mezzoblue.com/zengarden/translations/default.htm" title="View translated versions of this page. AccessKey: t" accesskey="t"><span class="accesskey">T</span>ranslations</a></li></ul></div></div></div></div><!-- These extra divs/spans may be used as catch-alls to add extra imagery. --><div id="extraDiv1"><span></span></div><div id="extraDiv2"><span></span></div><div id="extraDiv3"><span></span></div><div id="extraDiv4"><span></span></div><div id="extraDiv5"><span></span></div><div id="extraDiv6"><span></span></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample01/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" ><head><meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /><meta name="author" content="Dave Shea" /><meta name="keywords" content="design, css, cascading, style, sheets, xhtml, graphic design, w3c, web standards, visual, display" /><meta name="description" content="A demonstration of what can be accomplished visually through CSS-based design." /><meta name="robots" content="all" /><title>css Zen Garden: The Beauty in CSS Design</title><!-- to correct the unsightly Flash of Unstyled Content. http://www.bluerobot.com/web/css/fouc.asp --><script type="text/javascript"></script><link rel="stylesheet" type="text/css" href="css1/basic.css" /><!-- <link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico" /> --><!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="zengarden.xml" /> --></head><!--This xhtml document is marked up to provide the designer with the maximum possible flexibility.There are more classes and extraneous tags than needed, and in a real world situation, it's morelikely that it would be much leaner.However, I think we can all agree that even given that, we're still better off than if this had beenbuilt with tables.--><body id="css-zen-garden"><div id="container"><div id="intro"><div id="pageHeader"><h1><span>css Zen Garden</span></h1><h2><span>The Beauty of <acronym title="Cascading Style Sheets">CSS</acronym> Design</span></h2></div><div id="quickSummary"><p class="p1"><span>A demonstration of what can be accomplished visually through <acronym title="Cascading Style Sheets">CSS</acronym>-based design. Select any style sheet from the list to load it into this page.</span></p><p class="p2"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a></span></p></div><div id="preamble"><h3><span>The Road to Enlightenment</span></h3><p class="p1"><span>Littering a dark and dreary road lay the past relics of browser-specific tags, incompatible <acronym title="Document Object Model">DOM</acronym>s, and broken <acronym title="Cascading Style Sheets">CSS</acronym> support.</span></p><p class="p2"><span>Today, we must clear the mind of past practices. Web enlightenment has been achieved thanks to the tireless efforts of folk like the <acronym title="World Wide Web Consortium">W3C</acronym>, <acronym title="Web Standards Project">WaSP</acronym> and the major browser creators.</span></p><p class="p3"><span>The css Zen Garden invites you to relax and meditate on the important lessons of the masters. Begin to see with clarity. Learn to use the (yet to be) time-honored techniques in new and invigorating fashion. Become one with the web.</span></p></div></div><div id="supportingText"><div id="explanation"><h3><span>So What is This About?</span></h3><p class="p1"><span>There is clearly a need for <acronym title="Cascading Style Sheets">CSS</acronym> to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.</span></p><p class="p2"><span><acronym title="Cascading Style Sheets">CSS</acronym> allows complete and total control over the style of a hypertext document. The only way this can be illustrated in a way that gets people excited is by demonstrating what it can truly be, once the reins are placed in the hands of those able to create beauty from structure. To date, most examples of neat tricks and hacks have been demonstrated by structurists and coders. Designers have yet to make their mark. This needs to change.</span></p></div><div id="participation"><h3><span>Participation</span></h3><p class="p1"><span>Graphic artists only please. You are modifying this page, so strong <acronym title="Cascading Style Sheets">CSS</acronym> skills are necessary, but the example files are commented well enough that even <acronym title="Cascading Style Sheets">CSS</acronym> novices can use them as starting points. Please see the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources"><acronym title="Cascading Style Sheets">CSS</acronym> Resource Guide</a> for advanced tutorials and tips on working with <acronym title="Cascading Style Sheets">CSS</acronym>.</span></p><p class="p2"><span>You may modify the style sheet in any way you wish, but not the <acronym title="HyperText Markup Language">HTML</acronym>. This may seem daunting at first if you&#8217;ve never worked this way before, but follow the listed links to learn more, and use the sample files as a guide.</span></p><p class="p3"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a> to work on a copy locally. Once you have completed your masterpiece (and please, don&#8217;t submit half-finished work) upload your .css file to a web server under your control. <a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Use the contact form to send us your CSS file">Send us a link</a> to the file and if we choose to use it, we will spider the associated images. Final submissions will be placed on our server.</span></p></div><div id="benefits"><h3><span>Benefits</span></h3><p class="p1"><span>Why participate? For recognition, inspiration, and a resource we can all refer to when making the case for <acronym title="Cascading Style Sheets">CSS</acronym>-based design. This is sorely needed, even today. More and more major sites are taking the leap, but not enough have. One day this gallery will be a historical curiosity; that day is not today.</span></p></div><div id="requirements"><h3><span>Requirements</span></h3><p class="p1"><span>We would like to see as much <acronym title="Cascading Style Sheets, version 1">CSS1</acronym> as possible. <acronym title="Cascading Style Sheets, version 2">CSS2</acronym> should be limited to widely-supported elements only. The css Zen Garden is about functional, practical <acronym title="Cascading Style Sheets">CSS</acronym> and not the latest bleeding-edge tricks viewable by 2% of the browsing public. The only real requirement we have is that your <acronym title="Cascading Style Sheets">CSS</acronym> validates.</span></p><p class="p2"><span>Unfortunately, designing this way highlights the flaws in the various implementations of <acronym title="Cascading Style Sheets">CSS</acronym>. Different browsers display differently, even completely valid <acronym title="Cascading Style Sheets">CSS</acronym> at times, and this becomes maddening when a fix for one leads to breakage in another. View the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources">Resources</a> page for information on some of the fixes available. Full browser compliance is still sometimes a pipe dream, and we do not expect you to come up with pixel-perfect code across every platform. But do test in as many as you can. If your design doesn&#8217;t work in at least IE5+/Win and Mozilla (run by over 90% of the population), chances are we won&#8217;t accept it.</span></p><p class="p3"><span>We ask that you submit original artwork. Please respect copyright laws. Please keep objectionable material to a minimum; tasteful nudity is acceptable, outright pornography will be rejected.</span></p><p class="p4"><span>This is a learning exercise as well as a demonstration. You retain full copyright on your graphics (with limited exceptions, see <a href="../www.mezzoblue.com/zengarden/submit/guidelines/default.htm">submission guidelines</a>), but we ask you release your <acronym title="Cascading Style Sheets">CSS</acronym> under a Creative Commons license identical to the <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View the Zen Garden's license information.">one on this site</a> so that others may learn from your work.</span></p><p class="p5"><span>Bandwidth graciously donated by <a href="../www.dreamfirestudios.com/default.htm">DreamFire Studios</a>. Now available: <a href="../www.amazon.com/exec/obidos/asin/0321303474/mezzoblue-20/default.htm">Zen Garden, the book</a>.</span>&nbsp;</p></div><div id="footer"><a href="../validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a> &nbsp; <a href="../jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a> &nbsp; <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View details of the license of this site, courtesy of Creative Commons.">cc</a> &nbsp;<a href="../www.contentquality.com/mynewtester/cynthia.exe@url1=http_3a_252f_252fcsszengarden.com_252f" title="Check the accessibility of this site according to U.S. Section 508">508</a> &nbsp;<a href="../mezzoblue.com/zengarden/faq/#aaa" title="Check the accessibility of this site according to Web Content Accessibility Guidelines 1.0">aaa</a></div></div><div id="linkList"><div id="linkList2"><div id="lselect"><h3 class="select"><span>Select a Design:</span></h3><ul><li><a href="@cssfile=_2f202_2f202.css&page=0.htm" title="AccessKey: a" accesskey="a">Retro Theater</a> by <a href="../space-sheeps.info/default.htm" class="c">Eric Rog&eacute;</a></li><li><a href="@cssfile=_2f201_2f201.css&page=0.htm" title="AccessKey: b" accesskey="b">Lily Pond</a> by <a href="../www.tulips4rose.com/default.htm" class="c">Rose Thorogood</a></li><li><a href="@cssfile=_2f200_2f200.css&page=0.htm" title="AccessKey: c" accesskey="c">Icicle Outback</a> by <a href="../www.timovirtanen.com/default.htm" class="c">Timo Virtanen</a></li><li><a href="@cssfile=_2f199_2f199.css&page=0.htm" title="AccessKey: d" accesskey="d">Zen Army</a> by <a href="../www.niceguy.com/default.htm" class="c">Carl Desmond</a></li><li><a href="@cssfile=_2f198_2f198.css&page=0.htm" title="AccessKey: e" accesskey="e">The Original</a> by <a href="../www.bluejam.com/default.htm" class="c">Joachim Shotter</a></li><li><a href="@cssfile=_2f197_2f197.css&page=0.htm" title="AccessKey: f" accesskey="f">Floral Touch</a> by <a href="../www.jahmasta.com/default.htm" class="c">Jadas Jimmy</a></li><li><a href="@cssfile=_2f196_2f196.css&page=0.htm" title="AccessKey: g" accesskey="g">Elegance in Simplicity</a> by <a href="../www.manisheriar.com/blog/default.htm" class="c">Mani Sheriar</a></li><li><a href="@cssfile=_2f195_2f195.css&page=0.htm" title="AccessKey: h" accesskey="h">Dazzling Beauty</a> by <a href="../blog.denysri.com/default.htm" class="c">Deny Sri Supriyono</a></li></ul></div><div id="larchives"><h3 class="archives"><span>Archives:</span></h3><ul><li><a href="@cssfile=_2f175_2f175.css&page=1.htm" title="View next set of designs. AccessKey: n" accesskey="n"><span class="accesskey">n</span>ext designs &raquo;</a></li><li><a href="../www.mezzoblue.com/zengarden/alldesigns/default.htm" title="View every submission to the Zen Garden. AccessKey: w" accesskey="w">Vie<span class="accesskey">w</span> All Designs</a></li></ul></div><div id="lresources"><h3 class="resources"><span>Resources:</span></h3><ul><li><a href="175/175.css" title="View the source CSS file for the currently-viewed design, AccessKey: v" accesskey="v"><span class="accesskey">V</span>iew This Design&#8217;s <acronym title="Cascading Style Sheets">CSS</acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="Links to great sites with information on using CSS. AccessKey: r" accesskey="r"><acronym title="Cascading Style Sheets">CSS</acronym> <span class="accesskey">R</span>esources</a></li><li><a href="../www.mezzoblue.com/zengarden/faq/default.htm" title="A list of Frequently Asked Questions about the Zen Garden. AccessKey: q" accesskey="q"><acronym title="Frequently Asked Questions">FA<span class="accesskey">Q</span></acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Send in your own CSS file. AccessKey: s" accesskey="s"><span class="accesskey">S</span>ubmit a Design</a></li><li><a href="../www.mezzoblue.com/zengarden/translations/default.htm" title="View translated versions of this page. AccessKey: t" accesskey="t"><span class="accesskey">T</span>ranslations</a></li></ul></div></div></div></div><!-- These extra divs/spans may be used as catch-alls to add extra imagery. --><div id="extraDiv1"><span></span></div><div id="extraDiv2"><span></span></div><div id="extraDiv3"><span></span></div><div id="extraDiv4"><span></span></div><div id="extraDiv5"><span></span></div><div id="extraDiv6"><span></span></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample00/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/sample00/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" ><head><meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /><meta name="author" content="Dave Shea" /><meta name="keywords" content="design, css, cascading, style, sheets, xhtml, graphic design, w3c, web standards, visual, display" /><meta name="description" content="A demonstration of what can be accomplished visually through CSS-based design." /><meta name="robots" content="all" /><title>css Zen Garden: The Beauty in CSS Design</title><!-- to correct the unsightly Flash of Unstyled Content. http://www.bluerobot.com/web/css/fouc.asp --><script type="text/javascript"></script><!-- <link rel="stylesheet" type="text/css" href="css1/basic.css" /> --><!-- <link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico" /> --><!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="zengarden.xml" /> --></head><!--This xhtml document is marked up to provide the designer with the maximum possible flexibility.There are more classes and extraneous tags than needed, and in a real world situation, it's morelikely that it would be much leaner.However, I think we can all agree that even given that, we're still better off than if this had beenbuilt with tables.--><body id="css-zen-garden"><div id="container"><div id="intro"><div id="pageHeader"><h1><span>css Zen Garden</span></h1><h2><span>The Beauty of <acronym title="Cascading Style Sheets">CSS</acronym> Design</span></h2></div><div id="quickSummary"><p class="p1"><span>A demonstration of what can be accomplished visually through <acronym title="Cascading Style Sheets">CSS</acronym>-based design. Select any style sheet from the list to load it into this page.</span></p><p class="p2"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a></span></p></div><div id="preamble"><h3><span>The Road to Enlightenment</span></h3><p class="p1"><span>Littering a dark and dreary road lay the past relics of browser-specific tags, incompatible <acronym title="Document Object Model">DOM</acronym>s, and broken <acronym title="Cascading Style Sheets">CSS</acronym> support.</span></p><p class="p2"><span>Today, we must clear the mind of past practices. Web enlightenment has been achieved thanks to the tireless efforts of folk like the <acronym title="World Wide Web Consortium">W3C</acronym>, <acronym title="Web Standards Project">WaSP</acronym> and the major browser creators.</span></p><p class="p3"><span>The css Zen Garden invites you to relax and meditate on the important lessons of the masters. Begin to see with clarity. Learn to use the (yet to be) time-honored techniques in new and invigorating fashion. Become one with the web.</span></p></div></div><div id="supportingText"><div id="explanation"><h3><span>So What is This About?</span></h3><p class="p1"><span>There is clearly a need for <acronym title="Cascading Style Sheets">CSS</acronym> to be taken seriously by graphic artists. The Zen Garden aims to excite, inspire, and encourage participation. To begin, view some of the existing designs in the list. Clicking on any one will load the style sheet into this very page. The code remains the same, the only thing that has changed is the external .css file. Yes, really.</span></p><p class="p2"><span><acronym title="Cascading Style Sheets">CSS</acronym> allows complete and total control over the style of a hypertext document. The only way this can be illustrated in a way that gets people excited is by demonstrating what it can truly be, once the reins are placed in the hands of those able to create beauty from structure. To date, most examples of neat tricks and hacks have been demonstrated by structurists and coders. Designers have yet to make their mark. This needs to change.</span></p></div><div id="participation"><h3><span>Participation</span></h3><p class="p1"><span>Graphic artists only please. You are modifying this page, so strong <acronym title="Cascading Style Sheets">CSS</acronym> skills are necessary, but the example files are commented well enough that even <acronym title="Cascading Style Sheets">CSS</acronym> novices can use them as starting points. Please see the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources"><acronym title="Cascading Style Sheets">CSS</acronym> Resource Guide</a> for advanced tutorials and tips on working with <acronym title="Cascading Style Sheets">CSS</acronym>.</span></p><p class="p2"><span>You may modify the style sheet in any way you wish, but not the <acronym title="HyperText Markup Language">HTML</acronym>. This may seem daunting at first if you&#8217;ve never worked this way before, but follow the listed links to learn more, and use the sample files as a guide.</span></p><p class="p3"><span>Download the sample <a href="zengarden-sample.html" title="This page's source HTML code, not to be modified.">html file</a> and <a href="zengarden-sample.css" title="This page's sample CSS, the file you may modify.">css file</a> to work on a copy locally. Once you have completed your masterpiece (and please, don&#8217;t submit half-finished work) upload your .css file to a web server under your control. <a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Use the contact form to send us your CSS file">Send us a link</a> to the file and if we choose to use it, we will spider the associated images. Final submissions will be placed on our server.</span></p></div><div id="benefits"><h3><span>Benefits</span></h3><p class="p1"><span>Why participate? For recognition, inspiration, and a resource we can all refer to when making the case for <acronym title="Cascading Style Sheets">CSS</acronym>-based design. This is sorely needed, even today. More and more major sites are taking the leap, but not enough have. One day this gallery will be a historical curiosity; that day is not today.</span></p></div><div id="requirements"><h3><span>Requirements</span></h3><p class="p1"><span>We would like to see as much <acronym title="Cascading Style Sheets, version 1">CSS1</acronym> as possible. <acronym title="Cascading Style Sheets, version 2">CSS2</acronym> should be limited to widely-supported elements only. The css Zen Garden is about functional, practical <acronym title="Cascading Style Sheets">CSS</acronym> and not the latest bleeding-edge tricks viewable by 2% of the browsing public. The only real requirement we have is that your <acronym title="Cascading Style Sheets">CSS</acronym> validates.</span></p><p class="p2"><span>Unfortunately, designing this way highlights the flaws in the various implementations of <acronym title="Cascading Style Sheets">CSS</acronym>. Different browsers display differently, even completely valid <acronym title="Cascading Style Sheets">CSS</acronym> at times, and this becomes maddening when a fix for one leads to breakage in another. View the <a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="A listing of CSS-related resources">Resources</a> page for information on some of the fixes available. Full browser compliance is still sometimes a pipe dream, and we do not expect you to come up with pixel-perfect code across every platform. But do test in as many as you can. If your design doesn&#8217;t work in at least IE5+/Win and Mozilla (run by over 90% of the population), chances are we won&#8217;t accept it.</span></p><p class="p3"><span>We ask that you submit original artwork. Please respect copyright laws. Please keep objectionable material to a minimum; tasteful nudity is acceptable, outright pornography will be rejected.</span></p><p class="p4"><span>This is a learning exercise as well as a demonstration. You retain full copyright on your graphics (with limited exceptions, see <a href="../www.mezzoblue.com/zengarden/submit/guidelines/default.htm">submission guidelines</a>), but we ask you release your <acronym title="Cascading Style Sheets">CSS</acronym> under a Creative Commons license identical to the <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View the Zen Garden's license information.">one on this site</a> so that others may learn from your work.</span></p><p class="p5"><span>Bandwidth graciously donated by <a href="../www.dreamfirestudios.com/default.htm">DreamFire Studios</a>. Now available: <a href="../www.amazon.com/exec/obidos/asin/0321303474/mezzoblue-20/default.htm">Zen Garden, the book</a>.</span>&nbsp;</p></div><div id="footer"><a href="../validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a> &nbsp; <a href="../jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a> &nbsp; <a href="../creativecommons.org/licenses/by-nc-sa/1.0/default.htm" title="View details of the license of this site, courtesy of Creative Commons.">cc</a> &nbsp;<a href="../www.contentquality.com/mynewtester/cynthia.exe@url1=http_3a_252f_252fcsszengarden.com_252f" title="Check the accessibility of this site according to U.S. Section 508">508</a> &nbsp;<a href="../mezzoblue.com/zengarden/faq/#aaa" title="Check the accessibility of this site according to Web Content Accessibility Guidelines 1.0">aaa</a></div></div><div id="linkList"><div id="linkList2"><div id="lselect"><h3 class="select"><span>Select a Design:</span></h3><ul><li><a href="@cssfile=_2f202_2f202.css&page=0.htm" title="AccessKey: a" accesskey="a">Retro Theater</a> by <a href="../space-sheeps.info/default.htm" class="c">Eric Rog&eacute;</a></li><li><a href="@cssfile=_2f201_2f201.css&page=0.htm" title="AccessKey: b" accesskey="b">Lily Pond</a> by <a href="../www.tulips4rose.com/default.htm" class="c">Rose Thorogood</a></li><li><a href="@cssfile=_2f200_2f200.css&page=0.htm" title="AccessKey: c" accesskey="c">Icicle Outback</a> by <a href="../www.timovirtanen.com/default.htm" class="c">Timo Virtanen</a></li><li><a href="@cssfile=_2f199_2f199.css&page=0.htm" title="AccessKey: d" accesskey="d">Zen Army</a> by <a href="../www.niceguy.com/default.htm" class="c">Carl Desmond</a></li><li><a href="@cssfile=_2f198_2f198.css&page=0.htm" title="AccessKey: e" accesskey="e">The Original</a> by <a href="../www.bluejam.com/default.htm" class="c">Joachim Shotter</a></li><li><a href="@cssfile=_2f197_2f197.css&page=0.htm" title="AccessKey: f" accesskey="f">Floral Touch</a> by <a href="../www.jahmasta.com/default.htm" class="c">Jadas Jimmy</a></li><li><a href="@cssfile=_2f196_2f196.css&page=0.htm" title="AccessKey: g" accesskey="g">Elegance in Simplicity</a> by <a href="../www.manisheriar.com/blog/default.htm" class="c">Mani Sheriar</a></li><li><a href="@cssfile=_2f195_2f195.css&page=0.htm" title="AccessKey: h" accesskey="h">Dazzling Beauty</a> by <a href="../blog.denysri.com/default.htm" class="c">Deny Sri Supriyono</a></li></ul></div><div id="larchives"><h3 class="archives"><span>Archives:</span></h3><ul><li><a href="@cssfile=_2f175_2f175.css&page=1.htm" title="View next set of designs. AccessKey: n" accesskey="n"><span class="accesskey">n</span>ext designs &raquo;</a></li><li><a href="../www.mezzoblue.com/zengarden/alldesigns/default.htm" title="View every submission to the Zen Garden. AccessKey: w" accesskey="w">Vie<span class="accesskey">w</span> All Designs</a></li></ul></div><div id="lresources"><h3 class="resources"><span>Resources:</span></h3><ul><li><a href="175/175.css" title="View the source CSS file for the currently-viewed design, AccessKey: v" accesskey="v"><span class="accesskey">V</span>iew This Design&#8217;s <acronym title="Cascading Style Sheets">CSS</acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/resources/default.htm" title="Links to great sites with information on using CSS. AccessKey: r" accesskey="r"><acronym title="Cascading Style Sheets">CSS</acronym> <span class="accesskey">R</span>esources</a></li><li><a href="../www.mezzoblue.com/zengarden/faq/default.htm" title="A list of Frequently Asked Questions about the Zen Garden. AccessKey: q" accesskey="q"><acronym title="Frequently Asked Questions">FA<span class="accesskey">Q</span></acronym></a></li><li><a href="../www.mezzoblue.com/zengarden/submit/default.htm" title="Send in your own CSS file. AccessKey: s" accesskey="s"><span class="accesskey">S</span>ubmit a Design</a></li><li><a href="../www.mezzoblue.com/zengarden/translations/default.htm" title="View translated versions of this page. AccessKey: t" accesskey="t"><span class="accesskey">T</span>ranslations</a></li></ul></div></div></div></div><!-- These extra divs/spans may be used as catch-alls to add extra imagery. --><div id="extraDiv1"><span></span></div><div id="extraDiv2"><span></span></div><div id="extraDiv3"><span></span></div><div id="extraDiv4"><span></span></div><div id="extraDiv5"><span></span></div><div id="extraDiv6"><span></span></div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css4/basic/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css4/basic/</url>
      
        <content type="html"><![CDATA[body{margin: 0;font-family : Arial, Helvetica, sans-serif;font-size : 11px;color: #557788;background-color: #FFDB4A;}/********************/#container {background:url(bg.jpg);width: 780px;margin: 0 auto;padding: 0 0 10px 0;}/********************/#pageHeader {background:url(header.jpg) ;height: 260px;}h1,h2 {display:none;}/********************/#quickSummary {float: right;width: 265px;margin-right:10px;display:inline;}#quickSummary .p1 {    color:#000;background: url(trans.gif);border:1px #578 dashed;padding: 10px;margin: 10px;}#quickSummary .p2 {font-size : 10px;text-align:center;}/********************/#preamble {width: 490px;margin-left:10px;}h3 {font-size: 18px;margin: 10px 0px 10px 0px;line-height:27px;padding-left:10px;background: url(left-bg.jpg) no-repeat;color: #fff;}p{margin:10px;}/********************/#supportingText{margin-left:10px ;width:490px;}/*******************/#linkList {position:absolute;right:10px;top:370px;width: 270px;}#linkList h3{background: url(right-bg.jpg) no-repeat;}#container{position:relative;}/************************************/#footer{width:70px;position:absolute;bottom:20px;right:30px;}#footer a{text-align:center;display:block;padding:0 20px;border:1px #c00 dashed;}a:link,a:visited {text-decoration: none;color: #c00;}a:hover,a:active {text-decoration: underline;}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css3/basic/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css3/basic/</url>
      
        <content type="html"><![CDATA[/* css Zen Garden submission 191 - 'The Diary', by Alexander Shabuniewicz, http://eye.loveline.ru/ *//* css released under Creative Commons License - http://creativecommons.org/licenses/by-nc-sa/1.0/  *//* All associated graphics copyright 2006, Alexander Shabuniewicz *//* Added: February 15th, 2006 *//* IMPORTANT *//* This design is not a template. You may not reproduce it elsewhere without the    designer's written permission. However, feel free to study the CSS and use    techniques you learn from it elsewhere. */body{font:11px/20px Georgia,"Times New Roman",Times,serif;color:#666;background:#00496C;margin:0;padding:0}h1,h2,h3{margin:0;padding:0}a{color:#191970}a:hover{color:#B22222}a:visited{color:#696969}a acronym{border:none}acronym{cursor:help}/* main */#container{background:url("cover_bot.png") no-repeat left bottom;left:50%;position:absolute;width:770px;margin:10px 0 20px -385px;padding-bottom:120px}/* intro */#intro{padding:0 30px;background:url("cover.png") repeat-y;padding-bottom:1px}#pageHeader{margin:0 -30px;background:url("cover_top.png") no-repeat}#pageHeader h1{background:url("csszengarden.jpg") no-repeat;height:71px;width:268px;position:relative;top:50px;left:71px}#pageHeader h1 span{display:none}#pageHeader h2{background:url("thebeauty.jpg") no-repeat;height:20px;width:299px;position:relative;top:55px;left:57px}#pageHeader h2 span{display:none}#quickSummary{position:absolute;top:41px;padding:0 0 0 380px}#quickSummary .p1{margin:10px 81px 0 0;font-size:120%}#quickSummary .p2{margin:0;background:url("bookmark.jpg") no-repeat;position:absolute;top:-25px;left:620px;width:81px;height:131px}#quickSummary .p2 span{display:block;padding:20px 10px;color:#fff;font:11px/18px "Trebuchet MS",Arial,Helvetica,sans-serif}#quickSummary .p2 a{color:#fff}#quickSummary .p2 a:hover{text-decoration:none;color:#ccc}#preamble{padding-top:120px;background:url("img_1.jpg") 10px 170px no-repeat;height:1%}#preamble h3{background:url("roadto.png") no-repeat;position:relative;left:120px;height:44px;width:212px}#preamble h3 span{display:none}#preamble p{text-align:left;margin-top:-44px;font-style:italic;padding:0 10px 35px 380px}/* main content */#supportingText{background:url("cover.png") repeat-y;padding:0 30px}#explanation{height:1%;background:url("img_2.jpg") 370px 50% no-repeat}#explanation h3{background:url("sowhat.png") no-repeat;position:relative;left:380px;height:45px;width:176px}#explanation h3 span{display:none}#explanation p{text-align:right;margin-top:-45px;font-style:italic;padding:0 380px 35px 10px}#participation{height:1%;background:url("img_3.jpg") 5px 50% no-repeat}#participation h3{background:url("participation.png") no-repeat;position:relative;left:180px;height:45px;width:157px}#participation h3 span{display:none}#participation p{text-align:left;margin-top:-45px;font-style:italic;padding:0 10px 35px 380px}#benefits{background:url("img_4.png") 380px 50% no-repeat}#benefits h3{background:url("benefits.png") no-repeat;position:relative;left:380px;height:47px;width:150px}#benefits h3 span{display:none}#benefits p{text-align:right;margin-top:-47px;font-style:italic;padding:0 380px 35px 10px}#requirements h3{background:url("requirements.png") no-repeat;position:relative;left:180px;height:46px;width:150px}#requirements h3 span{display:none}#requirements p{text-align:left;margin-top:-46px;font-style:italic;padding:0 10px 35px 380px}#footer{padding-left:380px;text-align:center}#footer a{color:#666;text-decoration:none;border:1px solid #fffcf1;padding:5px}#footer a:hover{border:1px solid #ccc}/* notes */#linkList{font-size:120%;font-style:italic;position:absolute;width:300px;bottom:70px;left:80px}#linkList h3.select{width:142px;height:29px;background:url("select.png") no-repeat;position:relative;left:8px;top:8px}#linkList h3.select span{display:none}#linkList h3.archives{width:74px;height:25px;background:url("archives.png") no-repeat;position:relative;left:8px}#linkList h3.archives span{display:none}#linkList ul{margin:10px 5px 10px 40px;padding:0 5px}#linkList ul li{list-style-type:none;list-style-image:none}#lselect ul li{list-style:outside url("bull.png")}#linkList ul li a{text-decoration:none}#lresources{font:16px/22px "Trebuchet MS",Arial,Helvetica,sans-serif;background:url("notes.jpg") no-repeat;padding:20px 15px;width:252px}#lresources ul{margin:30px20px 50px 25px}#lresources h3.resources{width:85px;height:22px;background:url("resources.png") no-repeat}#lresources h3.resources span{display:none}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css2/basic/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css2/basic/</url>
      
        <content type="html"><![CDATA[body{margin: 0px;font-family : Arial, Helvetica, sans-serif;font-size : 11px;color: #557788;background-color: #C0CEDC;}p {margin:10px 0;}/********************/#container {background-color: White;width: 760px;margin: 10px auto;padding: 10px;position:relative;}/********************//********************/#pageHeader {background-color: #557788;padding: 10px;height: 35px;}h1 {font-size : 28px;color: White;margin: 0px;float: left;}h2 {font-size : 18px;color: #C0CEDC;margin-top: 5px;float: right;}/********************/#quickSummary {float: right;width: 260px;}#quickSummary .p1 {color: White;background-color: #C0CEDC;border:1px #578 dashed;padding: 10px;margin: 10px 0px;font-size : 13px;}#quickSummary .p2 {font-size : 10px;margin: 0;}/********************/#preamble {width: 490px;float: left;}h3 {font-size: 18px;margin: 10px 0px 10px 0px;background: #C0CEDC url(corner.gif) no-repeat;line-height:27px;padding-left:10px;}/********************/#supportingText{margin-right:270px;width:490px;}/*******************/#linkList {position:absolute;right:10px;top:230px;width: 260px;}#intro {height:230px;}#explanation h3{margin-top: 0px;}#footer{width:70px;position:absolute;bottom:20px;right:10px;}#footer a{text-align:center;display:block;padding:0 20px;border:1px #c00 dashed;}/******************/a:link,a:visited {text-decoration: none;color: #c00;}a:hover,a:active {text-decoration: underline;}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css1/basic/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter02/demo/css1/basic/</url>
      
        <content type="html"><![CDATA[/* css Zen Garden submission 158 - 'a Simple Sunset', by Rob Soule, http://www.couchfort.net/ *//* css released under Creative Commons License - http://creativecommons.org/licenses/by-nc-sa/1.0/  *//* All associated graphics copyright 2005, Rob Soule *//* Added: Mar. 7th, 2005 *//* IMPORTANT *//* This design is not a template. You may not reproduce it elsewhere without the    designer's written permission. However, feel free to study the CSS and use    techniques you learn from it elsewhere. *//*     'a Simple Sunset'    design by rob soule    www.couchfort.net *//* --// basic elements --// */body {  font: 11px georgia,times,serif;  color: #F0E9CE;  background: #F0E9CE url(mainbg.gif) repeat-x top;  margin: 0; text-align: center; }acronym { cursor: help; border-bottom: 1px dotted #F0E9CE;}/* --// links --// */a {  color: #F0AC4A; text-decoration: none; }a:hover,a:active { text-decoration: underline; }a acronym { border: 0; }li a { display: block; color: #2B0101; font-weight: bold; font-size: 11px; text-transform: none; padding: 2px 0 3px 0;}li a.c { font-size: 9px; font-weight: normal; display: inline; padding: 0; text-transform: uppercase;}#larchives li a, #lresources li a { display: inline; font-weight: normal; font-size: 9px; line-height: 15px; margin: 0; text-transform: uppercase;}li a:hover, li a:hover.c { color: #5E1919; }#footer a { color: #B6B2A3; margin: 0 5px; border: 1px solid #CBC7B5; text-decoration: none; padding: 2px 3px;}#footer a:hover { background: #CBC7B5; color: #2B0101;}/* --// id selectors --// */#container {  margin: 0 auto; text-align: left;  background: url(contbg.gif) repeat-y center; width: 672px;}#intro,#supportingText { line-height: 19px;}#pageHeader {  height: 287px; background: url(top.jpg) no-repeat;}#quickSummary { background: url(prebg.gif) no-repeat center top; height: 87px; font-size: 9px; text-transform: uppercase; }#preamble { width: 380px; margin-top: -95px;  padding: 0 0 0 260px; font-style: italic;}#supportingText { width: 380px; padding: 0 0 0 260px;}#linkList { position: absolute; top: 325px; padding-left: 45px; color: #2B0101;}#lselect,#larchives,#lresources { background: url(lselectbttm.gif) no-repeat bottom; padding-bottom: 12px; margin-top: 15px;  }/* --// layout ...booya --// */#preamble h3,#explanation h3, #participation h3, #benefits h3, #requirements h3{ text-indent: -5000px; height: 37px;}#lselect h3, #lresources h3, #larchives h3 { height: 23px; width: 189px; margin: 0; text-indent: -5000px; } #preamble h3 { background: url(h3road.gif) no-repeat right; }#explanation h3 { background: url(h3allabout.gif) no-repeat right; }#participation h3 { background: url(h3part.gif) no-repeat right; }#benefits h3 { background: url(h3benefits.gif) no-repeat right; }#requirements h3 { background: url(h3require.gif) no-repeat right; }#lresources h3 { background: url(lresourcesspan.gif); }#larchives h3 { background: url(larchivesspan.gif); }#lselect h3{ background: url(lselectspan.gif); margin: -15px 0 0 0;}#quickSummary .p2 { position: absolute; top: 190px; width: 280px; text-align: right;  margin-left: 360px; }#quickSummary .p1 { position: absolute; top: 100px; width: 158px; margin-left: 482px; text-align: right; line-height: 14px; }#footer { display: block; width: 625px; margin-left: -235px; text-align: center; padding: 15px 0 25px 0; font: 10px verdana,arial,serif; text-transform: uppercase; letter-spacing: -1px; background: #DCD5B8 url(footerbg.gif) repeat-x bottom; }#extraDiv1, #extraDiv2, #extraDiv3, #extraDiv4, #extraDiv1, #extraDiv5, #pageHeader h1,h2 { display : none; }/* --// lists --// */ul,li { list-style: none; padding: 0; margin: 0;}li { background: #F0E9CE; padding: 5px 7px; border-bottom: 1px solid #DCD5B8;  text-transform: uppercase;  font-size: 9px;}li:hover { background: #DCD5B8; }/* --// the lone class --// */.p5 { clear: both; }/* the end... doh doh doh */]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 拜托了大脑</h1><h2 id="0、学习中的痛点问题">0、学习中的痛点问题</h2><ul><li>为什么明明很努力了，但就是没效果？</li><li>学完记不住怎么办？</li><li>每天上课老师讲的代码我也都敲（抄）了，但是感觉什么都没学会怎么办？</li><li>为什么学着学着会感觉跟不上了？</li><li>学的东西太多感觉非常混乱怎么办？</li></ul><h2 id="1、人和人的差异是『系统』的差异">1、人和人的差异是『系统』的差异</h2><h3 id="①起点、路径、目标">①起点、路径、目标</h3><p>为什么同样是毕业5年，你和你的同学差距特别大？起点、路径、目标这三个东西哪个对人影响最大？</p><ul><li>目标：有的人目标是1亿，有的人目标是够吃饭就行。目标不同活法肯定不同。</li><li>路径：有的人根本不知道路在哪，有的人靠两条腿狂奔，有的人开汽车，有的人坐飞机，有的人坐火箭。</li><li>起点：最不重要的就是起点。对那些靠两条腿跑的人来说，10公里是非常遥远的距离，但是对开汽车的人来说很近。</li></ul><p>如果一个问题的解决办法已经<span style="color:blue;font-weight:bold;">有别人反复验证过可行、有效的路径存在</span>，那这种问题就非常容易解决。但即使这样不同的人应对同样问题时效果也完全不同。从深圳到北京，徒步、开车、高铁、飞机就是效率完全不同的解决方案。</p><p>在路上使用的<span style="color:blue;font-weight:bold;">交通工具</span>不同就是人和人之间<span style="color:blue;font-weight:bold;">系统</span>的不同，而系统其实就是一个人的<span style="color:blue;font-weight:bold;">认知水平、思维方式、学习和工作的方法</span>。</p><h3 id="②思维跃迁">②思维跃迁</h3><p>世界本身是极其复杂的，即使是细分之后的领域仍然非常复杂，比如一颗小小的芯片背后就是一个非常庞大、复杂的体系：科学、技术、设计、制造、供应链、操作系统、市场等等。面对这么复杂的世界，简单的思维方式是没法理解和应对的。而比我们成功的人一定是从更底层把握了<span style="color:blue;font-weight:bold;">复杂世界中简单规律</span>的人。</p><h4 id="1-穿透现象看到本质">[1]穿透现象看到本质</h4><p>实现同一个功能，代码可以有很多种不同的写法，我们要做的并不是把某一种代码背下来，而是<span style="color:blue;font-weight:bold;">直击本质</span>，<span style="color:blue;font-weight:bold;">把握规律</span>，<span style="color:blue;font-weight:bold;">以不变应万变</span>。</p><p><img src="./images/img015.jpg" alt="./images"></p><h4 id="2-宏观视野">[2]宏观视野</h4><p>将来大家走上工作岗位，参与开发都是非常庞大的系统，此时要求大家能够把视角拔高，<span style="color:blue;font-weight:bold;">从最高处俯瞰整个项目的架构</span>。而在具体的开发过程中对于微观的代码编写和故障调试又要求能够做到细致认真，对程序员来说这两种看似矛盾的能力必须同时具备。</p><h4 id="3-目标导向">[3]目标导向</h4><p>任何项目、任何技术都是为了解决实际问题而生的，所以我们不论是在技术学习过程中还是在项目开发过程中都要锻炼自己理解需求的能力和根据需求设定目标的能力。有了明确的<span style="color:blue;font-weight:bold;">目标</span>下一步才能一步一步分析出实现目标的<span style="color:blue;font-weight:bold;">思路</span>，然后根据思路中的各个环节编写<span style="color:blue;font-weight:bold;">代码</span>，最终把需求落地实现。</p><h4 id="4-抽象空间">[4]抽象空间</h4><p>一个人每天按时上课，按时自习，从不违纪，身体确实在教室，但是灵魂早已不知到哪里游荡，他算努力吗？</p><p>一个人把老师的代码抄了一遍又一遍，把课件背了一回又一回，他算努力吗？</p><p>一个人顶着狂风烈日面试了一家又一家公司，屡战屡败，屡败屡战，他算努力吗？</p><p>另一个人看着好像也没怎么努力，该打球打球，该拍拖拍拖，面试没几家就拿到N个不错的offer，老师劝他不着急入职，再多面几家肯定有更好的，他说现在这个不错了，懒的面了。你好像确实没法说他<span style="color:blue;font-weight:bold;">『努力』</span>，但是你不得不承认至少单纯在<span style="color:blue;font-weight:bold;">『参加培训找工作』</span>这一件事上他很<span style="color:red;font-weight:bold;">『成功』</span>。</p><p>所以老师不必费力向你证明前面那三个人并没有<span style="color:blue;font-weight:bold;">『真正努力』</span>，而只是<span style="color:blue;font-weight:bold;">『用战术上的勤奋掩盖战略上的懒惰』</span>——老师希望你注意到：即使是<span style="color:blue;font-weight:bold;">『真正的努力』</span>仍然只是<span style="color:blue;font-weight:bold;">『手段』</span>而不是<span style="color:blue;font-weight:bold;">『目的』</span>，我们真正的目的是<span style="color:blue;font-weight:bold;">『成功』</span>。不管过程中再怎么努力，最后达不成目的不还是白搭？当然，如果因此你得出一个结论就是那我不用努力了我也没有办法，毕竟谁都没法叫醒一个装睡的人不是？</p><p>那怎么做算是<span style="color:blue;font-weight:bold;">『战略正确』</span>呢？</p><p>进军<span style="color:blue;font-weight:bold;">抽象空间</span>，到抽象空间里占领一个又一个知识高地。</p><p><span style="color:blue;font-weight:bold;">学习的真正过程发生在人的意识中</span>，而意识是<span style="color:blue;font-weight:bold;">看不见、摸不着</span>的。所以当一个同学『人在教室、神游天外』时，老师明知道他没在学习可是还真不好说啥，因为他确实没有违反纪律。纪律只能在物质世界设置规则，而没法限制你的想法。</p><p>但所谓知识其实就是人类认识世界过程中总结、提炼的结晶，全部都是<span style="color:blue;font-weight:bold;">抽象的概念</span>，同样看不见、摸不着。我们上课的过程就是老师把他自己的意识空间用声音和图像投影到教室里，然后再投影到你的意识空间——毕竟老师没法双掌贴着你的后背把毕生功力传给你。</p><p>大家需要<span style="color:blue;font-weight:bold;">接收</span>到声音和图像的<span style="color:blue;font-weight:bold;">信号</span>，然后<span style="color:blue;font-weight:bold;">理解</span>它们的<span style="color:blue;font-weight:bold;">含义</span>，再重新<span style="color:blue;font-weight:bold;">凝练</span>成一个一个的概念<span style="color:blue;font-weight:bold;">结晶</span>，最后还要分门别类、井然有序的<span style="color:blue;font-weight:bold;">保存</span>起来以备将来使用。</p><p>所以学习真要比的话应该比的就是在意识空间中<span style="color:blue;font-weight:bold;">知识晶体的<span style="color:red;font-weight:bold;">数量</span>和<span style="color:red;font-weight:bold;">秩序</span></span>。</p><p>很多人为什么学习起来非常吃力？就是因为他完全没有办法进入抽象空间，完全没法理解任何抽象的东西。这里我们举个例子：</p><p>具象：3×2=6，2×3=6，4×7=28，7×4=28，……</p><p>抽象：乘法交换律</p><p>用具象的算式描述这个规律可以写出无限多个，可是用抽象的规律短短五个字就概括了。这就是掌握规律的力量，这就是为什么培根说『知识就是力量』。好在老师会用<span style="color:blue;font-weight:bold;">举例、类比、画图等等手段把抽象的东西尽量具象化</span>，但是谁也代替不了你自己的理解、提炼和总结。不过好消息是现在你知道怎么努力了。</p><p>所以各位朝气蓬勃的少男少女们，充分调动起你活跃的大脑，一起来提炼闪闪发光的知识晶体吧！</p><h2 id="2、『学习能力』就是一个系统">2、『学习能力』就是一个系统</h2><p><img src="./images/img014.png" alt="./images"></p><h3 id="①敞开心扉">①敞开心扉</h3><p>你真的对技术感兴趣吗？</p><p>小明拿瓶子去接水，咕咚咕咚一通灌。完事儿一看，瓶子里一滴水都没有。</p><p>为啥？瓶塞没有拔出来。</p><p>像不像你叫嚷着学Java，但其实真正的内心对Java没有任何兴趣，只是因为听说它很赚钱才学。你<span style="color:blue;font-weight:bold;">『真正喜欢』</span>的是<span style="color:blue;font-weight:bold;">『钱』</span>而不是<span style="color:blue;font-weight:bold;">『Java』</span>。</p><p>而真正学的时候内心是<span style="color:blue;font-weight:bold;">『抗拒』</span>的，你觉得这东西和你一点关系都没有。禁闭的心扉如同没有拔掉木塞的瓶子。这样谁都帮不了你，不管听了多少课都学不到东西的。</p><p>正确的状态是：<span style="color:blue;font-weight:bold;">对『Java本身』贼啦好奇</span>，<span style="color:blue;font-weight:bold;">『挖空心思』</span>想闹明白到底是咋回事，谁不让我学我跟谁急。</p><p>学会以后干活，<span style="color:blue;font-weight:bold;">不给钱也干</span>，谁不让我干我跟谁急，然后肯定会干得特别好，<span style="color:blue;font-weight:bold;">『意外』</span>赚了很多钱。</p><p>任何成功都来自于<span style="color:blue;font-weight:bold;">『内心深处强烈的渴求』</span>。而程序员的成功秘诀是<span style="color:blue;font-weight:bold;">『敲代码本身即是最大幸福和最高奖赏』</span>。</p><p>很多同学总是问学完Java用不用再学学大数据呀？Java干3年以后转型什么呀？</p><p>其实Java也好，大数据也好，都是『路径』，不是『目标』。你的<span style="color:blue;font-weight:bold;">『好奇心』</span>决定了你在这条路上能够走多远。而培训完的起薪都只是『起点』，前面说过了，三者中『起点』是最不重要的。</p><p>在以后的学习中我们任何技术点都会通过提出问题的方式来引入，大家要留意这个环节，在揭示答案之前用这个问题问问自己，看看这个问题是否能在你的心里<span style="color:blue;font-weight:bold;">引起共鸣</span>，<span style="color:blue;font-weight:bold;">激发</span>你的<span style="color:blue;font-weight:bold;">好奇心</span>，这是我们迈向成功的第一步。</p><h3 id="②大脑的工作机制">②大脑的工作机制</h3><h4 id="1-大脑的结构">[1]大脑的结构</h4><ul><li>最内层：爬行动物脑，只在乎吃饭和制造下一代，再复杂点的事情就理解不了了。</li><li>中间层：哺乳动物脑，感情中枢，很多哺乳动物都进化出了这一层大脑，所以你会感觉到你家狗狗对你非常有感情——相信我，那是真感情。</li><li>最外层：<span style="color:blue;font-weight:bold;">大脑皮层</span>，人的理性思维在这里生成，语言、视觉、听觉、逻辑思维、空间想象力等等都在大脑皮层这里有专门的负责区域。其中学Java的时候要用到的理性思维是大脑皮层中的<span style="color:blue;font-weight:bold;">『前额叶』</span>这个部分。可以说迄今为止人类文明所造就的所有辉煌成果都是建立在前额叶的基础上。</li></ul><h4 id="2-死记硬背？">[2]死记硬背？</h4><p>不会吧，不会吧？现在还有同学想靠死记硬背来学Java？请马上停止！</p><p>相比较<span style="color:blue;font-weight:bold;">『记忆』</span>来说，大脑更擅长<span style="color:blue;font-weight:bold;">『思考』</span>。前面说过思考是由前额叶来负责的，下面说说记忆：</p><ul><li>临时记忆：海马体。比如别人和你说忙完给他打个电话，你当时答应了但是一转眼就忘了。信息刚刚进入大脑的时候其实是在海马体临时存储的。</li><li>长期记忆：写入大脑皮层。这可不容易，死记硬背就是通过大量的重复把信息强行写入大脑皮层。就好比你非要靠脑子记住一个手机号，大致就是这个办法。但遗憾的是一个<span style="color:blue;font-weight:bold;">孤立的信息</span>即使通过大量重复强行写入到大脑皮层也不会存在太久。小学同学朝夕相处，但是分开20年还是会忘记很多人的名字。</li></ul><p>这就是为什么总有同学很困扰：学完了记不住呀！对于这个问题我的回应如下：</p><ul><li><p>你想记住啥？</p><p>你想记住代码怎么写吗？需求会变，代码永远要跟着变。</p><p>你想记住老师说的每一句话吗？老师一天能说一万句话。</p><p>想记住这些这不是痴心妄想吗？</p></li><li><p>你该记住啥？</p><p>具象：3×2=6，2×3=6，4×7=28，7×4=28，……</p><p>抽象：乘法交换律</p><p>你该记住的是从现象中提取出来的规律而不是现象。甚至这么说也不准确。因为这个规律你<span style="color:blue;font-weight:bold;">理解了自然就记住了</span>，不需要背。</p></li><li><p>知识的网络</p><p>任何孤立的信息都很容易忘，但是点和点之间组成一个彼此联系的<span style="color:blue;font-weight:bold;">网络</span>就很<span style="color:blue;font-weight:bold;">不容易忘</span>记了。</p></li><li><p>细节记不住咋办？</p><p>即使理解并且记住了要点，但是知识点相关的细节还是记不住怎么办？比如大段的配置，代码调用的API方法，特定场景需要传递的参数等等。好办，<span style="color:blue;font-weight:bold;">『好记性不如烂笔头』</span>，这些东西记到笔记里永久保存。</p></li></ul><h4 id="3-外接硬盘">[3]外接硬盘</h4><p>通过前面的分析我们看到，大脑是一个有CPU（前额叶）有内存（海马体）的电脑，但是没有硬盘来做永久存储。所以我们需要给大脑连接一个能够永久存储信息的外部设备：笔记。由此我们就得出了大脑要扮演的第一个角色：<span style="color:blue;font-weight:bold;">搜索引擎</span>。</p><p>首先，学习的过程就是建设索引库的过程：</p><p><img src="./images/img016.png" alt="./images"></p><p>然后在解决实际问题时需要运用学过的知识就到索引库中去检索：</p><p><img src="./images/img017.png" alt="./images"></p><h4 id="4-快思维和慢思维">[4]快思维和慢思维</h4><p>大脑的第二个角色是：<span style="color:blue;font-weight:bold;">司令部</span>。而你是<span style="color:blue;font-weight:bold;">司令</span>。对，你没看错，其实『你不是你的大脑，你的大脑也不是你』。就像手、脚、胯骨轴是你的一部分一样，大脑同样只是你的一部分。但是大脑对人来说太重要了，人的很多无意识行为都是大脑来协调和指挥的。比如：人走路时的身体平衡，身体各个系统和脏器的正常工作，应激反应等等都是大脑来指挥的，而这些事情你完全不知道是怎么做的，也无法干涉。<span style="color:blue;font-weight:bold;">司令部协助司令指挥部队，司令把握总体的战略方向</span>。</p><p>而司令部这个角色和学习有关系的部分就是大脑的快思维和慢思维。</p><p>小孩子没法一边穿衣服、系扣子一边走路。因为它穿衣服、系扣子需要慢慢做，一边做一边想。所以事情不熟练、需要慢慢思考的时候，大脑就需要以慢思维的模式工作——这个过程是需要<span style="color:blue;font-weight:bold;">『你』</span>参与的。</p><p>大人穿衣服、系扣子都很熟练了，不需要想，所以可以一边走路，一边穿衣服。这个过程就<span style="color:blue;font-weight:bold;">不需要『你』参与</span>了，大脑调用现成的『路径』在快思维的工作模式下完成动作。</p><p>这是因为<span style="color:blue;font-weight:bold;">『慢思维』</span>非常消耗能量，而<span style="color:blue;font-weight:bold;">『快思维』</span>能耗非常低，大脑会优先选择能耗低的路径执行动作，节约能量。这就是为什么人会有<span style="color:blue;font-weight:bold;">『习惯』</span>，而习惯一旦养成很难改变。本质原因就是大脑的这种<span style="color:blue;font-weight:bold;">『路径依赖』</span>的机制。</p><h3 id="③知识的知识：元知识">③知识的知识：元知识</h3><h4 id="1-知识点">[1]知识点</h4><p>比如：<span style="color:blue;font-weight:bold;">『黄赤交角导致地球上四季更迭』</span>这就是一个知识点。</p><p><img src="./images/img018.png" alt="./images"></p><h4 id="2-前置知识">[2]前置知识</h4><p>想理解『黄赤交角导致地球上四季更迭』这个知识点的前提是知道『赤道』、『黄道』、『地球自转』、『地球公转』等等概念，还必须具备一定的『立体几何』的基础。这就说明知识的大厦是一砖一瓦建成的，没有1楼别想上2楼。</p><p><img src="./images/img019.png" alt="./images"></p><p>如果想理解B的<span style="color:blue;font-weight:bold;">前提</span>是知道A，那么A就是B的前置知识点。</p><h4 id="3-知识链">[3]知识链</h4><p><img src="./images/img020.png" alt="./images"></p><p>把所有前置知识连起来就形成了一条知识的链条。虽然我们学习的时候不需要把这个链条画出来，但是它可以帮助你理解你<span style="color:blue;font-weight:bold;">为什么会跟不上</span>：在知识的链条中前置知识点缺失太多了。不知道『赤道』、『黄道』、『地球自转』、『地球公转』等等概念也不理解两个平面之间的夹角是怎么回事的时候听别人给你讲地球上为什么会有春夏秋冬那就是听天书，完全不明白什么意思。</p><h4 id="4-知识树">[4]知识树</h4><p>为什么老师讲课的课件总是划分成章节，章节里面还有一、二、三、……1、2、3、……①、②、③、……这样的小点？就是因为知识点根据彼此之间的归类和相关性可以『纵向抽取』，从而整理成一个树形结构，这样也是为了大家更好理解。</p><p>但是老师讲课的时候还是要从这根葡萄梗上把葡萄一颗一颗摘下来给你。</p><p>而你拿到葡萄以后就乱放了，散落一地的葡萄非常不好拿，到用的时候各种颜色的葡萄混杂的胡乱堆放在一起，根本找不到你要的。</p><p>所以大家听完课还是要在自己的精神世界里把葡萄往葡萄梗上一颗一颗装回去。用专业术语来说就是<span style="color:blue;font-weight:bold;">把节点按照树形结构重新组装</span>起来。</p><p><img src="./images/img021.jpg" alt="./images"></p><h4 id="5-知识网络">[5]知识网络</h4><p>哲学知识点：矛盾是对立统一，矛盾中对立的双方都不能脱离对方而单独存在。</p><p>化学知识点：在碱溶液中会有极少量的H<sup>+</sup>离子，在酸溶液中会有极少量的OH<sup>-</sup>离子。</p><p>横向来看，知识点之间很容易找到相通或类似的情况。有些知识点之间的横向对比能够彼此印证，帮助我们理解；而有些看起来相似但实质不同的知识点却会干扰我们的判断和使用。</p><p>所以<span style="color:blue;font-weight:bold;">知识点融会贯通之后必然会打破彼此的界限连成网络，这个网络越发达你的视野越开阔，网络中的具体知识点掌握越牢固</span>。</p><h4 id="6-知识体系">[6]知识体系</h4><p>在生物学中把生物划分为了界、门、纲、目、科、属、种，这有什么好处呢？不仅让已知的生物更易于研究和学习，将来发现新物种就直接按照这个划分方法<span style="color:blue;font-weight:bold;">纳入体系</span>就好了。</p><p><img src="./images/img022.gif" alt="./images"></p><p>有了知识体系之后，你的学习会非常快速，因为新的知识点会快速被已有的知识体系接纳，旧的知识会帮助你理解新的知识。</p><table><thead><tr><th> </th><th>MySQL</th><th>Redis</th></tr></thead><tbody><tr><td>数据库连接</td><td>Connection</td><td>Jedis</td></tr><tr><td>数据库连接池</td><td>Druid</td><td>JedisPool</td></tr><tr><td>连接信息</td><td>主协议:子协议://主机地址:端口号/数据库名称<br />用户名<br />密码<br />数据库驱动</td><td>主机地址:端口号</td></tr></tbody></table><p>当你不断的感受到旧知识点在帮助你理解新知识点，你的知识体系就在不断扩大；知识系统不断扩大之后，旧知识点对新知识点的帮助能力就更大，形成一个<span style="color:blue;font-weight:bold;">『增强回路』</span>，让你的学习越来越快，形成一条指数曲线。</p><p><img src="./images/img023.png" alt="./images"></p><h3 id="④卖油翁的微笑">④卖油翁的微笑</h3><blockquote><p>陈康肃公善射，当世无双 ，公亦以此自矜。尝射于家圃，有卖油翁释担而立，睨之久而不去。见其发矢十中八九，但微颔之。<br>康肃问曰：“汝亦知射乎？吾射不亦精乎？”。翁曰：“无他， 但手熟尔。”康肃忿然曰：“尔安敢轻吾射！”翁曰：“以我酌油知之。”乃取一葫芦置于地，以钱覆其口，徐以杓酌油沥之，自钱孔入，而钱不湿。因曰：“我亦无他，惟手熟尔。”康肃笑而遣之。</p></blockquote><p>编程本质上是一个技能，而任何技能都需要通过大量的重复练习才能够熟练掌握。李小龙说：<span style="color:blue;font-weight:bold;">『我不怕会一万种招式的人，我怕把一种招式练一万次的人』</span>。神枪手是用一匣一匣的子弹喂出来的，优秀的程序员就是用一堆又一堆的bug给练出来的。所以学编程肯定要多敲多练。</p><p>但是我说的是<span style="color:blue;font-weight:bold;">『敲』</span>不是<span style="color:blue;font-weight:bold;">『抄』</span>！很多同学照着老师的代码敲自己的代码，看着是敲了一遍，其实只是抄了一遍。抄完发现没有什么效果。关上电脑什么都不记得。这其实是正常的认知规律的体现。</p><p>在『抄』的时候大脑其实不需要多想什么，因为它只需要考虑A处是什么单词，再到B处敲同样的单词就行了，这是一件很简单的事情，大脑调用5%就足够了——这调用深度远远不够。而且你不觉得非常枯燥无聊吗？</p><p>真正的学习状态是什么？向知识点提问、打草稿、分析思路、画流程图、和别人讨论、敲代码验证、分析结果为什么和老师不一样、把验证结果写到笔记里……</p><p>你看看这是不是<span style="color:blue;font-weight:bold;">热火朝天</span>？这么整的话大脑的利用率可是有95%啊！而且<span style="color:blue;font-weight:bold;">兴趣盎然</span>啊有木有？这么学习既高效又开心，谁不让我学我和谁急！</p><p>这时大脑扮演了第三个角色：<span style="color:blue;font-weight:bold;">教练</span>。</p><h3 id="⑤输出倒逼输入">⑤输出倒逼输入</h3><p>你有没有发现看老师讲课的视频特别容易睡着？这不是老师讲得不好，也不是你不爱学习，而是单纯的看视频只是被动接受，大脑还是没有充分调动起来。大脑进入闲置状态自然会<span style="color:blue;font-weight:bold;">昏昏欲睡</span>。</p><p>而当你和别人讨论问题，把你的观点讲出来，就会越聊越兴奋甚至争得脸红脖子粗有木有？</p><p>甚至是在和别人表达自己观点的时候会发现自己以前理解的某个知识点其实完全不是那么回事，开始以为自己懂了但是要说的时候才发现自己根本没有懂，理解的不透彻。</p><p>其实在大脑里很多角落都在黑暗中，当我们想拿出来的时候才会用手电筒照过去，把那个地方<span style="color:blue;font-weight:bold;">照亮</span>，照亮以后才能<span style="color:blue;font-weight:bold;">看清楚</span>那里到底放着什么。</p><p>所以一切形式的<span style="color:blue;font-weight:bold;">『输出』</span>都会非常有效的提高学习效率。那么输出的形式包括哪些呢？</p><ul><li>做笔记：自己亲手做，不是抄别人的。</li><li>敲代码：不是抄啊！</li><li>和别人讨论：有问有答的那种</li><li>调bug：bug虐我千百遍，我待bug如初恋</li><li>发博客：积累多了对职业发展很有帮助的哟</li></ul><h3 id="⑥总结">⑥总结</h3><p>说了这么多，我们具体在学习的时候应该怎么学呢？</p><ul><li>第一步：提出问题，激发好奇。</li><li>第二步：思考分析，理解原理。</li><li>第三步：敲代码、调bug练习，验证原理，修正理解。</li><li>第四步：做笔记，既是备忘，又是建设自己的索引库和知识体系。</li><li>第五步：遇到相似知识点就详细辨析比对，直到充分区别不会混淆。</li><li>第六步：回归到真实场景，在项目中运用，彻底掌握这个技术，让所学技术真正落地。</li></ul><p>所以<span style="color:blue;font-weight:bold;">『学习』</span>两个字中，<span style="color:blue;font-weight:bold;">『学』</span>指的是理解原理，建立知识体系，而<span style="color:blue;font-weight:bold;">『习』</span>则是练习技能，引申到各种形式的输出都算<span style="color:blue;font-weight:bold;">『习』</span>。而只有拿学过、练过的东西真正的解决了现实生活中真正的实际问题才算是<span style="color:red;font-weight:bold;">『会』</span>。而任何形式的市场都只会为能够真正解决问题的人付<span style="color:green;font-weight:bold;">『钱』</span>。</p><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/index/</url>
      
        <content type="html"><![CDATA[<h1>第一章 Web开发概述</h1><p><a href="verse01.html">第一节 Web基础概念</a></p><p><a href="verse02.html">第二节 拜托了大脑</a></p><p><a href="../index.html">回目录</a> <a href="../chapter02/index.html">下一章</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/chapter01/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 Web基础概念简介</h1><h2 id="1、服务器与客户端">1、服务器与客户端</h2><h3 id="①线下的服务器与客户端">①线下的服务器与客户端</h3><p><img src="./images/img001.png" alt="./images"></p><h3 id="②线上的服务器与客户端">②线上的服务器与客户端</h3><p><img src="./images/img002.png" alt="./images"></p><h3 id="③客户端的各种形式">③客户端的各种形式</h3><h4 id="1-PC端网页">[1]PC端网页</h4><p><img src="./images/img003.png" alt="./images"></p><h4 id="2-移动端">[2]移动端</h4><p><img src="./images/img004.jpg" alt="./images"></p><h4 id="3-Iot设备">[3]Iot设备</h4><p><img src="./images/img005.jpg" alt="./images"></p><h3 id="④服务器的各种形式">④服务器的各种形式</h3><p><a href="../../../pro000-dev-story/chapter11/content.html" target="_blank">点我查看完整内容</a></p><h2 id="2、服务器端应用程序">2、服务器端应用程序</h2><p>我们要开发的就是<span style="color:blue;font-weight:bold;">服务器端应用程序</span>。</p><p><img src="./images/img008.png" alt="./images"></p><h2 id="3、业务">3、业务</h2><p>项目中的功能就是业务。</p><h2 id="4、请求和响应">4、请求和响应</h2><h3 id="①发生在饭馆的请求和响应">①发生在饭馆的请求和响应</h3><p><img src="./images/img006.png" alt="./images"></p><h3 id="②项目中的请求和响应">②项目中的请求和响应</h3><p><img src="./images/img007.png" alt="./images"></p><h2 id="5、项目的逻辑构成">5、项目的逻辑构成</h2><ul><li><p>请求：请求是项目中最基本的逻辑单元，就像万事万物都由原子构成</p><blockquote><p>举例：点超链接跳转到注册页面</p></blockquote></li><li><p>功能：一个功能包含很多个请求</p><blockquote><p>举例：注册用户功能</p><ul><li>请求1：点超链接跳转到注册页面</li><li>请求2：发送请求获取短信验证码</li><li>请求3：检查用户名是否可用</li><li>请求4：提交表单完成注册</li></ul></blockquote></li><li><p>模块：一个模块包含很多功能</p><blockquote><p>举例：用户信息管理模块</p><ul><li>功能1：用户注册功能</li><li>功能2：用户登录功能</li><li>功能3：个人中心——账户安全功能</li><li>功能4：个人中心——账户绑定功能</li><li>功能5：个人中心——收货地址功能</li><li>功能6：个人中心——我的银行卡功能</li></ul></blockquote></li><li><p>子系统：根据项目规模的不同，子系统这层逻辑概念可能有也可能没有。如果设置了子系统，那么子系统中也必然包含很多模块。其实庞大项目的子系统已经相当于一个项目了，甚至比小型项目整个都大。</p><blockquote><p>举例：认证中心子系统</p><ul><li>模块1：用户信息管理模块</li><li>模块2：权限管理模块</li><li>模块3：授权管理模块</li><li>模块4：权限检查模块</li></ul></blockquote></li><li><p>项目：为了解决现实生活中的实际问题开发一个项目，这个项目就是为这个需求提供的一整套解决方案。</p><blockquote><p>举例：电商项目</p><ul><li>子系统1：认证中心子系统</li><li>子系统2：商品管理子系统</li><li>子系统3：购物车子系统</li><li>子系统4：仓储子系统</li><li>子系统5：物流子系统</li><li>子系统6：订单子系统</li></ul></blockquote></li></ul><p><img src="./images/img009.png" alt="./images"></p><h2 id="6、架构">6、架构</h2><h3 id="①概念">①概念</h3><p><span style="color:blue;font-weight:bold;">『架构』其实就是项目的『结构』</span>。只不过『结构』这个词太小了，不适合用来描述项目这么大的东西，所以换了另一个更大的词：架构。所以当我们聊一个项目的架构时，我们聊的是项目是由哪些部分组成的。</p><h3 id="②发展演变历程">②发展演变历程</h3><h4 id="1-单一架构">[1]单一架构</h4><p>一个项目就是一个工程，这样的结构就是单一架构，也叫all in one。我们现在的JavaWeb阶段、SSM阶段都是学习单一架构开发技术。</p><h4 id="2-分布式架构">[2]分布式架构</h4><p>一个项目中包含很多工程，每个工程作为一个模块。模块之间存在调用关系。分布式架构阶段的技术分为两类：</p><ul><li>Java框架：SpringBoot、SpringCloud、Dubbo等等。</li><li>中间件：Redis、ElasticSearch、FastDFS、Nginx、Zookeeper、RabbitMQ等等。</li></ul><p><img src="./images/img010.png" alt="./images"></p><h3 id="③单一架构技术体系">③单一架构技术体系</h3><ul><li>视图：用户的操作界面+数据的动态显示<ul><li>前端技术：HTML/CSS/JavaScript</li><li>服务器端页面模板技术：Thymeleaf</li></ul></li><li>控制层：处理请求+跳转页面<ul><li>服务器：Tomcat</li><li>控制器：Servlet</li><li>域对象：request、session、servletContext</li><li>过滤器：Filter</li><li>监听器：Listener</li><li>异步交互：Ajax</li></ul></li><li>业务逻辑层：业务逻辑计算</li><li>持久化层：操作数据库</li></ul><p><img src="./images/img011.png" alt="./images"></p><h2 id="7、本阶段技术体系">7、本阶段技术体系</h2><p><img src="./images/img012.png" alt="./images"></p><h2 id="8、本阶段案例简介">8、本阶段案例简介</h2><p><img src="./images/img013.png" alt="./images"></p><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 显示购物车数据</h1><h2 id="1、思路">1、思路</h2><p><img src="./images/img007.png" alt="./images"></p><h2 id="2、代码实现">2、代码实现</h2><h3 id="①CartServlet增加getCartJSON-方法">①CartServlet增加getCartJSON()方法</h3><h4 id="1-Cart模型的局限性">[1]Cart模型的局限性</h4><p><img src="./images/img008.png" alt="./images"></p><p>目前的Cart对象转换为JSON后，没有totalCount、totalAmount这样的属性，Map结构也不如LIst遍历方便。</p><h4 id="2-调整方式">[2]调整方式</h4><p>把前端页面需要的属性，存入Map中即可。</p><h4 id="3-方法代码">[3]方法代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">getCartJSON</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    AjaxCommonResult&lt;Map&lt;String, Object&gt;&gt; result = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.尝试获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.检查cart对象是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (cart == <span class="literal">null</span>) &#123;</span><br><span class="line">        result = <span class="keyword">new</span> <span class="title class_">AjaxCommonResult</span>&lt;&gt;(AjaxCommonResult.FAILED, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; cartJSONMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        cartJSONMap.put(<span class="string">&quot;totalCount&quot;</span>, cart.getTotalCount());</span><br><span class="line">        cartJSONMap.put(<span class="string">&quot;totalAmount&quot;</span>, cart.getTotalAmount());</span><br><span class="line">        cartJSONMap.put(<span class="string">&quot;cartItemList&quot;</span>, cart.getCartItemMap().values());</span><br><span class="line"></span><br><span class="line">        result = <span class="keyword">new</span> <span class="title class_">AjaxCommonResult</span>&lt;Map&lt;String, Object&gt;&gt;(AjaxCommonResult.SUCCESS, <span class="literal">null</span>, cartJSONMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.将AjaxCommonResult对象转换为JSON作为响应返回</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> gson.toJson(result);</span><br><span class="line">    response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②前端代码">②前端代码</h3><h4 id="1-去除Thymeleaf痕迹">[1]去除Thymeleaf痕迹</h4><p>将cart.html页面中，由Thymeleaf渲染数据的部分去掉。</p><h4 id="2-使用Vue对象初步接管页面渲染">[2]使用Vue对象初步接管页面渲染</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appCart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;cart&quot;</span>:<span class="string">&quot;empty&quot;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>HTML标签：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tbody</span> <span class="attr">v-if</span>=<span class="string">&quot;cart == &#x27;empty&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span>&gt;</span>购物车还是空空的，赶紧去添加吧！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-在mounted生命周期环境发Ajax请求">[3]在mounted生命周期环境发Ajax请求</h4><p>记得加入axios库：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/script/axios.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cartApp = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appCart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;cart&quot;</span>:<span class="string">&quot;empty&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;mounted&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">axios</span>(&#123;</span><br><span class="line">            <span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:<span class="string">&quot;protected/CartServlet&quot;</span>,</span><br><span class="line">            <span class="string">&quot;params&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;method&quot;</span>:<span class="string">&quot;getCartJSON&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.从响应数据中获取请求处理结果</span></span><br><span class="line">            <span class="keyword">var</span> result = response.<span class="property">data</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.检查结果是成功还是失败</span></span><br><span class="line">            <span class="keyword">if</span> (result == <span class="string">&quot;SUCCESS&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3.获取购物车数据并赋值给Vue对象</span></span><br><span class="line">                cartApp.<span class="property">cart</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(cartApp.<span class="property">cart</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br></pre></td></tr></table></figure><h4 id="4-完成Vue页面渲染">[4]完成Vue页面渲染</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;appCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;w&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>图片<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>商品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>金额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">v-if</span>=<span class="string">&quot;cart == &#x27;empty&#x27;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span>&gt;</span>购物车还是空空的，赶紧去添加吧！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">v-if</span>=<span class="string">&quot;cart != &#x27;empty&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;cartItem in cart.cartItemList&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;cartItem.imgPath&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;cartItem.bookName&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookId&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;cartItem.bookId&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;itemDecrease&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> @<span class="attr">change</span>=<span class="string">&quot;itemCountChange&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count-num&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;cartItem.count&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;itemIncrease&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;cartItem.price&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;cartItem.amount&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;removeConfirm&quot;</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-left&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;clearCart&quot;</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet?method=clearCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;clear-cart&quot;</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span>&gt;</span>继续购物<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>共<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;cart.totalCount&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>件商品<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;total-price&quot;</span>&gt;</span>总金额&#123;&#123;cart.totalAmount&#125;&#125;元<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;pay&quot;</span> <span class="attr">href</span>=<span class="string">&quot;protected/OrderClientServlet?method=checkout&quot;</span>&gt;</span>去结账<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 加入购物车</h1><h2 id="1、思路">1、思路</h2><p><img src="./images/img005.png" alt="./images"></p><h2 id="2、代码实现">2、代码实现</h2><h3 id="①加入layer弹层组件">①加入layer弹层组件</h3><p><img src="./images/img006.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/script/jquery-1.7.2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/layer/layer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②顶层bar绑定Vue对象">②顶层bar绑定Vue对象</h3><p>Thymeleaf在服务器端渲染的过程中将购物车总数量计算得到，通过表达式设置写入JavaScript代码，作为Vue对象的初始值。然后由Vue对象通过v-show判断是否显示数量标签。</p><h4 id="1-在HTML标签上标记id">[1]在HTML标签上标记id</h4><p>由于要考虑是否登录的情况，所以id加到了两种情况外层的div</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;topBarApp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;w&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>送至:<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-ai-arrow-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-right&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.user == null&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toLoginPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toRegisterPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet?method=showCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;AdminServlet?method=toPortalPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--          登录后风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-right&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.user != null&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎你<span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.userName&#125;&quot;</span>&gt;</span>张总<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet?method=showCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span></span><br><span class="line">            购物车</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cart-num&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;totalCount &gt; 0&quot;</span>&gt;</span>&#123;&#123;totalCount&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/manager/book_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-创建Vue对象">[2]创建Vue对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// topBarApp对象的totalCount属性的初始值是Thymeleaf在服务器端运算出来用表达式设置的</span></span><br><span class="line"><span class="keyword">var</span> topBarApp = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>: <span class="string">&quot;#topBarApp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;totalCount&quot;</span>: [[$&#123;(session.<span class="property">cart</span> == <span class="literal">null</span>)?<span class="string">&quot;0&quot;</span>:session.<span class="property">cart</span>.<span class="property">totalCount</span>&#125;]]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="③图书列表div绑定Vue对象">③图书列表div绑定Vue对象</h3><h4 id="1-在HTML标签上标记id-2">[1]在HTML标签上标记id</h4><p>目的是为了便于创建Vue对象</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bookListApp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-content&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;book : $&#123;bookList&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;book.imgPath&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/uploads/huozhe.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>书名:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span>&gt;</span>活着<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>作者:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.author&#125;&quot;</span>&gt;</span>余华<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>价格:￥<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.price&#125;&quot;</span>&gt;</span>66.6<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>销量:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.sales&#125;&quot;</span>&gt;</span>230<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>库存:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.stock&#125;&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;button&gt;加入购物车&lt;/button&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/protected/CartServlet(method=addCart,bookId=$&#123;book.bookId&#125;)&#125;&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-在首页引入Vue和axios库文件">[2]在首页引入Vue和axios库文件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/script/vue.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/script/axios.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-创建Vue对象">[3]创建Vue对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#bookListApp&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="4-绑定单击响应函数">[4]绑定单击响应函数</h4><p>给加入购物车按钮绑定单击响应函数</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addToCart&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#bookListApp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;addToCart&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="5-将bookId设置到按钮中">[5]将bookId设置到按钮中</h4><p>为了便于在按钮的单击响应函数中得到bookId的值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;book.bookId&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addToCart&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="6-在单击响应函数中发送Ajax请求">[6]在单击响应函数中发送Ajax请求</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#bookListApp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;addToCart&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// event：事件对象</span></span><br><span class="line">            <span class="comment">// event.target：当前事件操作的对象</span></span><br><span class="line">            <span class="comment">// event.target.id：前事件操作的对象的id属性的值</span></span><br><span class="line">            <span class="keyword">var</span> bookId = event.<span class="property">target</span>.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">axios</span>(&#123;</span><br><span class="line">                <span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>:<span class="string">&quot;protected/CartServlet&quot;</span>,</span><br><span class="line">                <span class="string">&quot;params&quot;</span>:&#123;</span><br><span class="line">                    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;addCart&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;bookId&quot;</span>:bookId</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> result = response.<span class="property">data</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="string">&quot;SUCCESS&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 给出提示：加入购物车成功</span></span><br><span class="line">                    layer.<span class="title function_">msg</span>(<span class="string">&quot;加入购物车成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 从响应数据中获取购物车总数量</span></span><br><span class="line">                    <span class="comment">// response.data其实就是AjaxCommonResult对象的JSON格式</span></span><br><span class="line">                    <span class="comment">// response.data.data就是访问AjaxCommonResult对象的data属性</span></span><br><span class="line">                    <span class="keyword">var</span> totalCount = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 修改页头位置购物车的总数量</span></span><br><span class="line">                    topBarApp.<span class="property">totalCount</span> = totalCount;</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 给出提示：response.data.message</span></span><br><span class="line">                    layer.<span class="title function_">msg</span>(response.<span class="property">data</span>.<span class="property">message</span>);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="④后端代码">④后端代码</h3><p>CartServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCart</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据bookId查询图书数据</span></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getBookById(bookId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.尝试从Session域获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.判断Cart对象是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (cart == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.如果不存在，则创建新的Cart对象</span></span><br><span class="line">        cart = <span class="keyword">new</span> <span class="title class_">Cart</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.将新创建的Cart对象存入Session域</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.添加购物车</span></span><br><span class="line">    cart.addCartItem(book);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9.给Ajax返回JSON格式响应</span></span><br><span class="line">    <span class="comment">// ①创建AjaxCommonResult对象</span></span><br><span class="line">    AjaxCommonResult&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">AjaxCommonResult</span>&lt;&gt;(AjaxCommonResult.SUCCESS, <span class="literal">null</span>, cart.getTotalCount());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ②创建Gson对象</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ③将AjaxCommonResult对象转换为JSON字符串</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> gson.toJson(result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ④设置响应体的内容类型</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ⑤返回响应</span></span><br><span class="line">    response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第六阶段</h1><p><a href="verse01.html">第一节 注册页面用户名唯一性检查优化</a></p><p><a href="verse02.html">第二节 加入购物车</a></p><p><a href="verse03.html">第三节 显示购物车数据</a></p><p><a href="../index.html">返回上一级</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore06/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 注册页面用户名唯一性检查优化</h1><h2 id="1、准备工作">1、准备工作</h2><ul><li>创建module</li><li>迁移代码</li></ul><h2 id="2、加入Ajax开发环境">2、加入Ajax开发环境</h2><h3 id="①前端所需axios库">①前端所需axios库</h3><p><img src="./images/img001.png" alt="./images"></p><h3 id="②后端所需Gson库">②后端所需Gson库</h3><p><img src="./images/img002.png" alt="./images"></p><h2 id="3、封装AjaxCommonsResult">3、封装AjaxCommonsResult</h2><h3 id="①模型的作用">①模型的作用</h3><p>在整个项目中，凡是涉及到给Ajax请求返回响应，我们都封装到AjaxCommonsResult类型中。</p><h3 id="②模型的代码">②模型的代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxCommonResult</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FAILED</span> <span class="operator">=</span> <span class="string">&quot;FAILED&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br></pre></td></tr></table></figure><p>各个属性的含义：</p><table><thead><tr><th>属性名</th><th>含义</th></tr></thead><tbody><tr><td>SUCCESS</td><td>代表服务器端处理请求成功</td></tr><tr><td>FAILED</td><td>代表服务器端处理请求失败</td></tr><tr><td>result</td><td>服务器端处理请求的结果，取值在SUCCESS和FAILED二者中选择一个</td></tr><tr><td>message</td><td>失败消息</td></tr><tr><td>data</td><td>针对查询操作返回的数据</td></tr></tbody></table><h3 id="③模型的好处">③模型的好处</h3><ul><li>作为整个团队开发过程中，前后端交互时使用的统一的数据格式</li><li>有利于团队成员之间的协助，提高开发效率</li></ul><h2 id="4、功能实现">4、功能实现</h2><h3 id="①定位功能的位置">①定位功能的位置</h3><p>在用户输入用户名之后，立即检查这个用户名是否可用。</p><h3 id="②思路">②思路</h3><h4 id="1-给用户名输入框绑定的事件类型">[1]给用户名输入框绑定的事件类型</h4><p>结论：不能在针对username设定的watch中发送Ajax请求。</p><p>原因：服务器端响应的速度跟不上用户输入的速度，而且服务器端异步返回响应数据，无法保证和用户输入的顺序完全一致。此时有下面几点问题：</p><ul><li>给服务器增加不必要的压力</li><li>用户输入的数据在输入过程中是不断发生变化的</li><li>响应数据和输入顺序不对应，会发生错乱</li></ul><p>解决办法：绑定的事件类型使用『值改变』事件。</p><h4 id="2-流程图">[2]流程图</h4><p><img src="./images/img004.png" alt="./images"></p><h3 id="③代码实现">③代码实现</h3><h4 id="0-在当前页面引入axios库文件">[0]在当前页面引入axios库文件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/script/axios.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-给用户名输入框绑定值改变事件">[1]给用户名输入框绑定值改变事件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;usernameUniqueCheck&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-JavaScript代码">[2]JavaScript代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> registerApp = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#registerForm&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;[[$&#123;param.username&#125;]]&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;passwordConfirm&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;email&quot;</span>:<span class="string">&quot;[[$&#123;param.email&#125;]]&quot;</span>,</span><br><span class="line"><span class="string">&quot;code&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;usernameCheckMessage&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;watch&quot;</span>:&#123;……&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">……,</span><br><span class="line">……,</span><br><span class="line"><span class="string">&quot;usernameUniqueCheck&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户在文本框中输入的数据</span></span><br><span class="line"><span class="keyword">var</span> username = <span class="variable language_">this</span>.<span class="property">username</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送Ajax请求执行检查</span></span><br><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line"><span class="string">&quot;method&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line"><span class="string">&quot;url&quot;</span>:<span class="string">&quot;UserServlet&quot;</span>,</span><br><span class="line"><span class="string">&quot;params&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;method&quot;</span>:<span class="string">&quot;checkUsernameUnique&quot;</span>,</span><br><span class="line"><span class="string">&quot;username&quot;</span>:username</span><br><span class="line">&#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.从响应数据中获取请求处理结果</span></span><br><span class="line"><span class="keyword">var</span> result = response.<span class="property">data</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.判断result的值</span></span><br><span class="line"><span class="keyword">if</span> (result == <span class="string">&quot;SUCCESS&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.用户名可用</span></span><br><span class="line"><span class="comment">// 注意：现在我们在then()的回调函数中，this已经不再指向Vue对象了</span></span><br><span class="line"><span class="comment">// 所以，我们通过Vue对象的变量名来访问Vue对象</span></span><br><span class="line">registerApp.<span class="property">usernameCheckMessage</span> = <span class="string">&quot;用户名可用&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.用户名不可用</span></span><br><span class="line">registerApp.<span class="property">usernameCheckMessage</span> = response.<span class="property">data</span>.<span class="property">message</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3-UserServlet">[3]UserServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">checkUsernameUnique</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    AjaxCommonResult&lt;String&gt; ajaxResult = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 2.调用Service方法检查用户名是否被占用</span></span><br><span class="line">        userService.checkUsernameUnique(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.按照检测成功的结果创建AjaxCommonResult对象</span></span><br><span class="line">        ajaxResult = <span class="keyword">new</span> <span class="title class_">AjaxCommonResult</span>&lt;&gt;(AjaxCommonResult.SUCCESS, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.按照检测失败的结果创建AjaxCommonResult对象</span></span><br><span class="line">        ajaxResult = <span class="keyword">new</span> <span class="title class_">AjaxCommonResult</span>&lt;&gt;(AjaxCommonResult.FAILED, e.getMessage(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.根据ajaxResult对象返回响应数据</span></span><br><span class="line">    <span class="comment">// ①创建Gson对象</span></span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ②执行JSON数据转换</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> gson.toJson(ajaxResult);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ③设置响应体内容类型</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-UserService">[4]UserService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkUsernameUnique</span><span class="params">(String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectUserByName(username);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名已经被占用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 结账</h1><h2 id="1、创建订单模型">1、创建订单模型</h2><h3 id="①物理建模">①物理建模</h3><h4 id="1-t-order表">[1]t_order表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order(</span><br><span class="line">order_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">order_sequence <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">create_time <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">total_count <span class="type">INT</span>,</span><br><span class="line">total_amount <span class="keyword">DOUBLE</span>,</span><br><span class="line">order_status <span class="type">INT</span>,</span><br><span class="line">user_id <span class="type">INT</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><table><thead><tr><th>字段名</th><th>字段作用</th></tr></thead><tbody><tr><td>order_id</td><td>主键</td></tr><tr><td>order_sequence</td><td>订单号</td></tr><tr><td>create_time</td><td>订单创建时间</td></tr><tr><td>total_count</td><td>订单的总数量</td></tr><tr><td>total_amount</td><td>订单的总金额</td></tr><tr><td>order_status</td><td>订单的状态</td></tr><tr><td>user_id</td><td>下单的用户的id</td></tr></tbody></table><ul><li>虽然order_sequence也是一个不重复的数值，但是不使用它作为主键。数据库表的主键要使用没有业务功能的字段来担任。</li><li>订单的状态<ul><li>待支付（书城项目中暂不考虑）</li><li>已支付，待发货：0</li><li>已发货：1</li><li>确认收货：2</li><li>发起退款或退货（书城项目中暂不考虑）</li></ul></li><li>用户id<ul><li>从逻辑和表结构的角度来说，这其实是一个外键。</li><li>但是开发过程中建议先不要加外键约束：因为开发过程中数据尚不完整，加了外键约束开发过程中使用测试数据非常不方便，建议项目预发布时添加外键约束测试。</li></ul></li></ul><h4 id="2-t-order-item表">[2]t_order_item表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order_item(</span><br><span class="line">item_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">book_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">price <span class="keyword">DOUBLE</span>,</span><br><span class="line">img_path <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">item_count <span class="type">INT</span>,</span><br><span class="line">item_amount <span class="keyword">DOUBLE</span>,</span><br><span class="line">order_id <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><table><thead><tr><th>字段名称</th><th>字段作用</th></tr></thead><tbody><tr><td>item_id</td><td>主键</td></tr><tr><td>book_name</td><td>书名</td></tr><tr><td>price</td><td>单价</td></tr><tr><td>item_count</td><td>当前订单项的数量</td></tr><tr><td>item_amount</td><td>当前订单项的金额</td></tr><tr><td>order_id</td><td>当前订单项关联的订单表的主键</td></tr></tbody></table><p>说明：book_name、author、price这三个字段其实属于t_book表，我们把它们加入到t_order_item表中，其实并不符合数据库设计三大范式。这里做不符合规范的操作的原因是：将这几个字段加入当前表就不必在显示数据时和t_book表做关联查询，提高查询的效率，这是一种变通的做法。</p><h3 id="②逻辑模型">②逻辑模型</h3><h4 id="1-Order类">[1]Order类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer orderId;</span><br><span class="line">    <span class="keyword">private</span> String orderSequence;</span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line">    <span class="keyword">private</span> Integer totalCount;</span><br><span class="line">    <span class="keyword">private</span> Double totalAmount;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">orderStatus</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br></pre></td></tr></table></figure><h4 id="2-OrdrItem类">[2]OrdrItem类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer itemId;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String imgPath;</span><br><span class="line">    <span class="keyword">private</span> Integer itemCount;</span><br><span class="line">    <span class="keyword">private</span> Double itemAmount;</span><br><span class="line">    <span class="keyword">private</span> Integer orderId;</span><br></pre></td></tr></table></figure><h2 id="2、创建组件">2、创建组件</h2><h3 id="①持久化层">①持久化层</h3><p><img src="./images/img003.png" alt="./images"></p><h3 id="②业务逻辑层">②业务逻辑层</h3><p><img src="./images/img004.png" alt="./images"></p><h3 id="③表述层">③表述层</h3><p><img src="./images/img005.png" alt="./images"></p><h2 id="3、结账功能">3、结账功能</h2><h3 id="①具体操作清单">①具体操作清单</h3><ul><li>创建订单对象</li><li>给订单对象填充数据<ul><li>生成订单号</li><li>生成订单的时间</li><li>从购物车迁移总数量和总金额</li><li>从已登录的User对象中获取userId并设置到订单对象中</li></ul></li><li>将订单对象保存到数据库中</li><li>获取订单对象在数据库中自增主键的值</li><li>根据购物车中的CartItem集合逐个创建OrderItem对象<ul><li>每个OrderItem对象对应的orderId属性都使用前面获取的订单数据的自增主键的值</li></ul></li><li>把OrderItem对象的集合保存到数据库</li><li>每一个item对应的图书增加销量</li><li>每一个item对应的图书减少库存</li><li>清空购物车</li></ul><h3 id="②思路">②思路</h3><p><img src="./images/img006.png" alt="./images"></p><h3 id="③代码实现">③代码实现</h3><h4 id="1-购物车页面结账超链接">[1]购物车页面结账超链接</h4><p>cart.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;pay&quot;</span> <span class="attr">href</span>=<span class="string">&quot;protected/OrderClientServlet?method=checkout&quot;</span>&gt;</span>去结账<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-OrderClientServlet-checkout">[2]OrderClientServlet.checkout()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取HttpSession对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cart == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.获取已登录的用户对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.调用Service方法执行结账的业务逻辑</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderSequence</span> <span class="operator">=</span> orderService.checkout(cart, user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.清空购物车</span></span><br><span class="line">    session.removeAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.将订单号存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;orderSequence&quot;</span>, orderSequence);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.将页面跳转到下单成功页面</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/checkout&quot;</span>;</span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-OrderService-checkout">[3]OrderService.checkout()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">checkout</span><span class="params">(Cart cart, User user)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从User对象中获取userId</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> user.getUserId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建订单对象</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给订单对象填充数据</span></span><br><span class="line">    <span class="comment">// 生成订单号=系统时间戳</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderSequence</span> <span class="operator">=</span> System.currentTimeMillis() + <span class="string">&quot;_&quot;</span> + userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成订单的时间</span></span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">createTime</span> <span class="operator">=</span> simpleDateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从购物车迁移总数量和总金额</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">totalCount</span> <span class="operator">=</span> cart.getTotalCount();</span><br><span class="line">    <span class="type">Double</span> <span class="variable">totalAmount</span> <span class="operator">=</span> cart.getTotalAmount();</span><br><span class="line"></span><br><span class="line">    order.setOrderSequence(orderSequence);</span><br><span class="line">    order.setCreateTime(createTime);</span><br><span class="line">    order.setTotalCount(totalCount);</span><br><span class="line">    order.setTotalAmount(totalAmount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将订单对象保存到数据库中</span></span><br><span class="line">    <span class="comment">// ※说明：这里对insertOrder()方法的要求是获取自增的主键并将自增主键的值设置到Order对象的orderId属性中</span></span><br><span class="line">    orderDao.insertOrder(order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取订单对象在数据库中自增主键的值</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">orderId</span> <span class="operator">=</span> order.getOrderId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据购物车中的CartItem集合逐个创建OrderItem对象</span></span><br><span class="line">    Map&lt;String, CartItem&gt; cartItemMap = cart.getCartItemMap();</span><br><span class="line">    Collection&lt;CartItem&gt; cartItems = cartItemMap.values();</span><br><span class="line">    List&lt;CartItem&gt; cartItemList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(cartItems);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了便于批量保存OrderItem，创建Object[][]</span></span><br><span class="line">    <span class="comment">// 二维数组第一维：SQL语句的数量</span></span><br><span class="line">    <span class="comment">// 二维数组第二维：SQL语句中参数的数量</span></span><br><span class="line">    Object[][] saveOrderItemParamArr = <span class="keyword">new</span> <span class="title class_">Object</span>[cartItems.size()][<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了便于批量更新Book，创建Object[][]</span></span><br><span class="line">    Object[][] updateBookParamArr = <span class="keyword">new</span> <span class="title class_">Object</span>[cartItems.size()][<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; cartItemList.size(); i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemList.get(i);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为保存OrderItem创建Object[]</span></span><br><span class="line">        Object[] orderItemParam = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// book_name,price,img_path,item_count,item_amount,order_id</span></span><br><span class="line">        orderItemParam[<span class="number">0</span>] = cartItem.getBookName();</span><br><span class="line">        orderItemParam[<span class="number">1</span>] = cartItem.getPrice();</span><br><span class="line">        orderItemParam[<span class="number">2</span>] = cartItem.getImgPath();</span><br><span class="line">        orderItemParam[<span class="number">3</span>] = cartItem.getCount();</span><br><span class="line">        orderItemParam[<span class="number">4</span>] = cartItem.getAmount();</span><br><span class="line">        orderItemParam[<span class="number">5</span>] = orderId;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将一维数组存入二维数组中</span></span><br><span class="line">        saveOrderItemParamArr[i] = orderItemParam;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建数组用于保存更新Book数据的信息</span></span><br><span class="line">        String[] bookUpdateInfoArr = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增加的销量</span></span><br><span class="line">        bookUpdateInfoArr[<span class="number">0</span>] = cartItem.getCount() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 减少的库存</span></span><br><span class="line">        bookUpdateInfoArr[<span class="number">1</span>] = cartItem.getCount() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// bookId</span></span><br><span class="line">        bookUpdateInfoArr[<span class="number">2</span>] = cartItem.getBookId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将数组存入List集合</span></span><br><span class="line">        updateBookParamArr[i] = bookUpdateInfoArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把OrderItem对象的集合保存到数据库：批量操作</span></span><br><span class="line">    orderItemDao.insertOrderItemArr(saveOrderItemParamArr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用bookUpdateInfoList对图书数据的表执行批量更新操作</span></span><br><span class="line">    bookDao.updateBookByParamArr(updateBookParamArr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回订单号</span></span><br><span class="line">    <span class="keyword">return</span> orderSequence;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-orderDao-insertOrder-order">[4]orderDao.insertOrder(order)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※DBUtils没有封装获取自增主键的方法，需要我们使用原生的JDBC来完成</span></span><br><span class="line">    <span class="comment">// 1.获取数据库连接</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建PreparedStatement对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO t_order(order_sequence,create_time,total_count,total_amount,order_status,user_id) VALUES(?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ①创建PreparedStatement对象，指明需要自增的主键</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql, PreparedStatement.RETURN_GENERATED_KEYS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②给PreparedStatement对象设置SQL语句的参数</span></span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, order.getOrderSequence());</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>, order.getCreateTime());</span><br><span class="line">        preparedStatement.setInt(<span class="number">3</span>, order.getTotalCount());</span><br><span class="line">        preparedStatement.setDouble(<span class="number">4</span>, order.getTotalAmount());</span><br><span class="line">        preparedStatement.setInt(<span class="number">5</span>, order.getOrderStatus());</span><br><span class="line">        preparedStatement.setInt(<span class="number">6</span>, order.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③执行更新</span></span><br><span class="line">        preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ④获取封装了自增主键的结果集</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">generatedKeysResultSet</span> <span class="operator">=</span> preparedStatement.getGeneratedKeys();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑤解析结果集</span></span><br><span class="line">        <span class="keyword">if</span> (generatedKeysResultSet.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">orderId</span> <span class="operator">=</span> generatedKeysResultSet.getInt(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            order.setOrderId(orderId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtils.releaseConnection(connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-BaseDao-batchUpdate">[5]BaseDao.batchUpdate()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用的批量增删改方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 执行批量操作的二维数组</span></span><br><span class="line"><span class="comment"> *               每一条SQL语句的参数是一维数组</span></span><br><span class="line"><span class="comment"> *               多条SQL语句的参数就是二维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 每一条SQL语句返回的受影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] batchUpdate(String sql, Object[][] params) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span>[] rowCountArr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rowCountArr = queryRunner.batch(connection, sql, params);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtils.releaseConnection(connection);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> rowCountArr;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-orderItemDao-insertOrderItemArr-saveOrderItemParamArr">[6]orderItemDao.insertOrderItemArr(saveOrderItemParamArr)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertOrderItemArr</span><span class="params">(Object[][] saveOrderItemParamArr)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO t_order_item(book_name,price,img_path,item_count,item_amount,order_id) VALUES(?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>.batchUpdate(sql, saveOrderItemParamArr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-bookDao-updateBookByParamArr-updateBookParamArr">[7]bookDao.updateBookByParamArr(updateBookParamArr)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBookByParamArr</span><span class="params">(Object[][] updateBookParamArr)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_book set sales=sales+?,stock=stock-? where book_id=?&quot;</span>;</span><br><span class="line">    <span class="built_in">super</span>.batchUpdate(sql, updateBookParamArr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 结账过程中使用事务（重要）</h1><h2 id="1、事务回顾">1、事务回顾</h2><h3 id="①ACID属性">①ACID属性</h3><ul><li><p>A：原子性 事务中包含的数据库操作缺一不可，整个事务是不可再分的。</p></li><li><p>C：一致性 事务执行之前，数据库中的数据整体是正确的；事务执行之后，数据库中的数据整体仍然是正确的。</p><ul><li>事务执行成功：提交（commit）</li><li>事务执行失败：回滚（rollback）</li></ul></li><li><p>I：隔离性 数据库系统同时执行很多事务时，各个事务之间基于不同隔离级别能够在一定程度上做到互不干扰。简单说就是：事务在并发执行过程中彼此隔离。</p></li><li><p>D：持久性 事务一旦提交，就永久保存到数据库中，不可撤销。</p></li></ul><h3 id="②隔离级别">②隔离级别</h3><h4 id="1-并发问题">[1]并发问题</h4><table><thead><tr><th>并发问题</th><th>问题描述</th></tr></thead><tbody><tr><td>脏读</td><td>当前事务读取了其他事务尚未提交的修改<br />如果那个事务回滚，那么当前事务读取到的修改就是错误的数据</td></tr><tr><td>不可重复读</td><td>当前事务读取同一个数据，第一次和第二次不一致</td></tr><tr><td>幻读</td><td>当前事务在执行过程中，数据库表增减或减少了一些记录，感觉像是出现了幻觉</td></tr></tbody></table><h4 id="2-隔离级别">[2]隔离级别</h4><table><thead><tr><th>隔离级别</th><th>描述</th><th>能解决的并发问题</th></tr></thead><tbody><tr><td>读未提交</td><td>允许当前事务读取其他事务尚未提交的修改</td><td>啥问题也解决不了</td></tr><tr><td>读已提交</td><td>允许当前事务读取其他事务已经提交的修改</td><td>脏读</td></tr><tr><td>可重复读</td><td>当前事务执行时锁定当前记录，不允许其他事务操作</td><td>脏读、不可重复读</td></tr><tr><td>串行化</td><td>当前事务执行时锁定当前表，不允许其他事务操作</td><td>脏读、不可重复读、幻读</td></tr></tbody></table><h2 id="2、JDBC事务控制">2、JDBC事务控制</h2><h3 id="①同一个数据库连接">①同一个数据库连接</h3><p><img src="./images/img007.png" alt="./images"></p><h3 id="②关闭事务的自动提交">②关闭事务的自动提交</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.setAutoCommit(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h3 id="③提交事务">③提交事务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.commit();</span><br></pre></td></tr></table></figure><h3 id="④回滚事务">④回滚事务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.rollBack();</span><br></pre></td></tr></table></figure><h3 id="⑤事务整体的代码块">⑤事务整体的代码块</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关闭事务的自动提交</span></span><br><span class="line">    connection.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 事务中包含的所有数据库操作</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">    connection.commit();</span><br><span class="line">&#125;<span class="keyword">catch</span>(Excetion e)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 回滚事务</span></span><br><span class="line">    connection.rollBack();</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放数据库连接</span></span><br><span class="line">    connection.close();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、将事务对接到书城项目中">3、将事务对接到书城项目中</h2><h3 id="①三层架构中事务要对接的位置">①三层架构中事务要对接的位置</h3><p>从逻辑上来说，一个事务对应一个业务方法（Service层的一个方法）。</p><p><img src="./images/img008.png" alt="./images"></p><h3 id="②假想">②假想</h3><p>每一个Service方法内部，都套用了事务操作所需要的try…catch…finally块。</p><h3 id="③假想代码的缺陷">③假想代码的缺陷</h3><ul><li>会出现大量的冗余代码：我们希望能够抽取出来，只写一次</li><li>对核心业务功能是一种干扰：我们希望能够在编写业务逻辑代码时专注于业务本身，而不必为辅助性质的套路代码分心</li><li>将持久化层对数据库的操作写入业务逻辑层，是对业务逻辑层的一种污染，导致持久化层和业务逻辑层耦合在一起</li></ul><h3 id="④事务代码抽取">④事务代码抽取</h3><ul><li>只要是Filter拦截到的请求都会从doFilter()方法经过</li><li>chain.doFilter(req, resp);可以包裹住将来要执行的所有方法</li><li>事务操作的try…catch…finally块只要把chain.doFilter(req, resp)包住，就能够包住将来要执行的所有方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 关闭事务的自动提交</span></span><br><span class="line">        connection.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 『事务中包含的所有数据库操作』就在chain.doFilter(req, resp);将来要调用的方法中</span></span><br><span class="line">        <span class="comment">// 所以用事务的try...catch...finally块包住chain.doFilter(req, resp);</span></span><br><span class="line">        <span class="comment">// 就能让所有事务方法都『享受』到事务功能的『服务』。</span></span><br><span class="line">        <span class="comment">// 所谓框架其实就是把常用的『套路代码』抽取出来，为大家服务，我们享受框架服务提高开发效率。</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        connection.commit();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Excetion e)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        connection.rollBack();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放数据库连接</span></span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑤在Filter中获取数据库连接">⑤在Filter中获取数据库连接</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 关闭事务的自动提交</span></span><br><span class="line">        connection.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 『事务中包含的所有数据库操作』就在chain.doFilter(req, resp);将来要调用的方法中</span></span><br><span class="line">        <span class="comment">// 所以用事务的try...catch...finally块包住chain.doFilter(req, resp);</span></span><br><span class="line">        <span class="comment">// 就能让所有事务方法都『享受』到事务功能的『服务』。</span></span><br><span class="line">        <span class="comment">// 所谓框架其实就是把常用的『套路代码』抽取出来，为大家服务，我们享受框架服务提高开发效率。</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        connection.commit();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Excetion e)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 回滚事务</span></span><br><span class="line">        connection.rollBack();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放数据库连接</span></span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑥保证所有数据库操作使用同一个连接">⑥保证所有数据库操作使用同一个连接</h3><p><span style="color:blue;font-weight:bold;">『重要发现』</span>：在书城项目中所有执行SQL语句的代码都是通过<span style="color:blue;font-weight:bold;">JDBCUtils.getConnection()</span>方法获取数据库连接。所以我们可以通过<span style="color:blue;font-weight:bold;">重构JDBCUtils.getConnection()</span>方法实现：所有数据库操作使用同一个连接。</p><p><img src="./images/img009.png" alt="./images"></p><h4 id="1-从数据源中只拿出一个">[1]从数据源中只拿出一个</h4><p>为了保证各个需要Connection对象的地方使用的都是同一个对象，我们从数据源中只获取一个Connection。不是说整个项目只用一个Connection，而是说调用JDBCUtils.getConnection()方法时，只使用一个。所以落实到代码上就是：每次调用getConnection()方法时先检查是否已经拿过了，拿过就给旧的，没拿过给新的。</p><h4 id="2-公共区域">[2]公共区域</h4><p>为了保证各个方法中需要Connection对象时都能拿到同一个对象，需要做到：将唯一的对象存入一个大家都能接触到的地方。</p><p><img src="./images/img010.png" alt="./images"></p><p><span style="color:blue;font-weight:bold;">结论</span>：使用<span style="color:blue;font-weight:bold;">线程本地化</span>技术实现Connection对象从上到下传递。</p><h3 id="⑦线程本地化">⑦线程本地化</h3><h4 id="1-确认同一个线程">[1]确认同一个线程</h4><p>在从Filter、Servlet、Service一直到Dao运行的过程中，我们始终都没有做类似new Thread().start()这样开启新线程的操作，所以整个过程在同一个线程中。</p><h4 id="2-一条小河">[2]一条小河</h4><p><img src="./images/img011.png" alt="./images"></p><h4 id="3-一个线程">[3]一个线程</h4><p><img src="./images/img012.png" alt="./images"></p><h4 id="4-代码">[4]代码</h4><p>java.lang.ThreadLocal的set()方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>java.lang.TheadLocal的get()方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以TheadLocal的基本原理是：它在内部维护了一个Map，需要存入数据时，就以this为键，要存入的数据为值，存入Map。需要取出数据时，就以this为键，从Map中取出数据。</p><h4 id="5-结论">[5]结论</h4><p>如果我们需要将数据在整个项目中按照<span style="color:blue;font-weight:bold;">从上到下</span>的方式传递，但是又<span style="color:blue;font-weight:bold;">没法通过方法的参数</span>来实现，这时使用线程本地化技术是一个非常好的选择。</p><h3 id="⑧异常向上抛出的线路">⑧异常向上抛出的线路</h3><p><img src="./images/img013.png" alt="./images"></p><p>上图中标记颜色的位置都是有try…catch块的代码，需要逐个检查一下，catch块捕获的异常是否转换为运行时异常又再次抛出。</p><p>如果没有抛出，异常就不会传递到Filter中，TransactionFilter就会认为代码执行过程中没有发生问题，从而提交事务，但是实际上应该回滚。下面是一个例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用的批量增删改方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 执行批量操作的二维数组</span></span><br><span class="line"><span class="comment"> *               每一条SQL语句的参数是一维数组</span></span><br><span class="line"><span class="comment"> *               多条SQL语句的参数就是二维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 每一条SQL语句返回的受影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] batchUpdate(String sql, Object[][] params) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] rowCountArr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        rowCountArr = queryRunner.batch(connection, sql, params);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtils.releaseConnection(connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rowCountArr;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、代码实现">4、代码实现</h2><h3 id="①重构JDBCUtils类">①重构JDBCUtils类</h3><ul><li>要点1：将ThreadLocal对象声明为静态成员变量</li><li>要点2：重构获取数据库连接的方法</li><li>要点3：重构释放数据库连接的方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 功能1：创建数据源对象</span></span><br><span class="line"><span class="comment"> * 功能2：获取数据库连接并绑定到当前线程上</span></span><br><span class="line"><span class="comment"> * 功能3：释放数据库连接并从当前线程移除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数据源对象设置为静态属性，保证大对象的单一实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将ThreadLocal对象设置为静态成员变量，保证以此为键时从Map中取值能够取到同一个值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建一个用于存储外部属性文件信息的Properties对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用当前类的类加载器加载外部属性文件：jdbc.properties</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> JDBCUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.将外部属性文件jdbc.properties中的数据加载到properties对象中</span></span><br><span class="line">            properties.load(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.创建数据源对象</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从数据源中获取数据库连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据库连接对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.尝试从当前线程获取Connection对象</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> threadLocal.get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connection == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 2.如果从当前线程上没有获取到Connection对象那么从数据源获取</span></span><br><span class="line">                connection = dataSource.getConnection();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3.将Connection对象绑定到当前线程</span></span><br><span class="line">                threadLocal.set(connection);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.返回Connection对象</span></span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放数据库连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection 要执行释放操作的连接对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">releaseConnection</span><span class="params">(Connection connection)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将Connection对象从当前线程移除</span></span><br><span class="line">                threadLocal.remove();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="②重构BaseDao">②重构BaseDao</h3><ul><li>要点：去除释放数据库连接的操作（转移到TransactionFilter中）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 各个具体Dao类的基类，泛型T对应具体实体类类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseDao</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用的批量增删改方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params 执行批量操作的二维数组</span></span><br><span class="line"><span class="comment">     *               每一条SQL语句的参数是一维数组</span></span><br><span class="line"><span class="comment">     *               多条SQL语句的参数就是二维数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 每一条SQL语句返回的受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] batchUpdate(String sql, Object[][] params) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] rowCountArr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            rowCountArr = queryRunner.batch(connection, sql, params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="comment">/* finally &#123;</span></span><br><span class="line"><span class="comment">            JDBCUtils.releaseConnection(connection);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rowCountArr;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用的增删改方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 要执行的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param 为SQL语句准备好的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">updatedRowCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            updatedRowCount = queryRunner.update(connection, sql, param);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 为了让上层方法调用方便，将编译时异常捕获</span></span><br><span class="line">        <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 为了不掩盖问题，将编译时异常封装为运行时异常抛出</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="comment">/* finally &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            // 关闭数据库连接</span></span><br><span class="line"><span class="comment">            JDBCUtils.releaseConnection(connection);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> updatedRowCount;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询单个对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 单个对象所对应的实体类类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   查询单个对象所需要的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param SQL语句的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      查询到的单个对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            t = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="comment">/* finally &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            // 关闭数据库连接</span></span><br><span class="line"><span class="comment">            JDBCUtils.releaseConnection(connection);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询集合对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 集合中单个对象所对应的实体类类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   查询集合所需要的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param SQL语句的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      查询到的集合对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getBeanList</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; list = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            list = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="comment">/* finally &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            // 关闭数据库连接</span></span><br><span class="line"><span class="comment">            JDBCUtils.releaseConnection(connection);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">注意</span>：OrderDao中insertOrder()方法也要去掉关闭数据库连接的操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※DBUtils没有封装获取自增主键的方法，需要我们使用原生的JDBC来完成</span></span><br><span class="line">    <span class="comment">// 1.获取数据库连接</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建PreparedStatement对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INS222ERT INTO t_order(order_sequence,create_time,total_count,total_amount,order_status,user_id) VALUES(?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ①创建PreparedStatement对象，指明需要自增的主键</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql, PreparedStatement.RETURN_GENERATED_KEYS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②给PreparedStatement对象设置SQL语句的参数</span></span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, order.getOrderSequence());</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>, order.getCreateTime());</span><br><span class="line">        preparedStatement.setInt(<span class="number">3</span>, order.getTotalCount());</span><br><span class="line">        preparedStatement.setDouble(<span class="number">4</span>, order.getTotalAmount());</span><br><span class="line">        preparedStatement.setInt(<span class="number">5</span>, order.getOrderStatus());</span><br><span class="line">        preparedStatement.setInt(<span class="number">6</span>, order.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ③执行更新</span></span><br><span class="line">        preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ④获取封装了自增主键的结果集</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">generatedKeysResultSet</span> <span class="operator">=</span> preparedStatement.getGeneratedKeys();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ⑤解析结果集</span></span><br><span class="line">        <span class="keyword">if</span> (generatedKeysResultSet.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">orderId</span> <span class="operator">=</span> generatedKeysResultSet.getInt(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            order.setOrderId(orderId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="comment">/*finally &#123;</span></span><br><span class="line"><span class="comment">        JDBCUtils.releaseConnection(connection);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③创建一个用于显示通用错误信息的页面">③创建一个用于显示通用错误信息的页面</h3><h4 id="1-创建页面">[1]创建页面</h4><p>这个页面可以从login_success.html复制过来</p><p><img src="./images/img015.png" alt="./images"></p><h4 id="2-创建Servlet跳转到页面">[2]创建Servlet跳转到页面</h4><p><img src="./images/img016.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">showSystemError</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④创建TransactionFilter">④创建TransactionFilter</h3><p><img src="./images/img014.png" alt="./images"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.atguigu.bookstore.filter.TransactionFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>TransactionFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Java代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; PUBLIC_STATIC_RESOURCE_EXT_NAME_SET = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.add(<span class="string">&quot;.png&quot;</span>);</span><br><span class="line">        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.add(<span class="string">&quot;.css&quot;</span>);</span><br><span class="line">        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.add(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.add(<span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.add(<span class="string">&quot;.gif&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 排除掉静态资源，它们和数据库操作没有关系</span></span><br><span class="line">        <span class="comment">// 1.给请求和响应对象转换类型</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) req;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) resp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.获取当前请求的ServletPath</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.检查servletPath中是否包含“.”</span></span><br><span class="line">        <span class="keyword">if</span> (servletPath.contains(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">extensionName</span> <span class="operator">=</span> servletPath.substring(index);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (PUBLIC_STATIC_RESOURCE_EXT_NAME_SET.contains(extensionName)) &#123;</span><br><span class="line">                chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行事务操作</span></span><br><span class="line">        <span class="comment">// 1.获取数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用try...catch...finally块管理事务</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.关闭事务的自动提交</span></span><br><span class="line">            connection.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.尝试执行目标代码</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.如果上面的操作没有抛出异常</span></span><br><span class="line">            connection.commit();</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6.如果上面的操作抛出了异常</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.rollback();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7.捕获到异常后，跳转到专门的页面显示提示消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> e.getMessage();</span><br><span class="line">            request.setAttribute(<span class="string">&quot;error&quot;</span>, message);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/ErrorServlet?method=showSystemError&quot;</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 8.不管前面操作是成功还是失败，到这里都要释放数据库连接</span></span><br><span class="line">            JDBCUtils.releaseConnection(connection);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 登录检查</h1><h2 id="1、目标">1、目标</h2><p>把项目中需要保护的功能保护起来，没有登录不允许访问。但是我们不考虑后台登录检查，仅完成前台登录检查。</p><ul><li>购物车功能</li><li>订单功能</li></ul><h2 id="2、思路">2、思路</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="3、代码实现">3、代码实现</h2><h3 id="①拦截受保护资源的请求">①拦截受保护资源的请求</h3><p>购物车资源地址：/protected/CartServlet</p><p>订单资源地址：/protected/OrderServlet</p><p>Filter拦截的地址：/protected/*</p><h3 id="②对访问购物车资源的地址进行修改">②对访问购物车资源的地址进行修改</h3><h4 id="1-首页加入购物车">[1]首页加入购物车</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/protected/CartServlet(method=addCart,bookId=$&#123;book.bookId&#125;)&#125;&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-首页显示购物车">[2]首页显示购物车</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet?method=showCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-cart-html清空购物车">[3]cart.html清空购物车</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;clearCart&quot;</span> <span class="attr">href</span>=<span class="string">&quot;protected/CartServlet?method=clearCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;clear-cart&quot;</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-cart-html删除超链接">[4]cart.html删除超链接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;removeConfirm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/protected/CartServlet(method=removeItem,bookId=$&#123;cartItemEntry.value.bookId&#125;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-cart-html中Vue代码">[5]cart.html中Vue代码</h4><p>凡是涉及到window.location.href都需要修改：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;protected/CartServlet?method=decrease&amp;bookId=&quot;</span>+bookId;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h3 id="③web-xml中修改CartServlet的url-pattern">③web.xml中修改CartServlet的url-pattern</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CartServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.model.CartServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CartServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/protected/CartServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④创建执行登录检查的Filter">④创建执行登录检查的Filter</h3><h4 id="1-Filter类">[1]Filter类</h4><p><img src="./images/img002.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前请求是否已登录的Filter</span></span><br><span class="line"><span class="comment"> * 由于在web.xml的配置中，这个Filter只拦截/protected开头的路径，</span></span><br><span class="line"><span class="comment"> * 所以，凡是被这个Filter拦截的请求都要求必须登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.将request对象的类型转换为HttpServletRequest</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过httpRequest对象获取HttpSession对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> httpRequest.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.尝试从Session域获取User对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.判断User对象是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.转发到登录页面，提示用户登录后再操作</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;请登录后再操作&quot;</span>);</span><br><span class="line"></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/UserServlet?method=toLoginPage&quot;</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 6.如果User对象存在，说明用户已登录，直接放行</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-注册Filter类">[2]注册Filter类</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>LoginFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.atguigu.bookstore.filter.LoginFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>LoginFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/protected/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore05/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第五阶段</h1><p><a href="verse01.html">第一节 登录检查</a></p><p><a href="verse02.html">第二节 结账</a></p><p><a href="verse03.html">第三节 结账过程中使用事务（重要）</a></p><p><a href="verse04.html">第四节 后台查看订单列表&amp;发货</a></p><p><a href="verse05.html">第五节 前台查看订单列表&amp;确认收货</a></p><p><a href="../index.html">返回上一级</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 保持登录状态</h1><h2 id="1、创建module">1、创建module</h2><ul><li>迁移src目录下的Java代码</li><li>迁移web目录下的static目录</li><li>迁移web/WEB-INF目录下的lib目录和pages目录</li><li>将lib目录下的jar包添加到运行时环境</li><li>将旧的web.xml中的配置复制到新module的web.xml中</li></ul><h2 id="2、将登录成功的User对象存入会话域">2、将登录成功的User对象存入会话域</h2><p><img src="./images/img001.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doLogin</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取用户名和密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.封装为User对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">userForm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, password, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用UserService的方法执行登录验证</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userService.doLogin(userForm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ※保持登录状态，将User对象存入会话域</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注意：不要放错，这里要使用从数据库查询得到的User对象</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;user&quot;</span>, userDB);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.登录成功后跳转到登录成功页面</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/UserServlet?method=toLoginSuccessPage&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.登录失败则显示提示消息</span></span><br><span class="line">        <span class="comment">// ①将登录失败的提示消息存入请求域</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;message&quot;</span>, e.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②执行登录页面的模板渲染</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/login&quot;</span>;</span><br><span class="line"></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、修改欢迎信息">3、修改欢迎信息</h2><h3 id="①登录成功页面">①登录成功页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;um_span&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.username&#125;&quot;</span>&gt;</span>张总<span class="tag">&lt;/<span class="name">span</span>&gt;</span>光临尚硅谷书城<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②首页">②首页</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-right&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.user == null&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toLoginPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toRegisterPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/cart/cart.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span></span><br><span class="line">        购物车</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cart-num&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;AdminServlet?method=toPortalPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--          登录后风格--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-right&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.user != null&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎你<span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.userName&#125;&quot;</span>&gt;</span>张总<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/cart/cart.jsp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span></span><br><span class="line">        购物车</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cart-num&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/manager/book_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、退出登录功能">4、退出登录功能</h2><h3 id="①页面超链接">①页面超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=logout&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②UserServlet-logout">②UserServlet.logout()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退出登录方案一：从会话域移除User对象</span></span><br><span class="line">    <span class="comment">// session.removeAttribute(&quot;user&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退出登录方案二：强制Session对象失效</span></span><br><span class="line">    session.invalidate();</span><br><span class="line"></span><br><span class="line">    processTemplate(<span class="string">&quot;index&quot;</span>, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 购物车</h1><h2 id="1、功能清单">1、功能清单</h2><ul><li>添加购物车</li><li>显示购物车信息</li><li>修改购物车中具体商品的数量</li><li>删除购物车中某个具体商品</li><li>清空购物车</li></ul><h2 id="2、创建购物车模型">2、创建购物车模型</h2><p><img src="./images/img007.png" alt="./images"></p><h3 id="①购物车详情类：CartItem">①购物车详情类：CartItem</h3><p><img src="./images/img008.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartItem</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bookId;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String imgPath;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> Double amount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取金额时需要计算得到</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count * <span class="built_in">this</span>.price;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="②购物车类：Cart">②购物车类：Cart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cart</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, CartItem&gt; cartItemMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加购物车</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCartItem</span><span class="params">(Book book)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取当前Book对象的id值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> book.getBookId() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.根据id值到Map中检查是否已存在</span></span><br><span class="line">        <span class="keyword">if</span> (cartItemMap.containsKey(bookId)) &#123;</span><br><span class="line">            <span class="comment">// 3.如果存在，则给原有的CartItem增加数量</span></span><br><span class="line">            <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(bookId);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">newCount</span> <span class="operator">=</span> cartItem.getCount() + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            cartItem.setCount(newCount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 4.如果不存在，则创建新的CartItem对象</span></span><br><span class="line">            <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CartItem</span>();</span><br><span class="line">            cartItem.setBookId(bookId);</span><br><span class="line">            cartItem.setBookName(book.getBookName());</span><br><span class="line">            cartItem.setCount(<span class="number">1</span>);</span><br><span class="line">            cartItem.setImgPath(book.getImgPath());</span><br><span class="line">            cartItem.setPrice(book.getPrice());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.将新的CartItem对象存入cartItemMap</span></span><br><span class="line">            cartItemMap.put(bookId, cartItem);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从购物车中删除CartItem</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeCartItem</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        cartItemMap.remove(bookId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把某个CartItem的数量修改为指定值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateItemCount</span><span class="params">(String bookId, Integer newCount)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据bookId从Map中获取对应的CartItem对象</span></span><br><span class="line">        <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(bookId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置新的数量值</span></span><br><span class="line">        cartItem.setCount(newCount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把某个CartItem的数量+1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">itemCountIncrease</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(bookId);</span><br><span class="line"></span><br><span class="line">        cartItem.setCount(cartItem.getCount() + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把某个CartItem的数量-1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">itemCountDecrease</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(bookId);</span><br><span class="line"></span><br><span class="line">        cartItem.setCount(cartItem.getCount() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cartItem.getCount() == <span class="number">0</span>) &#123;</span><br><span class="line">            removeCartItem(bookId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, CartItem&gt; <span class="title function_">getCartItemMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cartItemMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算总数量</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getTotalCount</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.声明一个变量用于存储累加结果</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.遍历Map集合</span></span><br><span class="line">        Set&lt;String&gt; keySet = cartItemMap.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">            <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(key);</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> cartItem.getCount();</span><br><span class="line">            sum = sum + count;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.返回累加结果</span></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算总金额</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getTotalAmount</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.声明一个变量用于存储累加结果</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.遍历Map集合</span></span><br><span class="line">        Set&lt;String&gt; keySet = cartItemMap.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">            <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(key);</span><br><span class="line">            <span class="type">Double</span> <span class="variable">amount</span> <span class="operator">=</span> cartItem.getAmount();</span><br><span class="line"></span><br><span class="line">            sum = sum + amount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.返回累加结果</span></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、添加购物车功能">3、添加购物车功能</h2><h3 id="①目标">①目标</h3><p>在首页点击『加入购物车』将该条图书加入『购物车』。</p><h3 id="②思路">②思路</h3><p>首页→加入购物车→CartServlet.addCart()→执行添加操作→回到首页</p><h3 id="③代码实现">③代码实现</h3><h4 id="1-创建CartServlet">[1]创建CartServlet</h4><p><img src="./images/img009.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCart</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.从请求参数中获取bookId</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.根据bookId查询图书数据</span></span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getBookById(bookId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.尝试从Session域获取购物车对象</span></span><br><span class="line">        <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.判断Cart对象是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (cart == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6.如果不存在，则创建新的Cart对象</span></span><br><span class="line">            cart = <span class="keyword">new</span> <span class="title class_">Cart</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7.将新创建的Cart对象存入Session域</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 8.添加购物车</span></span><br><span class="line">        cart.addCartItem(book);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 9.回首页</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-index-html页面">[2]index.html页面</h4><p>购物车数量显示：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--          登录后风格--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;topbar-right&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.user != null&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎你<span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.user.userName&#125;&quot;</span>&gt;</span>张总<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/cart/cart.jsp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span></span><br><span class="line">        购物车</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cart-num&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.cart != null&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.cart.totalCount&#125;&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pages/manager/book_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;admin&quot;</span>&gt;</span>后台管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>加入购物车：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-content&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;book : $&#123;bookList&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;book.imgPath&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/uploads/huozhe.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>书名:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span>&gt;</span>活着<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>作者:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.author&#125;&quot;</span>&gt;</span>余华<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>价格:￥<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.price&#125;&quot;</span>&gt;</span>66.6<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>销量:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.sales&#125;&quot;</span>&gt;</span>230<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>库存:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.stock&#125;&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;button&gt;加入购物车&lt;/button&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/CartServlet(method=addCart,bookId=$&#123;book.bookId&#125;)&#125;&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④CSS样式">④CSS样式</h3><p><img src="./images/img010.png" alt="./images"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.books-list</span> <span class="selector-class">.list-content</span> <span class="selector-class">.list-item</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#39987c</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">cursor</span>:pointer;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果修改完成后页面效果没有改变，可以使用Ctrl+F5强制刷新。</p><h2 id="4、显示购物车页面">4、显示购物车页面</h2><h3 id="①目标-2">①目标</h3><p>把购物车信息在专门的页面显示出来</p><h3 id="②思路-2">②思路</h3><p>首页→购物车超链接→CartServlet.showCart()→cart.html</p><h3 id="③代码实现-2">③代码实现</h3><h4 id="1-购物车超链接">[1]购物车超链接</h4><p>登录状态和未登录状态</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;CartServlet?method=showCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cart iconfont icon-gouwuche&quot;</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-CartServlet">[2]CartServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">showCart</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-cart-html">[3]cart.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span>/&gt;</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header-right&quot;</span> <span class="attr">th:include</span>=<span class="string">&quot;segment/welcome :: welcome-page&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.cart == null || session.cart.cartItemMap.size() == 0&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span>&gt;</span>购物车还是空空的，赶紧去添加吧！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.cart != null &amp;&amp; session.cart.cartItemMap.size() &gt; 0&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;cartItemEntry : $&#123;session.cart.cartItemMap&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;cartItemEntry.value.imgPath&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/uploads/huozhe.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;cartItemEntry.value.bookName&#125;&quot;</span>&gt;</span>活着<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;count-num&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;cartItemEntry.value.count&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;cartItemEntry.value.price&#125;&quot;</span>&gt;</span>36.8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;cartItemEntry.value.amount&#125;&quot;</span>&gt;</span>36.8<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.cart != null &amp;&amp; session.cart.cartItemMap.size() &gt; 0&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;clear-cart&quot;</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span>&gt;</span>继续购物<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>共<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.cart.totalCount&#125;&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">span</span>&gt;</span>件商品<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;total-price&quot;</span>&gt;</span>总金额<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.cart.totalAmount&#125;&quot;</span>&gt;</span>99.9<span class="tag">&lt;/<span class="name">span</span>&gt;</span>元<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;pay&quot;</span> <span class="attr">href</span>=<span class="string">&quot;checkout.html&quot;</span>&gt;</span>去结账<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5、清空购物车">5、清空购物车</h2><h3 id="①目标-3">①目标</h3><p>当用户确定点击清空购物车，将Session域中的Cart对象移除。</p><h3 id="②思路-3">②思路</h3><p>cart.html→清空购物车超链接→绑定单击响应函数→confirm()确认→确定→CartServlet.clearCart()→从Session域移除Cart对象</p><h3 id="③代码实现-3">③代码实现</h3><h4 id="1-清空购物车超链接">[1]清空购物车超链接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;CartServlet?method=clearCart&quot;</span> <span class="attr">class</span>=<span class="string">&quot;clear-cart&quot;</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-绑定单击响应函数">[2]绑定单击响应函数</h4><h5 id="1-引入Vue">(1)引入Vue</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/script/vue.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-编写Vue代码">(2)编写Vue代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="string">&quot;el&quot;</span>:<span class="string">&quot;#appCart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;clearCart&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 1.使用confirm()弹框向用户确认是否要清空</span></span><br><span class="line">            <span class="keyword">var</span> confirmResult = <span class="title function_">confirm</span>(<span class="string">&quot;您真的要清空购物车吗？&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.如果用户点击了取消</span></span><br><span class="line">            <span class="keyword">if</span> (!confirmResult) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3.调用事件对象的方法阻止超链接跳转页面</span></span><br><span class="line">                event.<span class="title function_">preventDefault</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3-CartServlet-clearCart">[3]CartServlet.clearCart()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">clearCart</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.通过request对象获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.将Session域的Cart对象移除</span></span><br><span class="line">    session.removeAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.渲染视图</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6、减号">6、减号</h2><h3 id="①目标-4">①目标</h3><ul><li>在大于1的数值基础上-1：执行-1的逻辑</li><li>在1的基础上-1：执行删除item的逻辑</li></ul><h3 id="②思路-4">②思路</h3><p>减号span绑定单击响应函数→获取文本框中的数据：当前数量→检查数量是否大于1</p><ul><li>数量大于1：发送请求访问CartServlet.decrease()方法→回到cart.html</li><li>数量等于1：confirm确认→发送请求访问CartServlet.removeItem()方法→回到cart.html</li></ul><h3 id="③后端代码">③后端代码</h3><p>CartServlet.decrease()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.通过请求参数获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.通过request对象获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.从Session域获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※考虑到如果Session超时会导致购物车数据丢失，所以先判断购物车数据是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (cart != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.从购物车对象中根据bookId执行-1操作</span></span><br><span class="line">        cart.itemCountDecrease(bookId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.回到购物车页面</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④前端代码">④前端代码</h3><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookId&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;cartItemEntry.value.bookId&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;itemDecrease&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    ……</span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="string">&quot;itemDecrease&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0.不管执行两种逻辑中的哪一种，都需要将当前item的bookId发送到Servlet</span></span><br><span class="line">    <span class="comment">// event：事件对象</span></span><br><span class="line">    <span class="comment">// event.target：当前事件操作的控件（HTML元素）</span></span><br><span class="line">    <span class="comment">// previousSibling：上一个兄弟节点。当前span标签的上一个兄弟节点是空格，所以要再找上一个兄弟</span></span><br><span class="line">    <span class="keyword">var</span> bookId = event.<span class="property">target</span>.<span class="property">previousSibling</span>.<span class="property">previousSibling</span>.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bookId=&quot;</span>+bookId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取文本框中的value属性值：当前item的数量</span></span><br><span class="line">    <span class="comment">// event：事件对象</span></span><br><span class="line">    <span class="comment">// event.target：当前事件操作的控件（HTML元素）</span></span><br><span class="line">    <span class="comment">// nextSibling：下一个兄弟节点。当前span标签的下一个兄弟节点是空格，所以要再找下一个兄弟</span></span><br><span class="line">    <span class="comment">// value：获取input标签的value属性值</span></span><br><span class="line">    <span class="keyword">var</span> currentCount = event.<span class="property">target</span>.<span class="property">nextSibling</span>.<span class="property">nextSibling</span>.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;currentCount=&quot;</span>+currentCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.判断currentCount是否大于1</span></span><br><span class="line">    <span class="keyword">if</span> (currentCount &gt; <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.应用-1逻辑</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;currentCount &gt; 1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;CartServlet?method=decrease&amp;bookId=&quot;</span>+bookId;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过DOM树形结构获取图书名称数据</span></span><br><span class="line">        <span class="comment">// event：事件对象</span></span><br><span class="line">        <span class="comment">// event.target：当前事件操作的控件（HTML元素）</span></span><br><span class="line">        <span class="comment">// parentNode：访问父节点</span></span><br><span class="line">        <span class="comment">// parentNode.getElementsByTagName()：在父节点范围内根据标签名称查找元素，返回数组</span></span><br><span class="line">        <span class="comment">// innerHTML：返回标签内部HTML代码</span></span><br><span class="line">        <span class="keyword">var</span> bookName = event.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;td&quot;</span>)[<span class="number">1</span>].<span class="property">innerHTML</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.应用删除item的逻辑</span></span><br><span class="line">        <span class="keyword">var</span> confirmResult = <span class="title function_">confirm</span>(<span class="string">&quot;你真的要从购物车中删除『&quot;</span>+bookName+<span class="string">&quot;』这条记录吗？&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (confirmResult) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;CartServlet?method=removeItem&amp;bookId=&quot;</span>+bookId;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7、删除">7、删除</h2><h3 id="①目标-5">①目标</h3><p>点击删除超链接后，把对应的CartItem从Cart中删除</p><h3 id="②思路-5">②思路</h3><p>cart.html→删除超链接→CartServlet.removeItem()→回到cart.html</p><h3 id="③代码实现-4">③代码实现</h3><h4 id="1-后端代码">[1]后端代码</h4><p>CartServlet.removeItem()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">removeItem</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.通过request对象获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.从Session域获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※考虑到如果Session超时会导致购物车数据丢失，所以先判断购物车数据是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (cart != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.执行删除item操作</span></span><br><span class="line">        cart.removeCartItem(bookId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.回到购物车页面</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-前端代码">[2]前端代码</h4><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;removeConfirm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/CartServlet(method=removeItem,bookId=$&#123;cartItemEntry.value.bookId&#125;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="string">&quot;removeConfirm&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过DOM树形结构获取图书名称数据</span></span><br><span class="line">    <span class="comment">// event：事件对象</span></span><br><span class="line">    <span class="comment">// event.target：当前事件操作的控件（HTML元素）</span></span><br><span class="line">    <span class="comment">// parentNode：访问父节点</span></span><br><span class="line">    <span class="comment">// parentNode.getElementsByTagName()：在父节点范围内根据标签名称查找元素，返回数组</span></span><br><span class="line">    <span class="comment">// innerHTML：返回标签内部HTML代码</span></span><br><span class="line">    <span class="keyword">var</span> bookName = event.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;td&quot;</span>)[<span class="number">1</span>].<span class="property">innerHTML</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bookName=&quot;</span> + bookName);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_">confirm</span>(<span class="string">&quot;你真的要从购物车中删除『&quot;</span>+bookName+<span class="string">&quot;』这条记录吗？&quot;</span>)) &#123;</span><br><span class="line">        event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8、文本框修改">8、文本框修改</h2><h3 id="①目标-6">①目标</h3><p>用户在文本框输入新数据后，根据用户输入在Session中的Cart中修改CartItem中的count</p><h3 id="②思路-6">②思路</h3><p>cart.html→前端数据校验→CartServlet.changeCount()→回到cart.html</p><h3 id="③代码实现-5">③代码实现</h3><h4 id="1-后端代码-2">[1]后端代码</h4><p>CartServlet.changeCount()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">changeCount</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数获取bookId和newCount</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">newCount</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;newCount&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.通过request对象获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.从Session域获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※考虑到如果Session超时会导致购物车数据丢失，所以先判断购物车数据是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (cart != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.执行修改数量操作</span></span><br><span class="line">        cart.updateItemCount(bookId, newCount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.回到购物车页面</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-前端代码-2">[2]前端代码</h4><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookId&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;cartItemEntry.value.bookId&#125;&quot;</span> /&gt;</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> @<span class="attr">change</span>=<span class="string">&quot;itemCountChange&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count-num&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;cartItemEntry.value.count&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    ……</span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="string">&quot;itemCountChange&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.获取文本框中输入的数据</span></span><br><span class="line"><span class="keyword">var</span> newCount = event.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.排除小数或零或负数的情况</span></span><br><span class="line"><span class="keyword">var</span> regExp = <span class="regexp">/^[0-9]+$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!regExp.<span class="title function_">test</span>(newCount) || newCount == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.如果用户输入的数据不是数字，给出提示</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;请输入正整数！&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8.将文本框恢复为默认值</span></span><br><span class="line">event.<span class="property">target</span>.<span class="property">value</span> = event.<span class="property">target</span>.<span class="property">defaultValue</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9.当前函数停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10.获取bookId值</span></span><br><span class="line"><span class="keyword">var</span> bookId = event.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;input&quot;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bookId=&quot;</span>+bookId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 11.发送请求执行修改</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;CartServlet?method=changeCount&amp;bookId=&quot;</span>+bookId+<span class="string">&quot;&amp;newCount=&quot;</span>+newCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9、加号">9、加号</h2><h3 id="①目标-7">①目标</h3><p>告诉Servlet将Session域中Cart对象里面对应的CartItem执行count+1操作</p><h3 id="②思路-7">②思路</h3><p>加号span绑定单击响应函数→获取文本框中的数据：当前数量→CartServlet.increase()→回到cart.html</p><h3 id="③代码实现-6">③代码实现</h3><h4 id="1-后端代码-3">[1]后端代码</h4><p>CartServlet.increase()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.通过请求参数获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.通过request对象获取Session对象</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.从Session域获取购物车对象</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> (Cart) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※考虑到如果Session超时会导致购物车数据丢失，所以先判断购物车数据是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (cart != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.从购物车对象中根据bookId执行-1操作</span></span><br><span class="line">        cart.itemCountIncrease(bookId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.回到购物车页面</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;cart/cart&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-前端代码-3">[2]前端代码</h4><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookId&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;cartItemEntry.value.bookId&#125;&quot;</span> /&gt;</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;itemIncrease&quot;</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="string">&quot;itemIncrease&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.获取bookId值</span></span><br><span class="line"><span class="keyword">var</span> bookId = event.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;input&quot;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.发送请求执行+1</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;CartServlet?method=increase&amp;bookId=&quot;</span>+bookId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10、Double数据运算过程中精度调整">10、Double数据运算过程中精度调整</h2><h3 id="①问题现象">①问题现象</h3><p><img src="./images/img011.png" alt="./images"></p><h3 id="②解决方案">②解决方案</h3><ul><li>使用BigDecimal类型来进行Double类型数据运算</li><li>创建BigDecimal类型对象时将Double类型的数据转换为字符串</li></ul><p>Cart类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算总金额</span></span><br><span class="line"><span class="keyword">public</span> Double <span class="title function_">getTotalAmount</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.声明一个变量用于存储累加结果</span></span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.0&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.遍历Map集合</span></span><br><span class="line">    Set&lt;String&gt; keySet = cartItemMap.keySet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">        <span class="type">CartItem</span> <span class="variable">cartItem</span> <span class="operator">=</span> cartItemMap.get(key);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">amount</span> <span class="operator">=</span> cartItem.getAmount();</span><br><span class="line"></span><br><span class="line">        sum = sum.add(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amount + <span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.返回累加结果</span></span><br><span class="line">    <span class="keyword">return</span> sum.doubleValue();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CartItem类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取金额时需要计算得到</span></span><br><span class="line"><span class="keyword">public</span> Double <span class="title function_">getAmount</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">bigDecimalCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="built_in">this</span>.count + <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">bigDecimalPrice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="built_in">this</span>.price + <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">multiReuslt</span> <span class="operator">=</span> bigDecimalCount.multiply(bigDecimalPrice);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> multiReuslt.doubleValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 验证码</h1><h2 id="1、目标">1、目标</h2><p>通过让用户填写验证码并在服务器端检查，防止浏览器端使用程序恶意访问。</p><h2 id="2、思路">2、思路</h2><p><img src="./images/img002.png" alt="./images"></p><h2 id="3、操作">3、操作</h2><h3 id="①导入jar包">①导入jar包</h3><p>kaptcha-2.3.2.jar</p><h3 id="②配置KaptchaServlet">②配置KaptchaServlet</h3><p>jar包中已经写好了Servlet的Java类，我们只需要在web.xml中配置这个Servlet即可。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/KaptchaServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③通过页面访问测试">③通过页面访问测试</h3><blockquote><p><a href="http://localhost:8080/bookstore/KaptchaServlet">http://localhost:8080/bookstore/KaptchaServlet</a></p></blockquote><h3 id="④在注册页面显示验证码图片">④在注册页面显示验证码图片</h3><p><img src="./images/img004.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;KaptchaServlet&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="⑤调整验证码图片的显示效果">⑤调整验证码图片的显示效果</h3><h4 id="1-去掉边框">[1]去掉边框</h4><p>KaptchaServlet会在初始化时读取init-param，而它能够识别的init-param在下面类中：</p><blockquote><p>com.google.code.kaptcha.util.Config</p></blockquote><p>web.xml中具体配置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过配置初始化参数影响KaptchaServlet的工作方式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可以使用的配置项参考com.google.code.kaptcha.util.Config类 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置kaptcha.border的值为false取消图片边框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.border<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>no<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/KaptchaServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>开发过程中的工程化细节：</p><p>no、false、none等等单词从含义上来说都表示『没有边框』这个意思，但是这里必须使用no。</p><p>参考的依据是下面的源码：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getBoolean</span><span class="params">(String paramName, String paramValue, <span class="type">boolean</span> defaultValue)</span> &#123;</span><br><span class="line"><span class="type">boolean</span> booleanValue;</span><br><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;yes&quot;</span>.equals(paramValue) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(paramValue) &amp;&amp; paramValue != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="string">&quot;no&quot;</span>.equals(paramValue)) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigException</span>(paramName, paramValue, <span class="string">&quot;Value must be either yes or no.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">booleanValue = <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">booleanValue = defaultValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> booleanValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-设置图片大小">[2]设置图片大小</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;width: 150px; height: 40px;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;KaptchaServlet&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="⑥点击图片刷新">⑥点击图片刷新</h3><h4 id="1-目的">[1]目的</h4><p>验证码图片都是经过刻意扭曲、添加了干扰、角度偏转，故意增加了识别的难度。所以必须允许用户在看不出来的时候点击图片刷新，生成新的图片重新辨认。</p><h4 id="2-实现的代码">[2]实现的代码</h4><p>修改图片的img标签：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> @<span class="attr">click</span>=<span class="string">&quot;refreshCodeImage&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 150px; height: 40px;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;KaptchaServlet&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>Vue代码：将refreshCodeImage()单击响应函数声明到注册表单验证功能的Vue对象的methods属性中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">,</span><br><span class="line"><span class="string">&quot;refreshCodeImage&quot;</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过event事件对象的target属性获取当前正在点击的img标签</span></span><br><span class="line"><span class="keyword">var</span> imgEle = event.<span class="property">target</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置img标签的src属性</span></span><br><span class="line">imgEle.<span class="property">src</span> = <span class="string">&quot;KaptchaServlet?random=&quot;</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑦执行注册前检查验证码">⑦执行注册前检查验证码</h3><p><img src="./images/img005.png" alt="./images"></p><h4 id="1-确认KaptchaServlet将验证码存入Session域时使用的属性名">[1]确认KaptchaServlet将验证码存入Session域时使用的属性名</h4><p><img src="./images/img006.png" alt="./images"></p><p>通过查看源码，找到验证码存入Session域时使用的属性名是：</p><blockquote><p>KAPTCHA_SESSION_KEY</p></blockquote><h4 id="2-在执行注册的方法中添加新的代码">[2]在执行注册的方法中添加新的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doRegister</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※检查验证码</span></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取用户提交的验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">codeForm</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取Session域中保存的验证码</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">    <span class="type">String</span> <span class="variable">codeSystem</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;KAPTCHA_SESSION_KEY&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.将表单验证码和系统验证码进行比较</span></span><br><span class="line">    <span class="keyword">if</span> (Objects.equals(codeForm, codeSystem)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.如果比较后发现二者一致，则将用过的验证码从Session域移除</span></span><br><span class="line">        session.removeAttribute(<span class="string">&quot;KAPTCHA_SESSION_KEY&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.如果比较后发现二者不一致，则返回注册的表单页面显示提示信息</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;验证码不正确，请重新填写&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/regist&quot;</span>;</span><br><span class="line"></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.停止执行当前方法</span></span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 后续是原来的代码……</span></span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore04/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第四阶段</h1><p><a href="verse01.html">第一节 保持登录状态</a></p><p><a href="verse02.html">第二节 验证码</a></p><p><a href="verse03.html">第三节 购物车</a></p><p><a href="../index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 前台图书展示</h1><h2 id="1、思路">1、思路</h2><p>index.html→PortalServlet.doPost()→把图书列表数据查询出来→渲染视图→页面迭代显示图书数据</p><h2 id="2、实现：PortalServlet-doPost">2、实现：PortalServlet.doPost()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PortalServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将两种请求方式的处理逻辑合并到一个方法</span></span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询图书列表数据</span></span><br><span class="line">        List&lt;Book&gt; bookList = bookService.getBookList();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将图书列表数据存入请求域</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;bookList&quot;</span>, bookList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 声明视图名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析模板视图</span></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、实现：页面迭代显示图书数据">3、实现：页面迭代显示图书数据</h2><p>页面文件：index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-content&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    抱歉，本商城现在没有上架任何商品</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-content&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;book : $&#123;bookList&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;book.imgPath&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/uploads/huozhe.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>书名:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span>&gt;</span>活着<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>作者:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.author&#125;&quot;</span>&gt;</span>余华<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>价格:￥<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.price&#125;&quot;</span>&gt;</span>66.6<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>销量:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.sales&#125;&quot;</span>&gt;</span>230<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>库存:<span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.stock&#125;&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 后台图书CRUD</h1><blockquote><p>C：Create 增</p><p>R：Retrieve 查</p><p>U：Update 改</p><p>D：Delete 删</p></blockquote><h2 id="1、建模">1、建模</h2><h3 id="①物理建模">①物理建模</h3><p><a href="bookstore.sql">点击这里查看SQL文件</a></p><blockquote><p>注：上面链接建议点右键→目标另存为，直接打开会显示乱码</p></blockquote><h3 id="②逻辑建模">②逻辑建模</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.bookstore.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer bookId;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> Integer sales;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="keyword">private</span> String imgPath;</span><br></pre></td></tr></table></figure><h2 id="2、创建并组装组件">2、创建并组装组件</h2><h3 id="①创建Servlet">①创建Servlet</h3><p><span style="color:blue;font-weight:bold;">注意</span>：由于项目分成『前台』和『后台』，所以Servlet也分成两个：</p><ul><li>前台：BookPortalServlet</li><li>后台：BookManagerServlet</li></ul><h3 id="②创建BookService">②创建BookService</h3><ul><li>接口：BookService</li><li>实现类：BookServiceImpl</li></ul><h3 id="③创建BookDao">③创建BookDao</h3><ul><li>接口：BookDao</li><li>实现类：BookDaoImpl</li></ul><h3 id="④组装">④组装</h3><ul><li>给BookManagerServlet组装BookService</li><li>给BookService组装BookDao</li></ul><h2 id="3、图书列表显示功能">3、图书列表显示功能</h2><h3 id="①思路">①思路</h3><p>manager.html→图书管理超链接→BookManagerServlet→showBookList()→book_manager.html</p><h3 id="②实现：修改图书管理超链接">②实现：修改图书管理超链接</h3><p>超链接所在文件位置：</p><blockquote><p>WEB-INF/pages/segment/admin-navigator.html</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;BookManagerServlet?method=showBookList&quot;</span> <span class="attr">class</span>=<span class="string">&quot;order&quot;</span>&gt;</span>图书管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③实现：BookManagerServlet-showBookList">③实现：BookManagerServlet.showBookList()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">showBookList</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.调用Service方法查询图书列表</span></span><br><span class="line">    List&lt;Book&gt; bookList = bookService.getBookList();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.将图书列表数据存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;bookList&quot;</span>, bookList);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.执行视图模板渲染</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;manager/book_manager&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④实现：BookService-getBookList">④实现：BookService.getBookList()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getBookList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookDao.selectBookList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑤实现：BookDao-selectBookList">⑤实现：BookDao.selectBookList()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">selectBookList</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select book_id bookId, book_name bookName, author, price, sales, stock, img_path imgPath from t_book order by book_Id desc&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> getBeanList(Book.class, sql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑥实现：调整book-manager-html">⑥实现：调整book_manager.html</h3><ul><li>Thymeleaf名称空间</li><li>base标签</li><li>路径中的…/和./</li><li>包含进来的代码片段</li></ul><h3 id="⑤实现：在book-manager-html中迭代显示图书列表">⑤实现：在book_manager.html中迭代显示图书列表</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;7&quot;</span>&gt;</span>抱歉，没有查询到您要的数据！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(bookList)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;book : $&#123;bookList&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;book.imgPath&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/uploads/huozhe.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span>&gt;</span>活着<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.price&#125;&quot;</span>&gt;</span>100.00<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.author&#125;&quot;</span>&gt;</span>余华<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.sales&#125;&quot;</span>&gt;</span>200<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;book.stock&#125;&quot;</span>&gt;</span>400<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;book_edit.html&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;del&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、图书删除功能">4、图书删除功能</h2><h3 id="①思路-2">①思路</h3><p>book_manager.html→删除超链接→BookManagerServlet.removeBook()→重定向显示列表功能</p><h3 id="②实现：删除超链接">②实现：删除超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/BookManagerServlet(method=removeBook,bookId=$&#123;book.bookId&#125;)&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;del&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③实现：BookManagerServlet-removeBook">③实现：BookManagerServlet.removeBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">removeBook</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 1.从请求参数中获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.调用Service方法执行删除</span></span><br><span class="line">    bookService.removeBook(bookId);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.重定向到显示列表功能</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/BookManagerServlet?method=showBookList&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④实现：BookService-removeBook">④实现：BookService.removeBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeBook</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line">    bookDao.deleteBook(bookId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑤实现：BookDao-deleteBook">⑤实现：BookDao.deleteBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from t_book where book_id=?&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    update(sql, bookId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5、新增图书功能">5、新增图书功能</h2><h3 id="①思路-3">①思路</h3><p>book_manager.html→添加图书超链接→BookManagerServlet.toAddPage()→book_add.html</p><p>book_add.html→提交表单→BookManagerServlet.saveBook()→重定向显示列表功能</p><h3 id="②实现：添加图书超链接">②实现：添加图书超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;BookManagerServlet?method=toAddPage&quot;</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③实现：BookManagerServlet-toAddPage">③实现：BookManagerServlet.toAddPage()</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void toAddPage(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    String viewName = &quot;book_add&quot;;</span><br><span class="line">    </span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④实现：book-add-html">④实现：book_add.html</h3><p>由book_edit.html复制出来，然后调整表单标签：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;BookManagerServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;saveBook&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入价格&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入作者&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sales&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入销量&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;stock&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入库存&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="⑤实现：BookManagerServlet-saveBook">⑤实现：BookManagerServlet.saveBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">saveBook</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookName&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">price</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">author</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;author&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sales</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;sales&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">stock</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;stock&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.封装对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ※imgPath按说应该通过文件上传的方式提供，但是现在这个技术还没学</span></span><br><span class="line">    <span class="comment">// 所以暂时使用一个固定值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">imgPath</span> <span class="operator">=</span> <span class="string">&quot;static/uploads/mi.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="literal">null</span>, bookName, author, Double.parseDouble(price), Integer.parseInt(sales), Integer.parseInt(stock), imgPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用Service方法执行保存</span></span><br><span class="line">    bookService.saveBook(book);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.重定向到显示列表页面</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/BookManagerServlet?method=showBookList&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑥实现：BookService-saveBook">⑥实现：BookService.saveBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    bookDao.insertBook(book);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑦实现：BookDao-insertBook">⑦实现：BookDao.insertBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert  into `t_book`(`book_name`,`author`,`price`,`sales`,`stock`,`img_path`) values (?,?,?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    update(sql, book.getBookName(), book.getAuthor(), book.getPrice(), book.getSales(), book.getStock(), book.getImgPath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6、修改图书功能">6、修改图书功能</h2><h3 id="①思路-4">①思路</h3><p>book_manager.html→修改图书超链接→BookManagerServlet.toEditPage()→book_edit.html（表单回显）</p><p>book_edit.html→提交表单→BookManagerServlet.updateBook()→重定向显示列表功能</p><h3 id="②实现：修改图书超链接">②实现：修改图书超链接</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/BookManagerServlet(method=toEditPage,bookId=$&#123;book.bookId&#125;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="③实现：BookManagerServlet-toEditPage">③实现：BookManagerServlet.toEditPage()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toEditPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.从请求参数中获取bookId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.根据bookId查询对应的Book对象</span></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getBookById(bookId);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.把Book对象存入请求域</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;book&quot;</span>, book);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4.渲染视图</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;manager/book_edit&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④实现：BookService-getBookById">④实现：BookService.getBookById()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">getBookById</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookDao.selectBookByPrimaryKey(bookId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑤实现：BookDao-selectBookByPrimaryKey">⑤实现：BookDao.selectBookByPrimaryKey()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">selectBookByPrimaryKey</span><span class="params">(String bookId)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select book_id bookId, book_name bookName, author, price, sales, stock, img_path imgPath from t_book where book_id=?&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> getBean(Book.class, sql, bookId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑥实现：book-edit-html（表单回显）">⑥实现：book_edit.html（表单回显）</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;BookManagerServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;updateBook&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bookName&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;book.price&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入价格&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;book.author&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入作者&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sales&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;book.sales&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入销量&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;stock&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;book.stock&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入库存&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="⑦实现：BookManagerServlet-updateBook">⑦实现：BookManagerServlet.updateBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.获取请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">bookId</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookId&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">bookName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;bookName&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">price</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">author</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;author&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sales</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;sales&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">stock</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;stock&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.封装对象</span></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(Integer.parseInt(bookId), bookName, author, Double.parseDouble(price), Integer.parseInt(sales), Integer.parseInt(stock), <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用Service方法执行更新</span></span><br><span class="line">    bookService.updateBook(book);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4.渲染视图</span></span><br><span class="line">    response.sendRedirect(request.getContextPath() + <span class="string">&quot;/BookManagerServlet?method=showBookList&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑧实现：BookService-updateBook">⑧实现：BookService.updateBook()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    bookDao.updateBook(book);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="⑨实现：BookDao-updateBook">⑨实现：BookDao.updateBook()</h3><p><span style="color:blue;font-weight:bold;">注意</span>：这里不修改imgPath字段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_book set book_name=?, author=?, price=?, sales=?, stock=? where book_id=?&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    update(sql, book.getBookName(), book.getAuthor(), book.getPrice(), book.getSales(), book.getStock(), book.getBookId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 完成用户模块</h1><h2 id="1、重构登录功能">1、重构登录功能</h2><h3 id="①思路">①思路</h3><p><img src="./images/img002.png" alt="./images"></p><h3 id="②实现：创建并组装组件">②实现：创建并组装组件</h3><h4 id="1-创建UserServlet">[1]创建UserServlet</h4><p>web.xml中的配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.model.UserServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>UserServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/UserServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Java代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doLogin</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toLoginPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toLoginSuccessPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">注意</span>：记得修改UserServlet继承的类ModelBaseServlet。</p><h4 id="2-把UserService组件组装到UserServlet中">[2]把UserService组件组装到UserServlet中</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h3 id="③实现：前往登录页面">③实现：前往登录页面</h3><h4 id="1-修改首页中登录超链接">[1]修改首页中登录超链接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toLoginPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-完成UserServlet-toLoginPage-方法">[2]完成UserServlet.toLoginPage()方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toLoginPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/login&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-调整登录页面代码">[3]调整登录页面代码</h4><ul><li>加入Thymeleaf名称空间</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改base标签</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改form标签action属性</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;UserServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>增加method请求参数的表单隐藏域</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;doLogin&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>根据条件显示登录失败消息</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red;font-weight: bold;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(message)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>这里根据条件显示登录失败消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-回显表单中的用户名">[4]回显表单中的用户名</h4><p>遇到问题：使用th:value=&quot;${param.username}&quot;确实实现了服务器端渲染，但是实际打开页面并没有看到。原因是页面渲染顺序：</p><ul><li>服务器端渲染</li><li>服务器端将渲染结果作为响应数据返回给浏览器</li><li>浏览器加载HTML文档</li><li>读取到Vue代码后，执行Vue代码</li><li>Vue又进行了一次浏览器端渲染，覆盖了服务器端渲染的值</li></ul><p>解决办法：将服务器端渲染的结果设置到Vue对象的data属性中。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#loginForm&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;[[$&#123;param.username&#125;]]&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="④实现：前往登录成功页面">④实现：前往登录成功页面</h3><p>UserServlet.toLoginSuccessPage()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toLoginSuccessPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/login_success&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>login_success.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    ……</span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="⑤实现：完成登录操作">⑤实现：完成登录操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doLogin</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取用户名和密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.封装为User对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">userForm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, password, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用UserService的方法执行登录验证</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userService.doLogin(userForm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.登录成功后跳转到登录成功页面</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/UserServlet?method=toLoginSuccessPage&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.登录失败则显示提示消息</span></span><br><span class="line">        <span class="comment">// ①将登录失败的提示消息存入请求域</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;message&quot;</span>, e.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ②执行登录页面的模板渲染</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/login&quot;</span>;</span><br><span class="line"></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、重构注册功能">2、重构注册功能</h2><h3 id="①思路-2">①思路</h3><p><img src="./images/img003.png" alt="./images"></p><h3 id="②实现：前往注册页面">②实现：前往注册页面</h3><h4 id="1-修改首页中注册超链接">[1]修改首页中注册超链接</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;UserServlet?method=toRegisterPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-完成UserServlet-toRegisterPage-方法">[2]完成UserServlet.toRegisterPage()方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toRegisterPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/regist&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-调整注册页面代码">[3]调整注册页面代码</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    ……</span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;registerForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;UserServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;doRegister&quot;</span> /&gt;</span></span><br><span class="line">        ……</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red;font-weight: bold;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(message)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>这里根据条件显示注册失败消息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#registerForm&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;[[$&#123;param.username&#125;]]&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;passwordConfirm&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;email&quot;</span>:<span class="string">&quot;[[$&#123;param.email&#125;]]&quot;</span>,</span><br><span class="line"><span class="string">&quot;code&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;usernameCheckMessage&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③实现：前往注册成功页面">③实现：前往注册成功页面</h3><p>UserServlet：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toRegisterSuccessPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/regist_success&quot;</span>;</span><br><span class="line"></span><br><span class="line">    processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>regist_success.html：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    ……</span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④实现：完成注册操作">④实现：完成注册操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doRegister</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 1.从请求参数中获取数据封装为User对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">userForm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, password, email);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.调用UserService的方法执行注册</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        userService.doRegister(userForm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.如果没有抛出异常那么就跳转到注册成功的页面</span></span><br><span class="line">        <span class="comment">// 选择重定向的原因：跳转到regist_success.html页面后，用户刷新浏览器不会重复提交注册表单</span></span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/UserServlet?method=toRegisterSuccessPage&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.如果抛出了异常</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;message&quot;</span>, e.getMessage());</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;user/regist&quot;</span>;</span><br><span class="line"></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第三阶段</h1><p><a href="verse01.html">第一节 创建module，迁移代码</a></p><p><a href="verse02.html">第二节 完成用户模块</a></p><p><a href="verse03.html">第三节 进入后台开发</a></p><p><a href="verse04.html">第四节 后台图书CRUD</a></p><p><a href="verse05.html">第五节 前台图书展示</a></p><p><a href="../index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 创建module，迁移代码</h1><h2 id="1、创建module">1、创建module</h2><p><img src="./images/img001.png" alt="./images"></p><p>把index.jsp删除</p><h2 id="2、加入jar包">2、加入jar包</h2><blockquote><p>attoparser-2.0.5.RELEASE.jar<br>commons-dbutils-1.6.jar<br>druid-1.1.9.jar<br>hamcrest-core-1.3.jar<br>javassist-3.20.0-GA.jar<br>junit-4.12.jar<br>log4j-1.2.15.jar<br>mysql-connector-java-5.1.37-bin.jar<br>ognl-3.1.26.jar<br>slf4j-api-1.7.25.jar<br>slf4j-log4j12-1.7.25.jar<br>thymeleaf-3.0.12.RELEASE.jar<br>unbescape-1.1.6.RELEASE.jar</p></blockquote><h2 id="3、从V02迁移代码">3、从V02迁移代码</h2><h3 id="①src目录下的Java源代码">①src目录下的Java源代码</h3><ul><li>在V02的module中的src目录上点右键</li><li>show in explorer在操作系统的窗口内打开</li><li>在操作系统的窗口内复制package目录和jdbc.properties</li><li>在操作系统的窗口内粘贴到V03的module中的src目录下</li><li>在V03的src目录下，找到上一个版本的Servlet，全部删除</li><li>创建两个子包<ul><li>存放Servlet基类：com.atguigu.bookstore.servlet.base</li><li>存放Servlet子类：com.atguigu.bookstore.servlet.model</li></ul></li><li>从view-demo中，将两个基类迁移过来<ul><li>视图基类：ViewBaseServlet</li><li>方法分发基类：ModelBaseServlet</li></ul></li></ul><h3 id="②前端页面">②前端页面</h3><ul><li>将V02中的pages目录整体复制到V03 module的<span style="color:blue;font-weight:bold;">WEB-INF目录</span>下</li><li>将V02中的static目录整体复制到V03 module的<span style="color:blue;font-weight:bold;">web目录</span>下</li><li>将V02中的index.html复制到V03 module的WEB-INF/pages目录下，将来通过Servlet访问</li></ul><h2 id="4、显示首页">4、显示首页</h2><h3 id="①配置web-xml">①配置web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在上下文参数中配置视图前缀和视图后缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/pages/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">注意</span>：这里需要将WEB-INF下的view改成pages，和当前项目环境的目录结构一致。</p><h3 id="②创建PortalServlet">②创建PortalServlet</h3><p><span style="color:blue;font-weight:bold;">注意</span>：这个PortalServlet映射的地址是/index.html，这样才能保证访问首页时访问它。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>PortalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.model.PortalServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>PortalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/index.html<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:blue;font-weight:bold;">注意</span>：PortalServlet服务于首页的显示，为了降低用户访问首页的门槛，不能附加任何请求参数，所以不能继承ModelBaseServlet，只能继承ViewBaseServlet。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PortalServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将两种请求方式的处理逻辑合并到一个方法</span></span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 声明视图名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析模板视图</span></span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③调整index-html">③调整index.html</h3><ul><li>加入Thymeleaf名称空间</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改base标签</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore03/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 进入后台开发</h1><h2 id="1、概念辨析">1、概念辨析</h2><p><img src="./images/img004.png" alt="./images"></p><h2 id="2、访问后台首页">2、访问后台首页</h2><h3 id="①思路">①思路</h3><p>首页→后台系统超链接→AdminServlet.toPortalPage()→manager.html</p><h3 id="②实现：创建AdminServlet">②实现：创建AdminServlet</h3><p>web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AdminServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.model.AdminServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AdminServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/AdminServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Java代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminServlet</span> <span class="keyword">extends</span> <span class="title class_">ModelBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">toPortalPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> <span class="string">&quot;manager/manager&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        processTemplate(viewName, request, response);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③实现：调整manager-html">③实现：调整manager.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>然后去除页面上的所有“…/”。</p><h3 id="④实现：抽取页面公共部分">④实现：抽取页面公共部分</h3><h4 id="1-公共部分内容">[1]公共部分内容</h4><p>三个超链接：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./book_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;order&quot;</span>&gt;</span>图书管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./order_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;destory&quot;</span>&gt;</span>订单管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../../index.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;gohome&quot;</span>&gt;</span>返回商城<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-抽取它们的理由">[2]抽取它们的理由</h4><p>为了实现链接地址修改时：一处修改，处处生效</p><h4 id="3-创建包含代码片段的页面">[3]创建包含代码片段的页面</h4><p><img src="./images/img005.png" alt="./images"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用th:fragment属性给代码片段命名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;navigator&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;book_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;order&quot;</span>&gt;</span>图书管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;order_manager.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;destory&quot;</span>&gt;</span>订单管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;gohome&quot;</span>&gt;</span>返回商城<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-在有需要的页面引入片段">[4]在有需要的页面引入片段</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;segment/admin-navigator :: navigator&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse05/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse05/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第五节 完成带数据库的登录注册</h1><h2 id="1、密码加密">1、密码加密</h2><h3 id="①加密方式介绍">①加密方式介绍</h3><ul><li>对称加密：在知道密文和加密算法的情况下，能够反推回明文</li><li>非对称加密：<ul><li>加密：使用私钥加密</li><li>解密：使用公钥解密</li></ul></li></ul><h3 id="②加密算法：HASH">②加密算法：HASH</h3><ul><li>特点1：不可逆</li><li>特点2：加密后，密文长度固定</li><li>特点3：输入数据不变，输出数据也保证不变；输入数据变化，输出数据一定变化</li></ul><p>常见的HASH算法举例：</p><ul><li>MD5</li><li>SHA1</li><li>SHA512</li><li>CRC32</li></ul><h3 id="③执行加密的工具方法">③执行加密的工具方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MD5Util</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 针对明文字符串执行MD5加密</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String source)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.判断明文字符串是否有效</span></span><br><span class="line">        <span class="keyword">if</span> (source == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(source)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用于加密的明文不可为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.声明算法名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> <span class="string">&quot;md5&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.获取MessageDigest对象</span></span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.获取明文字符串对应的字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] input = source.getBytes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.执行加密</span></span><br><span class="line">        <span class="type">byte</span>[] output = messageDigest.digest(input);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.创建BigInteger对象</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">signum</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">bigInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(signum, output);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.按照16进制将bigInteger的值转换为字符串</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">radix</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> bigInteger.toString(radix).toUpperCase();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> encoded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、注册功能">2、注册功能</h2><h3 id="①目标">①目标</h3><p>检查用户名是否可用，如果用户名可用则保存User对象</p><h3 id="②思路">②思路</h3><p><img src="./images/img021.png" alt="./images"></p><h3 id="③代码">③代码</h3><h4 id="1-创建UserService">[1]创建UserService</h4><p><img src="./images/img022.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doRegister</span><span class="params">(User userForm)</span>;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">doLogin</span><span class="params">(User userForm)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>开发中，接口设计和接口中方式定义的理念：</p><ul><li>方法的返回值应该对应这个方法本身的业务功能<ul><li>写操作：没有返回值</li><li>读操作：有返回值，返回值就是查询的结果</li></ul></li><li>方法执行是否成功<ul><li>成功：不抛异常</li><li>失败：抛异常</li></ul></li></ul><blockquote><p>启发：</p><p>上层方法向下层方法布置任务：方法名、方法的参数</p><p>下层方法向上层方法反馈结果：返回值、是否抛异常</p></blockquote><h4 id="2-实现UserService接口">[2]实现UserService接口</h4><p><img src="./images/img023.png" alt="./images"></p><p><img src="./images/img024.png" alt="./images"></p><h5 id="1-UserDao声明为成员变量">(1)UserDao声明为成员变量</h5><p>说明：将来在Servlet中使用Service的时候，也是同样声明为成员变量，那么从Servlet、Service到Dao就都是<span style="color:blue;font-weight:bold;">『单实例，多线程』</span>方式运行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRegister</span><span class="params">(User userForm)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">doLogin</span><span class="params">(User userForm)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>理由：</p><ul><li>创建对象的操作只执行一次</li><li>对象在内存中只保存一份，不会过多占用内存空间</li></ul><h5 id="2-实现注册功能">(2)实现注册功能</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doRegister</span><span class="params">(User userForm)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从userForm对象中获取用户通过表单提交的用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> userForm.getUserName();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据用户名调用UserDao方法查询对应的User对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userDao.selectUserByName(userName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.检查User对象是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (userDB != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 4.如果User对象不为空，则抛出异常，通知上层调用方法：用户名已经被占用</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名已经被占用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.对表单提交的密码执行MD5加密</span></span><br><span class="line">    <span class="comment">// ①取出表单的密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userPwd</span> <span class="operator">=</span> userForm.getUserPwd();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ②执行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> MD5Util.encode(userPwd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ③将加密得到的密文字符串设置回userForm对象</span></span><br><span class="line">    userForm.setUserPwd(encode);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.调用UserDao方法将userForm对象保存到数据库</span></span><br><span class="line">    userDao.insertUser(userForm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-修改RegisterServlet">[3]修改RegisterServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取数据封装为User对象</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">userForm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, password, email);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.调用UserService的方法执行注册</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        userService.doRegister(userForm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.如果没有抛出异常那么就跳转到注册成功的页面</span></span><br><span class="line">        <span class="comment">// 选择重定向的原因：跳转到regist_success.html页面后，用户刷新浏览器不会重复提交注册表单</span></span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/pages/user/regist_success.html&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.如果抛出了异常</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;注册失败：&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、登录功能">3、登录功能</h2><h3 id="①关键点提示">①关键点提示</h3><p>对用户密码进行验证时，无法将密文解密为明文，只能将明文再次加密为密文，<span style="color:blue;font-weight:bold;">『比较密文是否一致』</span>。</p><h3 id="②思路-2">②思路</h3><p><img src="./images/img025.png" alt="./images"></p><h3 id="③代码-2">③代码</h3><h4 id="1-UserService接口的doLogin">[1]UserService接口的doLogin()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">doLogin</span><span class="params">(User userForm)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.获取表单提交的用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> userForm.getUserName();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据用户名调用UserDao方法查询User对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userDao.selectUserByName(userName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.检查数据库查询的User对象是否为null</span></span><br><span class="line">    <span class="keyword">if</span> (userDB == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 4.如果数据库查询的User对象为null，说明用户名不正确，抛出异常：登录失败</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码不正确&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.密码验证</span></span><br><span class="line">    <span class="comment">// ①获取表单提交的密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userPwdForm</span> <span class="operator">=</span> userForm.getUserPwd();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ②对表单提交的密码进行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> MD5Util.encode(userPwdForm);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ③获取数据库查询到的密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userPwdDB</span> <span class="operator">=</span> userDB.getUserPwd();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ④比较表单密码和数据库密码</span></span><br><span class="line">    <span class="keyword">if</span> (Objects.equals(encode, userPwdDB)) &#123;</span><br><span class="line">        <span class="comment">// 6.如果密码验证成功，则将从数据库查询出来的User对象返回</span></span><br><span class="line">        <span class="keyword">return</span> userDB;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 7.如果密码验证失败，说明密码不正确，抛出异常：登录失败</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码不正确&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-LoginServlet的doPost-方法">[2]LoginServlet的doPost()方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.从请求参数中获取用户名和密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.封装为User对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">userForm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, username, password, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.调用UserService的方法执行登录验证</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userService.doLogin(userForm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.登录成功后跳转到登录成功页面</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/pages/user/login_success.html&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.登录失败则显示提示消息</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;登录失败：&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse04.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse04/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse04/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第四节 持久化层</h1><h2 id="1、加入所需jar包">1、加入所需jar包</h2><p><img src="./images/img013.png" alt="./images"></p><p><img src="./images/img014.png" alt="./images"></p><p><img src="./images/img015.png" alt="./images"></p><h2 id="2、创建连接数据库的工具类">2、创建连接数据库的工具类</h2><p><img src="./images/img016.png" alt="./images"></p><h2 id="3、创建外部属性文件">3、创建外部属性文件</h2><p><img src="./images/img017.png" alt="./images"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://192.168.198.100:3306/bookstore210107</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">atguigu</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="attr">maxWait</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure><p>注意：这里是上课演示时使用的参数，大家操作时要改成自己的。</p><h2 id="4、在JDBCUtils类中创建数据源对象">4、在JDBCUtils类中创建数据源对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.创建一个用于存储外部属性文件信息的Properties对象</span></span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.使用当前类的类加载器加载外部属性文件：jdbc.properties</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> JDBCUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.将外部属性文件jdbc.properties中的数据加载到properties对象中</span></span><br><span class="line">        properties.load(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.创建数据源对象</span></span><br><span class="line">        dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5、声明工具方法操作数据库连接">5、声明工具方法操作数据库连接</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从数据源中获取数据库连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 数据库连接对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = dataSource.getConnection();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> connection;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 释放数据库连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> connection 要执行释放操作的连接对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">releaseConnection</span><span class="params">(Connection connection)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookstoreTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnection</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;connection = &quot;</span> + connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6、创建BaseDao">6、创建BaseDao</h2><h3 id="①DAO概念">①DAO概念</h3><p>DAO：Data Access Object数据访问对象</p><p>DAL：Data Access Layer数据访问层</p><h3 id="②创建Java类">②创建Java类</h3><p><img src="./images/img018.png" alt="./images"></p><h3 id="③编写通用方法">③编写通用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 各个具体Dao类的基类，泛型T对应具体实体类类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseDao</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用的增删改方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 要执行的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param 为SQL语句准备好的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">updatedRowCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            updatedRowCount = queryRunner.update(connection, sql, param);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 为了让上层方法调用方便，将编译时异常捕获</span></span><br><span class="line">        <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 为了不掩盖问题，将编译时异常封装为运行时异常抛出</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtils.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> updatedRowCount;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询单个对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 单个对象所对应的实体类类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   查询单个对象所需要的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param SQL语句的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      查询到的单个对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            t = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtils.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询集合对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 集合中单个对象所对应的实体类类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql   查询集合所需要的SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param SQL语句的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      查询到的集合对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getBeanList</span><span class="params">(Class&lt;T&gt; clazz, String sql, Object ... param)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line"></span><br><span class="line">        List&lt;T&gt; list = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            list = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(clazz), param);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭数据库连接</span></span><br><span class="line">            JDBCUtils.releaseConnection(connection);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    BaseDao&lt;Object&gt; baseDao = <span class="keyword">new</span> <span class="title class_">BaseDao</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(user_name,user_pwd) values(?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> baseDao.update(sql, <span class="string">&quot;罗志祥&quot;</span>, <span class="string">&quot;789456&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBean</span><span class="params">()</span> &#123;</span><br><span class="line">    BaseDao&lt;User&gt; baseDao = <span class="keyword">new</span> <span class="title class_">BaseDao</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// user_id userId</span></span><br><span class="line">    <span class="comment">// user_name userName</span></span><br><span class="line">    <span class="comment">// user_pwd userPwd</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select user_id userId,user_name userName,user_pwd userPwd from t_user where user_id=?&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> baseDao.getBean(User.class, sql, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBeanList</span><span class="params">()</span> &#123;</span><br><span class="line">    BaseDao&lt;User&gt; baseDao = <span class="keyword">new</span> <span class="title class_">BaseDao</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select user_id userId,user_name userName,user_pwd userPwd from t_user&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = baseDao.getBeanList(User.class, sql);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7、创建UserDao">7、创建UserDao</h2><h3 id="①用户登录注册功能中的组件关系图">①用户登录注册功能中的组件关系图</h3><p><img src="./images/img019.png" alt="./images"></p><h3 id="②声明UserDao接口">②声明UserDao接口</h3><p><img src="./images/img020.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查询User对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 查询到的User对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">selectUserByName</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将User对象保存到数据库</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 要保存的User对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 受影响的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="③声明UserDaoImpl实现类">③声明UserDaoImpl实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseDao</span>&lt;User&gt; <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">selectUserByName</span><span class="params">(String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select user_id userId,user_name userName,user_pwd userPwd,email from t_user where user_name=?&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getBean(User.class, sql, username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_user(user_name,user_pwd,email) values(?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.update(sql, user.getUserName(), user.getUserPwd(), user.getEmail());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="④测试方法">④测试方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserDaoGetUserByName</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectUserByName(<span class="string">&quot;陈冠希&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserDaoSaveUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;陈冠希&quot;</span>, <span class="string">&quot;666666&quot;</span>, <span class="string">&quot;aaa@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> userDao.insertUser(user);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="verse03.html">上一节</a> <a href="index.html">回目录</a> <a href="verse05.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 三层架构</h1><h2 id="1、三层架构划分">1、三层架构划分</h2><p><img src="./images/img008.png" alt="./images"></p><ul><li>表述层：负责处理浏览器请求、返回响应、页面调度</li><li>业务逻辑层：负责处理业务逻辑，根据业务逻辑把持久化层从数据库查询出来的数据进行运算、组装，封装好后返回给表述层，也可以根据业务功能的需要调用持久化层把数据保存到数据库、修改数据库中的数据、删除数据库中的数据</li><li>持久化层：根据上一层的调用对数据库中的数据执行增删改查的操作</li></ul><h2 id="2、三层架构好处">2、三层架构好处</h2><p>如果不做三层架构形式的拆分：</p><p><img src="./images/img009.png" alt="./images"></p><p>所有和当前业务功能需求相关的代码全部耦合在一起，如果其中有任何一个部分出现了问题，牵一发而动全身，导致其他无关代码也要进行相应的修改。这样的话代码会非常难以维护。</p><p>所以为了提高开发效率，需要对代码进行模块化的拆分。整个项目模块化、组件化程度越高，越容易管理和维护，出现问题更容易排查。</p><h2 id="3、三层架构和模型的关系">3、三层架构和模型的关系</h2><p><img src="./images/img010.png" alt="./images"></p><p>模型对整个项目中三层架构的每一层都提供支持，具体体现是使用模型对象<span style="color:blue;font-weight:bold;">封装业务功能数据</span>。</p><blockquote><p>Java实体类有很多不同名称：</p><ul><li>POJO：Plain old Java Object，传统的普通的Java对象</li><li>entity：实体类</li><li>bean或Java bean</li><li>domain：领域模型</li></ul></blockquote><h2 id="4、模型开发的要求">4、模型开发的要求</h2><h3 id="①ORM">①ORM</h3><p>ORM：Object Relative Mapping对象关系映射</p><p>对象：Java对象</p><p>关系：关系型数据库</p><p>映射：Java对象和数据库表之间的对应关系</p><table><thead><tr><th>Java类</th><th>数据库表</th></tr></thead><tbody><tr><td>类</td><td>表</td></tr><tr><td>属性</td><td>字段/列</td></tr><tr><td>对象</td><td>记录/行</td></tr><tr><td>属性按照驼峰式命名</td><td>字段名各个单词之间用下划线分开</td></tr></tbody></table><h3 id="②Java实体类的要求">②Java实体类的要求</h3><ul><li><p>必须有一个无参构造器</p><p>将来使用框架后，大量的对象都是框架通过反射来创建的。</p><p>Class&lt;T&gt; clazz = Class.forName(“全类名”);</p><p>clazz.newInstance();</p></li><li><p>通过getXxx()、setXxx()方法定义属性：getXxx()或setXxx()方法去掉get或set后，Xxx把首字母小写，得到的xxx就是属性名。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String safeUserName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.safeUserName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.safeUserName = userName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面例子中，getXxx()、setXxx()方法定义的属性是userName，不是safeUserName。</p><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 建模</h1><h2 id="1、创建数据库">1、创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE bookstore210107 <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line">USE `bookstore210107`;</span><br></pre></td></tr></table></figure><h2 id="2、创建数据库表">2、创建数据库表</h2><p>物理建模的思路<a href="xxx">参考这里</a>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user(</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    user_name <span class="type">CHAR</span>(<span class="number">100</span>),</span><br><span class="line">    user_pwd <span class="type">CHAR</span>(<span class="number">100</span>),</span><br><span class="line">    email <span class="type">CHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="3、创建Java实体类">3、创建Java实体类</h2><p><img src="./images/img011.png" alt="./images"></p><p><img src="./images/img012.png" alt="./images"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer userId;<span class="comment">// user_id</span></span><br><span class="line">    <span class="keyword">private</span> String userName;<span class="comment">// user_name</span></span><br><span class="line">    <span class="keyword">private</span> String userPwd;<span class="comment">// user_pwd</span></span><br><span class="line">    <span class="keyword">private</span> String email;<span class="comment">// email</span></span><br><span class="line">    ……</span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a> <a href="verse04.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 不带数据库的登录注册</h1><h2 id="1、创建动态Web工程">1、创建动态Web工程</h2><p><img src="./images/img001.png" alt="./images"></p><h2 id="2、把V1中的页面粘贴过来">2、把V1中的页面粘贴过来</h2><p><img src="./images/img002.png" alt="./images"></p><h2 id="3、使用base标签统一设置路径基准">3、使用base标签统一设置路径基准</h2><h3 id="①base标签的语法规则">①base标签的语法规则</h3><ul><li>base标签要写在head标签内</li><li>base标签必须写在所有其他有路径的标签的前面</li><li>base标签使用href属性设置路径的基准</li><li>base标签生效的机制是：最终的访问地址=base标签href属性设置的基准+具体标签内的路径</li><li>对于想要参考base标签的具体标签，如果路径是以斜杠开头，那么它将不参考base标签</li></ul><h3 id="②base标签使用举例">②base标签使用举例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>书城首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/minireset.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/common.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/iconfont.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/index.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;static/css/swiper.min.css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、基于base标签调整整个页面的路径">4、基于base标签调整整个页面的路径</h2><h3 id="①base标签的代码">①base标签的代码</h3><p>在需要的页面把下面的base标签代码粘贴到head标签内、需要路径的标签前即可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;/bookstore/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②对需要统一调整的路径执行替换">②对需要统一调整的路径执行替换</h3><p>Ctrl+r调出替换操作窗口</p><p><img src="./images/img003.png" alt="./images"></p><p>具体操作时请参考页面的实际情况进行替换。</p><h2 id="5、基本假设">5、基本假设</h2><p>为了实现『不带数据库』的登录注册，我们需要假设：系统中目前已有用户：</p><table><thead><tr><th>用户名</th><th>密码</th></tr></thead><tbody><tr><td>tom</td><td>123456</td></tr></tbody></table><h2 id="6、登录功能">6、登录功能</h2><h3 id="①明确目标">①明确目标</h3><p>在服务器端检查用户通过表单提交的用户名、密码是否正确。</p><ul><li>成功：跳转到login_success.html页面</li><li>失败：返回错误消息</li></ul><h3 id="②思路">②思路</h3><p>友情提示：分析业务功能，捋清思路最好的办法就是画流程图</p><p><img src="./images/img004.png" alt="./images"></p><h3 id="③代码">③代码</h3><h4 id="1-创建LoginServlet">[1]创建LoginServlet</h4><p><img src="./images/img005.png" alt="./images"></p><blockquote><p>创建Packages时的规范：</p><p>公司或组织域名倒序.项目名.模块名.具体包名</p><p>或</p><p>公司或组织域名倒序.项目名.具体包名</p></blockquote><p>下面是完整的Servlet配置信息：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>LoginServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/LoginServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-完成doPost-方法中的代码">[2]完成doPost()方法中的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.声明两个变量，用于存储假设的用户名、密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">usernameSystem</span> <span class="operator">=</span> <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">passwordSystem</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取请求参数中的用户名、密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">usernameForm</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">passwordForm</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.执行判断</span></span><br><span class="line">    <span class="keyword">if</span>(usernameSystem.equals(usernameForm) &amp;&amp; passwordSystem.equals(passwordForm)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.登录成功：重定向到登录成功页面</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/pages/user/login_success.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.登录失败</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;抱歉！用户名或密码不正确，请重新输入！&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-HTML页面设置表单提交地址">[3]HTML页面设置表单提交地址</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;LoginServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名称：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sub_btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;loginCheck&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="④提示消息改进探索">④提示消息改进探索</h3><p>以下代码仅供参考：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.登录失败</span></span><br><span class="line"><span class="comment">// 返回提示消息方案一：过于简陋</span></span><br><span class="line"><span class="comment">// response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span></span><br><span class="line"><span class="comment">// response.getWriter().write(&quot;抱歉！用户名或密码不正确，请重新输入！&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回提示消息方案二：没有提示消息，让用户非常困惑</span></span><br><span class="line"><span class="comment">// request.getRequestDispatcher(&quot;/pages/user/login.html&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回提示消息方案三：确实能在登录页面显示提示消息，但是实现的方式让我想骂人</span></span><br><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"><span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">writer.write(<span class="string">&quot;&lt;!DOCTYPE html&gt;&quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">writer.write(<span class="string">&quot;&lt;base href=&#x27;/bookstore/&#x27; /&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="7、注册功能">7、注册功能</h2><h3 id="①明确目标-2">①明确目标</h3><p>用户提交注册表单后，检查用户名是否被占用</p><ul><li>没有被占用：注册成功</li><li>已经被占用：注册失败</li></ul><h3 id="②思路-2">②思路</h3><p><img src="./images/img006.png" alt="./images"></p><h3 id="③代码-2">③代码</h3><h4 id="1-创建RegisterServlet">[1]创建RegisterServlet</h4><p><img src="./images/img007.png" alt="./images"></p><p>完整配置信息：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.atguigu.bookstore.servlet.RegisterServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>RegisterServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/RegisterServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-完成doPost-方法中的代码-2">[2]完成doPost()方法中的代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.声明变量保存系统内置的用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">usernameSystem</span> <span class="operator">=</span> <span class="string">&quot;jerry&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.获取请求参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">usernameForm</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.比较</span></span><br><span class="line">    <span class="keyword">if</span> (usernameSystem.equals(usernameForm)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.说明用户名已经被占用，需要提示错误消息</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        writer.write(<span class="string">&quot;抱歉！用户名已经被占用，请重新输入！&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.说明用户名可用，跳转到注册成功页面</span></span><br><span class="line">        response.sendRedirect(request.getContextPath() + <span class="string">&quot;/pages/user/regist_success.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-HTML页面调整表单中的设置">[3]HTML页面调整表单中的设置</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;registerForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;RegisterServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;usernameCheckMessage&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>密码的长度至少为8位<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>确认密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;passwordConfirm&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入确认密码&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>密码两次输入不一致<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户邮箱:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入邮箱&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>请输入正确的邮箱格式<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;verify&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;code&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;static/img/code.bmp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>请输入正确的验证码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;registerCheck&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore02/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第二阶段</h1><p><a href="verse01.html">第一节 不带数据库的登录注册</a></p><p><a href="verse02.html">第二节 三层架构</a></p><p><a href="verse03.html">第三节 建模</a></p><p><a href="verse04.html">第四节 持久化层</a></p><p><a href="verse05.html">第五节 完成带数据库的登录注册</a></p><p><a href="../index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse02/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse02/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第二节 正则表达式</h1><h2 id="1、从凤姐的择偶标准说起">1、从凤姐的择偶标准说起</h2><p><img src="./images/img005.png" alt="images"></p><p>本人对伴侣要求如下：</p><ul><li>第一、必须为北京大学或清华大学硕士毕业生。必须本科硕士连读，中途无跳级，不留级，不转校。在外参加工作后再回校读书者免。</li><li>第二、必须为经济学专业毕业。非经济学专业毕业则必须精通经济学。或对经济学有浓厚的兴趣。</li><li>第三、必须具备国际视野，但是无长期定居国外甚至移民的打算。</li><li>第四、身高176–183左右。长得越帅越好。</li><li>第五、无生育史。过往所有女友均无因自身而致的堕胎史。</li><li>第六、东部户籍，即江、浙、沪三地户籍或黑龙江、广东、天津、山东、北京、吉林、辽宁等。</li><li>东北三省和内蒙古等地户籍，西南地区即重庆、贵州、云南、西藏和湖南、湖北等地籍贯者不予考虑。</li><li>第七、年龄25–28岁左右。即06届，07届，08届，09届毕业生。有一至两年的工作经验，06级毕业生需年龄在28岁左右，09级毕业生则需聪明过人。且具备丰富的社会实践经验。就职于国家机关，国有企事业单位者不愿考虑。但就职于中石油，中石化等世界顶尖型企业或银行者又比较喜欢。现自主创业者要商榷一番了。</li></ul><h2 id="2、标准在手，世界我有">2、标准在手，世界我有</h2><h3 id="①模式验证">①模式验证</h3><p>使用标准衡量一位具体的男士，返回一个布尔值，从而知道这位男士是否满足自己的标准——相当于我们使用正则表达式验证一个字符串是否满足规则。比如验证一个字符串是否是一个身份证号。</p><h3 id="②匹配读取">②匹配读取</h3><p>对全中国的男士应用这个标准，返回一个数组，遍历这个数组，可以得到所有符合标准的男士——相当于我们使用正则表达式获取一段文本中匹配的子字符串。比如将一篇文章中的电子邮件地址读取出来。</p><h3 id="③匹配替换">③匹配替换</h3><p>对全中国的男士应用这个标准，把其中已婚的变成未婚，这样凤姐就有机会了——相当于我们使用正则表达式替换所有匹配的部分。比如将一段文字中的”HelloWorld”替换为”HelloJava”。</p><blockquote><p>花絮：</p><p>记者：封老师您好！由于您的名字『封捷』和『凤姐』谐音，同学们总是以此来调侃您，说您是尚硅谷『凤姐』，对此您有什么想说的吗？</p><p>封老师：太过分了！我咋能和人家比！</p><p>记者：呃……太意外了，您的意思是？</p><p>封老师：虽然过气了，但人家好歹也是网红呀！</p></blockquote><h2 id="3、正则表达式的概念">3、正则表达式的概念</h2><p>使用一段<span style="color:blue;font-weight:bold;">字符串</span>定义的一个<span style="color:blue;font-weight:bold;">规则</span>，用以<span style="color:blue;font-weight:bold;">检测</span>某个字符串是否满足这个规则，或将目标字符串中满足规则的部分<span style="color:blue;font-weight:bold;">读取</span>出来，又或者将目标字符串中满足标准的部分<span style="color:blue;font-weight:bold;">替换</span>为其他字符串。所以正则表达式有三个主要用途：</p><ul><li>模式验证</li><li>匹配读取</li><li>匹配替换</li></ul><p><img src="./images/img006.png" alt="images"></p><h2 id="4、正则表达式零起步">4、正则表达式零起步</h2><h3 id="①创建正则表达式对象">①创建正则表达式对象</h3><h4 id="1-使用两个斜杠">[1]使用两个斜杠</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类似创建数组时可以使用[]、创建对象可以使用&#123;&#125;</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/a/</span>;</span><br></pre></td></tr></table></figure><h4 id="2-使用new关键字创建RegExp类型的对象">[2]使用new关键字创建RegExp类型的对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类似创建数组可以new Array()、创建对象可以使用new Object()</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;a&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="②正则表达式的组成">②正则表达式的组成</h3><p>正则表达式本身也是一个字符串，它由两种字符组成：</p><ul><li>普通字符，例如大、小写英文字母；数字等。</li><li>元字符：被系统赋予特殊含义的字符。例如：^表示以某个字符串开始，$表示以某个字符串结束。</li></ul><h3 id="③正则表达式初体验">③正则表达式初体验</h3><h4 id="1-模式验证">[1]模式验证</h4><p><span style="color:blue;font-weight:bold;">注意</span>：这里是使用<span style="color:blue;font-weight:bold;">正则表达式对象</span>来<span style="color:blue;font-weight:bold;">调用</span>方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个最简单的正则表达式对象</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/o/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个字符串对象作为目标字符串</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用正则表达式对象的test()方法验证目标字符串是否满足我们指定的这个模式，返回结果true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/o/.test(&#x27;Hello World!&#x27;)=&quot;</span>+reg.<span class="title function_">test</span>(str));</span><br></pre></td></tr></table></figure><h4 id="2-匹配读取">[2]匹配读取</h4><p><span style="color:blue;font-weight:bold;">注意</span>：这里是使用<span style="color:blue;font-weight:bold;">字符串对象</span>来<span style="color:blue;font-weight:bold;">调用</span>方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在目标字符串中查找匹配的字符，返回匹配结果组成的数组</span></span><br><span class="line"><span class="keyword">var</span> resultArr = str.<span class="title function_">match</span>(reg);</span><br><span class="line"><span class="comment">// 数组长度为1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr.length=&quot;</span>+resultArr.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组内容是o</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr[0]=&quot;</span>+resultArr[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><h4 id="3-替换">[3]替换</h4><p><span style="color:blue;font-weight:bold;">注意</span>：这里是使用<span style="color:blue;font-weight:bold;">字符串对象</span>来<span style="color:blue;font-weight:bold;">调用</span>方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newStr = str.<span class="title function_">replace</span>(reg,<span class="string">&#x27;@&#x27;</span>);</span><br><span class="line"><span class="comment">// 只有第一个o被替换了，说明我们这个正则表达式只能匹配第一个满足的字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str.replace(reg)=&quot;</span>+newStr);<span class="comment">//Hell@ World!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原字符串并没有变化，只是返回了一个新字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str=&quot;</span>+str);<span class="comment">//str=Hello World!</span></span><br></pre></td></tr></table></figure><h3 id="④匹配方式">④匹配方式</h3><h4 id="1-全文查找">[1]全文查找</h4><p>如果不使用g对正则表达式对象进行修饰，则使用正则表达式进行查找时，仅返回第一个匹配；使用g后，返回所有匹配。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标字符串</span></span><br><span class="line"><span class="keyword">var</span> targetStr = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有使用全局匹配的正则表达式</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/[A-Z]/</span>;</span><br><span class="line"><span class="comment">// 获取全部匹配</span></span><br><span class="line"><span class="keyword">var</span> resultArr = targetStr.<span class="title function_">match</span>(reg);</span><br><span class="line"><span class="comment">// 数组长度为1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr.length=&quot;</span>+resultArr.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历数组，发现只能得到&#x27;H&#x27;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultArr.<span class="property">length</span>; i++)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr[&quot;</span>+i+<span class="string">&quot;]=&quot;</span>+resultArr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标字符串</span></span><br><span class="line"><span class="keyword">var</span> targetStr = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用了全局匹配的正则表达式</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/[A-Z]/g</span>;</span><br><span class="line"><span class="comment">// 获取全部匹配</span></span><br><span class="line"><span class="keyword">var</span> resultArr = targetStr.<span class="title function_">match</span>(reg);</span><br><span class="line"><span class="comment">// 数组长度为2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr.length=&quot;</span>+resultArr.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历数组，发现可以获取到“H”和“W”</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultArr.<span class="property">length</span>; i++)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr[&quot;</span>+i+<span class="string">&quot;]=&quot;</span>+resultArr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-忽略大小写">[2]忽略大小写</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标字符串</span></span><br><span class="line"><span class="keyword">var</span> targetStr = <span class="string">&#x27;Hello WORLD!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//没有使用忽略大小写的正则表达式</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/o/g</span>;</span><br><span class="line"><span class="comment">//获取全部匹配</span></span><br><span class="line"><span class="keyword">var</span> resultArr = targetStr.<span class="title function_">match</span>(reg);</span><br><span class="line"><span class="comment">//数组长度为1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr.length=&quot;</span>+resultArr.<span class="property">length</span>);</span><br><span class="line"><span class="comment">//遍历数组，仅得到&#x27;o&#x27;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultArr.<span class="property">length</span>; i++)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr[&quot;</span>+i+<span class="string">&quot;]=&quot;</span>+resultArr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标字符串</span></span><br><span class="line"><span class="keyword">var</span> targetStr = <span class="string">&#x27;Hello WORLD!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用了忽略大小写的正则表达式</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/o/gi</span>;</span><br><span class="line"><span class="comment">//获取全部匹配</span></span><br><span class="line"><span class="keyword">var</span> resultArr = targetStr.<span class="title function_">match</span>(reg);</span><br><span class="line"><span class="comment">//数组长度为2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr.length=&quot;</span>+resultArr.<span class="property">length</span>);</span><br><span class="line"><span class="comment">//遍历数组，得到&#x27;o&#x27;和&#x27;O&#x27;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultArr.<span class="property">length</span>; i++)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resultArr[&quot;</span>+i+<span class="string">&quot;]=&quot;</span>+resultArr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-多行查找">[3]多行查找</h4><p>不使用多行查找模式，目标字符串中不管有没有换行符都会被当作一行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标字符串1</span></span><br><span class="line"><span class="keyword">var</span> targetStr01 = <span class="string">&#x27;Hello\nWorld!&#x27;</span>;</span><br><span class="line"><span class="comment">//目标字符串2</span></span><br><span class="line"><span class="keyword">var</span> targetStr02 = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//匹配以&#x27;Hello&#x27;结尾的正则表达式，没有使用多行匹配</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/Hello$/</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(targetStr01));<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(targetStr02));<span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>对比代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标字符串1</span></span><br><span class="line"><span class="keyword">var</span> targetStr01 = <span class="string">&#x27;Hello\nWorld!&#x27;</span>;</span><br><span class="line"><span class="comment">//目标字符串2</span></span><br><span class="line"><span class="keyword">var</span> targetStr02 = <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//匹配以&#x27;Hello&#x27;结尾的正则表达式，使用了多行匹配</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/Hello$/m</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(targetStr01));<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="title function_">test</span>(targetStr02));<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h2 id="5、元字符">5、元字符</h2><h3 id="①概念">①概念</h3><p>在正则表达式中被赋予特殊含义的字符，不能被直接当做普通字符使用。如果要匹配元字符本身，需要对元字符进行转义，转义的方式是在元字符前面加上“\”，例如：^</p><h3 id="②常用元字符">②常用元字符</h3><table><thead><tr><th>代码</th><th>说明</th></tr></thead><tbody><tr><td>.</td><td>匹配除换行字符以外的任意字符。</td></tr><tr><td>\w</td><td>匹配字母或数字或下划线等价于[a-zA-Z0-9_]</td></tr><tr><td>\W</td><td>匹配任何非单词字符。等价于[^A-Za-z0-9_]</td></tr><tr><td>\s</td><td>匹配任意的空白符，包括空格、制表符、换页符等等。等价于[\f\n\r\t\v]。</td></tr><tr><td>\S</td><td>匹配任何非空白字符。等价于[^\f\n\r\t\v]。</td></tr><tr><td>\d</td><td>匹配数字。等价于[0-9]。</td></tr><tr><td>\D</td><td>匹配一个非数字字符。等价于[^0-9]</td></tr><tr><td>\b</td><td>匹配单词的开始或结束</td></tr><tr><td>^</td><td>匹配字符串的开始，但在[]中使用表示取反</td></tr><tr><td>$</td><td>匹配字符串的结束</td></tr></tbody></table><h4 id="1-例1">[1]例1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;one two three four&#x27;</span>;</span><br><span class="line"><span class="comment">// 匹配全部空格</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\s/g</span>;</span><br><span class="line"><span class="comment">// 将空格替换为@</span></span><br><span class="line"><span class="keyword">var</span> newStr = str.<span class="title function_">replace</span>(reg,<span class="string">&#x27;@&#x27;</span>); <span class="comment">// one@two@three@four</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;newStr=&quot;</span>+newStr);</span><br></pre></td></tr></table></figure><h4 id="2-例2">[2]例2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;今年是2014年&#x27;</span>;</span><br><span class="line"><span class="comment">// 匹配至少一个数字</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\d+/g</span>;</span><br><span class="line">str = str.<span class="title function_">replace</span>(reg,<span class="string">&#x27;abcd&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;str=&#x27;</span>+str); <span class="comment">// 今年是abcd年</span></span><br></pre></td></tr></table></figure><h4 id="3-例3">[3]例3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str01 = <span class="string">&#x27;I love Java&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> str02 = <span class="string">&#x27;Java love me&#x27;</span>;</span><br><span class="line"><span class="comment">// 匹配以Java开头</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^Java/g</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str01)=&#x27;</span>+reg.<span class="title function_">test</span>(str01)); <span class="comment">// flase</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&lt;br /&gt;&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str02)=&#x27;</span>+reg.<span class="title function_">test</span>(str02)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="4-例4">[4]例4</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str01 = <span class="string">&#x27;I love Java&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> str02 = <span class="string">&#x27;Java love me&#x27;</span>;</span><br><span class="line"><span class="comment">// 匹配以Java结尾</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/Java$/g</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str01)=&#x27;</span>+reg.<span class="title function_">test</span>(str01)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&lt;br /&gt;&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str02)=&#x27;</span>+reg.<span class="title function_">test</span>(str02)); <span class="comment">// flase</span></span><br></pre></td></tr></table></figure><h2 id="6、字符集合">6、字符集合</h2><table><thead><tr><th>语法格式</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>[字符列表]</td><td>正则表达式：[abc]<br />含义：目标字符串包含abc中的任何一个字符<br />目标字符串：plain<br />是否匹配：是<br />原因：plain中的“a”在列表“abc”中</td><td>目标字符串中任何一个字符出现在字符列表中就算匹配。</td></tr><tr><td>[^字符列表]</td><td>[^abc]<br />含义：目标字符串包含abc以外的任何一个字符<br />目标字符串：plain<br />是否匹配：是<br />原因：plain中包含“p”、“l”、“i”、“n”</td><td>匹配字符列表中未包含的任意字符。</td></tr><tr><td>[字符范围]</td><td>正则表达式：[a-z]<br />含义：所有小写英文字符组成的字符列表<br />正则表达式：[A-Z]<br />含义：所有大写英文字符组成的字符列表</td><td>匹配指定范围内的任意字符。</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str01 = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> str02 = <span class="string">&#x27;I am Tom&#x27;</span>;</span><br><span class="line"><span class="comment">//匹配abc中的任何一个</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/[abc]/g</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str01)=&#x27;</span>+reg.<span class="title function_">test</span>(str01));<span class="comment">//flase</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;reg.test(str02)=&#x27;</span>+reg.<span class="title function_">test</span>(str02));<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h2 id="7、重复">7、重复</h2><table><thead><tr><th>代码</th><th>说明</th></tr></thead><tbody><tr><td>*</td><td>重复零次或多次</td></tr><tr><td>+</td><td>重复一次或多次</td></tr><tr><td>?</td><td>重复零次或一次</td></tr><tr><td>{n}</td><td>重复n次</td></tr><tr><td>{n,}</td><td>重复n次或多次</td></tr><tr><td>{n,m}</td><td>重复n到m次</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/[a]&#123;3&#125;/.test(&#x27;aa&#x27;)=&quot;</span>+<span class="regexp">/[a]&#123;3&#125;/g</span>.<span class="title function_">test</span>(<span class="string">&#x27;aa&#x27;</span>)); <span class="comment">// flase</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/[a]&#123;3&#125;/.test(&#x27;aaa&#x27;)=&quot;</span>+<span class="regexp">/[a]&#123;3&#125;/g</span>.<span class="title function_">test</span>(<span class="string">&#x27;aaa&#x27;</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/[a]&#123;3&#125;/.test(&#x27;aaaa&#x27;)=&quot;</span>+<span class="regexp">/[a]&#123;3&#125;/g</span>.<span class="title function_">test</span>(<span class="string">&#x27;aaaa&#x27;</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="8、在正则表达式中表达『或者』">8、在正则表达式中表达『或者』</h2><p>使用符号：|</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标字符串</span></span><br><span class="line"><span class="keyword">var</span> str01 = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> str02 = <span class="string">&#x27;I love Java&#x27;</span>;</span><br><span class="line"><span class="comment">// 匹配&#x27;World&#x27;或&#x27;Java&#x27;</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/World|Java/g</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str01.match(reg)[0]=&quot;</span>+str01.<span class="title function_">match</span>(reg)[<span class="number">0</span>]);<span class="comment">//World</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str02.match(reg)[0]=&quot;</span>+str02.<span class="title function_">match</span>(reg)[<span class="number">0</span>]);<span class="comment">//Java</span></span><br></pre></td></tr></table></figure><h2 id="9、常用正则表达式">9、常用正则表达式</h2><table><thead><tr><th>需求</th><th>正则表达式</th></tr></thead><tbody><tr><td>用户名</td><td>/^[a-zA-Z_][a-zA-Z_\-0-9]{5,9}$/</td></tr><tr><td>密码</td><td>/^[a-zA-Z0-9_\-@\#\&amp;\*]{6,12}$/</td></tr><tr><td>前后空格</td><td>/^\s+|\s+$/g</td></tr><tr><td>电子邮箱</td><td>/^[a-zA-Z0-9_\.-]+@([a-zA-Z0-9-]+[\.]{1})+[a-zA-Z]+$/</td></tr></tbody></table><p><a href="verse01.html">上一节</a> <a href="index.html">回目录</a> <a href="verse03.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse03/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse03/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第三节 第一阶段要实现的功能</h1><h2 id="0、准备工作">0、准备工作</h2><p>创建目录后，把一整套现成的前端页面复制到新建的目录下，然后用HBuilderX打开这个目录。然后把vue.js文件复制到script目录下。</p><p><img src="./images/img002.png" alt="./images"></p><h2 id="1、登录页面的表单验证">1、登录页面的表单验证</h2><h3 id="①规则设定">①规则设定</h3><ul><li>用户名非空</li><li>密码非空</li></ul><h3 id="②在login-html页面中加入Vue的环境">②在login.html页面中加入Vue的环境</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/bookstoreV01/static/script/vue.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./images/img003.png" alt="./images"></p><h3 id="③思路">③思路</h3><p><img src="./images/img004.png" alt="./images"></p><h3 id="④代码实现">④代码实现</h3><h4 id="1-HTML代码">[1]HTML代码</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;login_success.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名称：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">v-model:value</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sub_btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;loginCheck&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-Vue代码">[2]Vue代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#loginForm&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;loginCheck&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断用户名或密码是否为空</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">username</span> == <span class="string">&quot;&quot;</span> || <span class="variable language_">this</span>.<span class="property">password</span> == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line"><span class="comment">// 如果不满足验证条件，那么阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2、注册页面的表单验证">2、注册页面的表单验证</h2><h3 id="①HTML代码">①HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;registerForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;regist_success.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名称:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;usernameCheckMessage&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>密码的长度至少为8位<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>确认密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;passwordConfirm&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入确认密码&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>密码两次输入不一致<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>用户邮箱:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入邮箱&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>请输入正确的邮箱格式<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;verify&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model:value</span>=<span class="string">&quot;code&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../static/img/code.bmp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;errMess&quot;</span>&gt;</span>请输入正确的验证码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;registerCheck&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②Vue代码">②Vue代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line"><span class="string">&quot;el&quot;</span>:<span class="string">&quot;#registerForm&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;passwordConfirm&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;email&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;code&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;usernameCheckMessage&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;watch&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="keyword">function</span>(<span class="params">inputValue</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> usernameRegExp = <span class="regexp">/^[A-Z,a-z,0-9,_]&#123;5,8&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (usernameRegExp.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">username</span>)) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">usernameCheckMessage</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">usernameCheckMessage</span> = <span class="string">&quot;用户名不符合规则&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;methods&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;registerCheck&quot;</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.检查用户名</span></span><br><span class="line"><span class="keyword">var</span> usernameRegExp = <span class="regexp">/^[A-Z,a-z,0-9,_]&#123;5,8&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!usernameRegExp.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">username</span>)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不满足条件，则阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有任何一个条件不满足，后面就没必要检查了，所以函数可以停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.检查密码</span></span><br><span class="line"><span class="keyword">var</span> passwordRegExp = <span class="regexp">/^[A-Z,a-z,0-9,_]&#123;5,8&#125;$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!passwordRegExp.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">password</span>)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不满足条件，则阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有任何一个条件不满足，后面就没必要检查了，所以函数可以停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.检查确认密码是否和密码一致</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">password</span> != <span class="variable language_">this</span>.<span class="property">passwordConfirm</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不满足条件，则阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有任何一个条件不满足，后面就没必要检查了，所以函数可以停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.检查电子邮件</span></span><br><span class="line"><span class="keyword">var</span> emailRegExp = <span class="regexp">/^[a-zA-Z0-9_\.-]+@([a-zA-Z0-9-]+[\.]&#123;1&#125;)+[a-zA-Z]+$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!emailRegExp.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">email</span>)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不满足条件，则阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有任何一个条件不满足，后面就没必要检查了，所以函数可以停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.检查验证码</span></span><br><span class="line"><span class="keyword">var</span> codeRegExp = <span class="regexp">/[A-Z,a-z,0-9]&#123;5&#125;/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!codeRegExp.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">code</span>)) &#123;</span><br><span class="line"><span class="comment">// 如果不满足条件，则阻止表单提交</span></span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有任何一个条件不满足，后面就没必要检查了，所以函数可以停止执行</span></span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="verse02.html">上一节</a> <a href="index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/index/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/index/</url>
      
        <content type="html"><![CDATA[<h1>书城项目第一阶段</h1><p><a href="verse01.html">第一节 事件驱动补充</a></p><p><a href="verse02.html">第二节 正则表达式</a></p><p><a href="verse03.html">第三节 第一阶段要实现的功能</a></p><p><a href="../index.html">回目录</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse01/"/>
      <url>/2024/09/13/JAVA/%E5%B0%9A%E7%A1%85%E8%B0%B7JavaWeb%E8%AF%BE%E4%BB%B6%E8%B5%84%E6%96%99/bookstore01/verse01/</url>
      
        <content type="html"><![CDATA[<p>[[toc]]</p><h1>第一节 事件驱动补充</h1><h2 id="1、取消控件的默认行为">1、取消控件的默认行为</h2><h3 id="①控件默认行为">①控件默认行为</h3><ul><li>点超链接会跳转页面</li><li>点表单提交按钮会提交表单</li></ul><p>本来控件的默认行为是天经地义就该如此的，但是如果我们希望点击之后根据我们判断的结果再看是否要跳转，此时默认行为无脑跳转的做法就不符合我们的预期了。</p><h3 id="②取消方式">②取消方式</h3><p>调用<span style="color:blue;font-weight:bold;">事件对象</span>的<span style="color:blue;font-weight:bold;">preventDefault()</span>方法。</p><h4 id="1-超链接举例">[1]超链接举例</h4><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;anchor&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span>超链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JavaScript代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;anchor&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我点击了一个超链接&quot;</span>);</span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-表单提交按钮举例">[2]表单提交按钮举例</h4><p>HTML代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;submitBtn&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交表单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JavaScript代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;submitBtn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我点击了一个表单提交按钮&quot;</span>);</span><br><span class="line">event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、阻止事件冒泡">2、阻止事件冒泡</h2><p><img src="./images/img001.png" alt="images"></p><p>图中的两个div，他们的HTML标签是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outterDiv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;innerDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>点击里面的div同时也等于点击了外层的div，此时如果两个div上都绑定了单击响应函数那么就都会被触发：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;outterDiv&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;外层div的事件触发了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;innerDiv&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;内层div的事件触发了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>所以事件冒泡就是一个事件会不断向父元素传递，直到window对象。</p><p>如果这不是我们想要的效果那么可以使用<span style="color:blue;font-weight:bold;">事件对象</span>的<span style="color:blue;font-weight:bold;">stopPropagation()</span>函数阻止。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;innerDiv&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;内层div的事件触发了&quot;</span>);</span><br><span class="line"></span><br><span class="line">event.<span class="title function_">stopPropagation</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、Vue事件修饰符">3、Vue事件修饰符</h2><p>对于事件修饰符，Vue官网的描述是：</p><blockquote><p>在事件处理程序中调用 <code>event.preventDefault()</code> 或 <code>event.stopPropagation()</code> 是非常常见的需求。尽管我们可以在方法中轻松实现这点，但更好的方式是：<span style="color:blue;font-weight:bold;">方法只有纯粹的数据逻辑，而不是去处理 DOM 事件细节</span>。</p></blockquote><h3 id="①取消控件的默认行为">①取消控件的默认行为</h3><p>控件的默认行为指的是：</p><ul><li>点击超链接跳转页面</li><li>点击表单提交按钮提交表单</li></ul><p>实现这个需求使用的Vue事件修饰符是：<span style="color:blue;font-weight:bold;">.prevent</span></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;clickAnchor&quot;</span>&gt;</span>超链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;clickSubmitBtn&quot;</span>&gt;</span>提交表单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="②取消事件冒泡">②取消事件冒泡</h3><p>实现这个需求使用的Vue事件修饰符是：<span style="color:blue;font-weight:bold;">.stop</span></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outterDiv&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;clickOutterDiv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;innerDiv&quot;</span> @<span class="attr">click.stop</span>=<span class="string">&quot;clickInnerDiv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="index.html">回目录</a> <a href="verse02.html">下一节</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/12/shumo/24%E5%9B%BD%E8%B5%9BB/"/>
      <url>/2024/09/12/shumo/24%E5%9B%BD%E8%B5%9BB/</url>
      
        <content type="html"><![CDATA[<h1>摘  要</h1><p>随着科技的快速发展，我国电子产品的市场需求持续增长，消费者对于电子产品的质量要求不断提高。如何高效地保证配件和成品的合格率并控制成本，成为了企业运营面临的重要挑战。本文建立成本效益模型、整数规划模型从而提出多工序生产过程中的决策方案。</p><p>针对问题一，考虑到平衡置信水平、总体次品率和检测结果误差范围，本文设计了基于单边假设检验的零配件抽样检测方案，根据置信度设定接受或拒绝假设的临界条件。在此基础上，本文根据二项分布概率函数计算给定置信度下允许的最大次品数，并基于次品数量的二项分布正态近似公式，求解得到不同误差范围下的最佳样本容量（详见图1）。结果表明，当抽样检测的极限误差期望值为5%时，情形(1)和(2)的样本容量应该分别设置为98和59，可接受的次品数量分别为15和9。</p><p>针对问题二，本文基于成本效益分析法，建立了以各阶段成本与销售额为约束条件的净收益最大化目标函数，通过遍历16种决策方案，以净利润为指标，得到了假设零配件数量均为1000个时6种情形下的最大利润。求解得到的最优方案为（详见表5），情形1、2、3、5不对零配件或成品进行检测，只拆解不合格成品；情形4只检测两款零配配件；情形6不检测任何元件、不拆解不合格成品。</p><p>针对问题三，在问题二的基础之上，由于问题更为复杂，涉及多阶段决策优化问题，本文建立整数规划模型进行优化加速，建立各环节的成本方程，以净利润最大化为目标， 建立复杂生产工艺中的决策模型，从而得到各部件的决策方案（详见表7）。结果显示应该对零件2、7、半成品2和成品进行检测，拆解半成品3和成品，所获单个商品的期望利润最高为73.14元。</p><p>针对问题四，本文采用问题一制定的方案，计算95%置信度下允许的最大次品数和最小抽样数，将其比值作为模拟抽样的次品率。对二、三问的模型重新求解，发现在次品率扰动时总体方案的制定策略不变。同时在次品率10%~15%时，成本效益模型较为敏感，方案需加入零件的检测，随着工艺的复杂化对扰动的变化更不敏感。</p><p>关键词：假设检验   成本效益分析      整数规划       模拟规划</p><h1>问题重述</h1><h2 id="问题的背景">问题的背景</h2><p>在竞争激烈的科技产品市场中，某企业通过高效采购与精准生产来满足消费者的需求。该产品的核心在于向外采购的两款零件的完美结合。然而，零配件的质量直接关联到最终产品的合格率，任何一个零配件的缺陷都会导致成品不合格；即便零配件均合格，成品也可能因装配过程中的其他因素而未能达标。面对这一挑战，企业需要在采购阶段设计有效的质量检测方案，以确保零配件的质量符合标准，同时还需制定一套全面的生产管理策略，包括零配件的检测、成品的检测与不合格品的处理，以最大化成品合格率并实现成本效益最大化。</p><h2 id="问题的提出">问题的提出</h2><p>根据所给的企业自身条件，制定切实可行的采购与生产方案，确保企业在电子产品市场中的竞争力，解决以下问题：</p><p>（1）基于供应商次品率承诺，设计高效抽样检测方案，以最小成本验证零配件质量，确保在95%置信度下拒收超标批次，90%置信度下接收合格批次。</p><p>（2）利用已知次品率，制定多阶段生产流程的质量控制决策，包括零配件检测、成品检测、不合格品处理及售后管理，以优化生产效益。</p><p>（3）针对m道工序、n个零配件的复杂生产环境，基于次品率数据，优化质量控制决策，确保在多工序背景下实现高效生产。</p><p>（4）优化基于抽样检测方法的全面质量控制策略，考虑数据波动，确保决策在不确定性下依然稳健有效。</p><h1>问题分析</h1><h2 id="问题一的分析">问题一的分析</h2><p>问题一已知企业需要验证供应商提供的零配件次品率是否超过标称值，要求寻求最优化的抽样检测策略，旨在以较少的检测次数达到所需的置信度标准。由于产品的次品率检测服从二项分布，可以运用统计学原理，根据次品率标称值、置信度要求来确定样本量，并采用假设检验的方法设计抽样检测方案，将供应商声称的次品率作为原假设，根据置信水平要求设定拒绝或接受零配件的临界条件，最后根据抽样检测结果进行验证。</p><h2 id="问题二的分析">问题二的分析</h2><p>问题二已知企业在该款电子产品的生产过程中涉及零配件及成品的检测、不合格品的拆解与用户调换等多个环节，六种情况下的具体参数已经给出，要求对企业生产过程的各个阶段做出最优决策，属于多阶段决策过程。可以利用成本效益分析法[1]，将零配件与成品的不同决策间的关联综合考虑，平衡检测成本、拆解花费与调换损失之间的关系，通过比较不同决策下的成本与预期收益，为不同的情况选择净利润最大的方案。</p><h2 id="问题三的分析">问题三的分析</h2><p>基于问题二的规划思想，求解多工序多零件的决策方案，传统规划模型求解多阶段模型的时间复杂度较高，进一步优化模型，核心在于对生产过程中的多个工序和零配件进行优化决策以获得最大化利润，建立整数规划模型求解。 通过构造是否检测的决策变量，基于购买成本、检测成本、装配成本 、拆解成本、调换损失、销售收益构建需要最大化的利益目标函数，利用决策变量的0-1性质并使用Matlab进行求解。</p><h2 id="问题四的分析">问题四的分析</h2><p>问题四要求做出基于抽样检测结果的全过程生产控制回顾。根据问题一设定的抽样方案，在题中表一、二所给的次品率的基础上，选择问题一中的某种情形作为判定条件，在满足判定条件的情况下记录实际得到的各零配件、半成品、成品的次品率，并以这些新的次品率替换掉原先题目表中一、二中的次品率标称值，再重复问题二、三的解决步骤，观察最优方案的变化并分析原因和表现，分别在不同工艺流程模式中给出适合不同类型企业的最优决策。</p><h1>模型假设</h1><ul><li>假设抽样检测中每个零配件的检测结果相互独立，单个样品的次品率可以用二项分布描述</li><li>假设装配过程中两种零配件满足数量1:1配对</li><li>假设企业生产过程中的决策一旦制定，不会中途发生改变，即不会受其他因素影响</li><li>假设每种零配件均专用于单一半成品的装配，每种半成品则专门用于构造唯一的成品</li></ul><h1>符号说明</h1><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">说明</th><th style="text-align:center">单位</th></tr></thead><tbody><tr><td style="text-align:center">( alpha )​</td><td style="text-align:center">置信度</td><td style="text-align:center">—</td></tr><tr><td style="text-align:center">( P )</td><td style="text-align:center">零配件的次品率</td><td style="text-align:center">—</td></tr><tr><td style="text-align:center">( N )</td><td style="text-align:center">零配件的购买数量</td><td style="text-align:center">个</td></tr><tr><td style="text-align:center">( $P_0 $)</td><td style="text-align:center">零件次品率标称值</td><td style="text-align:center">—</td></tr><tr><td style="text-align:center">( E )</td><td style="text-align:center">抽样检测的极限误差的期望值</td><td style="text-align:center">—</td></tr><tr><td style="text-align:center">( M)</td><td style="text-align:center">成品销售额</td><td style="text-align:center">元</td></tr><tr><td style="text-align:center">Profit</td><td style="text-align:center">企业净收益</td><td style="text-align:center">元</td></tr></tbody></table><h1>问题一模型的建立与求解</h1><p>基于单边假设检验的检测方案制定</p><p>本文假设使用二项分布进行抽样且零配件总量足够大，因此可以认为次品数量服从正态分布。两种情形下待检验的假设[2]如表1所示。</p><p><strong>表 1 次品率不超过 0.1 的假设检验</strong></p><table><thead><tr><th style="text-align:center">情形</th><th style="text-align:center">原假设 (H_0 )</th><th style="text-align:center">备择假设 (H_1)</th><th style="text-align:center">显著性水平 ( \alpha​ )</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">( P\leq0.10 )</td><td style="text-align:center">( P &gt; 0.10 )</td><td style="text-align:center">0.05</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">( P &gt; 0.10 )</td><td style="text-align:center">($ P \leq 0.10 $)</td><td style="text-align:center">0.10</td></tr></tbody></table><p>抽样检测方案的具体步骤如下所示：</p><p>Step<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">1</mn></mrow><annotation encoding="application/x-tex">\mathbf{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">1</span></span></span></span>：进行抽样检测</p><p>基于企业能接受的误差范围，从总体中随机抽取<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>个样本，并记录下次品的数量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>，可得样本的次品率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>p</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>p</mi><mo>^</mo></mover><mo>=</mo><mfrac><mi>X</mi><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">\hat{p}=\frac{X}{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Step<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">2</mn></mrow><annotation encoding="application/x-tex">\mathbf{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">2</span></span></span></span>：计算置信度下允许的最大次品数</p><p>根据二项分布概率质量函数，计算在n次实验中发现k个次品的概率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><mi>X</mi><mo>=</mo><mi>k</mi><mo fence="true">)</mo></mrow><mo>=</mo><msubsup><mi>C</mi><mi>n</mi><mi>k</mi></msubsup><msubsup><mi>p</mi><mn>0</mn><mi>k</mi></msubsup><msup><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mn>0</mn></msub><mo fence="true">)</mo></mrow><mrow><mi>n</mi><mo>−</mo><mi>k</mi></mrow></msup></mrow><annotation encoding="application/x-tex">P\left(X=k\right)=C_n^kp_0^k\left(1-p_0\right)^{n-k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.239em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.989em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>Step<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">3</mn></mrow><annotation encoding="application/x-tex">\mathbf{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">3</span></span></span></span>：做出决策</p><p>企业在一定允许误差E下对计算得出的最小抽样检测样本进行检测，当累计分布函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><mi>X</mi><mo>≤</mo><mi>k</mi><mo fence="true">)</mo></mrow><mo>≥</mo><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">P\left(X\le k\right)\geq1-\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>时，此时的次品个数为在当前置信度下允许的最大值。当检验样本中的次品个数超标时，立即拒绝原假设。对于情形1，若检测出多于k个次品，则认为次品率显著大于10%，企业拒收供应商的零配件，否则接受原假设；对于情形2，若检测出不超过k个次品，说明次品率显著低于10%，企业接收供应商的零配件，否则接受原假设。</p><h2 id="基于次品率标称值的样本容量估计">基于次品率标称值的样本容量估计</h2><p>制定抽样检测方案首先应该确定样本容量，如果样本容量过大，抽样误差较小但检测的工作量增大，耗费的时间和成本过多，不符合企业高效采购的要求；若样本容量过小，耗费少但抽样误差太大，抽样检测的结果不具有代表性。因此，抽样设计的重点是确定必要的样本容量，即估计值与真实值较为接近且满足预定的置信度。</p><p>要满足给定的置信度，首先需要计算标准化统计量，即使用Z统计量进行正态近似，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>0</mn></msub><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">P_0=0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.1</span></span></span></span>是供应商提供的次品率标称值</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Z</mi><mo>=</mo><mfrac><mrow><mover accent="true"><mi>p</mi><mo>^</mo></mover><mo>−</mo><msub><mi>P</mi><mn>0</mn></msub></mrow><msqrt><mfrac><mrow><msub><mi>P</mi><mn>0</mn></msub><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mn>0</mn></msub><mo fence="true">)</mo></mrow></mrow><mi>n</mi></mfrac></msqrt></mfrac></mrow><annotation encoding="application/x-tex">Z=\frac{\hat{p}-P_0}{\sqrt{\frac{P_0\left(1-P_0\right)}{n}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1014em;vertical-align:-1.73em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.3175em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3175em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.2775em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.88em" viewBox="0 0 400000 1944" preserveAspectRatio="xMinYMin slice"><path d="M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5225em;"><span></span></span></span></span></span></span></span><span style="top:-3.5475em;"><span class="pstrut" style="height:3.3175em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.9945em;"><span class="pstrut" style="height:3.3175em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.73em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其次需要确定拒绝域，以95%置信度为例进行考虑，认定次品率是否超过标称值从而决定是否拒收，由于只关心次品率是否比标称值大而非是否与标称值不同，故选择进行单侧检验。在单侧检验中，情形1的拒绝域为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>&gt;</mo><msub><mi>Z</mi><mi>α</mi></msub></mrow><annotation encoding="application/x-tex">Z&gt;Z_\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>α</mi></msub></mrow><annotation encoding="application/x-tex">Z_\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是标准正态分布在\alpha水平下的临界值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mn>0.05</mn></msub><mo>=</mo><mn>1.645</mn></mrow><annotation encoding="application/x-tex">Z_{0.05}=1.645</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.05</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.645</span></span></span></span>；对于情形2，单侧检验的方向相反，拒绝域为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>&lt;</mo><msub><mi>Z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z&lt;Z_{1-\alpha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>，此时使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">1-\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>查找临界值，因此<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mn>0.1</mn></msub><mo>≈</mo><mn>1.282</mn></mrow><annotation encoding="application/x-tex">Z_{0.1}\approx1.282</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.282</span></span></span></span>。</p><p>根据本文假设，零配件中的次品数服从二项分布B(n,P)，其中n是抽样检测的样本数量，P是零配件总体中的次品率，即供应商保证的10%。设置信水平为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">1-\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>时，与总体次品率相联系的极限误差为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">E_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>，则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>E</mi><mi>p</mi></msub><mo>=</mo><msub><mi>Z</mi><mi>α</mi></msub><mo>⋅</mo><msqrt><mfrac><mrow><mi>P</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>P</mi><mo fence="true">)</mo></mrow></mrow><mi>n</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">E_p=Z_\alpha\cdot\sqrt{\frac{P\left(1-P\right)}{n}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.44em;vertical-align:-0.7356em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7044em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.6644em;"><span class="pstrut" style="height:4.4em;"></span><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="2.48em" viewBox="0 0 400000 2592" preserveAspectRatio="xMinYMin slice"><path d="M424,2478c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1014.6s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2z M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7356em;"><span></span></span></span></span></span></span></span></span></span></p><p>其中Z_\alpha是标准正态分布下的临界值，取决于设定的置信水平（95%置信度对应的Z=1.645，90%置信度对应的Z=1.28），在处理大样本且总体分布未知的情况下，本文将二项分布近似为正态分布，可以在减少样本量的同时保证所需的置信水平。设E为允许的极限误差E_p的期望值，化简可得总体次品率区间估计的样本容量为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>Z</mi><mi>α</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mi>P</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>P</mi><mo stretchy="false">)</mo></mrow><msup><mi>E</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">n=\frac{(Z_\alpha)^2P(1-P)}{E^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其中E直接影响样本量的大小，在其他条件不变的情况下，极限误差增大则必要的样本容量减少，可以节约成本但准确度偏低；反之若缩小极限误差，就要扩大必要的样本容量。结合相关文献[3]，电子产品的E值通常在2%~5%之间取值，且大多数情况下其值不超过10%，同时为满足该企业尽可能少地进行样本抽测，本文选取E=5%；P(1-P)反映了次品率的变化对样本量的影响，可以确保在过高或过低的次品率情况下，将对样本量相应调整，避免过多的样本检测。</p><p>利用Python仿真求解得到的不同置信水平下所需的最小样本容量和最大允许次品数如表2所示。</p><p><strong>表 2 5% 的极限误差下各情形样本与次品量</strong></p><table><thead><tr><th style="text-align:center">置信度</th><th style="text-align:center">情形</th><th style="text-align:center">样本量/个</th><th style="text-align:center">最大次品量/个</th></tr></thead><tbody><tr><td style="text-align:center">95%</td><td style="text-align:center">( p &gt; 10% ) 则拒收</td><td style="text-align:center">98</td><td style="text-align:center">15</td></tr><tr><td style="text-align:center">90%</td><td style="text-align:center">(  P \leq 0.10 % ) 则接受</td><td style="text-align:center">59</td><td style="text-align:center">9</td></tr></tbody></table><p>结果表明，如果企业希望以95%的把握认定零配件的次品率是否超过供应商声明的10%，那么至少需要检测98个样本，当有15个次品产生时则可以立即停止检测，认为标称值超过10%，拒收产品。这个样本量既考虑了检测的准确性，也兼顾了检测成本。</p><p>图1展示了不同误差范围下的样本容量和最大次品数变化情况，具体数值详见附录B(2)。从中可以看出，通过增加样本量，能够使企业更准确地估计总体次品率，减少因样本误差导致的误判风险。然而，较大的样本量也意味着更高的检测成本，因此在实际操作中需要权衡利弊。在90%的置信水平下，我们计算得到的样本容量为59个，当有9个次品产生时，立即停止检测且认为标称值超过10%，拒收产品。与95%置信水平相比，降低置信水平显著减少了所需的样本量。这表明，如果企业愿意接受稍低的置信度，可以通过减少检测样本数量来降低成本。</p><p><img src="https://pic.imgdb.cn/item/66e2f95dd9c307b7e945fc97.png" alt="图1 多种E取值下的样本容量与最大次品数"></p><p>综上所述，本文设计的抽样检测方案通过平衡置信水平、误差范围和总体次品率，为企业提供了在不同情境下选择最小样本容量的科学方法。企业可以根据实际情况和需求，灵活调整置信水平和样本量，以达到最佳的检测效果和成本控制。</p><h1>问题二模型的建立与求解</h1><p>为企业运营的各阶段做出决策属于多阶段决策过程，企业的最终目标是实现收益最大化，因此本文以企业净收益（包含企业信誉）为目标函数，根据每个阶段的决策能否为企业带来利益决定生产过程中的决策方案。</p><p>站在企业的角度考虑，净利润最大时的方案即为最优方案，每个生产阶段的决策会影响后续阶段的状态，即全局最优决策包括了每个阶段的最优决策[4]，因此本文采用成本效益分析模型和整数规划的思想进行模拟求解，当企业总利润不再增加时停止各阶段的循环，此时收益最大。由于该企业为热门电子企业，故零件数目必然巨大，考虑实际工作场景，拆解后的零件会回流至总零件库，次品率是零件的固有属性。不同于零件次品率表示次品零件占所有零件的比率，成品次品率是指对于合格的零件1、2装配完成后依旧出现不合格成品的概率。</p><h2 id="各阶段成本的计算">各阶段成本的计算</h2><p>企业的生产过程可以分为三个阶段：零件检测、成品装配检测和商品售卖与回收。本文分别将购买零件成本、零件检测成本、装配成本、成品检测成本、拆解成本、调换成本和丢弃成本进行量化，计算该产品从零件购买到售后花费的成本。</p><p>假设零配件1和2的购买数量均为N，购买单价分别为a_1和a_2，则两款零件的采购成本为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub><mo>=</mo><mi>N</mi><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><mi>N</mi><msub><mi>a</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_1=Na_1+Na_2 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>设零配件1和2的单个检测成本分别为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">b_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，则其总共的检测成本为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub><mo>=</mo><mi>N</mi><msub><mi>b</mi><mn>1</mn></msub><msub><mi>E</mi><mn>1</mn></msub><mo>+</mo><mi>N</mi><msub><mi>b</mi><mn>2</mn></msub><msub><mi>E</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2=Nb_1E_1+Nb_2E_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">E_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">E_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>均为二元变量，即<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>E</mi><mn>2</mn></msub><mo>∈</mo><mrow><mo fence="true">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">E_1,E_2\in\left\{0,1\right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span></span>，表示零配件1和2是否需要检测，其取值为0代表不检测、为1代表需要检测。未经检测的不合格零配件进入装配环节将直接导致成品不合格，设两款零配件的次品率分别为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup></mrow><annotation encoding="application/x-tex">P_0^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">P_0^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>，则以零配件1为例，其是否合格的数量可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>,合格</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>,不合格</mtext></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}N(1-P_0^1)&amp;\text{,合格}\\NP_0^1&amp;\text{,不合格}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">,</span><span class="mord cjk_fallback">合格</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">,</span><span class="mord cjk_fallback">不合格</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>成品装配检测阶段受第一阶段进入第二阶段的零配件数量的影响，故需分别考虑前序零件的检测情况，可根据两种零件是否检测分为4类，本文将以零配件1需要检测、零配件2无需检测的方案作为只检测一款零件时的代表，讨论以下三种情况的决策过程：</p><p><strong>情况1：零配件1检测、零配件2不检测</strong></p><p>由于成品的装配依赖两款零配件1:1的结合，不合格的配件1被丢弃，此时能与配件2相配的只有配件1的检测合格部分，其数量为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">N\left(1-P_0^1\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span>。设经过零配件检测阶段后装配的合格成品数量的最大可能取值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>，此时有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">N^\prime=N\left(1-P_0^1\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2141em;vertical-align:-0.35em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span></p><p>此情况下<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>中的次品来源如图2所示</p><p><img src="https://pic.imgdb.cn/item/66e2fe44d9c307b7e94cc727.png" alt="图2 成品中的次品来源示意图"></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mn>1</mn><mo mathvariant="normal">′</mo></msubsup></mrow><annotation encoding="application/x-tex">P_1^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>表示由两款合格配件组装的成品<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>的次品率。设此时由两款合格零件装配的成品数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><mi>k</mi><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><msubsup><mi>C</mi><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><mi>k</mi></msubsup><msubsup><mi>C</mi><mrow><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow><mo>−</mo><mi>k</mi></mrow></msubsup></mrow><msubsup><mi>C</mi><mi>N</mi><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow></mrow></msubsup></mfrac><mo separator="true">,</mo><mtext>     </mtext><mi>k</mi><mo>=</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mo separator="true">⋅</mo><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">P\left(N_1=k\right)=\frac{C_{N(1-P_0^2)}^kC_{NP_0^2}^{N\left(1-P_0^1\right)-k}}{C_N^{N\left(1-P_0^1\right)}},\ \ \ \ \ k=0,1,2···NP_0^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.86em;vertical-align:-1.5283em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3316em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.3448em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3448em;"><span style="top:-2.7065em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.6473em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.5748em;"><span class="pstrut" style="height:3.3448em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.3316em;"><span class="pstrut" style="height:3.3448em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.3394em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5786em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3448em;"><span style="top:-2.6212em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.6473em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">)</span></span></span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5968em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5283em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1111em;vertical-align:-0.247em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">⋅⋅⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>因此在此种情况下，由两款合格零件组装的成品数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和含非合格零件组成的成品数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>中次品数的期望值可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>E</mi><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mi>k</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>E</mi><msub><mi>N</mi><mn>2</mn></msub><mo>=</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><mi>E</mi><msub><mi>N</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}EN_1=\sum_{k=N^{\prime}-N^{\prime}P_0^2}^{N^{\prime}}kP(N_1=k)\\EN_2=N^{\prime}-EN_1\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0402em;vertical-align:-1.2701em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7701em;"><span style="top:-3.7701em;"><span class="pstrut" style="height:3.0824em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0824em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5178em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span><span style="top:-2.2443em;"><span class="pstrut" style="height:3.0824em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2701em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>零件1不检测，零件2检测的情况与情况1类似，故此处不再赘述。</p><p><strong>情况<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">2</mn></mrow><annotation encoding="application/x-tex">\mathbf{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">2</span></span></span></span>：零配件<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">1</mn></mrow><annotation encoding="application/x-tex">\mathbf{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">1</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">2</mn></mrow><annotation encoding="application/x-tex">\mathbf{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">2</span></span></span></span>均检测</strong></p><p>此时两款零配件只有检测合格的产品才能进入装配环节，因此有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mrow><mo fence="true">{</mo><mtext> </mtext><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mtext> </mtext><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup><mo fence="true">)</mo></mrow><mtext> </mtext><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">N^\prime=min\left\{\ N\left(1-P_0^1\right),\ N\left(1-P_0^2\right)\ \right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2141em;vertical-align:-0.35em;"></span><span class="mord mathnormal">min</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">{</span></span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace"> </span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">}</span></span></span></span></span></span></span></p><p>成品均由合格零配件装配而成，因此其次品率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mn>1</mn><mo mathvariant="normal">′</mo></msubsup></mrow><annotation encoding="application/x-tex">P_1^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>为企业已知的次品率。</p><p><strong>情况<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">3</mn></mrow><annotation encoding="application/x-tex">\mathbf{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">3</span></span></span></span>：零配件<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">1</mn></mrow><annotation encoding="application/x-tex">\mathbf{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">1</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn mathvariant="bold">2</mn></mrow><annotation encoding="application/x-tex">\mathbf{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord mathbf">2</span></span></span></span>均不检测</strong></p><p>两款零配件全部进入装配阶段，此时</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">N^\prime=N </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>中的次品来源与表3所示相同。不妨设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo><mo>&lt;</mo><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(1-P_0^1)&lt;N(1-P_0^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的最大可能取值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(1-P_0^1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，最小值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo><mo>−</mo><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">N(1-P_0^1)-NP_0^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>。则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><mi>k</mi><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><msubsup><mi>C</mi><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup><mo fence="true">)</mo></mrow></mrow><mi>k</mi></msubsup><msubsup><mi>C</mi><mrow><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow><mo>−</mo><mi>k</mi></mrow></msubsup></mrow><msubsup><mi>C</mi><mi>N</mi><mrow><mi>N</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo fence="true">)</mo></mrow></mrow></msubsup></mfrac></mrow><annotation encoding="application/x-tex">P\left(N_1=k\right)=\frac{C_{N\left(1-P_0^2\right)}^kC_{NP_0^2}^{N\left(1-P_0^1\right)-k}}{C_N^{N\left(1-P_0^1\right)}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.0601em;vertical-align:-1.5283em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5318em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.3448em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3448em;"><span style="top:-2.7065em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.6473em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.5748em;"><span class="pstrut" style="height:3.3448em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.5318em;"><span class="pstrut" style="height:3.3448em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.5055em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">)</span></span></span></span></span></span><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.797em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3448em;"><span style="top:-2.6212em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.6473em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="mtight">)</span></span></span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5968em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5283em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的期望可表示</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>E</mi><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo><mo>−</mo><mi>N</mi><msubsup><mi>P</mi><mn>0</mn><mn>2</mn></msubsup></mrow><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msubsup><mi>P</mi><mn>0</mn><mn>1</mn></msubsup><mo stretchy="false">)</mo></mrow></msubsup><mi>k</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>N</mi><mn>1</mn></msub><mo>=</mo><mi>k</mi><mtext>）</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>E</mi><msub><mi>N</mi><mn>2</mn></msub><mo>=</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><mi>E</mi><msub><mi>N</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}EN_1=\sum_{k=N(1-P_0^1)-NP_0^2}^{N(1-P_0^1)}kP(N_1=k）\\ EN_2=N^{\prime}-EN_1\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2058em;vertical-align:-1.3529em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8529em;"><span style="top:-3.8529em;"><span class="pstrut" style="height:3.1689em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1689em;"><span style="top:-2.3212em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1885em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3115em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.245em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5968em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord cjk_fallback">）</span></span></span><span style="top:-2.248em;"><span class="pstrut" style="height:3.1689em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3529em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h2 id="基于成本与售价的利润函数构建">基于成本与售价的利润函数构建</h2><p>将生产过程中所有涉及的成本为约束条件，其与总销售额M构成的方程组如下</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>1</mn></msub><mo>=</mo><mi>N</mi><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><mi>N</mi><msub><mi>a</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>2</mn></msub><mo>=</mo><mi>N</mi><msub><mi>b</mi><mn>1</mn></msub><msub><mi>E</mi><mn>1</mn></msub><mo>+</mo><mi>N</mi><msub><mi>b</mi><mn>2</mn></msub><msub><mi>E</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>3</mn></msub><mo>=</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>C</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>4</mn></msub><mo>=</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>d</mi><msub><mi>E</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>5</mn></msub><mo>=</mo><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mi>e</mi><msub><mi>E</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>6</mn></msub><mo>=</mo><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>E</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mi>f</mi><mo>+</mo><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>E</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mi>E</mi><mi>X</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>M</mi><mn>7</mn></msub><mo>=</mo><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>⋅</mo><mi>E</mi><mi>X</mi><mo>⋅</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>E</mi><mn>4</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">[</mo><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>E</mi><mn>3</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mi>g</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} &amp; M_1=Na_1+Na_2\\  &amp; M_2=Nb_1E_1+Nb_2E_2\\  &amp; M_3=N^{\prime}C\\  &amp; M_4=N^{\prime}dE_3\\  &amp; M_5=N^{\prime\prime}eE_4\\  &amp; M_6=N^{\prime\prime}(1-E_3)f+N^{\prime\prime}(1-E_3)EX\\  &amp; M_7=N^{\prime\prime}\cdot EX\cdot(1-E_4)\\  &amp; M=[N^{\prime}-N^{\prime\prime}(1-E_3)]g\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:11.52em;vertical-align:-5.51em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.95em;"><span style="top:-1.366em;"><span class="pstrut" style="height:5.916em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:5.916em;"></span><span style="height:3.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="3.916em" style="width:0.8889em" viewBox="0 0 888.89 3916" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V3916 H384z M384 0 H504 V3916 H384z"/></svg></span></span><span style="top:-5.916em;"><span class="pstrut" style="height:5.916em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-7.058em;"><span class="pstrut" style="height:5.916em;"></span><span style="height:3.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="3.916em" style="width:0.8889em" viewBox="0 0 888.89 3916" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V3916 H384z M384 0 H504 V3916 H384z"/></svg></span></span><span style="top:-10.966em;"><span class="pstrut" style="height:5.916em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.45em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.01em;"><span style="top:-8.01em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:-6.57em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:-5.13em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:-0.81em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:0.63em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span><span style="top:2.07em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.51em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.01em;"><span style="top:-8.01em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-6.57em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.13em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.81em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span></span></span><span style="top:0.63em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:2.07em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)]</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.51em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">M_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">M_4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示成品的装配成本和检测成本， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">M_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>6</mn></msub></mrow><annotation encoding="application/x-tex">M_6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>分别表示不合格成品的拆解成本和调换成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">M_7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示不合格成品直接丢弃造成的损失，c、d、e、f分别为单件装配成本、成品检测成本、拆解成本和调换成本，g为成品的单件市场售价。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>E</mi><mn>4</mn></msub><mo>∈</mo><mrow><mo fence="true">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">E_3,E_4\in\left\{0,1\right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span></span>，分别表示成品是否需要检测以及不合格成品是否进行拆解，其取值为0代表不检测或直接丢弃、为1代表需要检测或进行拆解。条件(6)中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo stretchy="false">(</mo><msub><mrow><mn>1</mn><mo>−</mo><mi>E</mi></mrow><mn>3</mn></msub><mo stretchy="false">)</mo><mi>E</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">N^{\prime\prime}({1-E}_3)EX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span></span></span></span>表示由于不合格品流入市场，企业需要额外生产一件产品补给顾客的期望成本。</p><p>针对任意情形下的生产过程，可以设置<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi><mi>l</mi></mrow></msub><mrow><mo fence="true">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>l</mi><mo>∈</mo><mrow><mo fence="true">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo fence="true">}</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A_{ijkl}\left(i,j,k,l\in\left\{0,1\right\}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ijk</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">}</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span>共16种决策方案，其具体含义如表4所示。</p><p><strong>表 4 决策方案的下标含义</strong></p><table><thead><tr><th style="text-align:center">下标</th><th style="text-align:left">取值内容</th></tr></thead><tbody><tr><td style="text-align:center">( i )</td><td style="text-align:left">取 1 代表零件 1 检测，取 0 代表零件 1 不检测</td></tr><tr><td style="text-align:center">( j )</td><td style="text-align:left">取 1 代表零件 2 检测，取 0 代表零件 2 不检测</td></tr><tr><td style="text-align:center">( k )</td><td style="text-align:left">取 1 代表成品检测，取 0 代表成品不检测</td></tr><tr><td style="text-align:center">( l )</td><td style="text-align:left">取 1 代表不合格成品拆解，取 0 代表直接丢弃</td></tr></tbody></table><p>公式(17)中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mrow><annotation encoding="application/x-tex">N^{\prime\prime}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span>表示第二阶段成品总数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">N^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>中的次品数量，包含次品零件装配的成品和均由合格零件装配的成品中变为的次品两部分，且有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo>=</mo><mi>P</mi><mi>E</mi><msub><mi>N</mi><mn>1</mn></msub><mo>+</mo><mi>E</mi><msub><mi>N</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">N^{\prime\prime}=PEN_1+EN_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>生产一件合格成品所需的费用最小值和最大值可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>C</mi><mi>o</mi><mi>s</mi><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>=</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>C</mi><mi>o</mi><mi>s</mi><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo>+</mo><mi>c</mi><mo>+</mo><mi>d</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}Cost_{min}=a_1+a_2+c\\Cost_{max}=a_1+a_2+b_1+b_2+c+d\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">os</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">os</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>为简化问题，本文将公式(17)中的条件(4)和(5)中的EX取生产费用的均值，即</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>X</mi><mo>=</mo><mfrac><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><mi>c</mi><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo>+</mo><mi>c</mi><mo>+</mo><mi>d</mi></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">EX=\frac{a_1+a_2+c+a_1+a_2+b_1+b_2+c+d}{2} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">EX</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>目标函数，即企业净利润可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mo>=</mo><mi>M</mi><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>7</mn></munderover><msub><mi>M</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Profit=M-\sum_{i=1}^7M_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="模型的求解与分析">模型的求解与分析</h2><p>由于零件1和2为1:1结合，故企业在购买原料时的比例以1：1为宜，本文假设各取零件1000个，零件到成品被售卖的过程只和概率有关，零件总量的取值不会影响最优方案的制定。本文对于生产过程中的每一阶段建立E_1~E_4的决策函数，建立包含决策函数的成本——收益函数方程组，以净利润最大为目标函数，按照图3所示的流程进行迭代，比较各决策过程的结果，确定每个情况的具体方案。</p><p><img src="https://pic.imgdb.cn/item/66e300c5d9c307b7e9505d59.png" alt="图3 具体决策流程图"></p><p>如上图所示，对于每一种情况，依序计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub><mtext> </mtext><msub><mi>M</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">M_1~M_7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，依照题目要求遍历不同的决策向量，将被检测出的不合格品和被退回的不合格品放回拆解步骤，将拆解后的零件放回零件检测环节，当累计利润开始下降或零件全被卖完停止迭代，取净利润最大的决策作为方案。由此得出的六种情况下的具体决策方案如表5所示。</p><p><strong>表 5 问题 2 的具体决策方案</strong></p><table><thead><tr><th style="text-align:center">情况</th><th style="text-align:center">选代次数</th><th style="text-align:center">最大利润/元</th><th style="text-align:center">零件 1</th><th style="text-align:center">零件 2</th><th style="text-align:center">成品</th><th style="text-align:center">不合格成品</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">10</td><td style="text-align:center">39521</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">16</td><td style="text-align:center">45339</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">3</td><td style="text-align:center">18535</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">3</td><td style="text-align:center">11123</td><td style="text-align:center">检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">17</td><td style="text-align:center">37538</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">1</td><td style="text-align:center">19564</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不拆解</td></tr></tbody></table><p>结合需要计算的情况分析结果，细致观察每种情况的最优决策组合的迭代轮次（详见支撑材料）易知：</p><p>（1）除了情况3、4外其余情形最优决策均选择不对成品进行检测，而是让成品直接流入市场，增加交易额和流通率</p><p>在循环加工的流水线生产模式下，对于成品中不合格品调换除了明显会对对企业造成损失，都不进行检验。这是因为加大产品的流通率可以显著增加成品流向市场的数量，一定基数下的零件经历相同工序后，回流比直接丢弃有更多的复用价值。这也符合当今各大厂商回收，以旧换新，只换不退，以换代修的经营模式，证明模型具有很高的现实可靠性。</p><p>（2）除了情况6，其他情形均选择对于不合格成品不拆解<br>对于企业而言，在情况6中拆解不合格产品带来的损失远超过直接丢弃带来的损失。而其余情况，企业让这些零配件回流可以增加市场流通率，这么做是符合经济学原理的。</p><p>（3）每一环节所需的成本互相影响，若其中某些项过大则不可接受其开销，转而采用其他环节以避免进入开销极大的阶段。</p><p>对于情况1和2，后者的两款零配件和成品的次品率为前者的两倍，较高的次品率会导致调换更加频繁，但在频繁调换下情况2的总利润仍旧远高于情况1，这是由于在该流水线成本设置下的流通效益更加明显，情况2可将1000个零件流通16轮，情况1则只能流通10轮，是因为大部分成品直接卖掉不会退回，此现象证明拆解的必要性以及原件回流的巨大效益。此种情况对应于市场的经典现象——“劣币驱逐良币”，这也是为何部分商家即使遭遇频繁退货和口碑损耗，却依旧赚得盆满钵满的原因。</p><p>对于情况5，零件检测成本呈现不相称情况，零件1的检测性价比较低，为加速回流，经计算零件2不进行检测会促使更多的零件回收利用，以制造出较多的合格成品。对比情形1，接近两倍的调换损失和更高的调换数量可能会导致利润的较大下降，但从利润来看每个产品仅少赚2元，这和流水线的零件回流效益有关。<br>可以进一步对每种情况的迭代过程绘制雷达图进行分析，以情况4第一轮迭代结果为例：</p><p><img src="https://pic.imgdb.cn/item/66e2f95ed9c307b7e945fce3.png" alt="图4  情况4成本与利润雷达图 "></p><p>上图中的e组合代表每组决策向量的尝试结果。从中可以发现，本文选定的最优策略的e组合（1，1，0，1）在一开始的总利润并未有明显优势，因为较少次数的迭代内会受到调换损失较大的制约，但其极低的零件检测成本以及尽可能让成品流向市场的理念避免了调换损失不可控的局面，同时结合情况2的分析结果，此情况具有“劣币”的特性，可以较好地进行产品回流，因此只要将调换费用通过前期的零件检测将退换率控制得当，以促进其在市场流通，可获得相对较多的利润。</p><p>综上所述，对于复杂的市场情况和企业生产流水线的性质，本文的模型具有良好的决策定制效果。</p><h1>问题三模型的建立与求解</h1><h2 id="整数规划模型">整数规划模型</h2><p>问题三在问题二思想的基础上进行模型优化，由于涉及m道工序和n个零件，采用第六节中枚举规划的方法时间复杂度过高，难以计算和应用，此问题属于多阶段的复杂决策问题[5]，所做的决策可以用0-1整数变量表示，因此适合使用整数规划进行求解。本节基于问题二分析的目标函数——求净利润的最大值建立整数规划模型，通过求解离散变量和复杂的约束条件进而得到全局最优解，可以在保证结果准确的情况下快速得到最优策略。相关的决策变量如表6所示。</p><p><strong>表 6 决策变量的设置说明</strong></p><table><thead><tr><th style="text-align:center">决策变量</th><th style="text-align:center">解释</th><th style="text-align:center">取 0 时的含义</th></tr></thead><tbody><tr><td style="text-align:center">( a_i \in {0,1}, i \in {1,2,…,n} )</td><td style="text-align:center">零配件 ( i ) 是否进行检测</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">( b_j \in {0,1}, j \in {1,2,3} )</td><td style="text-align:center">半成品 ( j ) 是否进行检测</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">( c_j \in {0,1}, j \in {1,2,3} )</td><td style="text-align:center">半成品 ( j ) 是否拆解</td><td style="text-align:center">否</td></tr><tr><td style="text-align:center">( d_f )</td><td style="text-align:center">成品是否检测</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">( e_f )</td><td style="text-align:center">不合格成品是否拆解</td><td style="text-align:center"></td></tr></tbody></table><p>由于零部件、半成品与成品在检测前是否为次品可视为未观测的随机变量，具有随机性，为了消除随机性对决策带来的影响，下面对企业生产一个成品所经历的各个环节的期望成本与期望收益进行分析。</p><p><strong>购买费用、检测费用与装配费用分</strong>析：无论零配件检测与否，企业都需要指出零配件的购买费用，用Pur表示，有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>u</mi><mi>r</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mtext> </mtext><msubsup><mi>C</mi><mrow><mi>b</mi><mi>u</mi><mi>y</mi></mrow><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">Pur=\sum_{i=1}^{n}\ C_{buy}^i </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>若企业选择对零部件进行检测，则须支付检测费用，用Dec表示，则</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>e</mi><mi>c</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mtext> </mtext><msub><mi>a</mi><mi>i</mi></msub><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><msub><mi>t</mi><mi>p</mi></msub></mrow><mi>i</mi></msubsup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup></munderover><mtext> </mtext><msub><mi>b</mi><mi>j</mi></msub><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><msub><mi>t</mi><mi>h</mi></msub></mrow><mi>j</mi></msubsup></mrow><annotation encoding="application/x-tex">Dec=\sum_{i=1}^{n}\ a_iC_{detect_p}^i+\sum_{j=1}^{n^\prime}\ b_jC_{detect_h}^j </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">Dec</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ec</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4443em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.3433em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9295em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ec</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4072em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>式中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><msub><mi>t</mi><mi>p</mi></msub></mrow><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">C_{detect_p}^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3051em;vertical-align:-0.4804em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-2.4169em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ec</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4804em;"><span></span></span></span></span></span></span></span></span></span>为零配件i的检测费用，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><msub><mi>t</mi><mi>h</mi></msub></mrow><mi>j</mi></msubsup></mrow><annotation encoding="application/x-tex">C_{detect_h}^j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3497em;vertical-align:-0.4072em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ec</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4072em;"><span></span></span></span></span></span></span></span></span></span>为半成品j的检测费用, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">n^\prime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span>为半成品的数量。无论企业如何决策，装配费用始终需要支出，生产一个成品的装配费用记为Ass，则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></munderover><msub><mi>b</mi><mi>j</mi></msub><msubsup><mi>C</mi><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>l</mi><msub><mi>e</mi><mi>h</mi></msub></mrow><mi>j</mi></msubsup><mo>+</mo><msub><mi>C</mi><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>l</mi><msub><mi>e</mi><mi>f</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">Ass=\sum_{j=1}^{n&#x27;}b_jC_{assemble_h}^j+C_{assemble_f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">ss</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.3433em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9295em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">sse</span><span class="mord mathnormal mtight">mb</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4072em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0364em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">sse</span><span class="mord mathnormal mtight">mb</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi></mrow><mi>j</mi></msubsup></mrow><annotation encoding="application/x-tex">C_{\mathrm{assemble}}^j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2439em;vertical-align:-0.3013em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">assemble</span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013em;"><span></span></span></span></span></span></span></span></span></span>为半成品j的装配费用，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>l</mi><msub><mi>e</mi><mi>f</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">C_{assemble_f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0364em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">sse</span><span class="mord mathnormal mtight">mb</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span></span></span></span>为成品装配费用。</p><p><strong>拆解费用期望计算</strong>：半成品或成品装配完成后，企业若对半成品或成品进行检测，且检测出不合格半成品或成品，则需选择是否拆解，并产生可能的拆解费用。拆解费用期望可表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>i</mi><mi>s</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></munderover><msub><mi>q</mi><mi>j</mi></msub><msub><mi>b</mi><mi>j</mi></msub><msub><mi>c</mi><mi>j</mi></msub><msubsup><mi>C</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>y</mi><mi>c</mi><mi>l</mi><msub><mi>e</mi><mi>h</mi></msub></mrow><mi>j</mi></msubsup><mo>+</mo><msub><mi>e</mi><mi>f</mi></msub><msub><mi>d</mi><mi>f</mi></msub><msub><mi>r</mi><mi>f</mi></msub><msub><mi>C</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>y</mi><mi>c</mi><mi>l</mi><msub><mi>e</mi><mi>f</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">Dis=\sum_{j=1}^{n&#x27;}q_jb_jc_jC_{recycle_h}^j+e_fd_fr_fC_{recycle_f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.3433em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9295em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">recyc</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0475em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">recyc</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">q_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>为半成品j的不合格率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>y</mi><mi>c</mi><mi>l</mi><msub><mi>e</mi><mi>h</mi></msub></mrow><mi>j</mi></msubsup></mrow><annotation encoding="application/x-tex">C_{recycle_h}^j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.38em;vertical-align:-0.4374em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9426em;"><span style="top:-2.3987em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">recyc</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374em;"><span></span></span></span></span></span></span></span></span></span>为第i件半成品的拆解费用。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">r_f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>为成品次品率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>y</mi><mi>c</mi><mi>l</mi><msub><mi>e</mi><mi>f</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">C_{recycle_f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0364em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">recyc</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span></span></span></span>为成品拆解费用。可以看出，拆解费用与次品率以及企业决策都有关。</p><p><strong>调换损失期望计算</strong>：若企业不合格产品未经检测流入市场，企业将无条件予以调换，并产生一定的调换损失。调换损失只有企业未作任何检测才可能产生，且只要零配件、半成品、成品生产过程中任何一个环节出现次品就会产生调换损失。考虑到零配件、半成品和成品的不合格率，调换损失期望可表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mi>e</mi><mi>p</mi><mo>=</mo><mrow><mo fence="true">[</mo><mn>1</mn><mo>−</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>⋅</mo><mrow><mo fence="true">[</mo><mn>1</mn><mo>−</mo><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></munderover><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">(</mo><mn>1</mn><mo>−</mo><msub><mi>q</mi><mi>j</mi></msub><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">)</mo><mo fence="true">]</mo></mrow><mo>⋅</mo><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">(</mo><mn>1</mn><mo>−</mo><msub><mi>d</mi><mi>f</mi></msub><mo fence="false" stretchy="true" minsize="1.2em" maxsize="1.2em">)</mo><msub><mi>C</mi><mtext>replace</mtext></msub></mrow><annotation encoding="application/x-tex">Rep=\left[1-\prod_{i=1}^n (1-a_i)(1-p_i)\right]\cdot\left[1-\prod_{j=1}^{n&#x27;} (1-b_i)\big(1-q_j\big)\right]\cdot\big(1-d_f\big)C_\text{replace}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.0277em;vertical-align:-1.2777em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9295em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="delimsizing size1">)</span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="delimsizing size1">)</span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">replace</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>式中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{\mathrm{replace}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">replace</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>表示成品调换损失。</p><p><strong>出售成品收益分析</strong>：企业在出售合格成品后，会获得收益，记为M，可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></munderover><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>q</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>r</mi><mi>f</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">M=\prod_{i=1}^n (1-p_i)\cdot\prod_{j=1}^{n^{\prime}} (1-q_j)\cdot(1-r_f)\cdot price</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.3433em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9295em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span></span></p><p>其中price为产品售价。目标函数为企业生产一个产品的期望利润，即</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mo>=</mo><mi>M</mi><mo>−</mo><mi>R</mi><mi>e</mi><mi>p</mi><mo>−</mo><mi>D</mi><mi>i</mi><mi>s</mi><mo>−</mo><mi>A</mi><mi>s</mi><mi>s</mi><mo>−</mo><mi>D</mi><mi>e</mi><mi>c</mi><mo>−</mo><mi>P</mi><mi>u</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">Profit=M-Rep-Dis-Ass-Dec-Pur </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">ss</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">Dec</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></span></p><p>由于必须要检测不合格才能进行拆解，因此本文有约束</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>≤</mo><msub><mi>b</mi><mi>j</mi></msub><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>e</mi><mi>f</mi></msub><mo>≤</mo><msub><mi>d</mi><mi>f</mi></msub></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}c_j\leq b_j,j\in\{1,2,...,n&#x27;\}\\e_f\leq d_f\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>综上，优化模型可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mspace width="1em"/><mi>P</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mspace linebreak="newline"></mspace><mtext>s.t.</mtext><mspace width="1em"/><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo><mo separator="true">,</mo><mi>i</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>b</mi><mi>j</mi></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>d</mi><mi>f</mi></msub><mo separator="true">,</mo><msub><mi>e</mi><mi>f</mi></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>c</mi><mi>j</mi></msub><mo>≤</mo><msub><mi>b</mi><mi>j</mi></msub><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msup><mi>n</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>e</mi><mi>f</mi></msub><mo>≤</mo><msub><mi>d</mi><mi>f</mi></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">max\quad Profit\\\text{s.t.}\quad\begin{cases}a_i\in\{0,1\},i\in\{1,2,...,n\}\\b_j\in\{0,1\},j\in\{1,2,...,n&#x27;\}\\c_j\in\{0,1\},j\in\{1,2,...,n&#x27;\}\\d_f,e_f\in\{0,1\}\\c_j\leq b_j,j\in\{1,2,...,n&#x27;\}\\e_f\leq d_f\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:8.64em;vertical-align:-4.07em;"></span><span class="mord text"><span class="mord">s.t.</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.45em;"><span style="top:-1.366em;"><span class="pstrut" style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:4.416em;"></span><span style="height:2.416em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="2.416em" style="width:0.8889em" viewBox="0 0 888.89 2416" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V2416 H384z M384 0 H504 V2416 H384z"/></svg></span></span><span style="top:-4.416em;"><span class="pstrut" style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-5.558em;"><span class="pstrut" style="height:4.416em;"></span><span style="height:2.416em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="2.416em" style="width:0.8889em" viewBox="0 0 888.89 2416" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V2416 H384z M384 0 H504 V2416 H384z"/></svg></span></span><span style="top:-7.966em;"><span class="pstrut" style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.95em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.57em;"><span style="top:-6.57em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span><span style="top:-5.13em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span><span style="top:-0.81em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span><span style="top:0.63em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.07em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>通过求解该优化模型，可最大化企业单件产品的期望利润，并指导企业在生产过程中做出正确决策。</p><h2 id="模型求解与分析">模型求解与分析</h2><p>使用Matlab的YALMIP求解器进行求解，企业的最优决策计算结果如表7所示</p><p><strong>表7  问题3具体决策方案</strong></p><table><thead><tr><th><strong>零配件</strong></th><th><strong>是否检测</strong></th><th><strong>零配件</strong></th><th><strong>是否检测</strong></th><th><strong>半成品</strong></th><th><strong>是否检测</strong></th><th><strong>不合格品是否拆解</strong></th></tr></thead><tbody><tr><td>1</td><td>不检测</td><td>5</td><td>不检测</td><td>1</td><td>不检测</td><td>不拆解</td></tr><tr><td>2</td><td>检测</td><td>6</td><td>不检测</td><td>2</td><td>检测</td><td>不拆解</td></tr><tr><td>3</td><td>不检测</td><td>7</td><td>检测</td><td>3</td><td>不检测</td><td>拆解</td></tr><tr><td>4</td><td>不检测</td><td>8</td><td>不检测</td><td>成品</td><td>检测</td><td>拆解</td></tr></tbody></table><p>最终结果表明，企业每销售一件成品，期望利润为73.14元。值得注意的是，该利润是期望利润而非实际利润，实际生产中企业所得的利润会在该值上下浮动。分析结果可知，最优方案对于成品需要进行检测和拆解，这是因为当不合格产品流入市场后造成的调换损失超过成品和拆解的成本之和，符合常理。</p><h1>问题四模型的建立与求解</h1><h2 id="基于抽样检测的次品率计算">基于抽样检测的次品率计算</h2><p>如题所述，零配件、半成品和成品的次品率均是通过抽样检测方法得到，参考问题1的求解策略，将给出的次品率视为标称值，对其进行抽样，计算最少抽样个数和置信度下允许的最大次品数，二者比值记为模拟抽样的次品率，而后对于问题二、三带入计算。</p><p>假设根据5.2节的抽样检测方案得到的最小样本容量为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">N_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，允许最大次品数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，由公式(1)可得此时样本中的次品率为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>p</mi><mo>^</mo></mover><mi>i</mi></msub><mo>=</mo><mfrac><msub><mi>n</mi><mi>i</mi></msub><msub><mi>N</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">{\hat{p}}_i=\frac{n_i}{N_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2175em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.9436em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>设任意情形下给定的次品率标称值为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，根据题目中表1可知其可能取值为5%、10%、20%，用其代入公式(4)可得此时的Z统计量正态近似公式</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Z</mi><mo>=</mo><mfrac><mrow><msub><mover accent="true"><mi>p</mi><mo>^</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><msqrt><mfrac><mrow><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msub><mi>N</mi><mi>i</mi></msub></mfrac></msqrt></mfrac></mrow><annotation encoding="application/x-tex">Z=\frac{\hat{p}_i-P_i}{\sqrt{\frac{P_i(1-P_i)}{N_i}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1014em;vertical-align:-1.73em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.2675em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2674em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.2274em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.88em" viewBox="0 0 400000 1944" preserveAspectRatio="xMinYMin slice"><path d="M983 90l0 -0c4,-6.7,10,-10,18,-10 H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5zM1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5726em;"><span></span></span></span></span></span></span></span><span style="top:-3.4975em;"><span class="pstrut" style="height:3.2675em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.9445em;"><span class="pstrut" style="height:3.2675em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.73em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>与次品率标称值相联系的极限误差可表示为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>E</mi><mi>p</mi></msub><mo>=</mo><msub><mi>Z</mi><mi>α</mi></msub><mo>⋅</mo><msqrt><mfrac><mrow><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msub><mi>N</mi><mi>i</mi></msub></mfrac></msqrt></mrow><annotation encoding="application/x-tex">E_p=Z_\alpha\cdot\sqrt{\frac{P_i(1-P_i)}{N_i}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.04em;vertical-align:-1.1106em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9294em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.8894em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="3.08em" viewBox="0 0 400000 3240" preserveAspectRatio="xMinYMin slice"><path d="M473,2793c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,606zM1001 80h400000v40H1017.7z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1106em;"><span></span></span></span></span></span></span></span></span></span></p><p>仍设E为允许的极限误差E_p的期望值，化简可得总体次品率区间估计的样本容量为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>N</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>Z</mi><mi>α</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msup><mi>E</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">N_i=\frac{(Z_\alpha)^2P_i(1-P_i)}{E^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1771em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>为保证较高的可置信度，本文取5.1节的较高置信度95%，极限误差的期望值仍取5%。将给出的标称值带入求解，得抽样得出的次品率在不同标称值下的结果，如表8所示</p><p><strong>表 8 95% 置信度下不同标称值的次品率</strong></p><table><thead><tr><th style="text-align:center">标称值</th><th style="text-align:center">样本容量</th><th style="text-align:center">允许最大次品数</th><th style="text-align:center">实际次品率</th></tr></thead><tbody><tr><td style="text-align:center">5%</td><td style="text-align:center">52</td><td style="text-align:center">5</td><td style="text-align:center">9.62%</td></tr><tr><td style="text-align:center">10%</td><td style="text-align:center">98</td><td style="text-align:center">15</td><td style="text-align:center">15.31%</td></tr><tr><td style="text-align:center">20%</td><td style="text-align:center">174</td><td style="text-align:center">44</td><td style="text-align:center">25.29%</td></tr></tbody></table><h2 id="问题二的重新求解">问题二的重新求解</h2><p>基于新求出来的次品率，更新问题二中数据，采用6.3节相同的算法求解，结果如表9所示。</p><p><strong>表 9 重解问题二的具体决策方案</strong></p><table><thead><tr><th style="text-align:center">情况</th><th style="text-align:center">选代次数</th><th style="text-align:center">最大利润/元</th><th style="text-align:center">零件 1</th><th style="text-align:center">零件 2</th><th style="text-align:center">成品</th><th style="text-align:center">不合格成品</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">51</td><td style="text-align:center">73225</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">82</td><td style="text-align:center">93668</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">4</td><td style="text-align:center">11235</td><td style="text-align:center">检测</td><td style="text-align:center">检测</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">4</td><td style="text-align:center">6777</td><td style="text-align:center">检测</td><td style="text-align:center">检测</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">36</td><td style="text-align:center">45386</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">1</td><td style="text-align:center">13455</td><td style="text-align:center">检测</td><td style="text-align:center">检测</td><td style="text-align:center">不检测</td><td style="text-align:center">不拆解</td></tr></tbody></table><p>将上表与此前问题二的结果对比发现：大部分情况的决策没有变化，说明本文的模型具有一定的稳定性。观察到情况3、6在零件检测的决策有所改变，下面进行详细讨论：</p><ul><li>情况3：当次品率上浮，先前中等的次品率尚能控制较高的调换成本，次品数增多，调换成本急剧增大，故在源头上对零件进行检测更为合适，同时不进行成品检测保持良好的市场交易额。</li><li>情况6：此时的次品率接近10%——原先所有情况中的中等水平，情况6的检测成本较为相称，由于拆解成本过高故该流水线生产的产品均为一次性交易，因此适合先行检测以保证尽可能多的合成成品的一次性产出，在成品处不检测是为了提升本次的交易额，让尽可能多的产品流向市场。</li></ul><p>为进一步分析次品率扰动带来的影响，绘制重解前后迭代次数和最大利润对比图，分析在实际变动情况下零件回流、风险控制和收益的关系：</p><p><img src="https://pic.imgdb.cn/item/66e2f95ed9c307b7e945fd15.png" alt="图5  不同组合下的最大利润与迭代次数"></p><p>从总体轮次上看，在次品率有所上浮的情况下，零件回流的轮次有所增加，企业所获总体利润增加，说明“劣币”在市场生产循环中有一定驱逐“良币”的空间。但对于调换损失较高的企业，上浮的次品率超过了限度，导致调换成本不可控，利润有所下降。</p><p>模型在10%~15%次品率区间附近较为敏感，大于15%较为稳定，这有助于次品率过高或者不合格品处理损失过多的企业抵御风险，同时有助于生产精度较高的企业在流水线产能发生扰动时及时调整策略。</p><p>综上，我们可以合理给出不同企业的策略制定建议：若企业注重信誉与口碑，较高的产品质量和检测才是明智之选；若企业注重商品的流通次数，尽可能降低拆解成本与调换损失即可，可以保持一定的次品率。不论是哪种企业，知名度是企业生存不可或缺的要素，模型也说明良好的市场交易额的潜在价值远高于调换损失带来的负面影响。经商之道在于知名度的提升和合理的风险控制。</p><h2 id="问题三的重新求解">问题三的重新求解</h2><p>类似于问题二，计算最少抽样个数和置信度下允许的最大次品数，二者比值记为模拟抽样的次品率。10%的标称次品率下，95%置信度下实际最大次品率为15.31%。重新求解问题三，可得</p><p><strong>表10重解问题三的具体决策方案</strong></p><table><thead><tr><th style="text-align:center">零配件</th><th style="text-align:center">是否检测</th><th style="text-align:center">零配件</th><th style="text-align:center">是否检测</th><th style="text-align:center">半成品</th><th style="text-align:center">是否检测</th><th style="text-align:center">不合格品是否拆解</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">不检测</td><td style="text-align:center">5</td><td style="text-align:center">不检测</td><td style="text-align:center">1</td><td style="text-align:center">不检测</td><td style="text-align:center">不拆解</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">检测</td><td style="text-align:center">6</td><td style="text-align:center">不检测</td><td style="text-align:center">2</td><td style="text-align:center">检测</td><td style="text-align:center">不拆解</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">不检测</td><td style="text-align:center">7</td><td style="text-align:center">不检测</td><td style="text-align:center">3</td><td style="text-align:center">不检测</td><td style="text-align:center">拆解</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">检测</td><td style="text-align:center">8</td><td style="text-align:center">不检测</td><td style="text-align:center">成品</td><td style="text-align:center">检测</td><td style="text-align:center">拆解</td></tr></tbody></table><p>将上表与此前问题三的结果对比发现，企业的决策方向没有变化，都是对部分零件、半成品2以及成品进行检测。此时，最大期望利润为67.06元，比原先略有下降，这是因为考虑到次品率的变化，企业的检测费用略有增加，但是增加的检测费用避免了更大的调换成本，因此，在问题三所给定的具体场景中，增加检测费用的投入是值得的。同时可以发现检测的零件由原先的2号、7号变为2号、4号，这意味着对于更高的次品率，保证更复杂的工艺合格更为关键。</p><p>同第二问对比发现，当工艺和流程变得更加复杂时，次品率带来的策略改变不明显，稳定性更高，此时劣币的优势会受制于各类成本而无法通过多轮回流获得大量资金反而容易因为较高的次品率产生亏损。因此对于电子产品的大型企业更需要在生产前期增加检测费用，有利于对产品质量进行更严格的把关，维护企业信誉和用户口碑。</p><h1>模型的评价与推广</h1><h2 id="模型的优点">模型的优点</h2><ul><li>结合企业所处市场环境和体量，有针对性地给出不同经验模型下不同企业的决策制定方案，使得流水线的生产销售具有良好的风险控制能力和盈利能力</li><li>本文采用的决策模型能够综合考虑生产过程的各个环节，通过迭代找到全局最优解，所得结果科学准确</li><li>问题三的求解考虑了工艺和零件的泛化情况，加强了模型的通用性，提高了求解速度</li><li>问题四的求解考虑了数据波动，结果证明决策在不确定性下依然稳健有效</li><li>通过模型求解找到了企业确定次品率较快的方法，具有较高的置信度和极低的检测成本</li></ul><h2 id="模型的缺点">模型的缺点</h2><ul><li>模型的计算需保持资源始终处于大基数状态下，更适用于有能力积累资源的大型企业，用于中小型企业的决策可能有较高风险</li><li>模型中难以体现市场环境、供应链波动等外部因素对生产过程造成影响</li></ul><h2 id="模型的推广">模型的推广</h2><ul><li>考虑资源有限的情况，在制定策略和估计次品率时采用动态调整可进一步适用于更多规模的企业</li><li>可以将模型的单一目标扩展为多目标优化，如同时考虑成本最小化、质量最优化等</li></ul><h1>参考文献</h1><p>[1]张清辉.基于成本效益分析的公共交通优化策略应用[J].现代企业,2024,(08):103-105.</p><p>[2]中国财经出版传媒集团. 统计学[M]. 北京：中国财政经济出版社，2007：159.</p><p>[3]茆诗松，程依明，健晓龙. 概率论与数理统计教程 第二版[M]. 3版. 北京：高等教育出版社，2010.</p><p>[4]漆月,石璐.基于动态规划的电子资源采购决策支持模型研究[J].数字图书馆论坛,2020,(11):27-32.</p><p>[5]武瑞清.状态转移方程在突发事件多阶段决策评估中的应用[J].决策探索(中),2020,(07):36-37.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2024年国赛B题——基于成本效益分析的生产决策模型</title>
      <link href="/2024/09/12/shumo/24%E5%9B%BD%E8%B5%9B/"/>
      <url>/2024/09/12/shumo/24%E5%9B%BD%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>24年国赛B题</p><p>这道题看起来比较简单实际上不太好做，难点在于决策模型的构建，这里给大家一定参考。</p><p>牵扯到概率论与数理统计以及排列组合，时间复杂度较高，会难以模拟，若简化问题会导致结果不够精确，有舍有得，要把握好度。</p><p><img src="https://pic.imgdb.cn/item/66e30c91d9c307b7e96961e3.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30c91d9c307b7e969621b.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30c94d9c307b7e96966e7.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30c94d9c307b7e969670e.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30c94d9c307b7e96966c9.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d1fd9c307b7e96a2dab.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d1fd9c307b7e96a2de3.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d20d9c307b7e96a2e2c.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d20d9c307b7e96a2e72.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d1fd9c307b7e96a2d7f.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d7bd9c307b7e96aa55d.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d7bd9c307b7e96aa585.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d7cd9c307b7e96aa756.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d7cd9c307b7e96aa77e.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30d7ad9c307b7e96aa454.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30dbed9c307b7e96b039d.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30dbed9c307b7e96b03c7.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30dbed9c307b7e96b0404.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30dbed9c307b7e96b0429.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30dbdd9c307b7e96b037c.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30deed9c307b7e96b4a56.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30deed9c307b7e96b4a9e.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30defd9c307b7e96b4ac9.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30defd9c307b7e96b4b01.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30deed9c307b7e96b4a32.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e11d9c307b7e96b7520.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e11d9c307b7e96b7550.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e11d9c307b7e96b7577.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e11d9c307b7e96b759d.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e10d9c307b7e96b74c8.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e36d9c307b7e96baaeb.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e36d9c307b7e96bab14.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e36d9c307b7e96bab3c.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e37d9c307b7e96bab5c.jpg" alt=""></p><p><img src="https://pic.imgdb.cn/item/66e30e36d9c307b7e96baac0.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 数模 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>图论</title>
      <link href="/2024/08/16/shuju/%E5%9B%BE%E8%AE%BA/"/>
      <url>/2024/08/16/shuju/%E5%9B%BE%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<p>稠密图用邻接矩阵存，稀疏图用邻接表存</p><p>D:\ruanjian\IntelliJ IDEA 2023.2\bin</p><h1>DFS</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建边</span></span><br><span class="line"><span class="comment">// 对于每个点k，开一个单链表，存储k所有可以走到的点。h[k]存储这个单链表的头结点</span></span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一条边a-&gt;b</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    st[u] = <span class="literal">true</span>; <span class="comment">// st[u] 表示点u已经被遍历过</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (!st[j]) <span class="built_in">dfs</span>(j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>几个要素：图中的值，各数组下标，边的编号</p><p><code>h[i]</code>:i是图中的值a，h[i]是这个值在e[i]中的下标i</p><p><code>e[i]</code>:i是数组下标，e[i]是图中的值b，由此实现了a-&gt;b</p><p><code>ne[i]</code>:i是数组下标,ne[i]是e[i]对应的下一个数组下标</p><p>嗯……要好好理解</p><h1>BFS</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">st[<span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 表示1号点已经被遍历过</span></span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">    q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (!st[j])</span><br><span class="line">        &#123;</span><br><span class="line">            st[j] = <span class="literal">true</span>; <span class="comment">// 表示点j已经被遍历过</span></span><br><span class="line">            q.<span class="built_in">push</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>应用：</p><ul><li><p>拓扑排序</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">topsort</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> hh = <span class="number">0</span>, tt = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// d[i] 存储点i的入度</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">if</span> (!d[i])</span><br><span class="line">            q[ ++ tt] = i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (hh &lt;= tt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q[hh ++ ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (-- d[j] == <span class="number">0</span>)</span><br><span class="line">                q[ ++ tt] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果所有点都入队了，说明存在拓扑序列；否则不存在拓扑序列。</span></span><br><span class="line">    <span class="keyword">return</span> tt == n - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.acwing.com/problem/content/847/">ACWing845. 八数码</a></p><p>有状态转移思想应用（妙啊）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">(string start)</span></span>&#123;</span><br><span class="line">    string end = <span class="string">&quot;12345678x&quot;</span>;<span class="comment">//定义目标状态</span></span><br><span class="line">    queue&lt;string&gt; q;</span><br><span class="line">    unordered_map&lt;string,<span class="type">int</span>&gt; d;<span class="comment">//O(1)</span></span><br><span class="line">    </span><br><span class="line">    q.<span class="built_in">push</span>(start);</span><br><span class="line">    d[start] = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> dis = d[t];</span><br><span class="line">        <span class="keyword">if</span>(t == end) <span class="keyword">return</span> dis;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> k = t.<span class="built_in">find</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">        <span class="type">int</span> x = k / <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> y = k % <span class="number">3</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> a = x + dx[i],b = y + dy[i];</span><br><span class="line">            <span class="keyword">if</span>(a &gt;= <span class="number">0</span> &amp;&amp; a&lt;<span class="number">3</span> &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b &lt; <span class="number">3</span>)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(t[k],t[a*<span class="number">3</span> + b]);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(!d.<span class="built_in">count</span>(t))&#123;</span><br><span class="line">                    d[t] = dis + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(t);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">swap</span>(t[k],t[a*<span class="number">3</span> + b]);<span class="comment">//还原状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1>朴素dijkstra算法</h1><ol><li><p>初始化距离</p><p>dis[1] = 0，dis[i] = +∞</p></li><li><p>找到当前已经确定最短距离的点，s:当前已经确定最短距离的点</p><p>for(i:1~n)</p><p>t:不在s中的，距离最近的点</p><p>t-&gt;s</p><p>更新距离</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijsktra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;=n;j++)&#123;<span class="comment">//找到这一轮距离最近的点</span></span><br><span class="line">            <span class="keyword">if</span>(!st[j] &amp;&amp; (t == <span class="number">-1</span> || dist[t] &gt; dist[j]))&#123;</span><br><span class="line">                t = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n;j++)&#123;<span class="comment">//更新这个点和其他所有点的距离</span></span><br><span class="line">            dist[j] = <span class="built_in">min</span>(dist[j],dist[t] + g[t][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st[t] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(dist[n] &gt;= <span class="number">10010</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>堆优化</h1><ol><li><p>初始化距离</p><p>dis[1] = 0，dis[i] = +∞</p></li><li><p>找到当前已经确定最短距离的点，s:当前已经确定最短距离的点</p><p>t:不在s中的，距离最近的点</p><p>t-&gt;s（m条边）</p><p>更新距离（堆更新一次是O(logn)）</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b;</span><br><span class="line">    w[idx] = c;</span><br><span class="line">    ne[idx] = h[a];<span class="comment">//存的是h[a]之前的数的idx,这样可以访问到所有a-&gt;x的边</span></span><br><span class="line">    h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    priority_queue&lt;PII,vector&lt;PII&gt;,greater&lt;PII&gt;&gt; heap;<span class="comment">//默认的是按照pair的第一个元素进行排序</span></span><br><span class="line">    heap.<span class="built_in">push</span>(&#123;<span class="number">0</span>,<span class="number">1</span>&#125;);<span class="comment">// 可以简写成 q.emplace(x, y)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(heap.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> t = heap.<span class="built_in">top</span>();</span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> ver = t.second,distance = t.first;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(st[ver]) <span class="keyword">continue</span>;</span><br><span class="line">        st[ver] = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = h[ver]; i != <span class="number">-1</span>; i = ne[i])&#123;<span class="comment">//找到和ver相连的边的最小的那一条</span></span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dist[j] &gt; dist[ver] + w[i])&#123;</span><br><span class="line">                dist[j] = dist[ver] + w[i];</span><br><span class="line">                heap.<span class="built_in">push</span>(&#123;dist[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(dist[n] &gt;= <span class="number">1000000010</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Bellman-Flord</h1><ol><li><p>建结构体a,b,w</p></li><li><p>for n次（迭代k次：从1号点经过不超过k条边到每个点的最短路的距离，若一次迭代没有点更新可直接结束）</p><p>​for 所有边a,b,w</p><p>​更新距离(松弛)</p></li></ol><blockquote><p>一定满足<code>dis[b] &lt;= dis[a] + w</code></p><p>如果有负权回路——一圈长度和小于0，就不一定有结果；若第n次还在迭代的话就有负环（一般用SPFA找）</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">bellman_ford</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line"></span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(last, dist, <span class="keyword">sizeof</span> dist);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> e = edges[j];</span><br><span class="line">            dist[e.b] = <span class="built_in">min</span>(dist[e.b], last[e.a] + e.c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>串联：由于这个算法的特性决定，每次更新得到的必然是在多考虑 1 条边之后能得到的全局的最短路。</p><p>而串联指的是一次更新之后考虑了不止一条边：由于使用了松弛，某节点的当前最短路依赖于其所有入度的节点的最短路；</p><p>假如在代码中使用dist[e.b]=min(dist[e.b],dist[e.a] + e.c);，我们无法保证dist[e.a]是否也在本次循环中被更新，如果被更新了，并且dist[e.b] &gt; dist[e.a] + e.c，那么会造成当前节点在事实上**“即考虑了一条从某个节点指向a的边，也考虑了a-&gt;b”，共两条边。**</p><p>而使用dist[e.b]=min(dist[e.b],last[e.a] + e.c);，可以保证a在dist更新后不影响对b的判定，因为后者使用last数组，保存着上一次循环中的dist的值。</p><h1>SPFA</h1><p>要求没有负环</p><p>第一个点入队</p><p>while queue不空</p><p>​t &lt;- q.front;q.pop();</p><p>​更新t的所有出边（t-&gt;b）</p><p>​queue&lt;-b;</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    st[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">    <span class="comment">//队列里都是由起点更新到的点，不存在bellman-ford算法中未更新的点同样被边更新的情况。</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">false</span>;<span class="comment">//曾经加入过队列的点出队后，会再次被加入队列继续更新与它联通的点</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                <span class="keyword">if</span> (!st[j])</span><br><span class="line">                <span class="comment">//前面假如出现了可以把二这个点变小的值，那就更新，但不用加入队列</span></span><br><span class="line">                <span class="comment">//因为队列里已经有二这个点了，他肯定会遍历到，然后去更新与他相邻的节点之间的距离，</span></span><br><span class="line">                <span class="comment">//这样就提高了效率，而被淘汰的点之后又会被加入队列是因为此时他的最短距离又被更新了，</span></span><br><span class="line">                <span class="comment">//那么自然和他相连的节点距离也会更新，所以需要把他重新加入队列之中</span></span><br><span class="line">                &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="判断负环">判断负环</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], w[M], e[M], ne[M], idx;</span><br><span class="line"><span class="type">int</span> dist[N], cnt[N];<span class="comment">//dist严格意义说不是用来存最短距离的。所以dist中元素初始值并不是那么重要。我们就拿dist中元素全部初始化为0来举例分析一下，如果图中全部是正权重，那么if就压根不会执行。cnt也不会更新。如果图中全是负权重，但没有负环，其实就跟求最短路比较类似了，但dist存的也不完全是源点1到各个点的最短距离，这里有这么两种情况(比如1-&gt;2,1-&gt;3,2-&gt;3,这时dist中元素就代表了源点1到各点的最短距离，因为如果这样，2,3开始不入队迟早也会入队，这样就退化成了，只开始入队1，其他点不入队的情况，算的是1到各点的最短距离。另外一种是可能存在1-&gt;3,2-&gt;3,1到不了2，这样此时dist[3]，就代表了1,2分别为起点到3的最短距离。如果存在连通分支的情况其实就是前面两个情况的结合。)第一种情况很显然就跟单源最短路一样，不存在负环的前提下最短路径的长度也就是n-1，一旦大于等于n就说明有负环。第二种情况可以把例如3这个点分别看成以1为源点，以2为源点求最短路。此时cnt代表的就是两个求最短路的过程中dist的更新次数。如果有n个点，1-&gt;n,但到不了2,2-&gt;n，但1可以到其他所有点，这样就变成以1为源点和以2为源点最短路，以1的角度看就是n-1个点的最短路，在这个最短路中cnt最多达到n-2，同样2-&gt;n最短路中cnt最多是1，相加也最对是n-1。类似的分析，如果1到不了很多点，可以看成多个最短路，在每个最短路中看cnt最大值，综合所有cnt更新会发现cnt最大也就是n-1(在没有负回路的前提下)有不同联通分支分析与第二种情况分析类似。</span></span><br><span class="line"><span class="comment">//如果既有负权重，又有正权重，对于dist全初始为0的情况来说，正权重其实就起不到作用，这里可以认为正权重的边不存在。把正权重的边删掉后，就又变成了全部是负权重的情况。回到了上面的分析。综上，如果回路中不存在负回路，那么cnt最多也就是n-1，只有存在负权重，cnt才会大于等于n</span></span><br><span class="line"><span class="comment">//所以结合上述分析，我们可以知道cnt[j]各个起源点到j点的最短长度的和</span></span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, w[idx] = c, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        st[i] = <span class="literal">true</span>;</span><br><span class="line">        q.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;<span class="comment">//这里是因为如果和正常的spfa一样的话，只能判断从源点1可以到达所有的点的路径中有没有负环。但如果源点有到不了的点，比如不在一个联通分支，这样就会有点不会入队，这样就没法判断这个点到其他点的路径中是否存在负环，即也无法判断图中是否有负环，所以开始让所有点都入队</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                cnt[j] = cnt[t] + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (cnt[j] &gt;= n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (!st[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Floyd</h1><p>for(k =1;k&lt;=n;k++)</p><p>​for(i =1;i&lt;=n;i++)</p><p>​for(j =1;j&lt;=n;j++)</p><p>​d[i,j] = min(d[i,j],d[i,k] + d[k,j]);</p><p>d[i,j]存的就是最短路长度</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">floyd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">                d[i][j] = <span class="built_in">min</span>(d[i][j], d[i][k] + d[k][j]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>拓扑排序</h1><p><strong>找到图中入度为 0 的节点，以及仅由入度为 0 节点所指向的节点</strong>。</p><p>LC802</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">eventualSafeNodes</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; graph)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = graph.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// 反图，邻接表存储</span></span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">new_graph</span>(n);</span><br><span class="line">        <span class="comment">// 节点入度</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Indeg</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x : graph[i]) &#123;</span><br><span class="line">                new_graph[x].<span class="built_in">push_back</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 原数组记录的节点出度，在反图中就是入度</span></span><br><span class="line">            Indeg[i] = graph[i].<span class="built_in">size</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拓扑排序</span></span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 首先将入度为 0 的点存入队列</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!Indeg[i]) &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="comment">// 每次弹出队头元素</span></span><br><span class="line">            <span class="type">int</span> cur = q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x : new_graph[cur]) &#123;</span><br><span class="line">                <span class="comment">// 将以其为起点的有向边删除，更新终点入度</span></span><br><span class="line">                Indeg[x]--;</span><br><span class="line">                <span class="keyword">if</span>(!Indeg[x]) q.<span class="built_in">push</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最终入度（原图中出度）为 0 的所有点均为安全点</span></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!Indeg[i]) ret.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实现横向联邦学习</title>
      <link href="/2024/08/15/%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/08/15/%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1>实现横向联邦学习</h1><p>横向联邦学习的服务端的主要功能是将被选择的客户端上传的本地模型进行模型聚合。</p><p>首先定义一个服务端类Server，类中的主要函数包括以下几个。</p><ul><li><p>定义构造函数。</p><p>在构造函数中，服务端的工作包括：</p><p>第一，将配置信息拷贝到服务端中；</p><p>第二，按照配置中的模型信息获取模型，使用torchvision 的models模块内置的ResNet-18模型。</p></li><li><p>定义模型聚合函数。</p><p>服务端的主要功能是进行模型的聚合，通过接收客户端上传的模型，使用聚合函数更新全局模型。采用经典的FedAvg 算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">model_aggregate</span>(<span class="params">self, weight_accumulator</span>):</span><br><span class="line"><span class="keyword">for</span> name, data <span class="keyword">in</span> self.global_model.state_dict().items():</span><br><span class="line">update_per_layer = weight_accumulator[name] * self.conf[<span class="string">&quot;lambda&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> data.<span class="built_in">type</span>() != update_per_layer.<span class="built_in">type</span>():</span><br><span class="line">data.add_(update_per_layer.to(torch.int64))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">data.add_(update_per_layer)</span><br></pre></td></tr></table></figure></li><li><p>定义模型评估函数。</p><p>评估当前的全局模型性能。</p></li></ul><h2 id="客户端">客户端</h2><p>横向联邦学习的客户端主要功能是接收服务端的下发指令和全局模型，利用本地数据进行局部模型训练。定义客户端类Client，类中的主要函数包括以下两种。</p><ul><li><p>定义构造函数。</p><p>在客户端构造函数中，客户端的主要工作包括</p><p>1.将配置信息拷贝到客户端中；</p><p>2.按照配置中的模型信息获取模型，通常由服务端将模型参数传递给客户端，客户端将该全局模型覆盖掉本地模型；</p><p>3.配置本地训练数据，通过torchvision 的datasets 模块获取cifar10 数据集后按客户端ID切分，不同的客户端拥有不同的子数据集，相互之间没有交集。</p></li><li><p>定义模型本地训练函数。</p><p>这是一个图像分类的任务，使用交叉熵作为本地模型的损失函数，利用梯度下降来求解并更新参数值，实现细节如下面代码块所示。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">local_train</span>(<span class="params">self, model</span>):</span><br><span class="line"><span class="keyword">for</span> name, param <span class="keyword">in</span> model.state_dict().items():</span><br><span class="line">self.local_model.state_dict()[name].copy_(param.clone())</span><br><span class="line">optimizer = torch.optim.SGD(self.local_model.parameters(), lr=self.conf[<span class="string">&#x27;lr&#x27;</span>],</span><br><span class="line">momentum=self.conf[<span class="string">&#x27;momentum&#x27;</span>])</span><br><span class="line">self.local_model.train()</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(self.conf[<span class="string">&quot;local_epochs&quot;</span>]):</span><br><span class="line"><span class="keyword">for</span> batch_id, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.train_loader):</span><br><span class="line">data, target = batch</span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">data = data.cuda()</span><br><span class="line">target = target.cuda()</span><br><span class="line">optimizer.zero_grad()</span><br><span class="line">output = self.local_model(data)</span><br><span class="line">loss = torch.nn.functional.cross_entropy(output, target)</span><br><span class="line">loss.backward()</span><br><span class="line">optimizer.step()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Epoch %d done.&quot;</span> % e)</span><br><span class="line">        </span><br><span class="line">diff = <span class="built_in">dict</span>()</span><br><span class="line"><span class="keyword">for</span> name, data <span class="keyword">in</span> self.local_model.state_dict().items():</span><br><span class="line">diff[name] = (data - model.state_dict()[name])</span><br><span class="line"><span class="keyword">return</span> diff</span><br></pre></td></tr></table></figure></li></ul><h2 id="整合">整合</h2><p>当配置文件、服务端类和客户端类都定义完毕，我们将这些信息组合起来。</p><p>首先，读取配置文件信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(args.conf, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">conf = json.load(f)</span><br></pre></td></tr></table></figure><p>分别定义一个服务端对象和多个客户端对象，用来模拟横向联邦训练场景。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train_datasets, eval_datasets = datasets.get_dataset(<span class="string">&quot;./data/&quot;</span>, conf[<span class="string">&quot;type&quot;</span>])</span><br><span class="line">server = Server(conf, eval_datasets)</span><br><span class="line">clients = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(conf[<span class="string">&quot;no_models&quot;</span>]):</span><br><span class="line">clients.append(Client(conf, server.global_model, train_datasets, c))</span><br></pre></td></tr></table></figure><p>每一轮的迭代，服务端会从当前的客户端集合中随机挑选一部分参与本轮迭代训练，被选中的客户端调用本地训练接口local_train进行本地训练，最后服务端调用模型聚合函数model_aggregate来更新全局模型。</p><h2 id="配置信息">配置信息</h2><ul><li>model_name：模型名称</li><li>no_models：客户端数量</li><li>type：数据集信息</li><li>global_epochs：全局迭代次数，即服务端与客户端的通信迭代次数</li><li>local_epochs：本地模型训练迭代次数</li><li>k：每一轮迭代时，服务端会从所有客户端中挑选k个客户端参与训练。</li><li>batch_size：本地训练每一轮的样本数</li><li>lr，momentum，lambda：本地训练的超参数设置</li></ul><h2 id="联邦学习与中心化训练的效果对比">联邦学习与中心化训练的效果对比</h2><p><img src="https://pic.imgdb.cn/item/66bdc36ad9c307b7e949ed6b.jpg" alt="联邦学习与中心化训练的效果对比"></p><ul><li>联邦训练配置：一共10台客户端设备（no_models=10），每一轮任意挑选其中的5台参与训练（k=5）， 每一次本地训练迭代次数为3次（local_epochs=3），全局迭代次数为20次（global_epochs=20）。</li><li>集中式训练配置：我们不需要单独编写集中式训练代码，只需要修改联邦学习配置既可使其等价于集中式训练。具体来说，我们将客户端设备no_models和每一轮挑选的参与训练设备数k都设为1即可。这样只有1台设备参与的联邦训练等价于集中式训练。其余参数配置信息与联邦学习训练一致。图中我们将局部迭代次数分别设置了1，2，3来进行比较。</li></ul><h2 id="3-7-联邦学习在模型推断上的效果对比">3.7 联邦学习在模型推断上的效果对比</h2><p>单点训练只的是在某一个客户端下，利用本地的数据进行模型训练的结果。</p><p><img src="https://pic.imgdb.cn/item/66bdc36bd9c307b7e949eed2.jpg" alt="模型推断上的效果对比"></p><p>我们看到单点训练的模型效果（蓝色条）明显要低于联邦训练 的效果（绿色条和红色条），这也说明了仅仅通过单个客户端的数据，不能够 很好的学习到数据的全局分布特性，模型的泛化能力较差。</p><p>此外，对于每一轮 参与联邦训练的客户端数目（k 值）不同，其性能也会有一定的差别，k 值越大，每一轮参与训练的客户端数目越多，其性能也会越好，但每一轮的完成时间也会相对较长。</p><p>运行原作者代码结果如下：</p><p><img src="https://pic.imgdb.cn/item/66bdc36ad9c307b7e949eddd.jpg" alt="运行结果"></p><p>尝试增大local_epochs,lr,batch_size,单独增加batch_size训练速度会有所提升，发现总体速率和原始保持一致，效果有明显提升：</p><p><img src="https://pic.imgdb.cn/item/66bdc36ad9c307b7e949edb4.jpg" alt="调整后效果"></p><h2 id="参考文献及代码">参考文献及代码</h2><p>1.<a href="https://github.com/FederatedAI/Practicing-Federated-Learning/tree/main/chapter03_Python_image_classification">用Python从零实现横向联邦图像分类</a></p><p>2.<a href="chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://proceedings.mlr.press/v54/mcmahan17a/mcmahan17a.pdf">Communication-Efficient Learning of Deep Networks from Decentralized Data</a></p><p>3.<a href="https://github.com/shaoxiongji/federated-learning">Communication-Efficient Learning of Deep Networks from Decentralized Data(代码)</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Java学习笔记</title>
      <link href="/2024/08/01/JAVA/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/08/01/JAVA/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1>变量</h1><h2 id="Java数据类型">Java数据类型</h2><p><img src="https://pic.imgdb.cn/item/66a4cc76d9c307b7e99c6ebc.png" alt="数据类型"></p><ul><li>整数类型<ul><li>byte——1字节</li><li>short——2字节</li><li>int——4字节（默认）</li><li>long——8字节</li></ul></li><li>浮点类型<ul><li>float——4字节</li><li>double——8字节（默认）</li></ul></li></ul><blockquote><p>浮点数使用陷阱<br>2.7和8.1/3比较，8.1/3的结果接近2.7而非2.7，精度问题</p><span class='p red'>运算结果是小数要注意</span> 应以两个数的差的绝对值在某精度范围内判断</blockquote><h2 id="Java-API-文档">Java API 文档</h2><p>API (Application Programming Interface,应用程序编程接口)是Java提供的基本编程接口(Gava提供的类还有相关的方法)。</p><blockquote><p>中文在线文档：<a href="https://www.matools.com">https://www.matools.com</a></p></blockquote><p>类的组织形式</p><p><img src="https://pic.imgdb.cn/item/66a4d18fd9c307b7e9a240ce.png" alt="类的组织形式"></p><ul><li><p>字符类型(char)</p><p>在java中，char的本质是一个整数，在输出时，是unicode码对应的字符，可参与运算。</p></li><li><p>布尔类型——1字节</p></li></ul><h2 id="基本数据类型转换">基本数据类型转换</h2><h3 id="自动类型转换">自动类型转换</h3><p>当java程序在进行赋值或者运算时，精度小的类型自动转换为<code>精度最大</code>的数据类型。</p><p><img src="https://pic.imgdb.cn/item/66a4d63bd9c307b7e9a776f1.png" alt="自动类型转换"></p><blockquote><p>精度大-&gt;精度小会报错</p><p>byte和char不自动转换</p><p>byte,char,short可以转换为int计算，一运算就成int</p><p>布尔不参与转换</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="variable">d1</span> <span class="operator">=</span> n1 + <span class="number">1.1</span>;<span class="comment">//错 结果类型是 double</span></span><br><span class="line"><span class="type">double</span> <span class="variable">d1</span> <span class="operator">=</span> n1 + <span class="number">1.1</span>;<span class="comment">//对 结果类型是 double</span></span><br><span class="line"> d1 = n1 + <span class="number">1.1F</span>;<span class="comment">//对 结果类型是 float</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> n ;<span class="comment">//错,变量间的赋值先判断类型</span></span><br><span class="line"></span><br><span class="line"><span class="type">byte</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">byte</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="type">byte</span> <span class="variable">a3</span> <span class="operator">=</span> a1 + a2;<span class="comment">//错 一运算就成int</span></span><br></pre></td></tr></table></figure><h3 id="强制类型转换">强制类型转换</h3><p>自动类型转换的逆过程，将容量大的数据类型转换为容量小的数据类型。使用时要加上强制转换符 ( )，但可能造成精度降低或溢出。</p><p><img src="https://pic.imgdb.cn/item/66a4db66d9c307b7e9aaf28f.png" alt="强制类型转换"></p><h3 id="基本数据类型和-String类型转换">基本数据类型和 String类型转换</h3><p>基本类型转String类型：将基本类型的值+“”</p><p>String类型转基本数据类型：通过基本类型的包装类调用parseXX:方法</p><blockquote><p>要确保String类型能够转成有效的数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">float</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="number">1.1F</span>;</span><br><span class="line"><span class="type">double</span> <span class="variable">d1</span> <span class="operator">=</span> <span class="number">4.5</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> n1 + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> Integer.parseInt(s5);</span><br><span class="line"><span class="type">double</span> <span class="variable">num2</span> <span class="operator">=</span> Double.parseDouble(s5);</span><br><span class="line"><span class="type">float</span> <span class="variable">num3</span> <span class="operator">=</span> Float.parseFloat(s5);</span><br><span class="line"><span class="type">long</span> <span class="variable">num4</span> <span class="operator">=</span> Long.parseLong(s5);</span><br><span class="line"><span class="type">byte</span> <span class="variable">num5</span> <span class="operator">=</span> Byte.parseByte(s5);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> Boolean.parseBoolean(<span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="type">short</span> <span class="variable">num6</span> <span class="operator">=</span> Short.parseShort(s5);</span><br></pre></td></tr></table></figure><h1>运算符</h1><h2 id="算术运算符">算术运算符</h2><p>对于除号/，它的整数除和小数除是有区别的：整数之间做除法时，只保留整数部分而舍弃小数部分。例如：intx=10/3,结果是3。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">3</span>  <span class="comment">//3</span></span><br><span class="line"><span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">3</span>  <span class="comment">//3.33</span></span><br></pre></td></tr></table></figure><p>%的本质： <code>a%b = a-a/b*b</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10 % -3 = 1</span><br><span class="line">-10 % 3 = -1</span><br><span class="line">-10 % -3 = -1</span><br></pre></td></tr></table></figure><p>i=i++:结果i=1</p><blockquote><p>使用临时变量：(1)temp=i:(2)i=i+1;(3)i=temp</p></blockquote><p>i=++i:结果i=2</p><h2 id="关系运算符">关系运算符</h2><p>都是boolean型</p><h2 id="逻辑运算符">逻辑运算符</h2><ul><li>逻辑与&amp;，逻辑或|，逻辑异或^</li><li>短路与&amp;&amp;，短路或||，取反!</li></ul><p><img src="https://pic.imgdb.cn/item/66a63a0cd9c307b7e9dcc0f3.png" alt="逻辑运算符"></p><blockquote><p>&amp;&amp;和&amp;使用区别(||和|同理)</p><p>&amp;&amp;短路与：如果第一个条件为false,则第二个条件不会判断，最终结果为false,效率高</p><p>&amp;逻辑与：不管第一个条件是否为false,第二个条件都要判断，效率低</p></blockquote><h2 id="赋值运算符">赋值运算符</h2><p>只有单目运算符、赋值运算符是从右向左运算，会进行类型转换。</p><h2 id="三元运算符">三元运算符</h2><blockquote><p>条件表达式 ? 表达式 1:表达式 2</p></blockquote><p>如果条件表达式为rue,运算后的结果是表达式1，如果条件表达式为false,运算后的结果是表达式2。</p><p>表达式 1 和表达式 2 要为可以赋给接收变量的类型(或可以自动转换)。</p><h2 id="标识符">标识符</h2><p>Java对各种变量、方法和类等命名时使用的字符序列称为标识符。</p><p>🎀命名规则</p><ol><li><p>由26个英文字母大小写，0-9，或$组成</p></li><li><p>数字不可以开头。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int3ab=<span class="number">1</span>;<span class="comment">//错误</span></span><br></pre></td></tr></table></figure></li><li><p>不可以使用关键字和保留字，但能包含关键字和保留字。</p></li><li><p>Java中严格区分大小写，长度无限制。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> totalNum=<span class="number">10</span>;intn=<span class="number">90</span>;</span><br></pre></td></tr></table></figure></li><li><p>标识符不能包含空格。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a b=<span class="number">90</span>;</span><br></pre></td></tr></table></figure></li></ol><p>包名：多单词组成时所有字母都小写：aaa.bbb.ccc //比如 com.hsp.crm</p><p>类名、接口名：多单词组成时，所有单词的首字母大写：XxxYyyZzz [大驼峰] 比如： TankShotGame</p><p>变量名、方法名：多单词组成时，第一个单词首字母小写，第二个单词开始每个单词首字母大写：xxxYyyZzz [小 驼峰， 简称 驼峰法] 比如：tankShotGame</p><p>常量名：所有字母都大写。多单词时每个单词用下划线连接：XXX_YYY_ZZZ 比如 ：定义一个所得税率 TAX_RATE</p><h2 id="关键字">关键字</h2><p>被 Java 语言赋予了特殊含义，用做专门用途的字符串（单词），所有字母都为小写。</p><h2 id="保留字">保留字</h2><p>现有 Java 版本尚未使用，但以后版本可能会作为关键字使用。自己命名标识符时要避免使用这些保留 字 byValue、cast、future、 generic、 inner、 operator、 outer、 rest、 var 、 goto 、const</p><h2 id="键盘输入语句">键盘输入语句</h2><p>以使用键盘输入语句来获取。Input.java , 需要一个 扫描器(对象), 就是 Scanner</p><p>🎀步骤：</p><ul><li>导入该类的所在包, java.util.</li><li>创建该类对象（声明变量）</li><li>调用里面的功能</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;<span class="comment">//表示把 java.util 下的 Scanner 类导入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Input</span> &#123;</span><br><span class="line">    <span class="comment">//编写一个 main 方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//演示接受用户的输入</span></span><br><span class="line">    <span class="comment">//步骤</span></span><br><span class="line">    <span class="comment">//Scanner 类 表示 简单文本扫描器，在 java.util 包</span></span><br><span class="line">    <span class="comment">//1. 引入/导入 Scanner 类所在的包</span></span><br><span class="line">    <span class="comment">//2. 创建 Scanner 对象 , new 创建一个对象,体会</span></span><br><span class="line">    <span class="comment">// myScanner 就是 Scanner 类的对象</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">myScanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="comment">//3. 接收用户输入了， 使用 相关的方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入名字&quot;</span>);</span><br><span class="line">    <span class="comment">//当程序执行到 next 方法时，会等待用户输入~~~</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> myScanner.next(); <span class="comment">//接收用户输入字符串</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入年龄&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> myScanner.nextInt(); <span class="comment">//接收用户输入 int</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入薪水&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">sal</span> <span class="operator">=</span> myScanner.nextDouble(); <span class="comment">//接收用户输入 double</span></span><br><span class="line">        System.out.println(<span class="string">&quot;人的信息如下:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;名字=&quot;</span> + name</span><br><span class="line">                + <span class="string">&quot; 年龄=&quot;</span> + age + <span class="string">&quot; 薪水=&quot;</span> + sal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="进制">进制</h2><p>Java没有无符号数，计算机运算时都是以补码形式运算</p><h2 id="位运算符">位运算符</h2><p>按位与<code>&amp;</code>、按位或<code>|</code>，按位异或<code>^</code>，按位取反<code>~</code>，算数右移<code>&gt;&gt;</code>，算数左移<code>&lt;&lt;</code>，逻辑右移<code>&gt;&gt;&gt;</code>（低位溢出，高位补 0），没有逻辑左移。</p><h1>程序控制结构</h1><ul><li>顺序控制 前向引用</li><li>分支控制 if-else</li><li>switch 分支结构</li><li>for</li><li>while</li></ul><h1>数组、排序和查找</h1><h2 id="数组">数组</h2><p>数组属引用类型，数组型数据是对象(object)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态初始化</span></span><br><span class="line"><span class="type">int</span> a[] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> b[] = &#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br></pre></td></tr></table></figure><p>数组中的元素可以是任何数据类型，包括基本类型和引用类型，但是不能混用。</p><p>数组创建后，如果没有赋值，有默认值 <code>int 0</code>，<code>short 0</code>, <code>byte 0</code>, <code>long 0</code>, <code>float 0.0</code>,<code>double 0.0</code>，<code>char \u0000</code>，<code>boolean false</code>，<code>String null</code></p><h2 id="赋值机制">赋值机制</h2><p>基本数据类型赋值方式为值拷贝</p><p>数组赋值方式为引用传递，赋的值是地址，赋值方式为引用传达</p><p>若需要拷贝后的数组地址独立，则需要new</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] arr1 = &#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>&#125;; </span><br><span class="line"><span class="type">int</span>[] arr2 = <span class="keyword">new</span> <span class="title class_">int</span> [arr1.length]</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr1.length;i++)&#123;</span><br><span class="line">arr2[i] = arr1[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二维数组">二维数组</h2><h3 id="动态初始化">动态初始化</h3><p><img src="https://pic.imgdb.cn/item/66aa5b52d9c307b7e96f50ea.png" alt="二维数组"></p><blockquote><p>也可以这样创建：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>][]</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    arr[i] = <span class="keyword">new</span> <span class="title class_">int</span>[i + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">//给每个一维数组开空间 new</span></span><br><span class="line"><span class="comment">//如果没有给一维数组 new ,那么 arr[i]就是 null</span></span><br><span class="line"><span class="comment">//遍历一维数组，并给一维数组的每个元素赋值</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr[i].length; j++) &#123;</span><br><span class="line">    arr[i][j] = i + <span class="number">1</span>;<span class="comment">//赋值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h3 id="静态初始化">静态初始化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] arr = &#123;&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;, &#123;<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>&#125;, &#123;<span class="number">100</span>&#125;&#125;;</span><br></pre></td></tr></table></figure><h1>面向对象编程</h1><h2 id="类与对象">类与对象</h2><p>类是抽象的，概念的，代表一类事物,比如人类,猫类…, 即它是数据类型</p><p>对象是具体的，实际的，代表一个具体事物, 即是实例</p><p>类是对象的模板，对象是类的一个个体，对应一个实例</p><p><img src="https://pic.imgdb.cn/item/66af0a8bd9c307b7e9124ad3.png" alt="类与对象"></p><p>属性的定义语法同变量，示例：访问修饰符 属性类型 属性名;</p><p>访问修饰符： 控制属性的访问范围 有四种访问修饰符 public, proctected, 默认, private ,</p><p>属性的定义类型可以为任意类型，包含基本类型或引用类型</p><p>属性如果不赋值，有默认值，规则和数组一致。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="number">0</span></span><br><span class="line"><span class="type">short</span> <span class="number">0</span></span><br><span class="line"><span class="type">byte</span> <span class="number">0</span></span><br><span class="line"><span class="type">long</span> <span class="number">0</span></span><br><span class="line"><span class="type">float</span> <span class="number">0.0</span></span><br><span class="line"><span class="type">double</span> <span class="number">0.0</span></span><br><span class="line"><span class="type">char</span> \u0000</span><br><span class="line"><span class="type">boolean</span> <span class="literal">false</span></span><br><span class="line">String nul</span><br></pre></td></tr></table></figure><ul><li>内存分配机制</li></ul><p>栈： 一般存放基本数据类型(局部变量)</p><p>堆： 存放对象(Cat cat , 数组等)</p><p>方法区：常量池(常量，比如字符串)， 类加载信息</p><h2 id="成员方法">成员方法</h2><p>调用机制</p><p><img src="https://pic.imgdb.cn/item/66af10bfd9c307b7e920090d.png" alt="方法调用机制"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">访问修饰符 返回数据类型 方法名（形参列表..） &#123;//方法体</span><br><span class="line">    语句；</span><br><span class="line">    return 返回值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>方法不能嵌套定义</p><p>跨类中的方法A类调用B类方法：需要通过对象名调用。比如对象名，方法名（参数)</p><p>跨类的方法调用和方法的访问修饰符相关</p></blockquote><h3 id="传参机制">传参机制</h3>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java核心技术卷Ⅰ</title>
      <link href="/2024/08/01/JAVA/Java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%8D%B7%E2%85%A0/"/>
      <url>/2024/08/01/JAVA/Java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%8D%B7%E2%85%A0/</url>
      
        <content type="html"><![CDATA[<h1>对象与类</h1><h2 id="面向对象程序设计概述">面向对象程序设计概述</h2><p>创建实例：类构建对象的过程</p><p>实例字段：对象中的数据；实例字段的值的集合称为状态</p><p>方法：操作数据的过程</p><h3 id="行为、状态、标识">行为、状态、标识</h3><p><img src="https://pic.imgdb.cn/item/66c2dbcdd9c307b7e99ffa0e.png" alt=""></p><h3 id="类之间的关系">类之间的关系</h3><ul><li>依赖</li><li>聚合</li><li>继承</li></ul><h2 id="使用预定义类">使用预定义类</h2><h3 id="对象与对象变量">对象与对象变量</h3><p>使用构造器（constructor）构造新实例，构造器的名字应该与类名相同。</p><blockquote><p>一个对象变量并没有实际包含一个对象，而仅仅引用一个对象。</p></blockquote><p>局部变量不会自动地初始化为null，而必须通过调用new或将它们设置为null进初始化。</p><h3 id="更改器方法与访问器方法">更改器方法与访问器方法</h3><p>只访问对象而不修改对象的方法有时称为访问器方法（accessor method）例如，LocalDate.getYear和GregorianCalendar.get。</p><p>GregorianCalendar.add方法是一个更改器方法（mutator method）。调用这个方法后，someDay对象的状态会改变。</p><h2 id="自定义类">自定义类</h2><h3 id="Employee类">Employee类</h3><p>文件名必须与public类的名字相匹配。在一个源文件中，只能有一个公有类，但可以有任意数目的非公有类。</p><p>类通常包含类类型的实例字段。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure><h3 id="构造器">构造器</h3><p>构造器与类同名，总是伴随着new操作符的执行被调用，而不能对一个已经存在的对象调用构造器来达到重新设置实例域的目的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String n, <span class="type">double</span> s, <span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span></span><br><span class="line">   &#123;</span><br><span class="line">      name = n;</span><br><span class="line">      salary = s;</span><br><span class="line">      hireDay = LocalDate.of(year, month, day);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">staff[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Carl Cracker&quot;</span>, <span class="number">75000</span>, <span class="number">1987</span>, <span class="number">12</span>, <span class="number">15</span>);<span class="comment">//正确</span></span><br><span class="line">james.Employee(<span class="string">&quot;Carl Cracker&quot;</span>, <span class="number">75000</span>, <span class="number">1987</span>, <span class="number">12</span>, <span class="number">15</span>);<span class="comment">//错误</span></span><br></pre></td></tr></table></figure><ul><li>构造器与类同名</li><li>每个类可以有一个以上的构造器</li><li>构造器可以有0个、1个或多个参数</li><li>构造器没有返回值</li><li>构造器总是伴随着new操作一起调用</li><li>所有的Java对象都是在堆中构造的</li><li>不要在构造器中定义与实例域重名的局部变量。这些变量只能在构造器内部访问。这些变量屏蔽了同名的实例域。</li></ul><p><strong>var关键字声明局部变量：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">harry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Carl Cracker&quot;</span>, <span class="number">75000</span>, <span class="number">1987</span>, <span class="number">12</span>, <span class="number">15</span>);</span><br></pre></td></tr></table></figure><p>只能用于方法中的局部变量，参数和字段的类型必须声明。</p><p><strong>使用null引用：</strong></p><p>null值应用一个方法，产生NullPointException异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LocalDate</span> <span class="variable">rightNow</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> rightNow.toString();<span class="comment">//NullPointException</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//解决中断情况</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String n,<span class="type">double</span> s,<span class="type">int</span> year,<span class="type">int</span> monh,<span class="type">int</span> day)</span>&#123;</span><br><span class="line">    name = Object.requireNonNulElse(n,<span class="string">&quot;unknown&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="隐式参数与显式参数">隐式参数与显式参数</h3><p>第一个参数称为隐式（implicit）参数，是出现在方法名前的Employee类对象。第二个参数位于方法名后面括号中的数值，这是一个显式（explicit）参数。在每一个方法中，关键字this表示隐式参数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">raiseSalary</span><span class="params">(<span class="type">double</span> byPercent)</span>&#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">raise</span> <span class="operator">=</span> <span class="built_in">this</span>.salary * byPercent/<span class="number">100</span>;</span><br><span class="line">    <span class="built_in">this</span>.salary += raise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="封装的优点">封装的优点</h3><p>需要获得或设置实例域的值。因此，应该提供下面三项内容：</p><ul><li><p>一个私有的数据域</p></li><li><p>一个公有的域访问器方法</p></li><li><p>一个公有的域更改器方法。</p></li></ul><blockquote><p>不要编写返回引用可变对象的访问器方法</p><p>如果需要返回一个可变数据域的拷贝，就应该使用clone</p></blockquote><h3 id="基于类的访问权限">基于类的访问权限</h3><p>方法可以访问所属类的私有特性（feature），而不仅限于访问隐式参数的私有特性。</p><h3 id="final实例字段">final实例字段</h3><p>可以将实例字段定义为final。构建对象时必须初始化这样的字段。必须确保在每一个构造器执行之后，这个字段的值被设置，并且在后面的操作中，不能够再对它进行修改。</p><p>但对于可变的类，使用final修饰符可能会造成混乱：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> StringBulider evaluations;</span><br></pre></td></tr></table></figure><p>final关键字只是表示存储在evaluations变量中的对象引用不会再指示其他StringBuilder对象。不过这个对象可以更改。</p><h2 id="静态字段和静态方法">静态字段和静态方法</h2><h3 id="静态字段">静态字段</h3><p>如果将字段定义为static，这个字段不出现在每个类的对象中，每个静态字段只有一个副本，静态字段属于类，但不属于单个对象。</p><p>可以用来构造静态常量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pubilc <span class="keyword">class</span> <span class="title class_">Math</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">PI</span> <span class="operator">=</span> <span class="number">3.1415926</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="静态方法">静态方法</h3><p>静态方法是一种不能向对象实施操作的方法。没有this参数，不能访问实例字段。</p><p>可用类名.静态方法名/对象.静态方法名调用。</p><h3 id="工厂方法">工厂方法</h3><p>继承子类</p><h3 id="main方法">main方法</h3><p>静态方法，不对任何对象进行操作</p><h2 id="方法参数">方法参数</h2><p>一个方法可以修改<strong>传递引用</strong>所对应的变量值，而不能修改传递<strong>值调用</strong>所对应的变量值。</p><p>Java程序设计语言总是采用按值调用。也就是说，方法得到的是所有参数值的一个拷贝，特别是，方法不能修改传递给它的任何参数变量的内容。</p><p><img src="https://pic.imgdb.cn/item/66c42efbd9c307b7e9412403.png" alt="按值调用"></p><p>对于对象来说可行：<br><img src="https://pic.imgdb.cn/item/66c42f77d9c307b7e941840f.png" alt="对象"></p><p>Java程序设计语言对对象采用的不是引用调用，实际上，对象引用是按值传递的。</p><ul><li>一个方法不能修改一个基本数据类型的参数（即数值型或布尔型）。</li><li>一个方法可以改变一个对象参数的状态。</li><li>一个方法不能让对象参数引用一个新的对象。</li></ul><h2 id="对象构造">对象构造</h2><h3 id="重载">重载</h3><p>如果多个方法（比如，StringBuilder构造器方法）有相同的名字、不同的参数，便产生了重载。</p><blockquote><p>Java允许重载任何方法，而不只是构造器方法。因此，要完整地描述一个方法，需要指出方法名以及参数类型。这叫做方法的签名（signature）。</p><p>不能有两个名字相同、参数类型也相同却返回不同类型值的方法。</p></blockquote><h3 id="默认字段初始化">默认字段初始化</h3><p>必须明确地初始化方法中的局部变量。但是，如果没有初始化类中的字段，将会被自动初始化为默认值（0、false或null）。</p><h3 id="无参数构造">无参数构造</h3><p>一个类时没有编写构造器，那么系统就会提供一个无参数构造器。如果类中提供了至少一个构造器，但是没有提供无参数的构造器，则在构造对象时如果没有提供参数就会被视为不合法。</p><h3 id="参数名技巧">参数名技巧</h3><p>参数变量会遮蔽同名的实例字段。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String aName,<span class="type">double</span> aSalary)</span>&#123;</span><br><span class="line">    name = aName;</span><br><span class="line">    salary = aSalary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name,<span class="type">double</span> salary)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="调用另一个构造器">调用另一个构造器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(<span class="type">double</span> s)</span>&#123;</span><br><span class="line"><span class="comment">//调用Employee(String name,double salary)</span></span><br><span class="line">    <span class="built_in">this</span>(<span class="string">&quot;Employee #&quot;</span> + nextId,s);</span><br><span class="line">    nextId++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="初始化块">初始化块</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">// set nextId to a random number between 0 and 9999</span></span><br><span class="line">      nextId = generator.nextInt(<span class="number">10000</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="对象析构">对象析构</h3><p>由于Java有自动的垃圾回收器，不需要人工回收内存，所以Java不支持析构器。</p><ul><li>一旦用完就关闭，close方法</li><li>等到虚拟机退出再关闭，Euntime.addShutdownHook</li></ul><h2 id="记录">记录</h2><p>是特殊的类，状态不可改变，公共可读。</p><p>组件：一个记录的实例字段。</p><ul><li>toString</li><li>equals</li><li>hashCode</li></ul><p>不能为记录增加实例字段</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Piont</span><span class="params">(<span class="type">double</span> x,<span class="type">double</span> y)</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">double</span> r;<span class="comment">//错误</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>记录的实例字段自动为final字段（可变），可自己设置不可变类型。</p><p>标准构造器：自动定义地设置所有实例字段的构造器。</p><p>自定义构造器：第一句必须调用另一个构造器，最终会调用标准构造器。</p><p>不能在简洁构造器主体中读取或修改实例字段。</p><h2 id="包">包</h2><h3 id="类的导入">类的导入</h3><p>类可以使用所属包中的所有类和其他包的公共类。</p><p>访问其他包的公共类：</p><ul><li>完全限定类名</li><li>import java.time*(只能导入一个包)</li></ul><h3 id="在包中增加类">在包中增加类</h3><p>要想将一个类放入包中，就必须将包的名字放在源文件的开头，包中定义类的代码之前。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.horstmann.corejava;</span><br></pre></td></tr></table></figure><p>如果没有在源文件中放置package语句，这个源文件中的类就被放置在一个无名包中。无名包是一个没有名字的包。</p><p>子目录：com\horstmann\corejava</p><blockquote><p>编译器处理文件（不检查目录结构），解释器加载类</p></blockquote><h3 id="包访问">包访问</h3><p>如果没有指定public或private，这个部分（类、方法或变量）可以被同一个包中的所有方法访问。</p><h3 id="文档注释">文档注释</h3><p>javadoc——HTML文档，<code>/**...*/</code>在标记之后紧跟着自由格式文本（free-form text）。标记由@开始，如@author或@param。自由格式文本的第一句应该是一个概要性的句子。javadoc实用程序自动地将这些句子抽取出来形成概要页。</p><blockquote><p>要键入等宽代码，需使用{@code …}而不是&lt;code&gt;…&lt;/code&gt;</p><p>果文档中有到其他文件的链接，例如，图像文件（用户界面的组件的图表或图像等），就应该将这些文件放到子目录doc-files中。javadoc实用程序将从源目录拷贝这些目录及其中的文件到文档目录中。在链接中需要使用doc-files目录，例如：&lt;img src=“doc-files/uml.png”alt=“UML diagram”&gt;。</p></blockquote><ul><li><p>类注释 类注释必须放在import语句之后，类定义之前。</p></li><li><p>方法注释 每一个方法注释必须放在所描述的方法之前。</p><ul><li><p>@param变量描述</p><p>这个标记将对当前方法的“param”（参数）部分添加一个条目。这个描述可以占据多行，并可以使用HTML标记。一个方法的所有@param标记必须放在一起。</p></li><li><p>@return描述</p><p>这个标记将对当前方法添加“return”（返回）部分。这个描述可以跨越多行，并可以使用HTML标记。</p></li><li><p>@throws类描述</p><p>这个标记将添加一个注释，用于表示这个方法有可能抛出异常。</p></li></ul></li><li><p>字段注释 只需要对公有字段（通常指的是静态常量）的注释</p></li><li><p>通用注释</p><ul><li><p>@author姓名</p></li><li><p>@version文本</p></li><li><p>@since文本</p></li><li><p>@see引用</p><p>建立一个链接到com.horstmann.corejava.Employee类的raiseSalary(double)方法的超链接。</p><p>@see标记后面有一个&lt;字符，就需要指定一个超链接。</p></li><li><p>@deprecated文本</p></li></ul></li><li><p>包注释</p><ul><li>提供一个以package.html命名的HTML文件。在标记&lt;body&gt;…&lt;/body&gt;之间的所有文本都会被抽取出来。</li><li>提供一个以package-info.java命名的Java文件。这个文件必须包含一个初始的以/*<em>和</em>/界定的Javadoc注释，跟随在一个包语句之后。它不应该包含更多的代码或注释。</li></ul></li><li><p>注释提取</p><ul><li><p>切换到包含想要生成文档的源文件目录。</p></li><li><pre><code class="language-java">javadoc -d docDirectory nameOfPackage//包javadoc -d docDirectory nameOfPackagenameOfPackage...//多个包的文档    javadoc -d docDirectory *java//文件在默认包<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 类设计技巧</span><br><span class="line"></span><br><span class="line">  - 一定要保证数据私有</span><br><span class="line">  - 一定要对数据初始化</span><br><span class="line">  - 不要在类中使用过多的基本类型</span><br><span class="line">  - 不是所有的字段都需要独立的字段访问器和字段更改器</span><br><span class="line">  - 将职责过多的类进行分解</span><br><span class="line">  - 类名和方法名要能够体现它们的职责</span><br><span class="line">  - 优先使用不可变的类</span><br><span class="line"></span><br><span class="line"># 继承</span><br><span class="line"></span><br><span class="line">## 类、超类和子类</span><br><span class="line"></span><br><span class="line">“is-a”关系是继承的特征</span><br><span class="line"></span><br><span class="line">### 定义子类</span><br><span class="line"></span><br><span class="line">所有继承都是公共继承</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">public class Manger extends Employee&#123;</span><br><span class="line">    added methods and fields</span><br><span class="line">&#125;//Employee超类，基类，父类</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><blockquote><p>声明为私有的类成员不会被这个类的子类继承，因为子类不能直接访问私有字段。但子类创建的对象有这些字段。</p></blockquote><h3 id="覆盖方法">覆盖方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSalary</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">baseSalary</span> <span class="operator">=</span> <span class="built_in">super</span>.getSalary();</span><br><span class="line">    <span class="keyword">return</span> baseSalary + bonus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>super不是对象的引用，是指示编译器调用超类方法的特殊关键字。继承不会删除任何字段或方法。</p></blockquote><h3 id="子类构造器">子类构造器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Manager</span><span class="params">(String name, <span class="type">double</span> salary, <span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">super</span>(name, salary, year, month, day);</span><br><span class="line">    <span class="comment">//调用Employee类的name, salary, year, month, day参数的构造器</span></span><br><span class="line">    bonus = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果子类的构造器没有显式地调用超类的构造器，则将自动地调用超类默认（没有参数）的构造器。</p><ul><li>this<ul><li>引用隐式参数</li><li>调用该类其他的构造器</li></ul></li><li>super<ul><li>调用超类的方法</li><li>调用超类的构造器</li></ul></li></ul><h3 id="继承层次结构">继承层次结构</h3><p><img src="https://pic.imgdb.cn/item/66c848f9d9c307b7e93f49a6.png" alt="层次结构"></p><p>由一个公共超类派生出来的所有类的集合被称为继承层次（inheritance hierarchy)，继承层次中，从某个特定的类到其祖先的路径被称为该类的继承链（inheritance chain）。</p><blockquote><p>Java不支持多继承。</p></blockquote><h3 id="多态">多态</h3><p>“is-a”规则的另一种表述法是置换法则。可以将一个子类的对象赋给超类变量。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> inheritance;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program demonstrates inheritance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.21 2004-02-21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Cay Horstmann</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerTest</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="type">var</span> <span class="variable">boss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Manager</span>(<span class="string">&quot;Carl Cracker&quot;</span>, <span class="number">80000</span>, <span class="number">1987</span>, <span class="number">12</span>, <span class="number">15</span>);</span><br><span class="line">      boss.setBonus(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">      <span class="type">var</span> <span class="variable">staff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">      staff[<span class="number">0</span>] = boss;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boss.setBonus(<span class="number">5000</span>) <span class="comment">//对</span></span><br><span class="line">staff[<span class="number">0</span>].setBonus(<span class="number">5000</span>) <span class="comment">//错</span></span><br><span class="line"><span class="type">Manager</span> <span class="variable">m</span> <span class="operator">=</span> staff[i] <span class="comment">//不能将超类的引用赋值给类变量</span></span><br></pre></td></tr></table></figure><p>staff[0]的声明类型是Employee</p><h3 id="理解方法调用">理解方法调用</h3><ol><li>编译器查看对象的声明类型和方法名。</li><li>查看调用方法时提供的参数类型。如果在所有名为f的方法中存在一个与提供的参数类型完全匹配，就选择这个方法，这个过程被称为<strong>重载解析</strong>。</li><li>如果是private方法、static方法、final方法（有关final修饰符的含义将在下一节讲述）或者构造器，那么编译器将可以准确地知道应该调用哪个方法，我们将这种调用方式称为<strong>静态绑定</strong>（static binding）。与此对应的是，调用的方法依赖于隐式参数的实际类型，并且在运行时实现<strong>动态绑定</strong>。</li><li>当程序运行，并且采用动态绑定调用方法时，虚拟机一定调用与x所引用对象的实际类型最合适的那个类的方法。假设x的实际类型是D，它是C类的子类。如果D类定义了方法f(String)，就直接调用它；否则，将在D类的超类中寻找f(String)，以此类推。</li></ol><p>虚拟机预先为每个类创建了一个方法表（method table），</p><blockquote><p>在覆盖一个方法的时候，子类方法不能低于超类方法的可见性。特别是，如果超类方法是public，子类方法一定要声明为public。</p></blockquote><h3 id="阻止继承：final类和方法">阻止继承：final类和方法</h3><p>不允许扩展的类被称为final类，使用final修饰符，final类中的所有方法自动地成为final方法。</p><p>如果一个方法没有被覆盖并且很短，编译器就能够对它进行优化处理，这个过程为称为<strong>内联</strong>（inlining）。</p><blockquote><p>枚举和记录总是final,它们不允许扩展。</p></blockquote><h3 id="强制类型转换✨">强制类型转换✨</h3><p>如果试图在继承链上进行向下的类型转换，并且“谎报”有关对象包含的内容，会报错</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Manager</span> <span class="variable">boss</span> <span class="operator">=</span> (Manager) staff[<span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>在进行类型转换之前，先查看一下是否能够成功地转换。这个过程简单地使用instanceof操作符就可以实现。如果这个类型转换不可能成功，编译器就不会进行这个转换。</p><p><img src="https://pic.imgdb.cn/item/66c8a73bd9c307b7e9d9714a.png" alt="instanceof"></p><ul><li>只能在继承层次内进行类型转换。</li><li>在将超类转换成子类之前，应该使用instanceof进行检查。</li></ul><h3 id="instanceof模式匹配✨">instanceof模式匹配✨</h3><p>Java16:直接在测试中声明子变量：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (staff[i] <span class="keyword">instanceof</span> Manager boss)&#123;</span><br><span class="line">boss.setBonus(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>staff[i]是Manager类的实体，boss变为staff[i]；否则，不会设置boss，生成false值。</p><p>引入一个变量时，可以立即在同一个表达式中使用这个变量。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Employee e;</span><br><span class="line"><span class="keyword">if</span> (e <span class="keyword">instanceof</span> Manager m &amp;&amp; m.getBonus() &gt; <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有&amp;&amp;左边true才计算右边，若计算右边，则m必为一个Manager实例</span></span><br></pre></td></tr></table></figure><p>instanceof模式定义的局部变量会遮蔽字段。</p><h3 id="受保护访问">受保护访问</h3><p>希望超类中的某些方法允许被子类访问，或允许子类的方法访问超类的某个字段。为此，需要将这些方法或域声明为<strong>protected</strong>。受保护的字段只能由同一个包的类访问</p><p>🎀Java用于控制可见性的4个访问修饰符</p><ul><li>仅对本类可见——private</li><li>对所有类可见——public</li><li>对本包和所有子类可见——protected</li><li>对本包可见——默认（很遗憾），不需要修饰符</li></ul><h2 id="Object：所有类的超类">Object：所有类的超类</h2><p>可以使用Object类型的变量引用任何类型的对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object obj <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Harry Hacker&quot;</span>,<span class="number">35000</span>);</span><br></pre></td></tr></table></figure><p>Object类型的变量只能用于作为各种值的泛型容器。要想对其中的内容进行具体的操作，还需要清楚对象的原始类型，并进行相应的类型转换。</p><p>只有基本类型（primitive types）不是对象，例如，数值、字符和布尔类型的值都不是对象。<strong>所有的数组类型，不管是对象数组还是基本类型的数组都扩展了Object类。</strong></p><h3 id="equals方法">equals方法</h3><p>只有在两个对象属于同一个类时，才有可能相等。</p><p>在子类中定义equals方法时，首先调用超类的equals。如果检测失败，对象就不可能相等。如果超类中的字段都相等，就需要比较子类中的实例字段。</p><h3 id="相等测试与继承">相等测试与继承</h3><p>如果发现类不匹配，equals方法就返回false。但是，许多程序员却喜欢使用instanceof进行检测：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!(otherObject <span class="keyword">instanceof</span> Employee)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>特性:</p><ol><li>自反性：对于任何非空引用x, x.equals(x)应该返回true。</li><li>对称性：对于任何引用x和y，当且仅当y.equals(x)返回true,x.equals(y)也应该返回true。</li><li>传递性：对于任何引用x、y和z，如果x.equals(y)返回true,y.equals(z)返回true, x.equals(z)也应该返回true。</li><li>一致性：如果x和y引用的对象没有发生变化，反复调用x.equals(y)应该返回同样的结果。</li><li>对于任意非空引用x, x.equals(null)应该返回false。</li></ol><p>注意：</p><ul><li>如果子类能够拥有自己的相等概念，则对称性需求将强制采用getClass进行检测。</li><li>如果由超类决定相等的概念，那么就可以使用instanceof进行检测，这样可以在不同子类的对象之间进行相等的比较。</li></ul><h3 id="hashCode方法">hashCode方法</h3><p>要考虑这个散列码是基于数值还是地址计算的</p><h3 id="toString方法">toString方法</h3><p>最好给每个类都搞一个toString方法。</p><p>Object类定义了toString方法，用来打印输出对象所属的类名和散列码。</p><h2 id="泛型数组列表">泛型数组列表</h2><p>在运行时确定数组大小——ArrayList，一个采用<strong>类型参数</strong>（type parameter）的泛型类（generic class）。</p><h3 id="声明数组列表">声明数组列表</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Employee&gt; staff = <span class="keyword">new</span> <span class="title class_">ArryList</span>&lt;Employee&gt;(<span class="number">100</span>);<span class="comment">//初始容量100</span></span><br><span class="line">    </span><br><span class="line"><span class="type">var</span> <span class="variable">staff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArryList</span>&lt;Employee&gt;();</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Employee&gt; staff = <span class="keyword">new</span> <span class="title class_">ArryList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><blockquote><p>分配数组列表 != 分配数组元素</p></blockquote><p>确定数组大小不再变化后可使用trimToSize方法，需移动内存块。</p><h3 id="访问数组元素">访问数组元素</h3><p>只有i小于或等于数组列表的大小时，才能够调用list.set(i, x)，要得到一个数组列表的元素，可以使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> staff.get(i); </span><br><span class="line"><span class="comment">//只有i小于或等于数组列表的大小时，才能够调用list.set(i, x)。</span></span><br><span class="line"></span><br><span class="line"><span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> (Employee) staff.get(i); </span><br><span class="line"><span class="comment">//get方法的调用者必须对返回值进行类型转换</span></span><br></pre></td></tr></table></figure><p>更为保险的方法是想创建一个数组列表，而后将其转换为数组元素（toArray方法）。</p><h3 id="类型化与原始数组列表的兼容性">类型化与原始数组列表的兼容性</h3><p>鉴于兼容性的考虑，编译器在对类型转换进行检查之后，如果没有发现违反规则的现象，就将所有的类型化数组列表转换成原始ArrayList对象。在程序运行时，所有的数组列表都是一样的，即没有虚拟机中的类型参数。因此，类型转换（ArrayList）和（ArrayList<Employee>）将执行相同的运行时检查。</p><p>只要在与遗留的代码进行交叉操作时，研究一下编译器的警告性提示，并确保这些警告不会造成太严重的后果就行了。</p><h3 id="对象包装器与自动装箱">对象包装器与自动装箱</h3><p>对象包装器类是不可变的，即一旦构造了包装器，就不允许更改包装在其中的值。</p><p>对象包装器类还是final，因此不能定义它们的子类。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">List</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">list.add(<span class="number">3</span>);<span class="comment">//自动装箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> list.get(i);<span class="comment">//自动拆箱</span></span><br></pre></td></tr></table></figure><blockquote><p>绝对不要依赖包装器对象的同一性。不要用<code>==</code>比较包装器对象（这是依据存储位置进行比较），可以用equals()比较，也不要将包装器对象作为锁。</p></blockquote><p>装箱和拆箱是编译器的工作，不是虚拟机。</p><p>Integer对象是不可变的，在方法内部对这个拷贝所做的任何修改都不会影响到原始变量。这就是所谓的“<strong>按值传递</strong>”。</p><h2 id="参数个数可变的方法">参数个数可变的方法</h2><p>可以将已经存在且最后一个参数是数组的方法重新定义为可变参数的方法，而不会破坏任何已经存在的代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String...args)</span></span><br></pre></td></tr></table></figure><h2 id="抽象类">抽象类</h2><p>包含一个或多个抽象方法的类本身必须被声明为抽象的，抽象方法相当于子类中实现的具体方法的占位符。</p><blockquote><p>抽象类不能实例化，仍可以创建一个抽象类的对象变量，但只能引用非抽象子类的对象。</p><p>编译器只允许调用在类中声明的方法。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> acstract <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"><span class="keyword">public</span> acstract String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="枚举类">枚举类</h2><p>枚举的构造器总是私有的，所有枚举类型都是抽象类Enum的子类，</p><ul><li>ordinal方法返回enum声明中枚举常量的位置，位置从0开始计数。</li><li>每个枚举类型都有一个静态的values方法，它将返回一个包含全部枚举值的数组。</li><li>toString，这个方法能够返回枚举常量名。</li></ul><h2 id="密封类">密封类</h2><p>acstract sealsd声明为密封类，控制哪些类可以继承它。</p><p>一个密封类允许的子类必须是可访问的，不能是嵌套在另一个类中的私有类，也不能是位于另一个包中的包可见的类。</p><blockquote><p>记录和枚举可以实现接口但不能扩展类</p></blockquote><h2 id="反射（待补充）">反射（待补充）</h2><p>能够分析类能力的程序称为<strong>反射</strong>。</p><h1>接口、lambda表达式和内部类</h1><p>接口（interface）技术，这种技术主要用来描述类具有什么功能，而并不给出每个功能的具体实现。</p><p>使用lambda表达式，可以用一种精巧而简洁的方式表示使用回调或变量行为的代码。</p><p>内部类（inner class）机制，内部类定义在另外一个类的内部，其中的方法可以访问包含它们的外部类的字段。内部类技术主要用于设计具有相互协作关系的类集合。</p><p>代理是一种非常专业的构造工具，它可以用来构建系统级的工具。</p><h2 id="接口">接口</h2><h3 id="接口概念">接口概念</h3><p>接口（英文：Interface），在JAVA编程语言中是一个抽象类型，是抽象方法的集合，接口通常以interface来声明。一个类通过继承接口的方式，从而来继承接口的抽象方法。</p><p>接口并不是类，编写接口的方式和类很相似，但是它们属于不同的概念。类描述对象的属性和方法。接口则包含类要实现的方法。</p><p>除非实现接口的类是抽象类，否则该类要定义接口中的所有方法。</p><p>接口无法被实例化，但是可以被实现。一个实现接口的类，必须实现接口内所描述的所有方法，否则就必须声明为抽象类。另外，在 Java 中，接口类型可用来声明一个变量，他们可以成为一个空指针，或是被绑定在一个以此接口实现的对象。</p><h3 id="接口与类相似点">接口与类相似点</h3><ul><li>一个接口可以有多个方法。</li><li>接口文件保存在 .java 结尾的文件中，文件名使用接口名。</li><li>接口的字节码文件保存在 .class 结尾的文件中。</li><li>接口相应的字节码文件必须在与包名称相匹配的目录结构中。</li></ul><h3 id="接口与类的区别">接口与类的区别</h3><ul><li>接口不能用于实例化对象。</li><li>接口没有构造方法。</li><li>接口中所有的方法必须是抽象方法，Java 8 之后 接口中可以使用 default 关键字修饰的非抽象方法。</li><li>接口不能包含成员变量，除了 static 和 final 变量。</li><li>接口不是被类继承了，而是要被类实现。</li><li>接口支持多继承。</li></ul><h3 id="接口特性">接口特性</h3><ul><li>接口中每一个方法也是隐式抽象的,接口中的方法会被隐式的指定为 <strong>public abstract</strong>（只能是 public abstract，其他修饰符都会报错）。</li><li>接口中可以含有变量，但是接口中的变量会被隐式的指定为 <strong>public static final</strong> 变量（并且只能是 public，用 private 修饰会报编译错误）。</li><li>接口中的方法是不能在接口中实现的，只能由实现接口的类来实现接口中的方法。</li></ul><h3 id="抽象类和接口的区别">抽象类和接口的区别</h3><ul><li>抽象类中的方法可以有方法体，就是能实现方法的具体功能，但是接口中的方法不行。</li><li>抽象类中的成员变量可以是各种类型的，而接口中的成员变量只能是 <strong>public static final</strong> 类型的。</li><li>接口中不能含有静态代码块以及静态方法(用 static 修饰的方法)，而抽象类是可以有静态代码块和静态方法。</li><li>一个类只能继承一个抽象类，而一个类却可以实现多个接口。</li></ul><h3 id="接口的声明">接口的声明</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface 接口名称 [extends 其他的接口名] &#123;</span><br><span class="line">    <span class="comment">// 声明变量</span></span><br><span class="line">    <span class="comment">// 抽象方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Interface关键字用来声明一个接口。</p><ul><li>接口是隐式抽象的，当声明一个接口的时候，不必使用<strong>abstract</strong>关键字。</li><li>接口中每一个方法也是隐式抽象的，声明时同样不需要<strong>abstract</strong>关键字。</li><li>接口中的方法都是公有的。</li></ul><h3 id="接口的实现">接口的实现</h3><p>当类实现接口的时候，类要实现接口中所有的方法。否则，类必须声明为抽象的类。</p><p>类使用implements关键字实现接口。在类声明中，Implements关键字放在class声明后面。</p><p>实现一个接口的语法:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...implements 接口名称[, 其他接口名称, 其他接口名称..., ...] ...</span><br></pre></td></tr></table></figure><p>EG:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 文件名 : MammalInt.java */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MammalInt</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Mammal eats&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">travel</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Mammal travels&quot;</span>);</span><br><span class="line">   &#125; </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">noOfLegs</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span>&#123;</span><br><span class="line">      <span class="type">MammalInt</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MammalInt</span>();</span><br><span class="line">      m.eat();</span><br><span class="line">      m.travel();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重写接口中声明的方法时，需要注意以下规则：</p><ul><li>类在实现接口的方法时，不能抛出强制性异常，只能在接口中，或者继承接口的抽象类中抛出该强制性异常。</li><li>类在重写方法时要保持一致的方法名，并且应该保持相同或者相兼容的返回值类型。</li><li>如果实现接口的类是抽象类，那么就没必要实现该接口的方法。</li></ul><p>在实现接口的时候，也要注意一些规则：</p><ul><li>一个类可以同时实现多个接口。</li><li>一个类只能继承一个类，但是能实现多个接口。</li><li>一个接口能继承另一个接口，这和类之间的继承比较相似。</li></ul><h3 id="接口的继承">接口的继承</h3><p>一个接口能继承另一个接口，和类之间的继承方式比较相似。接口的继承使用extends关键字，子接口继承父接口的方法。</p><p>下面的Sports接口被Hockey和Football接口继承：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名: Sports.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sports</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHomeTeam</span><span class="params">(String name)</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVisitingTeam</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 文件名: Football.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Football</span> <span class="keyword">extends</span> <span class="title class_">Sports</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">homeTeamScored</span><span class="params">(<span class="type">int</span> points)</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitingTeamScored</span><span class="params">(<span class="type">int</span> points)</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endOfQuarter</span><span class="params">(<span class="type">int</span> quarter)</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 文件名: Hockey.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Hockey</span> <span class="keyword">extends</span> <span class="title class_">Sports</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">homeGoalScored</span><span class="params">()</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitingGoalScored</span><span class="params">()</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endOfPeriod</span><span class="params">(<span class="type">int</span> period)</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">overtimePeriod</span><span class="params">(<span class="type">int</span> ot)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hockey接口自己声明了四个方法，从Sports接口继承了两个方法，这样，实现Hockey接口的类需要实现六个方法。</p><p>相似的，实现Football接口的类需要实现五个方法，其中两个来自于Sports接口。</p><h3 id="接口的多继承">接口的多继承</h3><p>在Java中，类的多继承是不合法，但接口允许多继承。</p><p>在接口的多继承中extends关键字只需要使用一次，在其后跟着继承接口。 如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Hockey</span> <span class="keyword">extends</span> <span class="title class_">Sports</span>, Event</span><br></pre></td></tr></table></figure><p>与类不同的是，接口允许多继承，而 Sports及 Event 可以定义或是继承相同的方法。</p><h3 id="标记接口">标记接口</h3><p>最常用的继承接口是没有包含任何方法的接口。</p><p>标记接口是没有任何方法和属性的接口.它仅仅表明它的类属于一个特定的类型,供其他代码来测试允许做一些事情。</p><p>标记接口作用：简单形象的说就是给某个对象打个标（盖个戳），使对象拥有某个或某些特权。</p><p>例如：java.awt.event 包中的 MouseListener 接口继承的 java.util.EventListener 接口定义如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><p>没有任何方法的接口被称为标记接口。标记接口主要用于以下两种目的：</p><ul><li><p>建立一个公共的父接口：</p><p>正如EventListener接口，这是由几十个其他接口扩展的Java API，你可以使用一个标记接口来建立一组接口的父接口。例如：当一个接口继承了EventListener接口，Java虚拟机(JVM)就知道该接口将要被用于一个事件的代理方案。</p></li><li><p>向一个类添加数据类型：</p><p>这种情况是标记接口最初的目的，实现标记接口的类不需要定义任何接口方法(因为标记接口根本就没有方法)，但是该类通过多态性变成一个接口类型。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于主题的潜在bug</title>
      <link href="/2024/07/29/anzhiyu/%E5%85%B3%E4%BA%8E%E4%B8%BB%E9%A2%98%E7%9A%84%E6%BD%9C%E5%9C%A8bug/"/>
      <url>/2024/07/29/anzhiyu/%E5%85%B3%E4%BA%8E%E4%B8%BB%E9%A2%98%E7%9A%84%E6%BD%9C%E5%9C%A8bug/</url>
      
        <content type="html"><![CDATA[<p>这个可真是太劲爆了，不知道是不是只有我一个人遇到了，原来用的Shokax主题可能因为我node的版本不太对，还有一个插件作者以放弃维护导致不兼容，主题传不上去。。。遂换主题，然后历经整整一个月，遇到各种配置的bug，换过wordpress，租了服务器，买了域名，发现不好用，主题也不是很貌美（自己改不了太多。。。）而后某天一行一行对代码终于找出这个主题的小问题，也是给还在用上了哈哈。写给新手，希望能有效解决，别轻易放弃这么美貌的主题~</p><h1>github服务器样式渲染错误问题</h1><p>先是用了和安知鱼很像的另一个主题，蓝色鹿头的，发现传上去about页不能居中显示（本地测试正常），找不到解决方法，遂入坑安知鱼，如果你想用同款的其他作者的主题建议谨慎考虑。</p><p>某次本地测试没问题，上传后发现github上的css样式丢失，尝试各种方法无果，一点点改，问题在这里：</p><p><img src="https://pic.imgdb.cn/item/66bdbae0d9c307b7e942f8c3.png" alt="问题"></p><p class='p red'>这里的url不能改，随便改成自己的会导致css渲染不出来，保持原样即可，切记切记！！！</p><h1>本地测试样式丢失问题</h1><p>在初版配置过程中头部会出现配置了图片但显示出来是很多雪花小人，但<code>hexo d</code>上去没问题，后来随着解决样式渲错误问题一并消失。</p><p><img src="https://pic.imgdb.cn/item/66bdbae0d9c307b7e942f8e8.png" alt=""></p><p>绿框部分可能存在不显示图片或者显示的都是同一张图片（经测试大概20张图片就解决这个问题），左边那部分的雪花小人你把URL改成默认就行。</p><p>但这个本地的样式和传上去的不影响，不修复也行，不知道为啥。</p><p>另外弱弱吐槽一句，现在博客对音乐方面的API支持这么弱吗？找API要跨越各种客户端搞半天我真的谢……</p>]]></content>
      
      
      <categories>
          
          <category> anzhiyu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> anzhiyu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MATLAB基本使用</title>
      <link href="/2024/07/14/shumo/%E3%80%8AMATLAB%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/07/14/shumo/%E3%80%8AMATLAB%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1>向量</h1><h2 id="基础运算">基础运算</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">0</span>:<span class="number">0.1</span>:<span class="number">50</span>; <span class="comment">%冒号法：0-50相信间隔值组成的向量x,间隔值为0.1</span></span><br><span class="line">x=[<span class="number">2</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span>]<span class="comment">%行向量</span></span><br><span class="line">x=[<span class="number">1</span>;<span class="number">2</span>;<span class="number">3</span>]<span class="comment">%列向量</span></span><br><span class="line">x=<span class="built_in">linspace</span>(<span class="number">0</span>,<span class="number">10</span>,<span class="number">6</span>)<span class="comment">%linspace(first_value,last_value,number)平均取值</span></span><br><span class="line">x=<span class="built_in">logspace</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)<span class="comment">%logspace(first_value,last_value,number)从10^first_value-10^last_value,包含number个</span></span><br><span class="line"><span class="comment">%向量元素引用</span></span><br><span class="line">x(n)<span class="comment">%x中第x个元素</span></span><br><span class="line">x(n1:n2)<span class="comment">%x中n1-n2的元素</span></span><br><span class="line">.* <span class="comment">%点积运算</span></span><br><span class="line"><span class="built_in">cross</span>()<span class="comment">%叉积运算cross(a,b)a,b必为长为3的向量</span></span><br><span class="line">poly2sym(p)<span class="comment">%多项式构造</span></span><br><span class="line">conv(p1,p2)<span class="comment">%卷积运算，乘法运算</span></span><br><span class="line">[k,r]=deconv(p1,p2)<span class="comment">%除法运算,k-商,r-余数</span></span><br><span class="line">poly(root)<span class="comment">%求以root为解的多项式系数</span></span><br><span class="line">polyder(p)<span class="comment">%求p的导数的系数</span></span><br></pre></td></tr></table></figure><h2 id="特殊变量">特殊变量</h2><h3 id="单元型变量">单元型变量</h3><h4 id="赋值语句定义">赋值语句定义</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">1</span> <span class="number">2</span>;<span class="number">3</span> <span class="number">4</span>];</span><br><span class="line">B=<span class="number">3</span>+<span class="number">2</span>*<span class="built_in">i</span>;</span><br><span class="line">C=<span class="string">&#x27;efg&#x27;</span>;</span><br><span class="line">D=<span class="number">2</span>;</span><br><span class="line">E=&#123;A,B;C,D&#125;</span><br></pre></td></tr></table></figure><h4 id="对单元语句逐个赋值——cell">对单元语句逐个赋值——cell()</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E=cell(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">E&#123;<span class="number">1</span>,<span class="number">1</span>&#125;=[<span class="number">1</span>:<span class="number">4</span>];</span><br><span class="line">E&#123;<span class="number">1</span>,<span class="number">2</span>&#125;=<span class="number">3</span>+<span class="number">2</span>*<span class="built_in">i</span>;</span><br><span class="line">E&#123;<span class="number">1</span>,<span class="number">3</span>&#125;=<span class="number">2</span>;</span><br><span class="line">E</span><br><span class="line">E&#123;<span class="number">1</span>&#125;</span><br><span class="line">E(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>cell(size(A)):生成与A相同形式的单元型置空矩阵</p></blockquote><h4 id="引用">引用</h4><ul><li>大括号显示单元具体的值</li><li>小括号显示单元压缩值</li></ul><h4 id="常用函数">常用函数</h4><p>1.celldisp()显示内容</p><p>2.cedllplot()用图形显示</p><h3 id="结构型变量">结构型变量</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mn=struct(<span class="string">&#x27;color&#x27;</span>,&#123;<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;black&#x27;</span>&#125;,<span class="string">&#x27;number&#x27;</span>,&#123;<span class="number">1</span>,<span class="number">2</span>&#125;)</span><br><span class="line">mn(<span class="number">1</span>)</span><br><span class="line">mn(<span class="number">2</span>) </span><br><span class="line">mn(<span class="number">2</span>).color</span><br></pre></td></tr></table></figure><h1>矩阵运算</h1><h2 id="矩阵生成">矩阵生成</h2><h3 id="利用M文件创建">利用M文件创建</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% sample.m</span></span><br><span class="line"><span class="comment">% 创建一个M文件，用以输入大规模矩阵</span></span><br><span class="line">gmatrix=[<span class="number">378</span> <span class="number">89</span> <span class="number">90</span>  <span class="number">83</span> <span class="number">382</span> <span class="number">92</span> <span class="number">29</span>;</span><br><span class="line"><span class="number">3829</span> <span class="number">32</span> <span class="number">9283</span> <span class="number">2938</span> <span class="number">378</span> <span class="number">839</span> <span class="number">29</span>;</span><br><span class="line"><span class="number">388</span> <span class="number">389</span> <span class="number">200</span> <span class="number">923</span> <span class="number">920</span> <span class="number">92</span> <span class="number">7478</span>;</span><br><span class="line"><span class="number">3829</span> <span class="number">892</span> <span class="number">66</span> <span class="number">89</span> <span class="number">90</span> <span class="number">56</span> <span class="number">8980</span>;</span><br><span class="line"><span class="number">7827</span> <span class="number">67</span> <span class="number">890</span> <span class="number">6557</span> <span class="number">45</span>  <span class="number">123</span> <span class="number">35</span>]</span><br></pre></td></tr></table></figure><h3 id="利用文本文件创建">利用文本文件创建</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load goods.txt</span><br><span class="line">goods</span><br></pre></td></tr></table></figure><h3 id="创建特殊矩阵">创建特殊矩阵</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">zeros</span>(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">ones</span>(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">ones</span>(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">rand</span>(<span class="number">3</span>)<span class="comment">%3*3随机数矩阵，值在(0,1)之间</span></span><br><span class="line"><span class="built_in">rand</span>(<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">magic</span>(<span class="number">3</span>)<span class="comment">%3阶魔方矩阵</span></span><br><span class="line"><span class="built_in">hilb</span>(<span class="number">3</span>)<span class="comment">%3阶Hilbert矩阵</span></span><br><span class="line"><span class="built_in">invhilb</span>(<span class="number">3</span>)<span class="comment">%3阶Hilbert矩阵的逆</span></span><br></pre></td></tr></table></figure><h3 id="矩阵元素的运算">矩阵元素的运算</h3><h4 id="元素的修改">元素的修改</h4><ul><li>D=[A,B C],A- 原矩阵，B C-包含要扩充的元素，D-扩充后的矩阵</li><li>A=(m,),A的m行</li></ul><h4 id="矩阵的变维">矩阵的变维</h4><p>reshape(X,m,n)——将已知矩阵变成m行n列的矩阵</p><p>:法</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A=<span class="number">1</span>:<span class="number">12</span></span><br><span class="line">B=<span class="built_in">reshape</span>(A,<span class="number">2</span>,<span class="number">6</span>)</span><br><span class="line">C=<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">4</span>); </span><br><span class="line">C(:)=A(:)</span><br></pre></td></tr></table></figure><h4 id="矩阵的变向">矩阵的变向</h4><ul><li>rot90(A):A逆时针旋转90°</li><li>rot90(A,k):A逆时针旋转90°*k</li><li>fliplr(X):X左右翻转</li><li>flipud(X):X上下翻转</li><li>flipdim(X,dim):dim=1——行翻转；dim=2——列翻转</li></ul><h4 id="矩阵的提取">矩阵的提取</h4><h2 id="矩阵数学运算">矩阵数学运算</h2><h3 id="加减法">加减法</h3><h3 id="乘法">乘法</h3><ul><li>叉乘：一行乘一列</li><li>点乘：相同位置的进行乘法运算</li></ul><h3 id="除法">除法</h3><ul><li>左除 B.\A：B的相应位置除A的相应位置</li><li>右除 B/A:A的相应位置除B的相应位置</li></ul><h2 id="基本运算">基本运算</h2><ul><li>幂函数 A.^2</li><li>逆 inv(X)</li><li>逆条件数 rcond(A)</li><li>逆的更新 updateinv(A)</li><li>2-范数 norm(A)</li><li>2-范数估计值 normest(A)</li><li>行列式 det(A)</li></ul><h2 id="矩阵分解">矩阵分解</h2><h3 id="楚列斯基分解-正定矩阵">楚列斯基分解(正定矩阵)</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>;<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>;<span class="number">1</span> <span class="number">3</span> <span class="number">6</span> <span class="number">10</span>;<span class="number">1</span> <span class="number">4</span> <span class="number">10</span> <span class="number">20</span>];<span class="comment">%创建正定矩阵A</span></span><br><span class="line">R=chol(A)<span class="comment">%求正定矩阵A的楚列斯基分解因子</span></span><br><span class="line"></span><br><span class="line">R =</span><br><span class="line"></span><br><span class="line">     <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line">     <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span></span><br><span class="line">     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">3</span></span><br><span class="line">     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line"></span><br><span class="line">     <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line">     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span></span><br><span class="line">     <span class="number">1</span>     <span class="number">3</span>     <span class="number">6</span>    <span class="number">10</span></span><br><span class="line">     <span class="number">1</span>     <span class="number">4</span>    <span class="number">10</span>    <span class="number">20</span></span><br></pre></td></tr></table></figure><h3 id="LU分解-三角分解">LU分解(三角分解)</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>;<span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span>;<span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">1</span>;<span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">6</span>];</span><br><span class="line">[L,U]=lu(A)<span class="comment">%返回下三角矩阵L，上三角矩阵U</span></span><br><span class="line"></span><br><span class="line">L =</span><br><span class="line"></span><br><span class="line">    <span class="number">0.1429</span>    <span class="number">1.0000</span>         <span class="number">0</span>         <span class="number">0</span></span><br><span class="line">    <span class="number">0.7143</span>    <span class="number">0.3333</span>    <span class="number">1.0000</span>         <span class="number">0</span></span><br><span class="line">    <span class="number">0.2857</span>    <span class="number">0.8333</span>    <span class="number">0.2500</span>    <span class="number">1.0000</span></span><br><span class="line">    <span class="number">1.0000</span>         <span class="number">0</span>         <span class="number">0</span>         <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">U =</span><br><span class="line"></span><br><span class="line">    <span class="number">7.0000</span>    <span class="number">8.0000</span>    <span class="number">5.0000</span>    <span class="number">6.0000</span></span><br><span class="line">         <span class="number">0</span>    <span class="number">0.8571</span>    <span class="number">2.2857</span>    <span class="number">3.1429</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>    <span class="number">2.6667</span>    <span class="number">2.6667</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>         <span class="number">0</span>   <span class="number">-4.0000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L =</span><br><span class="line"></span><br><span class="line">    <span class="number">1.0000</span>         <span class="number">0</span>         <span class="number">0</span>         <span class="number">0</span></span><br><span class="line">    <span class="number">0.1429</span>    <span class="number">1.0000</span>         <span class="number">0</span>         <span class="number">0</span></span><br><span class="line">    <span class="number">0.7143</span>    <span class="number">0.3333</span>    <span class="number">1.0000</span>         <span class="number">0</span></span><br><span class="line">    <span class="number">0.2857</span>    <span class="number">0.8333</span>    <span class="number">0.2500</span>    <span class="number">1.0000</span></span><br><span class="line"></span><br><span class="line">[L,U,P]=lu(A)<span class="comment">%返回下三角矩阵L，上三角矩阵U，置换矩阵P，PA=LU</span></span><br><span class="line">U =</span><br><span class="line"></span><br><span class="line">    <span class="number">7.0000</span>    <span class="number">8.0000</span>    <span class="number">5.0000</span>    <span class="number">6.0000</span></span><br><span class="line">         <span class="number">0</span>    <span class="number">0.8571</span>    <span class="number">2.2857</span>    <span class="number">3.1429</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>    <span class="number">2.6667</span>    <span class="number">2.6667</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>         <span class="number">0</span>   <span class="number">-4.0000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">P =</span><br><span class="line"></span><br><span class="line">     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line">     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span></span><br><span class="line">     <span class="number">0</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span></span><br><span class="line">     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="LDM-T和-LDL-T分解"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mi>L</mi><mi>D</mi><mi>M</mi></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{LDM}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9146em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9146em;"><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mi>L</mi><mi>D</mi><mi>L</mi></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{LDL}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9146em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">L</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9146em;"><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>分解</h3><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mi>L</mi><mi>D</mi><mi>M</mi></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{LDM}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9146em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9146em;"><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>分解</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[L,D,M]</span>=<span class="title">ldm</span><span class="params">(A)</span></span></span><br><span class="line"><span class="comment">%此函数用来求解矩阵A的LDM&#x27;分解</span></span><br><span class="line"><span class="comment">%其中L，M均为单位下三角矩阵，D为对角矩阵</span></span><br><span class="line">[m,n]=<span class="built_in">size</span>(A);</span><br><span class="line"><span class="keyword">if</span> m~=n</span><br><span class="line">    error(<span class="string">&#x27;输入矩阵不是方阵，请正确输入矩阵!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">D(<span class="number">1</span>,<span class="number">1</span>)=A(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    L(<span class="built_in">i</span>,<span class="built_in">i</span>)=<span class="number">1</span>;</span><br><span class="line">    M(<span class="built_in">i</span>,<span class="built_in">i</span>)=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">L(<span class="number">2</span>:n,<span class="number">1</span>)=A(<span class="number">2</span>:n,<span class="number">1</span>)/D(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">M(<span class="number">2</span>:n,<span class="number">1</span>)=A(<span class="number">1</span>,<span class="number">2</span>:n)&#x27;/D(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">2</span>:n</span><br><span class="line">    v(<span class="number">1</span>)=A(<span class="number">1</span>,<span class="built_in">j</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">2</span>:<span class="built_in">j</span></span><br><span class="line">        v(<span class="built_in">i</span>)=A(<span class="built_in">i</span>,<span class="built_in">j</span>)-L(<span class="built_in">i</span>,<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>)*v(<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>)&#x27;;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span></span><br><span class="line">        M(<span class="built_in">j</span>,<span class="built_in">i</span>)=v(<span class="built_in">i</span>)/D(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    D(<span class="built_in">j</span>,<span class="built_in">j</span>)=v(<span class="built_in">j</span>);</span><br><span class="line">    L(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="built_in">j</span>)=(A(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="built_in">j</span>)-L(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)*v(<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)&#x27;)/v(<span class="built_in">j</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>;<span class="number">4</span> <span class="number">6</span> <span class="number">10</span> <span class="number">2</span>;<span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span>;<span class="number">0</span> <span class="number">0</span> <span class="number">2</span> <span class="number">3</span>];</span><br><span class="line">[L,D,M]=ldm(A)</span><br><span class="line">L*D*M&#x27;</span><br></pre></td></tr></table></figure><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mi>L</mi><mi>D</mi><mi>L</mi></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">{LDL}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9146em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">L</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9146em;"><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>分解</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[L,D]</span>=<span class="title">ldlt</span><span class="params">(A)</span></span></span><br><span class="line"><span class="comment">%此函数用来求解实对称矩阵A的LDL&#x27;分解</span></span><br><span class="line"><span class="comment">%其中L为单位下三角矩阵，D为对角矩阵</span></span><br><span class="line"></span><br><span class="line">[m,n]=<span class="built_in">size</span>(A);</span><br><span class="line"><span class="keyword">if</span> m~=n | ~<span class="built_in">isequal</span>(A,A&#x27;)</span><br><span class="line">    error(<span class="string">&#x27;请正确输入矩阵!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">D(<span class="number">1</span>,<span class="number">1</span>)=A(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    L(<span class="built_in">i</span>,<span class="built_in">i</span>)=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">L(<span class="number">2</span>:n,<span class="number">1</span>)=A(<span class="number">2</span>:n,<span class="number">1</span>)/D(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">2</span>:n</span><br><span class="line">    v(<span class="number">1</span>)=A(<span class="number">1</span>,<span class="built_in">j</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span></span><br><span class="line">        v(<span class="built_in">i</span>)=L(<span class="built_in">j</span>,<span class="built_in">i</span>)*D(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    v(<span class="built_in">j</span>)=A(<span class="built_in">j</span>,<span class="built_in">j</span>)-L(<span class="built_in">j</span>,<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)*v(<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)&#x27;;</span><br><span class="line">    D(<span class="built_in">j</span>,<span class="built_in">j</span>)=v(<span class="built_in">j</span>);</span><br><span class="line">    L(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="built_in">j</span>)=(A(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="built_in">j</span>)-L(<span class="built_in">j</span>+<span class="number">1</span>:n,<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)*v(<span class="number">1</span>:<span class="built_in">j</span><span class="number">-1</span>)&#x27;)/v(<span class="built_in">j</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>;<span class="number">2</span> <span class="number">5</span> <span class="number">7</span> <span class="number">8</span>;<span class="number">3</span> <span class="number">7</span> <span class="number">6</span> <span class="number">9</span>;<span class="number">4</span> <span class="number">8</span> <span class="number">9</span> <span class="number">1</span>];</span><br><span class="line">[L,D]=ldlt(A)</span><br><span class="line">L*D*L&#x27;</span><br></pre></td></tr></table></figure><h3 id="QR分解-正交三角形分解">QR分解(正交三角形分解)</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">A=<span class="built_in">rand</span>(<span class="number">4</span>)</span><br><span class="line">[Q,R] =qr(A)</span><br><span class="line">A =</span><br><span class="line">    <span class="number">0.4218</span>    <span class="number">0.6557</span>    <span class="number">0.6787</span>    <span class="number">0.6555</span></span><br><span class="line">    <span class="number">0.9157</span>    <span class="number">0.0357</span>    <span class="number">0.7577</span>    <span class="number">0.1712</span></span><br><span class="line">    <span class="number">0.7922</span>    <span class="number">0.8491</span>    <span class="number">0.7431</span>    <span class="number">0.7060</span></span><br><span class="line">    <span class="number">0.9595</span>    <span class="number">0.9340</span>    <span class="number">0.3922</span>    <span class="number">0.0318</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Q =</span><br><span class="line">   <span class="number">-0.2634</span>    <span class="number">0.4305</span>    <span class="number">0.6535</span>    <span class="number">0.5641</span></span><br><span class="line">   <span class="number">-0.5718</span>   <span class="number">-0.7879</span>    <span class="number">0.2092</span>    <span class="number">0.0919</span></span><br><span class="line">   <span class="number">-0.4947</span>    <span class="number">0.3338</span>    <span class="number">0.2413</span>   <span class="number">-0.7653</span></span><br><span class="line">   <span class="number">-0.5991</span>    <span class="number">0.2871</span>   <span class="number">-0.6862</span>    <span class="number">0.2962</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R =</span><br><span class="line">   <span class="number">-1.6015</span>   <span class="number">-1.1728</span>   <span class="number">-1.2146</span>   <span class="number">-0.6389</span></span><br><span class="line">         <span class="number">0</span>    <span class="number">0.8058</span>    <span class="number">0.0559</span>    <span class="number">0.3921</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>    <span class="number">0.5123</span>    <span class="number">0.6127</span></span><br><span class="line">         <span class="number">0</span>         <span class="number">0</span>         <span class="number">0</span>   <span class="number">-0.1454</span></span><br></pre></td></tr></table></figure><p>qrdelete &amp; qrinsert</p><h3 id="SVD分解">SVD分解</h3><p>[U,S,V]=svd(A)</p><p>m*m矩阵U，对角矩阵S，n*n矩阵V</p><h3 id="舒尔分解">舒尔分解</h3><h3 id="海森伯格分解">海森伯格分解</h3><h1>二维绘图</h1><h2 id="plot">plot</h2><ul><li>plot(x,y)</li><li>subplot(m,n,p) m*n个视图区域，当前为第p个(按行排列)</li><li>tiledlayout(m,n)+nexttile</li><li>tiledlayout(2,2) 布局为2*2的区域</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">0</span>:<span class="built_in">pi</span>/<span class="number">10</span>:<span class="number">2</span>*<span class="built_in">pi</span>;</span><br><span class="line">y1=<span class="built_in">sin</span>(x);</span><br><span class="line">y2=<span class="built_in">cos</span>(x);</span><br><span class="line">y3=x;</span><br><span class="line">y4=x.^<span class="number">2</span>;<span class="comment">%输入以x为自变量的4个函数表达式</span></span><br><span class="line"><span class="built_in">hold</span> on<span class="comment">%在此画布上进行绘制</span></span><br><span class="line"><span class="built_in">plot</span>(x,y1,<span class="string">&#x27;r*&#x27;</span>)</span><br><span class="line"><span class="built_in">plot</span>(x,y2,<span class="string">&#x27;kp&#x27;</span>)</span><br><span class="line"><span class="built_in">plot</span>(x,y3,<span class="string">&#x27;bd&#x27;</span>)</span><br><span class="line"><span class="built_in">plot</span>(x,y4,<span class="string">&#x27;m--&#x27;</span>)</span><br><span class="line"><span class="built_in">hold</span> off</span><br></pre></td></tr></table></figure><ul><li>fplot 一元函数图像</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="built_in">linspace</span>(<span class="number">0.01</span>,<span class="number">0.02</span>,<span class="number">50</span>);</span><br><span class="line">y=<span class="built_in">sin</span>(<span class="number">1.</span>/x);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>),<span class="built_in">plot</span>(x,y)</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>),fplot(@(x)<span class="built_in">sin</span>(<span class="number">1.</span>/x),[<span class="number">0.01</span>,<span class="number">0.02</span>])</span><br><span class="line"><span class="comment">%(x)sin(1./x)是定义的匿名函数。</span></span><br></pre></td></tr></table></figure><h2 id="不同坐标系下的绘图命令">不同坐标系下的绘图命令</h2><h3 id="极坐标系——polarplot">极坐标系——polarplot</h3><ul><li>polarplot(thera,rho) thera——弧度，rho——半径</li><li>polarplot(thera,rho,LineSpace)  LineSpace——样式</li><li>pol2cart(t,r) 极坐标下的数据点换到直角坐标系下</li></ul><h3 id="半对数坐标系——semilogx-semilogy">半对数坐标系——semilogx/semilogy</h3><h3 id="双对数坐标系——loglog">双对数坐标系——loglog</h3><h3 id="双y轴坐标——yyaxis">双y轴坐标——yyaxis</h3><ul><li>yyaxis left</li><li>yyaxis right</li></ul><h2 id="图形窗口">图形窗口</h2><ul><li>finger——创建图形窗口</li><li>set(n)——返回图像属性名称和所有属性值</li><li>get(n)——返回图像属性名称和当前属性值</li></ul><h1>图形标注</h1><h2 id="属性设置">属性设置</h2><h3 id="坐标系与坐标轴">坐标系与坐标轴</h3><p>axis(xmin,xmax,ymin,ymax,zmin,zmax)——设置坐标系</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">t=<span class="number">0</span>:<span class="number">2</span>*<span class="built_in">pi</span>/<span class="number">99</span>:<span class="number">2</span>*<span class="built_in">pi</span>;</span><br><span class="line">x=<span class="number">1.15</span>*<span class="built_in">cos</span>(t);y=<span class="number">3.25</span>*<span class="built_in">sin</span>(t);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>),<span class="built_in">plot</span>(x,y),axis normal,grid on,</span><br><span class="line">title(<span class="string">&#x27;Normal and Grid on&#x27;</span>)<span class="comment">%grid on显示分割线</span></span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>),<span class="built_in">plot</span>(x,y),axis equal,grid on,title(<span class="string">&#x27;Equal&#x27;</span>)</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>),<span class="built_in">plot</span>(x,y),axis square,grid on,title(<span class="string">&#x27;Square&#x27;</span>)</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>),<span class="built_in">plot</span>(x,y),axis image,box off,title(<span class="string">&#x27;Image and Box off&#x27;</span>)</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>),<span class="built_in">plot</span>(x,y),axis image fill,box off</span><br><span class="line">title(<span class="string">&#x27;Image and Fill&#x27;</span>)</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>),<span class="built_in">plot</span>(x,y),axis tight,box off,title(<span class="string">&#x27;Tight&#x27;</span>)</span><br></pre></td></tr></table></figure><p>fill(X,Y,C) X,Y——创建的图形，C——颜色</p><p>title——标题</p><p>x/ylabel——轴注释</p><p>text(x,y,string)——在图中(x,y)位置显示string</p><p>gtext——鼠标在任意位置进行标注</p><p>legend——添加图例</p><h2 id="特殊图形">特殊图形</h2><h3 id="统计图形">统计图形</h3><ul><li>条形图<ul><li>二维：bar——竖直条形图；barh——水平条形图</li><li>三维：bar3——竖直条形图；bar3h——水平条形图</li></ul></li><li>面积图：area(Y)</li><li>饼图：pie/pie3</li><li>柱状图<ul><li>直角坐标系：histogram</li><li>极坐标系：ploarhistogram</li></ul></li></ul><h3 id="离散数据图形">离散数据图形</h3><ul><li>误差棒图：errorbar(y,err)</li><li>火柴杆图：stem(Y)</li><li>阶梯图：stairs(Y)</li></ul><h3 id="向量图形">向量图形</h3><ul><li><p>罗盘图：compass(U,V)</p></li><li><p>羽毛图：feather(U,V)</p></li><li><p>箭头图：quiver(U,V)/quiver3</p><p>返回数值梯度：gradient(Z,2,2)</p></li></ul><h1>三维绘图</h1><h2 id="绘图命令">绘图命令</h2><ul><li><p>plot3/fplot3</p></li><li><p>三维网格命令</p><ul><li>mesh(X,Y,Z) 网线面</li><li>mesh(X,Y) x-y为底，y对应的值为z轴</li><li>meshc 加基本等高线</li><li>meshz 网格线与零平面连起来</li><li>fmesh(f)</li></ul></li><li><p>三维曲面命令</p><ul><li>surf<ul><li>surfc 加基本等高线</li><li>surfl 有亮度的曲面</li></ul></li><li>fsurf</li></ul></li><li><p>柱面与球面</p><ul><li><p>[X,Y,Z]=cylinder 返回对应函数的x,y,z坐标值</p><p>cylinder(2,6) 正六边形，半径为2的棱柱</p></li><li><p>sphere 生成球面</p><p>[X,Y,Z]=cylinder(n) 绘制n*n个面的球面，返回球面坐标</p></li></ul></li><li><p>三维图形等值线</p><ul><li><p>contour3(x,y,z)</p></li><li><p>contourf 填充颜色的二维等值图</p><p>colormap gray 应用灰度颜色图</p></li><li><p>C=contourc(Z) 计算等值线矩阵C</p></li><li><p>clabel 在二维等值图中添加高度标签</p></li><li><p>fcontour 符号函数等值线图</p></li></ul></li></ul><h2 id="三维图形修饰处理">三维图形修饰处理</h2><h3 id="视角处理">视角处理</h3><p>view(az,el) az——方位角，el——仰角</p><h3 id="颜色处理">颜色处理</h3><ul><li><p>brighten(beat) 明暗处理0&lt;beat&lt;1</p></li><li><p>caxi([cmin,cmax]) 色轴刻度</p><p>colorbar 显示垂直色轴</p></li><li><p>shading 颜色渲染设置</p></li><li><p>colormap(M) 将M作为当前窗口颜色映像</p></li></ul><h3 id="光照处理">光照处理</h3><ul><li>surfl 带光照模式</li><li>light/lightangle 确定光源位置</li></ul><h2 id="图像处理">图像处理</h2><ul><li>imread 图像读入</li><li>imwrite 图像写入</li><li>image/imageesc/imshow 图像显示</li><li>imfinfo 图像信息查询</li></ul><h1>程序设计</h1><h2 id="M文件">M文件</h2><ul><li><p>命令文件</p></li><li><p>函数文件</p><p>function开始</p></li></ul><h2 id="程序设计">程序设计</h2><ul><li>程序结构<ul><li>顺序结构</li><li>循环结构</li><li>分支结构</li></ul></li><li>流程控制<ul><li>break</li><li>pause(10) 暂停10秒</li><li>continue</li><li>return</li><li>echo on 显示执行过程中每一行语句的执行过程</li><li>waring(massage) 不影响正常运行</li><li>error(massage) 终止运行</li></ul></li><li>交互式输入<ul><li>input(massage)</li><li>keyboard 暂停程序，使用键盘调用命令</li><li>menu</li></ul></li><li>程序调试<ul><li>系统提示</li><li>断点</li></ul></li></ul><h2 id="函数句柄">函数句柄</h2><p>1.创建</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fun_handle=@save <span class="comment">%创建函数save()的句柄</span></span><br><span class="line"></span><br><span class="line">fun_handle =</span><br><span class="line">  包含以下值的 function_handle:</span><br><span class="line">    @save</span><br></pre></td></tr></table></figure><p>2.调用——feval()</p><h1>矩阵分析</h1><h2 id="特征值与特征向量">特征值与特征向量</h2><ul><li><p>[V,D]=eig(A,balanceOption) 求矩阵A的特征值和特征向量</p><p>balanceOption:默认平衡处理</p></li><li><p>[T,B]=balance(A) 求相似变换矩阵T，平衡矩阵B</p><p>[S,P,B]=balance(A) 缩放向量S，置换向量P</p></li><li><p>c=ploy(A) 求特征多项式</p></li><li><p>r=roots© 求特征多项式的根</p></li><li><p>eigs 部分特征值</p></li><li><p>eig(A,B) 求广义特征值</p></li></ul><h2 id="矩阵对角化">矩阵对角化</h2><p>判断矩阵能否对角化</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span>=<span class="title">isdiag1</span><span class="params">(A)</span></span></span><br><span class="line"><span class="comment">%该函数用来判断矩阵A是否可以对角化</span></span><br><span class="line"><span class="comment">%若返回值为1，则说明A可以对角化；若返回值为0，则说明A不可以对角化</span></span><br><span class="line"></span><br><span class="line">[m,n]=<span class="built_in">size</span>(A); <span class="comment">%求矩阵A的阶数</span></span><br><span class="line"><span class="keyword">if</span> m~=n<span class="comment">%若A不是方阵，则肯定不能对角化</span></span><br><span class="line">    y=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    [V,D]=eig(A);</span><br><span class="line">    <span class="keyword">if</span> rank(V)==n <span class="comment">%判断A的特征向量是否线性无关</span></span><br><span class="line">        y=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        y=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>矩阵对角化</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span><span class="params">[P,D]</span>=<span class="title">reduce_diag</span><span class="params">(A)</span></span></span><br><span class="line"><span class="keyword">if</span> ~isdiag(A)</span><br><span class="line">error(<span class="string">&#x27;该矩阵不能对角化&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;将下面的矩阵P乘以任意非零整数所得矩阵仍满足inv(P)*P*A=D&#x27;</span>);</span><br><span class="line">[P,D]=eig(A);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="若尔当标准型">若尔当标准型</h2><p>[P,J]=jordam(A) 若尔当标准形矩阵J，相似变换矩阵P</p><h2 id="矩阵的反射与旋转变换">矩阵的反射与旋转变换</h2><h3 id="豪斯霍尔德反射波变换">豪斯霍尔德反射波变换</h3><p>避免上溢求豪斯霍尔德向量函数</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[v,beta]</span>=<span class="title">house</span><span class="params">(x)</span></span></span><br><span class="line"><span class="comment">%此函数用来计算满足v(1)=1的v和beta使得P=I-beta*v*v&#x27;</span></span><br><span class="line"><span class="comment">%是正交矩阵且P*x=norm(x)*e1</span></span><br><span class="line"></span><br><span class="line">n=<span class="built_in">length</span>(x);</span><br><span class="line"><span class="keyword">if</span> n==<span class="number">1</span></span><br><span class="line">    error(<span class="string">&#x27;请正确输入向量!&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    sigma=x(<span class="number">2</span>:n)&#x27;*x(<span class="number">2</span>:n);</span><br><span class="line">    v=[<span class="number">1</span>;x(<span class="number">2</span>:n)];</span><br><span class="line">    <span class="keyword">if</span> sigma==<span class="number">0</span></span><br><span class="line">        <span class="built_in">beta</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        mu=<span class="built_in">sqrt</span>(x(<span class="number">1</span>)^<span class="number">2</span>+sigma);</span><br><span class="line">        <span class="keyword">if</span> x(<span class="number">1</span>)&lt;=<span class="number">0</span></span><br><span class="line">            v(<span class="number">1</span>)=x(<span class="number">1</span>)-mu;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            v(<span class="number">1</span>)=-sigma/(x(<span class="number">1</span>)+mu);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">beta</span>=<span class="number">2</span>*v(<span class="number">1</span>)^<span class="number">2</span>/(sigma+v(<span class="number">1</span>)^<span class="number">2</span>);</span><br><span class="line">        v=v/v(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>豪斯霍尔德矩阵求法</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="number">2</span> <span class="number">3</span> <span class="number">4</span>]&#x27;;</span><br><span class="line">[v,<span class="built_in">beta</span>]=house(x)</span><br><span class="line">P=<span class="built_in">eye</span>(<span class="number">3</span>)-<span class="built_in">beta</span>*v*v&#x27; </span><br><span class="line">a=norm(x)</span><br><span class="line">P*x </span><br></pre></td></tr></table></figure><h3 id="吉文斯旋转变换">吉文斯旋转变换</h3><p>[G,y]=planerot(x) y=Gx且y(2)=0,x——二维列向量</p><h1>符号运算</h1><h2 id="符号与数值">符号与数值</h2><ul><li>eval(expression) 符号-&gt;数值</li><li>subs(s) 数值-&gt;符号</li><li>digits(D) 有效数字个数为D</li><li>vpa(x) 算数精度</li><li>B=sparse(A) 将A转换为稀疏格式</li><li>B=sparse(A) 创建A的伴随矩阵</li></ul><h2 id="符号矩阵">符号矩阵</h2><h3 id="创建">创建</h3><ul><li><p>直接输入</p></li><li><p>sym(‘x’) sym(‘a’,n)</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">x = sym(<span class="string">&#x27;x&#x27;</span>); </span><br><span class="line">y = sym(<span class="string">&#x27;y&#x27;</span>);</span><br><span class="line">a=[x+y,x;y,y+<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">a = sym(<span class="string">&#x27;a&#x27;</span>, [<span class="number">1</span> <span class="number">4</span>])<span class="comment">%用自动生成的元素创建符号向量</span></span><br><span class="line">a = sym(<span class="string">&#x27;x_%d&#x27;</span>, [<span class="number">1</span> <span class="number">4</span>])</span><br><span class="line"> </span><br><span class="line">a(<span class="number">1</span>)</span><br><span class="line">a(<span class="number">2</span>:<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a = </span><br><span class="line">[a1, a2, a3, a4]</span><br><span class="line">a =</span><br><span class="line">[x_1, x_2, x_3, x_4]</span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line">x_1</span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line">[x_2, x_3]</span><br></pre></td></tr></table></figure></li><li><p>数值矩阵-&gt;符号矩阵</p><p>B=sym(A)</p></li></ul><p>计算不同精度的pi值</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pi</span><span class="comment">%默认精度</span></span><br><span class="line">vpa(<span class="built_in">pi</span>)<span class="comment">%使用可变精度，32位数字</span></span><br><span class="line"></span><br><span class="line">digits(<span class="number">10</span>)<span class="comment">%将vpa精度设成10</span></span><br><span class="line">vpa(<span class="built_in">pi</span>)<span class="comment">%10位有效数字</span></span><br><span class="line"> </span><br><span class="line">r = sym(<span class="built_in">pi</span>)</span><br><span class="line">f = sym(<span class="built_in">pi</span>,<span class="string">&#x27;f&#x27;</span>)<span class="comment">%返回精确的有理数 </span></span><br><span class="line">d = sym(<span class="built_in">pi</span>,<span class="string">&#x27;d&#x27;</span>)<span class="comment">%使用十进制模式将浮点数转换为符号数字</span></span><br><span class="line">e = sym(<span class="built_in">pi</span>,<span class="string">&#x27;e&#x27;</span>)<span class="comment">%使用误差估值模式将浮点数转换为符号数字</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =<span class="number">3.1416</span></span><br><span class="line"><span class="built_in">ans</span> =<span class="number">3.141592654</span> </span><br><span class="line"><span class="built_in">ans</span> =<span class="number">3.141592654</span></span><br><span class="line">r =<span class="built_in">pi</span></span><br><span class="line">f =<span class="number">884279719003555</span>/<span class="number">281474976710656</span></span><br><span class="line">d =<span class="number">3.141592654</span></span><br><span class="line">e =<span class="built_in">pi</span> - (<span class="number">198</span>*<span class="built_in">eps</span>)/<span class="number">359</span></span><br></pre></td></tr></table></figure><h3 id="其他运算">其他运算</h3><ul><li>转置<ul><li>B=A.’</li><li>B=transpose(A)</li></ul></li><li>行列式运算 d=det(A)</li><li>逆 inv(A)</li><li>求秩 rank(A)</li><li>特征值，特征向量 eig()</li><li>奇异值 svd()</li><li>若尔当标准型 jordan()</li></ul><h3 id="符号多项式简化">符号多项式简化</h3><ul><li><p>因式分解 factor(x) 返回x的所有不可约因子</p></li><li><p>符号矩阵的展开 expand(S)</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syms x y</span><br><span class="line">expand((x+<span class="number">3</span>)^<span class="number">4</span>)</span><br><span class="line">expand(<span class="built_in">cos</span>(x+y))</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> = x^<span class="number">4</span> + <span class="number">12</span>*x^<span class="number">3</span> + <span class="number">54</span>*x^<span class="number">2</span> + <span class="number">108</span>*x + <span class="number">81</span></span><br><span class="line"><span class="built_in">ans</span> = <span class="built_in">cos</span>(x)*<span class="built_in">cos</span>(y) - <span class="built_in">sin</span>(x)*<span class="built_in">sin</span>(y)</span><br></pre></td></tr></table></figure></li><li><p>符号简化 simplify</p></li><li><p>分式通分 [n,d]=numden(A) 表达式分子n,分母d</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">syms x y</span><br><span class="line">[n,d]=numden(x/y-y/x+x.^<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">n = x^<span class="number">3</span>*y + x^<span class="number">2</span> - y^<span class="number">2</span></span><br><span class="line">d = x*y</span><br></pre></td></tr></table></figure></li><li><p>“秦九韶型”重写 horner(p)</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">syms x</span><br><span class="line">horner(x^<span class="number">4</span><span class="number">-3</span>*x^<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =x^<span class="number">2</span>*(x^<span class="number">2</span> - <span class="number">3</span>) + <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul><h1>数列与极限</h1><h2 id="数列">数列</h2><h3 id="数列求和">数列求和</h3><ul><li>sum(A,dim)<ul><li>向量——所有元素和 dim=1：不求和；dim=2：求和</li><li>矩阵——每一列元素和 dim=1：列求和，行显示；dim=2：行求和，列显示</li><li>sum(·，nanflag) nanflag=includenan——计算NaN,nanflag=omitnan——计算NaN,</li></ul></li><li>nansum(A) 忽略NaN累计求和函数</li><li>cumsum(A) 求此元素之前的元素和函数</li><li>cumtrapz(Y) 求梯形累计和函数(积分)</li></ul><h3 id="数列求积">数列求积</h3><ul><li><p>元素连续相乘函数 B=prod(A)</p><p>矩阵：按列向量的所有元素的积</p></li><li><p>求累计积函数 B=cumprod(A)</p></li><li><p>阶乘函数 f=factorial(n)</p></li><li><p>伽马函数(非整数的阶乘) gamma()</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">factorial</span>(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line">   <span class="number">720</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="built_in">gamma</span>(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line">   <span class="number">120</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="number">6</span>*<span class="built_in">gamma</span>(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =</span><br><span class="line">   <span class="number">720</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="极限和导数">极限和导数</h2><h3 id="极限">极限</h3><ul><li><p>x-&gt;0</p><p>limit(f)</p></li><li><p>x-&gt;∞</p><p>limit(f,inf,’right’) right:右极限</p></li></ul><h3 id="导数">导数</h3><ul><li>diff(f,n) 求函数f的n阶导数</li><li>diff(f,x) 求函数f对x的导数</li></ul><h2 id="级数求和">级数求和</h2><ul><li>有限项级数求和 symsum(f,k,a,b) 计算级数f关于指数k从a到b的有限项和</li><li>无穷级数求和 将b改为inf</li></ul><h1>积分</h1><h2 id="积分">积分</h2><ul><li>定积分和广义积分 int(f,x,a,b)</li><li>不定积分 int(f,x)</li></ul><h2 id="多重积分">多重积分</h2><ul><li><p>二重积分 intergral2(fun,xmin,xmax,ymin,ymax)</p><p>fzero(‘2*x-0.5*x’,0) 求f1-f2=0，即f1,f2的交点</p></li></ul><h2 id="泰勒展开">泰勒展开</h2><p>taylor(f,m,a)</p><p>taylor(f,’order’,5) 五阶麦克劳林型近似展开</p><h2 id="傅里叶展开">傅里叶展开</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[a0,an,bn]</span>=<span class="title">Fourierzpi</span><span class="params">(f)</span></span></span><br><span class="line">syms x n</span><br><span class="line">a0=int(f,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">pi</span>)/<span class="built_in">pi</span>;</span><br><span class="line">an=int(f*<span class="built_in">cos</span>(n*x),<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">pi</span>)/<span class="built_in">pi</span>;</span><br><span class="line">bn=int(f*<span class="built_in">sin</span>(n*x),<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">pi</span>)/<span class="built_in">pi</span>;</span><br></pre></td></tr></table></figure><h2 id="积分变换">积分变换</h2><ul><li>傅里叶积分变换 fourier(f,u,v)</li><li>傅里叶逆变换 ifourier(F,v,u)</li><li>快速傅里叶变换</li><li>拉普拉斯变换 laplace(F,w,z)</li><li>拉普拉斯逆变换 ilaplace(L,x,y)</li></ul><h1>方程求解</h1><h2 id="线性方程组求解">线性方程组求解</h2><h3 id="判断线性方程组的解">判断线性方程组的解</h3><p>Z=null(A) 求矩阵A的核空间矩阵Z，Z的列向量是Ax=0的基础解系，满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Z</mi><mi>T</mi></msup><mi>Z</mi><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">Z^TZ=I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></p><p>Z=null(A,’r’) Z的列向量是Ax=0的有理基，Z不满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Z</mi><mi>T</mi></msup><mi>Z</mi><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">Z^TZ=I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></p><blockquote><p>判断线性方程组Ax=b的解的存在性</p></blockquote><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span>=<span class="title">isexist</span><span class="params">(A,b)</span></span></span><br><span class="line"><span class="comment">%该函数用来判断线性方程组Ax=b的解的存在性</span></span><br><span class="line"><span class="comment">%若方程组无解则返回0，若有唯一解则返回1，若有无穷多解则返回Inf</span></span><br><span class="line">[m,n]=<span class="built_in">size</span>(A);</span><br><span class="line">[mb,nb]=<span class="built_in">size</span>(b);</span><br><span class="line"><span class="keyword">if</span> m~=mb</span><br><span class="line">    error(<span class="string">&#x27;输入有误!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">r=rank(A);</span><br><span class="line">s=rank([A,b]);</span><br><span class="line"><span class="keyword">if</span> r==s&amp;r==n</span><br><span class="line">    y=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">elseif</span> r==s&amp;r&lt;n</span><br><span class="line">    y=Inf;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    y=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="利用矩阵的逆-伪逆-与除法求解">利用矩阵的逆(伪逆)与除法求解</h3><p>Ax=b</p><ul><li>为恰定方程组且A是非奇异的,<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msup><mi>A</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>b</mi></mrow><annotation encoding="application/x-tex">x=A^{-1}b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">b</span></span></span></span></li><li>不为为恰定方程组或A奇异，x=A\b</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">format <span class="built_in">rat</span></span><br><span class="line">A=[<span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">0</span>;<span class="number">0</span> <span class="number">1</span> <span class="number">-2</span> <span class="number">-2</span>;<span class="number">1</span> <span class="number">3</span> <span class="number">0</span> <span class="number">-2</span>];</span><br><span class="line">b=[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]&#x27;;</span><br><span class="line">x0=pinv(A)*b <span class="comment">%利用伪逆求一个特解</span></span><br><span class="line">Z=null(A,<span class="string">&#x27;r&#x27;</span>)<span class="comment">%求基础解系</span></span><br><span class="line">format</span><br><span class="line"></span><br><span class="line">x0 =</span><br><span class="line">      <span class="number">13</span>/<span class="number">77</span>    </span><br><span class="line">      <span class="number">46</span>/<span class="number">77</span>    </span><br><span class="line">      <span class="number">-2</span>/<span class="number">11</span>    </span><br><span class="line">     <span class="number">-40</span>/<span class="number">77</span>    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Z =</span><br><span class="line">      <span class="number">-6</span>             <span class="number">-4</span>       </span><br><span class="line">       <span class="number">2</span>              <span class="number">2</span>       </span><br><span class="line">       <span class="number">1</span>              <span class="number">0</span>       </span><br><span class="line">       <span class="number">0</span>              <span class="number">1</span>   </span><br></pre></td></tr></table></figure><h3 id="利用行阶梯型求解">利用行阶梯型求解</h3><p>只适用于恰定方程组，且系数矩阵非奇异</p><p>矩阵-&gt;行阶梯型 [R,jb]=rref(A) jb:非零主元列</p><h3 id="利用矩阵分解法求解">利用矩阵分解法求解</h3><ul><li><p>LU分解法</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>=<span class="title">solvebyLU</span><span class="params">(A,b)</span></span></span><br><span class="line"><span class="comment">%该函数利用LU分解法求线性方程组Ax=b的解</span></span><br><span class="line">flag=isexist(A,b);<span class="comment">%调用函数isexist()判断方程组解的情况</span></span><br><span class="line"><span class="keyword">if</span> flag==<span class="number">0</span></span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;该方程组无解!&#x27;</span>);</span><br><span class="line">    x=[];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    r=rank(A);</span><br><span class="line">    [m,n]=<span class="built_in">size</span>(A);</span><br><span class="line">    [L,U,P]=lu(A);</span><br><span class="line">    b=P*b;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">%解Ly=b</span></span><br><span class="line">    y(<span class="number">1</span>)=b(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> m&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">2</span>:m</span><br><span class="line">            y(<span class="built_in">i</span>)=b(<span class="built_in">i</span>)-L(<span class="built_in">i</span>,<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>)*y(<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>)&#x27;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    y=y&#x27;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">%解Ux=y得原方程组的一个特解</span></span><br><span class="line">    x0(r)=y(r)/U(r,r);</span><br><span class="line">    <span class="keyword">if</span> r&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=r<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">1</span></span><br><span class="line">            x0(<span class="built_in">i</span>)=(y(<span class="built_in">i</span>)-U(<span class="built_in">i</span>,<span class="built_in">i</span>+<span class="number">1</span>:r)*x0(<span class="built_in">i</span>+<span class="number">1</span>:r)&#x27;)/U(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    x0=x0&#x27;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag==<span class="number">1</span><span class="comment">%若方程组有唯一解</span></span><br><span class="line">        x=x0;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">%若方程组有无穷多解</span></span><br><span class="line">        format <span class="built_in">rat</span>;</span><br><span class="line">        Z=null(A,<span class="string">&#x27;r&#x27;</span>);<span class="comment">%求出对应齐次方程组的基础解系</span></span><br><span class="line">        [mZ,nZ]=<span class="built_in">size</span>(Z);</span><br><span class="line">        x0(r+<span class="number">1</span>:n)=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:nZ</span><br><span class="line">            t=sym(char([<span class="number">107</span> <span class="number">48</span>+<span class="built_in">i</span>]));</span><br><span class="line">            k(<span class="built_in">i</span>)=t;<span class="comment">%取k=[k1,k2,…]; </span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        x=x0;         </span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:nZ          </span><br><span class="line">            x=x+k(<span class="built_in">i</span>)*Z(:,<span class="built_in">i</span>); <span class="comment">%将方程组的通解表示为特解加对应齐次通解形式</span></span><br><span class="line">        <span class="keyword">end</span>        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">format<span class="comment">%恢复数据显示格式</span></span><br></pre></td></tr></table></figure></li><li><p>QR分解法</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>=<span class="title">solvebyQR</span><span class="params">(A,b)</span></span></span><br><span class="line"><span class="comment">%该函数利用QR分解法求线性方程组Ax=b的解</span></span><br><span class="line">flag=isexist(A,b);<span class="comment">%调用函数isexist()判断方程组解的情况</span></span><br><span class="line"><span class="keyword">if</span> flag==<span class="number">0</span></span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;该方程组无解!&#x27;</span>);</span><br><span class="line">    x=[];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    r=rank(A);</span><br><span class="line">    [m,n]=<span class="built_in">size</span>(A);</span><br><span class="line">    [Q,R]=qr(A);</span><br><span class="line">    b=Q&#x27;*b;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">%解Rx=b得原方程组的一个特解</span></span><br><span class="line">    x0(r)=b(r)/R(r,r);</span><br><span class="line">    <span class="keyword">if</span> r&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=r<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">1</span></span><br><span class="line">            x0(<span class="built_in">i</span>)=(b(<span class="built_in">i</span>)-R(<span class="built_in">i</span>,<span class="built_in">i</span>+<span class="number">1</span>:r)*x0(<span class="built_in">i</span>+<span class="number">1</span>:r)&#x27;)/R(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    x0=x0&#x27;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> flag==<span class="number">1</span> <span class="comment">%若方程组有唯一解</span></span><br><span class="line">        x=x0;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">%若方程组有无穷多解</span></span><br><span class="line">        format <span class="built_in">rat</span>;</span><br><span class="line">        Z=null(A,<span class="string">&#x27;r&#x27;</span>);<span class="comment">%求出对应齐次方程组的基础解系</span></span><br><span class="line">        [mZ,nZ]=<span class="built_in">size</span>(Z);</span><br><span class="line">        x0(r+<span class="number">1</span>:n)=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:nZ</span><br><span class="line">            t=sym(char([<span class="number">107</span> <span class="number">48</span>+<span class="built_in">i</span>]));</span><br><span class="line">            k(<span class="built_in">i</span>)=t;<span class="comment">%取k=[k1,…,kr]; </span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        x=x0;         </span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:nZ          </span><br><span class="line">            x=x+k(<span class="built_in">i</span>)*Z(:,<span class="built_in">i</span>);<span class="comment">%将方程组的通解表示为特解加对应齐次通解形式</span></span><br><span class="line">        <span class="keyword">end</span>        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">format<span class="comment">%恢复数据显示格式</span></span><br></pre></td></tr></table></figure></li><li><p>楚列斯基分解法</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>=<span class="title">solvebyCHOL</span><span class="params">(A,b)</span></span></span><br><span class="line"><span class="comment">%该函数利用楚列斯基分解法求线性方程组Ax=b的解</span></span><br><span class="line">lambda=eig(A);</span><br><span class="line"><span class="keyword">if</span> lambda&gt;<span class="built_in">eps</span>&amp;<span class="built_in">isequal</span>(A,A&#x27;)</span><br><span class="line">    [n,n]=<span class="built_in">size</span>(A);</span><br><span class="line">    R=chol(A);</span><br><span class="line">    <span class="comment">%解R&#x27;y=b</span></span><br><span class="line">    y(<span class="number">1</span>)=b(<span class="number">1</span>)/R(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">2</span>:n</span><br><span class="line">            y(<span class="built_in">i</span>)=(b(<span class="built_in">i</span>)-R(<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>,<span class="built_in">i</span>)&#x27;*y(<span class="number">1</span>:<span class="built_in">i</span><span class="number">-1</span>)&#x27;)/R(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">%解Rx=y</span></span><br><span class="line">    x(n)=y(n)/R(n,n);</span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=n<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">1</span></span><br><span class="line">            x(<span class="built_in">i</span>)=(y(<span class="built_in">i</span>)-R(<span class="built_in">i</span>,<span class="built_in">i</span>+<span class="number">1</span>:n)*x(<span class="built_in">i</span>+<span class="number">1</span>:n)&#x27;)/R(<span class="built_in">i</span>,<span class="built_in">i</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    x=x&#x27;;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    x=[];</span><br><span class="line">    <span class="built_in">disp</span>(<span class="string">&#x27;该方法只适用于对称正定的系数矩阵!&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>  </span><br></pre></td></tr></table></figure></li></ul><h3 id="非负最小二乘解">非负最小二乘解</h3><p>lsqnonneg(A,b)</p><h2 id="方程与方程组的优化解">方程与方程组的优化解</h2><ul><li>非线性方程基本函数<ul><li>x=fzero(fun,x0)</li><li>x=fzero(fun,x0,options)</li><li>x=fzero(problem)</li><li>[x,fval,exitflag,output]=fzero(···)</li></ul></li><li>非线性方程组基本函数<ul><li>x=fslove(fun,x0)</li><li>x=fslove(fun,x0,options)</li><li>x=fslove(problem)</li><li>[x,fval,exitflag,output,jacobian]=fslove(···)</li></ul></li></ul><h1>微分方程</h1><h2 id="微分方程">微分方程</h2><p>S=desolve(eqn,cond,Name,Value)</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">syms x(t) y(t)</span><br><span class="line">eqns=[diff(x,t)==y,diff(y,t)==-x];</span><br><span class="line">S=dsolve(eqns)</span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;微分方程的解&#x27;</span>,blanks(<span class="number">2</span>),<span class="string">&#x27;x&#x27;</span>,blanks(<span class="number">22</span>),<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line"><span class="built_in">disp</span>([S.x,S.y])<span class="comment">%显示方程的解</span></span><br></pre></td></tr></table></figure><h2 id="常微分方程的数值解法">常微分方程的数值解法</h2><h3 id="欧拉方法">欧拉方法</h3><p>根据欧拉公式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>y</mi><mi>n</mi></msub><mo>+</mo><mi>h</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y_{n+1}=y_n+hf(x_n,y_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[x,y]</span>=<span class="title">euler</span><span class="params">(f,x0,y0,xf,h)</span></span></span><br><span class="line">n=<span class="built_in">fix</span>((xf-x0)/h);</span><br><span class="line">y(<span class="number">1</span>)=y0;</span><br><span class="line">x(<span class="number">1</span>)=x0;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    x(<span class="built_in">i</span>+<span class="number">1</span>)=x0+<span class="built_in">i</span>*h;</span><br><span class="line">    y(<span class="built_in">i</span>+<span class="number">1</span>)=y(<span class="built_in">i</span>)+h*feval(f,x(<span class="built_in">i</span>),y(<span class="built_in">i</span>));</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>改进的欧拉公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>y</mi><mi>p</mi></msub><mo>=</mo><msub><mi>y</mi><mi>n</mi></msub><mo>+</mo><mi>h</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>y</mi><mi>c</mi></msub><mo>=</mo><msub><mi>y</mi><mi>n</mi></msub><mo>+</mo><mi>h</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>y</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msub><mi>y</mi><mi>p</mi></msub><mo>+</mo><msub><mi>y</mi><mi>c</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;y_p=y_n+hf(x_n,y_n) \\&amp;y_c=y_n+hf(x_{n+1},y_n) \\&amp;y_{n+1}=\frac{1}{2}(y_{p}+y_{c})\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.3074em;vertical-align:-2.4037em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.9037em;"><span style="top:-5.3852em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"></span></span><span style="top:-3.8852em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"></span></span><span style="top:-1.9037em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.4037em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.9037em;"><span style="top:-5.3852em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.8852em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-1.9037em;"><span class="pstrut" style="height:3.3214em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.4037em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[x,y]</span>=<span class="title">adeuler</span><span class="params">(f,x0,y0,xf,h)</span></span></span><br><span class="line">n=<span class="built_in">fix</span>((xf-x0)/h);</span><br><span class="line">x(<span class="number">1</span>)=x0;</span><br><span class="line">y(<span class="number">1</span>)=y0;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    x(<span class="built_in">i</span>+<span class="number">1</span>)=x0+h*<span class="built_in">i</span>;</span><br><span class="line">    yp=y(<span class="built_in">i</span>)+h*feval(f,x(<span class="built_in">i</span>),y(<span class="built_in">i</span>));</span><br><span class="line">    yc=y(<span class="built_in">i</span>)+h*feval(f,x(<span class="built_in">i</span>+<span class="number">1</span>),yp);</span><br><span class="line">    y(<span class="built_in">i</span>+<span class="number">1</span>)=(yp+yc)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="龙格-库塔方法">龙格-库塔方法</h3><ul><li><p>非刚性</p><ul><li>ode23 二、三阶R-K函数</li><li>ode45 四、五阶R-K函数</li><li>ode113</li></ul></li><li><p>刚性</p><ul><li>ode15s 多步法</li><li>ode23s 单步法</li><li>ode23t 难度适中</li><li>ode23tb 较难</li></ul></li><li><p>完全隐式 ode15i</p></li></ul><h2 id="偏微分方程-PDE">偏微分方程 PDE</h2><p>[PDE工具箱使用](<a href="https://blog.csdn.net/lusongno1/article/details/84097005">matlab的PDE工具箱的简单使用_matlab pde-CSDN博客</a>)</p><h3 id="区域设置及网格化">区域设置及网格化</h3><ul><li><p>创建偏微分方程定义的区域 文件名：pdegeom</p><ul><li><p>ne=pdegeom</p><p>ne——几何区域边界的线段数</p></li><li><p>d=pdegeom(bs)</p><p>d——一个区域边界数据的矩阵</p></li><li><p>[x,y]=pdegeom(bs,s)</p><p>bs——指定的边界线段</p><p>s——相应线段弧长的近似值</p></li></ul></li><li><p>网格化</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">model = createpde;</span><br><span class="line">geometryFromEdges(model,@cardg);<span class="comment">%根据自定义函数的几何形状创建模型对象的几何图形</span></span><br><span class="line">mesh=generateMesh(model);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>),pdemesh(model)</span><br><span class="line">title(<span class="string">&#x27;初始网格图&#x27;</span>)</span><br><span class="line">mesh=generateMesh(model,<span class="string">&#x27;Hmax&#x27;</span>,<span class="number">2</span>);  </span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>),pdemesh(model)</span><br><span class="line">title(<span class="string">&#x27;修改网格边界最大值&#x27;</span>)</span><br><span class="line">mesh=generateMesh(model,<span class="string">&#x27;Hmin&#x27;</span>,<span class="number">2</span>); </span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>),pdemesh(model),title(<span class="string">&#x27;修改网格边界最小值&#x27;</span>) </span><br><span class="line">mesh=generateMesh(model,<span class="string">&#x27;GeometricOrder&#x27;</span>,<span class="string">&#x27;linear&#x27;</span>,<span class="string">&#x27;Hgrad&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>),pdemesh(model)</span><br><span class="line">title(<span class="string">&#x27;修改网格几何秩序和增长率&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="边界条件设置">边界条件设置</h3><p>M文件名：pdebound</p><p>调用格式：[q,g,h,r]=pdebound(p,e,u,time)</p><p>e——边界</p><p>工具箱自带文件squareb3,m 区域为单位正方形</p><h3 id="PDE函数求解">PDE函数求解</h3><p>result=solvepde(model) 稳态</p><p>result=solvepde(model,tlist) 时间相关</p><blockquote><p>lplsfc.m</p></blockquote><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">model = createpde(); </span><br><span class="line">geometryFromEdges(model,@cirsg);<span class="comment">%cirsg自带的</span></span><br><span class="line">specifyCoefficients(model,<span class="string">&#x27;m&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;d&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;c&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;f&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">%方程系数</span></span><br><span class="line">rfun=@(location,state) </span><br><span class="line"><span class="comment">%初始条件</span></span><br><span class="line"><span class="built_in">cos</span>(<span class="number">2</span>/<span class="number">3</span>*<span class="built_in">atan2</span>(location.y,location.x));</span><br><span class="line">applyBoundaryCondition(model,<span class="string">&#x27;dirichlet&#x27;</span>,<span class="string">&#x27;Edge&#x27;</span>,...</span><br><span class="line"><span class="number">1</span>:model.Geometry.NumEdges,<span class="string">&#x27;r&#x27;</span>,rfun,<span class="string">&#x27;h&#x27;</span>,<span class="number">1</span>);<span class="comment">%在所有边缘设置狄利克雷条件</span></span><br><span class="line">generateMesh(model,<span class="string">&#x27;Hmax&#x27;</span>,<span class="number">0.25</span>); <span class="comment">%设置最大边界尺寸，生成模型网络</span></span><br><span class="line">results=solvepde(model);</span><br><span class="line">u=results.NodalSolution;</span><br><span class="line">pdeplot(model,<span class="string">&#x27;XYData&#x27;</span>,u,<span class="string">&#x27;ZData&#x27;</span>,u(:,<span class="number">1</span>))</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">pdemesh(model,u)</span><br><span class="line">title(<span class="string">&#x27;解的网格表面图&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>rcd.m</p></blockquote><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">model = createpde();  </span><br><span class="line">geometryFromEdges(model,@squareg);</span><br><span class="line"><span class="comment">%自带的正方形区域</span></span><br><span class="line">applyBoundaryCondition(model,<span class="string">&#x27;dirichlet&#x27;</span>,...</span><br><span class="line"><span class="string">&#x27;Face&#x27;</span>,<span class="number">1</span>:model.Geometry.NumFaces,<span class="string">&#x27;u&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">%在所有面应用dirichlet边界条件</span></span><br><span class="line">specifyCoefficients(model,<span class="string">&#x27;m&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;d&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;f&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">%边界条件</span></span><br><span class="line">u0=@(location) location.x.^<span class="number">2</span>+location.y.^<span class="number">2</span>&lt;<span class="number">0.4</span>;</span><br><span class="line"><span class="comment">%定义初始条件</span></span><br><span class="line">setInitialConditions(model,u0);<span class="comment">%设置初始条件</span></span><br><span class="line">generateMesh(model,<span class="string">&#x27;Hmax&#x27;</span>,<span class="number">0.25</span>); </span><br><span class="line">tlist = <span class="built_in">linspace</span>(<span class="number">0</span>,<span class="number">0.1</span>,<span class="number">20</span>); <span class="comment">%时间列表</span></span><br><span class="line">results = solvepde(model,tlist);</span><br><span class="line">u=results.NodalSolution;</span><br><span class="line">pdeplot(model,<span class="string">&#x27;XYData&#x27;</span>,u,<span class="string">&#x27;ZData&#x27;</span>,u(:,<span class="number">1</span>))<span class="comment">%表面图</span></span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">pdemesh(model,u)<span class="comment">%网格图</span></span><br><span class="line">title(<span class="string">&#x27;解的网格表面图&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="解特征值方程">解特征值方程</h3><p>result=slovepdeeig(model,evr) evr——特征值范围</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">model = createpde();</span><br><span class="line">geometryFromEdges(model,@lshapeg);</span><br><span class="line"><span class="comment">%lshapeg为自带的L形区域文件</span></span><br><span class="line">Mesh=generateMesh(model); <span class="comment">%生成模型网络</span></span><br><span class="line">pdegplot(model,<span class="string">&#x27;FaceLabels&#x27;</span>,<span class="string">&#x27;on&#x27;</span>,<span class="string">&#x27;FaceAlpha&#x27;</span>,<span class="number">0.5</span>)</span><br><span class="line">applyBoundaryCondition(model,<span class="string">&#x27;dirichlet&#x27;</span>,<span class="string">&#x27;Edge&#x27;</span>,...</span><br><span class="line"><span class="number">1</span>:model.Geometry.NumEdges,<span class="string">&#x27;u&#x27;</span>,<span class="number">0</span>);</span><br><span class="line">specifyCoefficients(model,<span class="string">&#x27;m&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;d&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;f&#x27;</span>,<span class="number">0</span>); </span><br><span class="line">evr = [-Inf,<span class="number">100</span>]; <span class="comment">%指定区间</span></span><br><span class="line">generateMesh(model,<span class="string">&#x27;Hmax&#x27;</span>,<span class="number">0.25</span>);</span><br><span class="line">results = solvepdeeig(model,evr); <span class="comment">%求解特征值</span></span><br><span class="line"></span><br><span class="line">              Basis= <span class="number">10</span>,  Time=   <span class="number">0.00</span>,  New conv eig=  <span class="number">0</span></span><br><span class="line">              Basis= <span class="number">30</span>,  Time=   <span class="number">0.00</span>,  New conv eig=  <span class="number">6</span></span><br><span class="line">              Basis= <span class="number">50</span>,  Time=   <span class="number">0.00</span>,  New conv eig= <span class="number">17</span></span><br><span class="line">              Basis= <span class="number">70</span>,  Time=   <span class="number">0.02</span>,  New conv eig= <span class="number">35</span></span><br><span class="line">End of sweep: Basis= <span class="number">70</span>,  Time=   <span class="number">0.02</span>,  New conv eig= <span class="number">33</span></span><br><span class="line">              Basis= <span class="number">43</span>,  Time=   <span class="number">0.02</span>,  New conv eig=  <span class="number">0</span></span><br><span class="line">              Basis= <span class="number">63</span>,  Time=   <span class="number">0.02</span>,  New conv eig=  <span class="number">1</span></span><br><span class="line">End of sweep: Basis= <span class="number">63</span>,  Time=   <span class="number">0.02</span>,  New conv eig=  <span class="number">1</span></span><br><span class="line"></span><br><span class="line">V = results.Eigenvectors; <span class="comment">%特征值向量</span></span><br><span class="line">pdeplot(model,<span class="string">&#x27;XYData&#x27;</span>,V,<span class="string">&#x27;ZData&#x27;</span>,V(:,<span class="number">1</span>)); </span><br><span class="line">title(<span class="string">&#x27;第一特征模态图&#x27;</span>) </span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line">pdeplot(model,<span class="string">&#x27;XYData&#x27;</span>,V,<span class="string">&#x27;ZData&#x27;</span>,V(:,<span class="number">16</span>));</span><br><span class="line">title(<span class="string">&#x27;第十六特征模态图&#x27;</span>)</span><br></pre></td></tr></table></figure><h1>数据可视化分析</h1><h2 id="样本空间">样本空间</h2><p>概率：p(A)</p><h2 id="数据可视化">数据可视化</h2><h3 id="离散情况">离散情况</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="number">25</span>  <span class="number">28</span>  <span class="number">26</span>  <span class="number">26</span>  <span class="number">29</span>  <span class="number">22</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">26</span>  <span class="number">27</span>  <span class="number">30</span>  <span class="number">28</span>  <span class="number">29</span>];</span><br><span class="line">y=[<span class="number">28</span>  <span class="number">23</span>  <span class="number">35</span>  <span class="number">21</span>  <span class="number">24</span>  <span class="number">32</span>  <span class="number">35</span>  <span class="number">34</span>  <span class="number">31</span>  <span class="number">30</span>  <span class="number">28</span>  <span class="number">29</span>  <span class="number">27</span>]; </span><br><span class="line"> <span class="built_in">plot</span>(x,y,<span class="string">&#x27;r^&#x27;</span>) </span><br><span class="line">title(<span class="string">&#x27;尼古丁含量测试情况&#x27;</span>)</span><br><span class="line">grid on</span><br></pre></td></tr></table></figure><h3 id="连续情况">连续情况</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="number">25</span>  <span class="number">28</span>  <span class="number">26</span>  <span class="number">26</span>  <span class="number">29</span>  <span class="number">22</span>  <span class="number">21</span>  <span class="number">22</span>  <span class="number">26</span>  <span class="number">27</span>  <span class="number">30</span>  <span class="number">28</span>  <span class="number">29</span>];</span><br><span class="line">y=[<span class="number">28</span>  <span class="number">23</span>  <span class="number">35</span>  <span class="number">21</span>  <span class="number">24</span>  <span class="number">32</span>  <span class="number">35</span>  <span class="number">34</span>  <span class="number">31</span>  <span class="number">30</span>  <span class="number">28</span>  <span class="number">29</span>  <span class="number">27</span>]; </span><br><span class="line"><span class="built_in">plot</span>(x,y,<span class="string">&#x27;r^&#x27;</span>) </span><br><span class="line">title(<span class="string">&#x27;尼古丁含量测试情况&#x27;</span>)</span><br><span class="line">grid on</span><br></pre></td></tr></table></figure><h2 id="正交试验分析">正交试验分析</h2><h3 id="极差分析-直观分析法">极差分析(直观分析法)</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[result,sum0]</span>=<span class="title">zjjc</span><span class="params">(s,opt)</span></span></span><br><span class="line"><span class="comment">%对正交试验进行极差分析，s是输入矩阵，opt是最优参数，其中</span></span><br><span class="line"><span class="comment">%若opt=1，表示最优取最大，若opt=2，表示最优取最小</span></span><br><span class="line"><span class="comment">%s=[1     1  1    1   857;</span></span><br><span class="line"><span class="comment">%    1     2   2   2   951;</span></span><br><span class="line"><span class="comment">%    1     3   3   3   909;</span></span><br><span class="line"><span class="comment">%    2     1   2   3   878;</span></span><br><span class="line"><span class="comment">%    2     2   3   1   973;</span></span><br><span class="line"><span class="comment">%    2     3   1   2   899;</span></span><br><span class="line"><span class="comment">%    3     1   3   2   803;</span></span><br><span class="line"><span class="comment">%    3     2   1   3  1030;</span></span><br><span class="line"><span class="comment">%    3     3   2   1   927];</span></span><br><span class="line"><span class="comment">%s的最后一列是各个正交组合的试验测量值，前几列是正交表</span></span><br><span class="line"> [m,n]=<span class="built_in">size</span>(s);</span><br><span class="line">  p=<span class="built_in">max</span>(s(:,<span class="number">1</span>));<span class="comment">%取水平数</span></span><br><span class="line">  q=n<span class="number">-1</span>;<span class="comment">%取列数</span></span><br><span class="line">  sum0=<span class="built_in">zeros</span>(p,q);</span><br><span class="line">  <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:q</span><br><span class="line">    <span class="keyword">for</span> k=<span class="number">1</span>:m </span><br><span class="line">         <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:p</span><br><span class="line">          <span class="keyword">if</span>(s(k,<span class="built_in">i</span>)==<span class="built_in">j</span>)</span><br><span class="line">              sum0(<span class="built_in">j</span>,<span class="built_in">i</span>)=sum0(<span class="built_in">j</span>,<span class="built_in">i</span>)+s(k,n);<span class="comment">%求和</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line">maxdiff=<span class="built_in">max</span>(sum0)-<span class="built_in">min</span>(sum0);<span class="comment">%求极差</span></span><br><span class="line">result(<span class="number">1</span>,:)=maxdiff;</span><br><span class="line"><span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">    maxsum0=<span class="built_in">max</span>(sum0);</span><br><span class="line">    <span class="keyword">for</span> kk=<span class="number">1</span>:q</span><br><span class="line">        modmax=<span class="built_in">mod</span>(<span class="built_in">find</span>(sum0==maxsum0(kk)),p);<span class="comment">%求最大水平</span></span><br><span class="line">        <span class="keyword">if</span> modmax==<span class="number">0</span></span><br><span class="line">            modmax=p;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        result(<span class="number">2</span>,kk)=(modmax);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   minsum0=<span class="built_in">min</span>(sum0);</span><br><span class="line">    <span class="keyword">for</span> kk=<span class="number">1</span>:q</span><br><span class="line">        modmin=<span class="built_in">mod</span>(<span class="built_in">find</span>(sum0==minsum0(kk)),p);<span class="comment">%求最小水平</span></span><br><span class="line">        <span class="keyword">if</span> modmin==<span class="number">0</span></span><br><span class="line">            modmin=p;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        result(<span class="number">2</span>,kk)=(modmin);</span><br><span class="line">    <span class="keyword">end</span> </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">s=[  <span class="number">1</span>     <span class="number">1</span>  <span class="number">1</span>    <span class="number">1</span>  <span class="number">857</span>;</span><br><span class="line">     <span class="number">1</span>     <span class="number">2</span>   <span class="number">2</span>   <span class="number">2</span>  <span class="number">951</span>;</span><br><span class="line">     <span class="number">1</span>     <span class="number">3</span>   <span class="number">3</span>   <span class="number">3</span>  <span class="number">909</span>;</span><br><span class="line">     <span class="number">2</span>     <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>  <span class="number">878</span>;</span><br><span class="line">     <span class="number">2</span>     <span class="number">2</span>   <span class="number">3</span>   <span class="number">1</span>  <span class="number">973</span>;</span><br><span class="line">     <span class="number">2</span>     <span class="number">3</span>   <span class="number">1</span>   <span class="number">2</span>  <span class="number">899</span>;</span><br><span class="line">     <span class="number">3</span>     <span class="number">1</span>   <span class="number">3</span>   <span class="number">2</span>  <span class="number">803</span>;</span><br><span class="line">     <span class="number">3</span>     <span class="number">2</span>   <span class="number">1</span>   <span class="number">3</span>  <span class="number">1030</span>;</span><br><span class="line">     <span class="number">3</span>     <span class="number">3</span>   <span class="number">2</span>   <span class="number">1</span>   <span class="number">927</span>]; </span><br><span class="line"></span><br><span class="line">[result,sum0]=zjjc(s,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">result =</span><br><span class="line">    <span class="number">43</span>   <span class="number">416</span>   <span class="number">101</span>   <span class="number">164</span><span class="comment">%每个因素的极差</span></span><br><span class="line">     <span class="number">3</span>     <span class="number">2</span>     <span class="number">1</span>     <span class="number">3</span><span class="comment">%相应因素的最优生产条件</span></span><br><span class="line">sum0 =<span class="comment">%相应因素每个水平的数据和</span></span><br><span class="line">        <span class="number">2717</span>        <span class="number">2538</span>        <span class="number">2786</span>        <span class="number">2757</span></span><br><span class="line">        <span class="number">2750</span>        <span class="number">2954</span>        <span class="number">2756</span>        <span class="number">2653</span></span><br><span class="line">        <span class="number">2760</span>        <span class="number">2735</span>        <span class="number">2685</span>        <span class="number">2817</span></span><br></pre></td></tr></table></figure><h3 id="方差分析">方差分析</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[result,error,errorDim]</span>=<span class="title">zjfc</span><span class="params">(s,opt)</span></span></span><br><span class="line"><span class="comment">%对正交试验进行方差分析，s是输入矩阵，opt是空列参数向量，给出s中是空白列的列序号</span></span><br><span class="line"><span class="comment">%s=[1  1   1   1  1 1 1 83.4;</span></span><br><span class="line"><span class="comment">%    1  1   1   2  2 2 2    84;</span></span><br><span class="line"><span class="comment">%    1  2   2   1  1 2 2 87.3;</span></span><br><span class="line"><span class="comment">%    1  2   2   2  2 1 1 84.8;</span></span><br><span class="line"><span class="comment">%    2  1   2   1  2 1 2 87.3;</span></span><br><span class="line"><span class="comment">%    2  1   2   2  1 2 1    88;</span></span><br><span class="line"><span class="comment">%    2  2   1   1  2 2 1 92.3;</span></span><br><span class="line"><span class="comment">%    2  2   1   2  1 1 2 90.4;</span></span><br><span class="line"><span class="comment">%];</span></span><br><span class="line"><span class="comment">%opt=[3,7];</span></span><br><span class="line"><span class="comment">%s的最后一列是各个正交组合的试验测量值，前几列是正交表</span></span><br><span class="line">[m,n]=<span class="built_in">size</span>(s);</span><br><span class="line"> p=<span class="built_in">max</span>(s(:,<span class="number">1</span>)); <span class="comment">%取水平数</span></span><br><span class="line"> q=n<span class="number">-1</span>;<span class="comment">%取列数</span></span><br><span class="line"> sum0=<span class="built_in">zeros</span>(p,q);</span><br><span class="line"> <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:q</span><br><span class="line">    <span class="keyword">for</span> k=<span class="number">1</span>:m </span><br><span class="line">         <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:p</span><br><span class="line">          <span class="keyword">if</span>(s(k,<span class="built_in">i</span>)==<span class="built_in">j</span>)</span><br><span class="line">              sum0(<span class="built_in">j</span>,<span class="built_in">i</span>)=sum0(<span class="built_in">j</span>,<span class="built_in">i</span>)+s(k,n);<span class="comment">%求和</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line">totalsum=sum(s(:,n));</span><br><span class="line">ss=sum0.*sum0;</span><br><span class="line">levelsum=m/p; <span class="comment">%水平重复数</span></span><br><span class="line">ss=sum(ss./levelsum)-totalsum^<span class="number">2</span>/m; <span class="comment">%每一列的S</span></span><br><span class="line">ssError=sum(ss(opt));</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:q</span><br><span class="line">    f(<span class="built_in">i</span>)=p<span class="number">-1</span>;    <span class="comment">%自由度</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fError=sum(f(opt));  <span class="comment">%误差自由度</span></span><br><span class="line">ssbar=ss./f;</span><br><span class="line">Errorbar=ssError/fError;</span><br><span class="line">index=<span class="built_in">find</span>(ssbar&lt;Errorbar);</span><br><span class="line">index1=<span class="built_in">find</span>(index==opt);</span><br><span class="line">index(index==index(index1))=[];<span class="comment">%剔除重复</span></span><br><span class="line">ssErrorNew=ssError+sum(ss(index));  <span class="comment">%并入误差</span></span><br><span class="line">fErrorNew=fError+sum(f(index));  <span class="comment">%新误差自由度</span></span><br><span class="line">F=(ss./f)/(ssErrorNew./fErrorNew);   <span class="comment">%F值</span></span><br><span class="line">errorDim=[opt,index];</span><br><span class="line"> errorDim=<span class="built_in">sort</span>(errorDim);<span class="comment">%误差列的序号</span></span><br><span class="line">result=[ss&#x27;,f&#x27;,ssbar&#x27;,F&#x27;];</span><br><span class="line">error=[ssError,fError;ssErrorNew,fErrorNew];</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">s=[ <span class="number">51</span> <span class="number">25</span> <span class="number">18</span> <span class="number">32</span>;</span><br><span class="line"><span class="number">40</span> <span class="number">23</span> <span class="number">13</span> <span class="number">35</span>;</span><br><span class="line"><span class="number">43</span> <span class="number">24</span> <span class="number">12</span> <span class="number">34</span>;</span><br><span class="line"><span class="number">48</span> <span class="number">26</span> <span class="number">16</span> <span class="number">30</span>;</span><br><span class="line"><span class="number">35</span> <span class="number">30</span> <span class="number">11</span> <span class="number">35</span>;</span><br><span class="line"><span class="number">32</span> <span class="number">31</span> <span class="number">10</span> <span class="number">37</span>];</span><br><span class="line"></span><br><span class="line">[result,sum0]=zjfc(s,<span class="number">1</span>)<span class="comment">%第1列为空白列以考查试验误差进行方差分析</span></span><br><span class="line"></span><br><span class="line">result =<span class="comment">%方差分析结果</span></span><br><span class="line">   <span class="number">1.0e+04</span> *</span><br><span class="line">    <span class="number">5.1773</span>    <span class="number">0.0050</span>    <span class="number">0.1035</span>    <span class="number">0.0001</span></span><br><span class="line">    <span class="number">5.1773</span>    <span class="number">0.0050</span>    <span class="number">0.1035</span>    <span class="number">0.0001</span></span><br><span class="line">    <span class="number">5.1773</span>    <span class="number">0.0050</span>    <span class="number">0.1035</span>    <span class="number">0.0001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sum0 =<span class="comment">%误差</span></span><br><span class="line">   <span class="number">1.0e+04</span> *</span><br><span class="line">    <span class="number">5.1773</span>    <span class="number">0.0050</span></span><br><span class="line">    <span class="number">5.1773</span>    <span class="number">0.0050</span></span><br></pre></td></tr></table></figure><h1>回归分析和方差分析</h1><h2 id="回归分析">回归分析</h2><h3 id="一元线性回归">一元线性回归</h3><p>ployfit()</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="number">82</span> <span class="number">93</span> <span class="number">105</span> <span class="number">130</span> <span class="number">144</span> <span class="number">150</span> <span class="number">160</span> <span class="number">180</span> <span class="number">270</span> <span class="number">300</span> <span class="number">400</span>]; </span><br><span class="line">y=[<span class="number">75</span> <span class="number">85</span> <span class="number">92</span> <span class="number">105</span> <span class="number">120</span> <span class="number">130</span> <span class="number">145</span> <span class="number">156</span> <span class="number">200</span> <span class="number">200</span> <span class="number">240</span>];</span><br><span class="line">[p,s]=polyfit(x,y,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">plot</span>(x,y,<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">x0=[<span class="built_in">min</span>(x):<span class="number">1</span>:<span class="built_in">max</span>(x)];<span class="comment">%重新定义取值点，间隔为1</span></span><br><span class="line">y0=p(<span class="number">1</span>)*x0+p(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">hold</span> on </span><br><span class="line"><span class="built_in">plot</span>(x0,y0)</span><br><span class="line"></span><br><span class="line">p =<span class="comment">%多项式的系数向量</span></span><br><span class="line">    <span class="number">0.5269</span>   <span class="number">44.2547</span></span><br><span class="line">s = <span class="comment">%用于获取误差估计值的结构体</span></span><br><span class="line">  包含以下字段的 struct:</span><br><span class="line">        R: [<span class="number">2</span>×<span class="number">2</span> double]</span><br><span class="line">       df: <span class="number">9</span></span><br><span class="line">    normr: <span class="number">36.8058</span></span><br></pre></td></tr></table></figure><h3 id="多元线性回归">多元线性回归</h3><p>[b,bint,r,rint,stats]=regress(y,X,alpha) 因变量y,自变量X</p><p>b——对回归系数的最小二乘估计</p><p>bint——回归系数b的95%置信度的置信区间</p><p>r——残差</p><p>rint——r的置信区间</p><p>stats——检验统计量</p><blockquote><p>假设回归方程有常数项，计算stats时，X应该包含一个全1的列</p></blockquote><p>alpha——指定的置信水平</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">y=[<span class="number">11.9</span> <span class="number">22.8</span> <span class="number">18.7</span> <span class="number">20.1</span> <span class="number">12.9</span> <span class="number">21.7</span> <span class="number">27.1</span> <span class="number">25.4</span> <span class="number">21.3</span> <span class="number">19.3</span> <span class="number">25.4</span> <span class="number">27.2</span> <span class="number">11.7</span><span class="number">17.8</span> <span class="number">12.8</span> <span class="number">23.9</span> <span class="number">22.6</span> <span class="number">25.4</span> <span class="number">14.8</span> <span class="number">21.1</span>];</span><br><span class="line"><span class="comment">%测量数据</span></span><br><span class="line">x=[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>; <span class="number">19.5</span> <span class="number">24.7</span> <span class="number">30.7</span> <span class="number">29.8</span><span class="number">19.1</span><span class="number">25.6</span><span class="number">31.4</span><span class="number">27.9</span><span class="number">22.1</span><span class="number">25.5</span> <span class="number">31.1</span><span class="number">30.4</span><span class="number">18.7</span><span class="number">19.7</span><span class="number">14.6</span><span class="number">29.5</span><span class="number">27.7</span><span class="number">30.2</span><span class="number">22.7</span><span class="number">25.2</span>;  <span class="number">43.1</span><span class="number">49.8</span><span class="number">51.9</span><span class="number">54.3</span><span class="number">42.2</span><span class="number">53.9</span><span class="number">58.6</span><span class="number">52.1</span><span class="number">49.9</span><span class="number">53.5</span> <span class="number">56.6</span><span class="number">56.7</span><span class="number">46.5</span><span class="number">44.2</span><span class="number">42.7</span><span class="number">54.4</span><span class="number">55.3</span><span class="number">58.6</span><span class="number">48.2</span><span class="number">51</span>; <span class="number">29.1</span>  <span class="number">28.2</span><span class="number">37</span><span class="number">31.1</span><span class="number">30.9</span><span class="number">23.7</span><span class="number">27.6</span><span class="number">30.6</span><span class="number">23.2</span><span class="number">24.8</span> <span class="number">30</span><span class="number">28.3</span><span class="number">23</span><span class="number">28.6</span><span class="number">21.3</span><span class="number">30.1</span><span class="number">25.6</span><span class="number">24.6</span><span class="number">27.1</span><span class="number">27.5</span> ]; <span class="comment">%构建分析数据矩阵</span></span><br><span class="line">[b,bint,r,rint,stats]=regress(y&#x27;,x&#x27;)</span><br><span class="line"></span><br><span class="line">b =<span class="comment">%系数估计值</span></span><br><span class="line">  <span class="number">107.8763</span></span><br><span class="line">    <span class="number">4.0599</span></span><br><span class="line">   <span class="number">-2.6200</span></span><br><span class="line">   <span class="number">-2.0402</span></span><br><span class="line">bint =<span class="comment">%系数估计值的置信边界的上界和下界</span></span><br><span class="line"> <span class="number">-100.7196</span>  <span class="number">316.4721</span></span><br><span class="line">   <span class="number">-2.2526</span>   <span class="number">10.3723</span></span><br><span class="line">   <span class="number">-8.0200</span>    <span class="number">2.7801</span></span><br><span class="line">   <span class="number">-5.3790</span>    <span class="number">1.2986</span></span><br><span class="line">r =<span class="comment">%残差</span></span><br><span class="line">   <span class="number">-2.8541</span></span><br><span class="line">    <span class="number">2.6523</span></span><br><span class="line">   <span class="number">-2.3515</span></span><br><span class="line">   <span class="number">-3.0467</span></span><br><span class="line">    <span class="number">1.0842</span></span><br><span class="line">   <span class="number">-0.5405</span></span><br><span class="line">    <span class="number">1.5828</span></span><br><span class="line">    <span class="number">3.1830</span></span><br><span class="line">    <span class="number">1.7691</span></span><br><span class="line">   <span class="number">-1.3383</span></span><br><span class="line">    <span class="number">0.7572</span></span><br><span class="line">    <span class="number">2.1928</span></span><br><span class="line">   <span class="number">-3.3433</span></span><br><span class="line">    <span class="number">4.0958</span></span><br><span class="line">    <span class="number">0.9780</span></span><br><span class="line">    <span class="number">0.1931</span></span><br><span class="line">   <span class="number">-0.6220</span></span><br><span class="line">   <span class="number">-1.3659</span></span><br><span class="line">   <span class="number">-3.6641</span></span><br><span class="line">    <span class="number">0.6382</span></span><br><span class="line">rint =<span class="comment">%用于诊断离群值的区间</span></span><br><span class="line">   <span class="number">-7.0569</span>    <span class="number">1.3488</span></span><br><span class="line">   <span class="number">-2.1810</span>    <span class="number">7.4856</span></span><br><span class="line">   <span class="number">-6.2623</span>    <span class="number">1.5593</span></span><br><span class="line">   <span class="number">-7.9378</span>    <span class="number">1.8444</span></span><br><span class="line">   <span class="number">-3.2626</span>    <span class="number">5.4310</span></span><br><span class="line">   <span class="number">-5.6469</span>    <span class="number">4.5659</span></span><br><span class="line">   <span class="number">-3.1194</span>    <span class="number">6.2849</span></span><br><span class="line">   <span class="number">-1.5201</span>    <span class="number">7.8862</span></span><br><span class="line">   <span class="number">-3.0732</span>    <span class="number">6.6113</span></span><br><span class="line">   <span class="number">-6.0888</span>    <span class="number">3.4121</span></span><br><span class="line">   <span class="number">-4.3244</span>    <span class="number">5.8388</span></span><br><span class="line">   <span class="number">-2.8440</span>    <span class="number">7.2297</span></span><br><span class="line">   <span class="number">-7.8489</span>    <span class="number">1.1623</span></span><br><span class="line">   <span class="number">-0.3044</span>    <span class="number">8.4960</span></span><br><span class="line">   <span class="number">-3.4144</span>    <span class="number">5.3703</span></span><br><span class="line">   <span class="number">-4.9673</span>    <span class="number">5.3534</span></span><br><span class="line">   <span class="number">-5.7883</span>    <span class="number">4.5444</span></span><br><span class="line">   <span class="number">-6.1250</span>    <span class="number">3.3932</span></span><br><span class="line">   <span class="number">-8.3703</span>    <span class="number">1.0420</span></span><br><span class="line">   <span class="number">-4.6541</span>    <span class="number">5.9305</span></span><br><span class="line">stats =<span class="comment">%模型统计量</span></span><br><span class="line">    <span class="number">0.7993</span>   <span class="number">21.2383</span>    <span class="number">0.0000</span>    <span class="number">6.2145</span></span><br></pre></td></tr></table></figure><h3 id="部分最小二乘回归">部分最小二乘回归</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[beta,VIP]</span>= <span class="title">pls</span><span class="params">(X,Y)</span></span></span><br><span class="line">[n,p]=<span class="built_in">size</span>(X);</span><br><span class="line">[n,q]=<span class="built_in">size</span>(Y); </span><br><span class="line">meanX=<span class="built_in">mean</span>(X);<span class="comment">%均值</span></span><br><span class="line">varX=var(X);<span class="comment">%方差</span></span><br><span class="line">meanY=<span class="built_in">mean</span>(Y);<span class="comment">%均值</span></span><br><span class="line">varY=var(Y);<span class="comment">%方差 </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">%%%%数据标准化过程</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:p      </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:n</span><br><span class="line">    X0(<span class="built_in">j</span>,<span class="built_in">i</span>)=(X(<span class="built_in">j</span>,<span class="built_in">i</span>)-meanX(<span class="built_in">i</span>))/((varX(<span class="built_in">i</span>))^<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:q</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:n</span><br><span class="line">    Y0(<span class="built_in">j</span>,<span class="built_in">i</span>)=(Y(<span class="built_in">j</span>,<span class="built_in">i</span>)-meanY(<span class="built_in">i</span>))/((varY(<span class="built_in">i</span>))^<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span><br><span class="line"> </span><br><span class="line">[omega(:,<span class="number">1</span>),t(:,<span class="number">1</span>),pp(:,<span class="number">1</span>),XX(:,:,<span class="number">1</span>),rr(:,<span class="number">1</span>),YY(:,:,<span class="number">1</span>)]=plsfactor(X0,Y0);</span><br><span class="line">[omega(:,<span class="number">2</span>),t(:,<span class="number">2</span>),pp(:,<span class="number">2</span>),XX(:,:,<span class="number">2</span>),rr(:,<span class="number">2</span>),YY(:,:,<span class="number">2</span>)]=plsfactor(XX(:,:,<span class="number">1</span>), YY(:,:,<span class="number">1</span>));</span><br><span class="line"> </span><br><span class="line">PRESShj=<span class="number">0</span>;</span><br><span class="line">tt0=<span class="built_in">ones</span>(n<span class="number">-1</span>,<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    YY0(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:)=Y0(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:);</span><br><span class="line">    YY0(<span class="built_in">i</span>:(n<span class="number">-1</span>),:)=Y0((<span class="built_in">i</span>+<span class="number">1</span>):n,:);</span><br><span class="line">    tt0(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:)=t(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:);</span><br><span class="line">     tt0(<span class="built_in">i</span>:(n<span class="number">-1</span>),:)=t((<span class="built_in">i</span>+<span class="number">1</span>):n,:);</span><br><span class="line">     expPRESS(<span class="built_in">i</span>,:)=(Y0(<span class="built_in">i</span>,:)-t(<span class="built_in">i</span>,:)*inv((tt0&#x27;*tt0))*tt0&#x27;*YY0);</span><br><span class="line">     <span class="keyword">for</span> m=<span class="number">1</span>:q</span><br><span class="line">        PRESShj=PRESShj+expPRESS(<span class="built_in">i</span>,m)^<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> sum1=sum(PRESShj);</span><br><span class="line"> PRESSh=sum(sum1);</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">for</span> m=<span class="number">1</span>:q</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">             SShj(<span class="built_in">i</span>,m)=YY(<span class="built_in">i</span>,m,<span class="number">1</span>)^<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> sum2=sum(SShj);</span><br><span class="line"> SSh=sum(sum2);</span><br><span class="line"> </span><br><span class="line"> Q=<span class="number">1</span>-(PRESSh/SSh);</span><br><span class="line"> </span><br><span class="line"> k=<span class="number">3</span>;</span><br><span class="line"> <span class="comment">%%%%%%%%%%%%%%%%循环，提取主元 </span></span><br><span class="line"> <span class="keyword">while</span> Q&gt;<span class="number">0.0975</span></span><br><span class="line">     [omega(:,k),t(:,k),pp(:,k),XX(:,:,k),rr(:,k),YY(:,:,k)]=plsfactor (XX(:,:,k<span class="number">-1</span>),YY(:,:,k<span class="number">-1</span>));</span><br><span class="line">      PRESShj=<span class="number">0</span>;</span><br><span class="line">    tt00=<span class="built_in">ones</span>(n<span class="number">-1</span>,k);</span><br><span class="line"> <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">    YY0(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:)=Y0(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:);</span><br><span class="line">    YY0(<span class="built_in">i</span>:(n<span class="number">-1</span>),:)=Y0((<span class="built_in">i</span>+<span class="number">1</span>):n,:);</span><br><span class="line">     tt00(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:)=t(<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>),:);</span><br><span class="line">     tt00(<span class="built_in">i</span>:(n<span class="number">-1</span>),:)=t((<span class="built_in">i</span>+<span class="number">1</span>):n,:);</span><br><span class="line">     expPRESS(<span class="built_in">i</span>,:)=(Y0(<span class="built_in">i</span>,:)-t(<span class="built_in">i</span>,:)*((tt00&#x27;*tt00)^(<span class="number">-1</span>))*tt00&#x27;*YY0);</span><br><span class="line">     <span class="keyword">for</span> m=<span class="number">1</span>:q</span><br><span class="line">        PRESShj=PRESShj+expPRESS(<span class="built_in">i</span>,m)^<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line"> <span class="keyword">for</span> m=<span class="number">1</span>:q</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n</span><br><span class="line">            SShj(<span class="built_in">i</span>,m)=YY(<span class="built_in">i</span>,m,k<span class="number">-1</span>)^<span class="number">2</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">sum2=sum(SShj);</span><br><span class="line"> SSh=sum(sum2);</span><br><span class="line">  Q=<span class="number">1</span>-(PRESSh/SSh);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> Q&gt;<span class="number">0.0975</span></span><br><span class="line">     k=k+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%</span></span><br><span class="line">h=k<span class="number">-1</span>;<span class="comment">%%%%%%%%%提取主元的个数 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%%%%%%%%%%%%%还原回归系数 </span></span><br><span class="line">omegaxing=<span class="built_in">ones</span>(p,h,q);</span><br><span class="line"><span class="keyword">for</span> m=<span class="number">1</span>:q</span><br><span class="line">omegaxing(:,<span class="number">1</span>,m)=rr(m,<span class="number">1</span>)*omega(:,<span class="number">1</span>);</span><br><span class="line">   <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">2</span>:(h)</span><br><span class="line">       <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:(<span class="built_in">i</span><span class="number">-1</span>)</span><br><span class="line">          omegaxingi =(<span class="built_in">eye</span>(p)-omega(:,<span class="built_in">j</span>)*pp(:,<span class="built_in">j</span>)&#x27;);</span><br><span class="line">          omegaxingii=<span class="built_in">eye</span>(p);</span><br><span class="line">          omegaxingii=omegaxingii*omegaxingi;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">      omegaxing(:,<span class="built_in">i</span>,m)=rr(m,<span class="built_in">i</span>)*omegaxingii*omega(:,<span class="built_in">i</span>);</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="built_in">beta</span>(:,m)=sum(omegaxing(:,:,m),<span class="number">2</span>);</span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="comment">%%%%%%%计算相关系数 </span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:h</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:q</span><br><span class="line">        relation(<span class="built_in">i</span>,<span class="built_in">j</span>)=sum(prod(corrcoef(t(:,<span class="built_in">i</span>),Y(:,<span class="built_in">j</span>))))/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span><br><span class="line">Rd=relation.*relation;</span><br><span class="line">RdYt=sum(Rd,<span class="number">2</span>)/q;</span><br><span class="line">Rdtttt=sum(RdYt);</span><br><span class="line">omega22=omega.*omega; </span><br><span class="line">VIP=((p/Rdtttt)*(omega22*RdYt)).^<span class="number">0.5</span>; <span class="comment">%%%计算VIP系数</span></span><br></pre></td></tr></table></figure><p>提取主元</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[omega,t,pp,XXX,r,YYY]</span>=<span class="title">plsfactor</span><span class="params">(X0,Y0)</span> </span></span><br><span class="line">XX=X0&#x27;*Y0*Y0&#x27;*X0;</span><br><span class="line">[V,D]=eig(XX);</span><br><span class="line">Lamda=<span class="built_in">max</span>(D);</span><br><span class="line">[MAXLamda,I]=<span class="built_in">max</span>(Lamda);</span><br><span class="line">omega=V(:,I);          <span class="comment">%最大特征值对应的特征向量 </span></span><br><span class="line"> <span class="comment">%%%第一主元 </span></span><br><span class="line">t=X0*omega;</span><br><span class="line">pp=X0&#x27;*t/(t&#x27;*t);</span><br><span class="line">XXX=X0-t*pp&#x27;;</span><br><span class="line">r=Y0&#x27;*t/(t&#x27;*t);</span><br><span class="line">YYY=Y0-t*r&#x27;;</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">X=[<span class="number">191</span> <span class="number">36</span> <span class="number">50</span>;<span class="comment">%自变量</span></span><br><span class="line"><span class="number">189</span> <span class="number">37</span> <span class="number">52</span>;</span><br><span class="line"><span class="number">193</span> <span class="number">38</span> <span class="number">58</span>;</span><br><span class="line"><span class="number">162</span> <span class="number">35</span> <span class="number">62</span>;</span><br><span class="line"><span class="number">189</span> <span class="number">35</span> <span class="number">46</span>;</span><br><span class="line"><span class="number">182</span> <span class="number">36</span> <span class="number">56</span>;</span><br><span class="line"><span class="number">211</span> <span class="number">38</span> <span class="number">56</span>;</span><br><span class="line"><span class="number">167</span> <span class="number">34</span> <span class="number">60</span>;</span><br><span class="line"><span class="number">176</span> <span class="number">31</span> <span class="number">74</span>;</span><br><span class="line"><span class="number">154</span> <span class="number">33</span> <span class="number">56</span>;</span><br><span class="line"><span class="number">169</span> <span class="number">34</span> <span class="number">50</span>;</span><br><span class="line"><span class="number">166</span> <span class="number">33</span> <span class="number">52</span>;</span><br><span class="line"><span class="number">154</span> <span class="number">34</span> <span class="number">64</span>;</span><br><span class="line"><span class="number">247</span> <span class="number">46</span> <span class="number">50</span>;</span><br><span class="line"><span class="number">193</span> <span class="number">36</span> <span class="number">46</span>;</span><br><span class="line"><span class="number">202</span> <span class="number">37</span> <span class="number">62</span>;</span><br><span class="line"><span class="number">176</span> <span class="number">37</span> <span class="number">54</span>;</span><br><span class="line"><span class="number">157</span> <span class="number">32</span> <span class="number">52</span>;</span><br><span class="line"><span class="number">156</span> <span class="number">33</span> <span class="number">54</span>;</span><br><span class="line"><span class="number">138</span> <span class="number">33</span> <span class="number">68</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">Y=[<span class="number">5</span> <span class="number">162</span> <span class="number">60</span>;<span class="comment">%因变量</span></span><br><span class="line"><span class="number">2</span> <span class="number">110</span> <span class="number">60</span>;</span><br><span class="line"><span class="number">12</span> <span class="number">101</span> <span class="number">101</span>;</span><br><span class="line"><span class="number">12</span> <span class="number">105</span> <span class="number">37</span>;</span><br><span class="line"><span class="number">13</span> <span class="number">155</span> <span class="number">58</span>;</span><br><span class="line"><span class="number">4</span> <span class="number">101</span> <span class="number">42</span>;</span><br><span class="line"><span class="number">8</span> <span class="number">101</span> <span class="number">38</span>;</span><br><span class="line"><span class="number">6</span> <span class="number">125</span> <span class="number">40</span>;</span><br><span class="line"><span class="number">15</span> <span class="number">200</span> <span class="number">40</span>;</span><br><span class="line"><span class="number">17</span> <span class="number">251</span> <span class="number">250</span>;</span><br><span class="line"><span class="number">17</span> <span class="number">120</span> <span class="number">38</span>;</span><br><span class="line"><span class="number">13</span> <span class="number">210</span> <span class="number">115</span>;</span><br><span class="line"><span class="number">14</span> <span class="number">215</span> <span class="number">105</span>;</span><br><span class="line"><span class="number">1</span> <span class="number">50</span> <span class="number">50</span> ;</span><br><span class="line"><span class="number">6</span> <span class="number">70</span> <span class="number">31</span>;</span><br><span class="line"><span class="number">12</span> <span class="number">210</span> <span class="number">120</span>;</span><br><span class="line"><span class="number">4</span> <span class="number">60</span> <span class="number">25</span>;</span><br><span class="line"><span class="number">11</span> <span class="number">230</span> <span class="number">80</span>;</span><br><span class="line"><span class="number">15</span> <span class="number">225</span> <span class="number">73</span>;</span><br><span class="line"><span class="number">2</span> <span class="number">110</span> <span class="number">43</span>];</span><br><span class="line">[<span class="built_in">beta</span>,VIP]=pls(X,Y)<span class="comment">%进行部分最小二乘回归</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">beta</span> =</span><br><span class="line">   <span class="number">-0.0778</span>   <span class="number">-0.1385</span>   <span class="number">-0.0604</span></span><br><span class="line">   <span class="number">-0.4989</span>   <span class="number">-0.5244</span>   <span class="number">-0.1559</span></span><br><span class="line">   <span class="number">-0.1322</span>   <span class="number">-0.0854</span>   <span class="number">-0.0073</span></span><br><span class="line">VIP =</span><br><span class="line">    <span class="number">0.9982</span></span><br><span class="line">    <span class="number">1.2977</span></span><br><span class="line">    <span class="number">0.5652</span></span><br></pre></td></tr></table></figure><h2 id="数理统计基础">数理统计基础</h2><h3 id="样本均值">样本均值</h3><p>M=mean(A)</p><ul><li>算术平均 nanmean</li><li>几何平均 geomean</li><li>调和平均 harmmean</li><li>调整平均 trimmean</li></ul><h3 id="样本方差与标准差">样本方差与标准差</h3><ul><li><p>方差 var(A,w) w——权重向量</p></li><li><p>标准差 std(A,w)</p><p>w=0(默认)，按N-1进行归一化</p><p>w=1，按观测数值量N进行归一化</p></li></ul><h3 id="协方差和相关系数">协方差和相关系数</h3><ul><li>协方差 cov(A)</li><li>相关系数 corrcoef(A)</li></ul><h2 id="多元数据相关分析">多元数据相关分析</h2><h3 id="主成分分析">主成分分析</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[F,rate,maxlamda]</span>=<span class="title">mainfactor</span><span class="params">(X)</span></span></span><br><span class="line">[n,p]=<span class="built_in">size</span>(X);</span><br><span class="line">meanX=<span class="built_in">mean</span>(X);</span><br><span class="line">varX=var(X);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:p      </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:n</span><br><span class="line">    X0(<span class="built_in">j</span>,<span class="built_in">i</span>)=(X(<span class="built_in">j</span>,<span class="built_in">i</span>)-meanX(<span class="built_in">i</span>))/((varX(<span class="built_in">i</span>))^<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">V=corrcoef(X0);</span><br><span class="line">[VV0,lamda0]=eig(V);</span><br><span class="line">lamda1=sum(lamda0);</span><br><span class="line">lamda=lamda1(<span class="built_in">find</span>(lamda1&gt;<span class="number">0</span>));</span><br><span class="line">VV=VV0(:,<span class="built_in">find</span>(lamda1&gt;<span class="number">0</span>));</span><br><span class="line">k=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(k&lt;=<span class="built_in">length</span>(lamda))</span><br><span class="line">    [maxlamda(k),I]=<span class="built_in">max</span>(lamda);</span><br><span class="line">    maxVV(:,k)=VV(:,I);</span><br><span class="line">    lamda(I)=[];</span><br><span class="line">    VV(:,I)=[];</span><br><span class="line">    k=k+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">lamdarate=maxlamda/sum(maxlamda);</span><br><span class="line">rate=(<span class="built_in">zeros</span>(<span class="number">1</span>,<span class="built_in">length</span>(maxlamda)));</span><br><span class="line"><span class="keyword">for</span> l=<span class="number">1</span>:<span class="built_in">length</span>(maxlamda)</span><br><span class="line">    F(:,l)=maxVV(:,<span class="number">1</span>)&#x27;*X&#x27;;</span><br><span class="line">    <span class="keyword">for</span> m=<span class="number">1</span>:l</span><br><span class="line">    rate(l)=rate(l)+lamdarate(m);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">X=[<span class="number">19.5</span> <span class="number">24.7</span> <span class="number">30.7</span> <span class="number">29.8</span> <span class="number">19.1</span> <span class="number">25.6</span> <span class="number">31.4</span> <span class="number">27.9</span> <span class="number">22.1</span> <span class="number">25.5</span>  <span class="number">31.1</span> <span class="number">30.4</span> <span class="number">18.7</span> <span class="number">19.7</span> <span class="number">14.6</span><span class="number">29.5</span><span class="number">27.7</span><span class="number">30.2</span><span class="number">22.7</span><span class="number">25.2</span>;<span class="number">43.1</span><span class="number">49.8</span><span class="number">51.9</span><span class="number">54.3</span><span class="number">42.2</span><span class="number">53.9</span><span class="number">58.6</span><span class="number">52.1</span><span class="number">49.9</span><span class="number">53.5</span> <span class="number">56.6</span><span class="number">56.7</span><span class="number">46.5</span><span class="number">44.2</span><span class="number">42.7</span><span class="number">54.4</span><span class="number">55.3</span><span class="number">58.6</span><span class="number">48.2</span><span class="number">51</span>;  <span class="number">29.1</span> <span class="number">28.2</span><span class="number">37</span><span class="number">31.1</span><span class="number">30.9</span><span class="number">23.7</span><span class="number">27.6</span><span class="number">30.6</span><span class="number">23.2</span><span class="number">24.8</span>  <span class="number">30</span><span class="number">28.3</span><span class="number">23</span><span class="number">28.6</span><span class="number">21.3</span><span class="number">30.1</span><span class="number">25.6</span><span class="number">24.6</span><span class="number">27.1</span><span class="number">27.5</span>];</span><br><span class="line">[F,rate,maxlamda]=mainfactor(X)</span><br><span class="line"></span><br><span class="line">F =<span class="comment">%对应的主成分</span></span><br><span class="line">  <span class="number">113.2766</span>  <span class="number">113.2766</span>  <span class="number">113.2766</span>  <span class="number">113.2766</span>  <span class="number">113.2766</span>  <span class="number">113.2766</span></span><br><span class="line">  <span class="number">229.0117</span>  <span class="number">229.0117</span>  <span class="number">229.0117</span>  <span class="number">229.0117</span>  <span class="number">229.0117</span>  <span class="number">229.0117</span></span><br><span class="line">  <span class="number">123.3809</span>  <span class="number">123.3809</span>  <span class="number">123.3809</span>  <span class="number">123.3809</span>  <span class="number">123.3809</span>  <span class="number">123.3809</span></span><br><span class="line">rate =<span class="comment">%每个主成分的贡献率</span></span><br><span class="line">    <span class="number">0.9681</span>    <span class="number">1.0000</span>    <span class="number">1.0000</span>    <span class="number">1.0000</span>    <span class="number">1.0000</span>    <span class="number">1.0000</span></span><br><span class="line">maxlamda =<span class="comment">%从大到小排列的协方差阵特征值</span></span><br><span class="line">   <span class="number">19.3620</span>    <span class="number">0.6380</span>    <span class="number">0.0000</span>    <span class="number">0.0000</span>    <span class="number">0.0000</span>    <span class="number">0.0000</span></span><br></pre></td></tr></table></figure><h3 id="典型相关分析">典型相关分析</h3><p>看是否存在相关关系</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[maxVV1,maxVV2,F,G]</span>=<span class="title">dxxg</span><span class="params">(X,Y)</span></span></span><br><span class="line">[n,p]=<span class="built_in">size</span>(X);</span><br><span class="line">[n,q]=<span class="built_in">size</span>(Y);</span><br><span class="line">meanX=<span class="built_in">mean</span>(X);</span><br><span class="line">varX=var(X);</span><br><span class="line">meanY=<span class="built_in">mean</span>(Y);</span><br><span class="line">varY=var(Y);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:p      </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:n</span><br><span class="line">    X0(<span class="built_in">j</span>,<span class="built_in">i</span>)=(X(<span class="built_in">j</span>,<span class="built_in">i</span>)-meanX(<span class="built_in">i</span>))/((varX(<span class="built_in">i</span>))^<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:q</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:n</span><br><span class="line">    Y0(<span class="built_in">j</span>,<span class="built_in">i</span>)=(Y(<span class="built_in">j</span>,<span class="built_in">i</span>)-meanY(<span class="built_in">i</span>))/((varY(<span class="built_in">i</span>))^<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">V1=inv(X0&#x27;*X0)*X0&#x27;*Y0*inv(Y0&#x27;*Y0)*Y0&#x27;*X0;</span><br><span class="line">V2=inv(Y0&#x27;*Y0)*Y0&#x27;*X0*inv(X0&#x27;*X0)*X0&#x27;*Y0;</span><br><span class="line">[VV1,lamda1]=eig(V1);</span><br><span class="line">[VV2,lamda2]=eig(V2);</span><br><span class="line">lamda11=sum(lamda1);</span><br><span class="line">lamda21=sum(lamda2);</span><br><span class="line">k=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(k&lt;=(<span class="built_in">length</span>(lamda1))^<span class="number">0.5</span>)</span><br><span class="line">    [maxlamda1(k),I]=<span class="built_in">max</span>(lamda11);   </span><br><span class="line">    maxVV1(:,k)=VV1(:,I);</span><br><span class="line">    lamda11(I)=[];</span><br><span class="line">    VV1(:,I)=[];</span><br><span class="line">     [maxlamda2(k),I]=<span class="built_in">max</span>(lamda21);</span><br><span class="line">    maxVV2(:,k)=VV2(:,I);</span><br><span class="line">     lamda21(I)=[];</span><br><span class="line">    VV2(:,I)=[];</span><br><span class="line">    k=k+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">F=X0*maxVV1;</span><br><span class="line">G=Y0*maxVV2;</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">X=[<span class="number">191</span> <span class="number">36</span> <span class="number">50</span>; <span class="number">189</span> <span class="number">37</span> <span class="number">52</span>; <span class="number">193</span> <span class="number">38</span> <span class="number">58</span>; <span class="number">162</span> <span class="number">35</span> <span class="number">62</span>; <span class="number">189</span> <span class="number">35</span> <span class="number">46</span>; <span class="number">182</span> <span class="number">36</span> <span class="number">56</span>; <span class="number">211</span> <span class="number">38</span> <span class="number">56</span>; <span class="number">167</span> <span class="number">34</span> <span class="number">60</span>; <span class="number">176</span> <span class="number">31</span> <span class="number">74</span>; <span class="number">154</span> <span class="number">33</span> <span class="number">56</span>; <span class="number">169</span> <span class="number">34</span> <span class="number">50</span>; <span class="number">166</span> <span class="number">33</span> <span class="number">52</span>; <span class="number">154</span> <span class="number">34</span> <span class="number">64</span>; <span class="number">247</span> <span class="number">46</span> <span class="number">50</span>; <span class="number">193</span> <span class="number">36</span> <span class="number">46</span>; <span class="number">202</span> <span class="number">37</span> <span class="number">62</span>; <span class="number">176</span> <span class="number">37</span> <span class="number">54</span>; <span class="number">157</span> <span class="number">32</span> <span class="number">52</span>; <span class="number">156</span> <span class="number">33</span> <span class="number">54</span>; <span class="number">138</span> <span class="number">33</span> <span class="number">68</span>];</span><br><span class="line">Y=[<span class="number">5</span> <span class="number">162</span> <span class="number">60</span>; <span class="number">2</span> <span class="number">110</span> <span class="number">60</span>; <span class="number">12</span> <span class="number">101</span> <span class="number">101</span>; <span class="number">12</span> <span class="number">105</span> <span class="number">37</span>; <span class="number">13</span> <span class="number">155</span> <span class="number">58</span>; <span class="number">4</span> <span class="number">101</span> <span class="number">42</span>; <span class="number">8</span> <span class="number">101</span> <span class="number">38</span>; <span class="number">6</span> <span class="number">125</span> <span class="number">40</span>; <span class="number">15</span> <span class="number">200</span> <span class="number">40</span>; <span class="number">17</span> <span class="number">251</span> <span class="number">250</span>; <span class="number">17</span> <span class="number">120</span> <span class="number">38</span>; <span class="number">13</span> <span class="number">210</span> <span class="number">115</span>; <span class="number">14</span> <span class="number">215</span> <span class="number">105</span>; <span class="number">1</span> <span class="number">50</span> <span class="number">50</span> ; <span class="number">6</span> <span class="number">70</span> <span class="number">31</span>; <span class="number">12</span> <span class="number">210</span> <span class="number">120</span>; <span class="number">4</span> <span class="number">60</span> <span class="number">25</span>; <span class="number">11</span> <span class="number">230</span> <span class="number">80</span>; <span class="number">15</span> <span class="number">225</span> <span class="number">73</span>; <span class="number">2</span> <span class="number">110</span> <span class="number">43</span>];</span><br><span class="line">[maxVV1,maxVV2,F,G]=dxxg(X,Y)</span><br><span class="line"></span><br><span class="line">maxVV1 =<span class="comment">%X的典型主轴</span></span><br><span class="line">    <span class="number">0.4405</span></span><br><span class="line">   <span class="number">-0.8971</span></span><br><span class="line">    <span class="number">0.0336</span></span><br><span class="line">maxVV2 =<span class="comment">%Y的典型主轴</span></span><br><span class="line">   <span class="number">-0.2645</span></span><br><span class="line">   <span class="number">-0.7976</span></span><br><span class="line">    <span class="number">0.5421</span></span><br><span class="line">F =<span class="comment">%X的典型成分</span></span><br><span class="line">    <span class="number">0.0247</span></span><br><span class="line">   <span class="number">-0.2819</span></span><br><span class="line">   <span class="number">-0.4627</span></span><br><span class="line">   <span class="number">-0.1566</span></span><br><span class="line">    <span class="number">0.2506</span></span><br><span class="line">   <span class="number">-0.1079</span></span><br><span class="line">   <span class="number">-0.1510</span></span><br><span class="line">    <span class="number">0.2035</span></span><br><span class="line">    <span class="number">1.2698</span></span><br><span class="line">    <span class="number">0.2331</span></span><br><span class="line">    <span class="number">0.1926</span></span><br><span class="line">    <span class="number">0.4286</span></span><br><span class="line">   <span class="number">-0.0098</span></span><br><span class="line">   <span class="number">-1.7782</span></span><br><span class="line">    <span class="number">0.0417</span></span><br><span class="line">   <span class="number">-0.0034</span></span><br><span class="line">   <span class="number">-0.5045</span></span><br><span class="line">    <span class="number">0.5482</span></span><br><span class="line">    <span class="number">0.2595</span></span><br><span class="line">    <span class="number">0.0036</span></span><br><span class="line">G =<span class="comment">%Y的典型成分</span></span><br><span class="line">   <span class="number">-0.0960</span></span><br><span class="line">    <span class="number">0.7170</span></span><br><span class="line">    <span class="number">0.7649</span></span><br><span class="line">    <span class="number">0.0373</span></span><br><span class="line">   <span class="number">-0.4281</span></span><br><span class="line">    <span class="number">0.5414</span></span><br><span class="line">    <span class="number">0.2990</span></span><br><span class="line">    <span class="number">0.1142</span></span><br><span class="line">   <span class="number">-1.2921</span></span><br><span class="line">    <span class="number">0.1779</span></span><br><span class="line">   <span class="number">-0.3935</span></span><br><span class="line">   <span class="number">-0.5266</span></span><br><span class="line">   <span class="number">-0.7461</span></span><br><span class="line">    <span class="number">1.4262</span></span><br><span class="line">    <span class="number">0.7202</span></span><br><span class="line">   <span class="number">-0.4237</span></span><br><span class="line">    <span class="number">0.8843</span></span><br><span class="line">   <span class="number">-1.0515</span></span><br><span class="line">   <span class="number">-1.2619</span></span><br><span class="line">    <span class="number">0.5373</span></span><br></pre></td></tr></table></figure><h2 id="方差分析-2">方差分析</h2><h3 id="单因素方差分析">单因素方差分析</h3><p><img src="../../source/imgs/$%7Bfiilename%7D/6697c401d9c307b7e97f30c2.jpg" alt="单因素方差分析表"></p><p>anoval(X,group) group——标识箱线图中的坐标</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">X=[<span class="number">4.3</span>  <span class="number">6.1</span>  <span class="number">6.5</span>  <span class="number">9.3</span>  <span class="number">9.5</span>; <span class="number">7.8</span>  <span class="number">7.3</span>  <span class="number">8.3</span><span class="number">8.7</span> <span class="number">8.8</span>; <span class="number">3.2</span>  <span class="number">4.2</span>  <span class="number">8.6</span><span class="number">7.2</span><span class="number">11.4</span>; <span class="number">6.5</span>  <span class="number">4.1</span>  <span class="number">8.2</span>  <span class="number">10.1</span>  <span class="number">7.8</span>];</span><br><span class="line"><span class="built_in">mean</span>(X)</span><br><span class="line">[p,<span class="built_in">table</span>,stats]=anova1(X)</span><br><span class="line"></span><br><span class="line"><span class="built_in">ans</span> =<span class="comment">%样本均值</span></span><br><span class="line">    <span class="number">5.4500</span>    <span class="number">5.4250</span>    <span class="number">7.9000</span>    <span class="number">8.8250</span>    <span class="number">9.3750</span></span><br><span class="line">p =<span class="comment">%各列均值相等的概率值</span></span><br><span class="line">    <span class="number">0.0042</span></span><br><span class="line"><span class="built_in">table</span> =<span class="comment">%方差分析表</span></span><br><span class="line">  <span class="number">4</span>×<span class="number">6</span> cell 数组</span><br><span class="line">    &#123;<span class="string">&#x27;来源&#x27;</span>&#125;    &#123;<span class="string">&#x27;SS&#x27;</span>     &#125;    &#123;<span class="string">&#x27;df&#x27;</span>&#125;    &#123;<span class="string">&#x27;MS&#x27;</span>      &#125;    &#123;<span class="string">&#x27;F&#x27;</span>       &#125;    &#123;<span class="string">&#x27;p 值(F)&#x27;</span> &#125;</span><br><span class="line">    &#123;<span class="string">&#x27;列&#x27;</span>  &#125;    &#123;[<span class="number">55.5370</span>]&#125;    &#123;[ <span class="number">4</span>]&#125;    &#123;[ <span class="number">13.8843</span>]&#125;    &#123;[  <span class="number">6.0590</span>]&#125;    &#123;[  <span class="number">0.0042</span>]&#125;</span><br><span class="line">    &#123;<span class="string">&#x27;误差&#x27;</span>&#125;    &#123;[<span class="number">34.3725</span>]&#125;    &#123;[<span class="number">15</span>]&#125;    &#123;[  <span class="number">2.2915</span>]&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;</span><br><span class="line">    &#123;<span class="string">&#x27;合计&#x27;</span>&#125;    &#123;[<span class="number">89.9095</span>]&#125;    &#123;[<span class="number">19</span>]&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;</span><br><span class="line">stats = <span class="comment">%结果结构体</span></span><br><span class="line">  包含以下字段的 struct:</span><br><span class="line">    gnames: [<span class="number">5</span>×<span class="number">1</span> char]</span><br><span class="line">         n: [<span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span>]</span><br><span class="line">    source: <span class="string">&#x27;anova1&#x27;</span></span><br><span class="line">     means: [<span class="number">5.4500</span> <span class="number">5.4250</span> <span class="number">7.9000</span> <span class="number">8.8250</span> <span class="number">9.3750</span>]</span><br><span class="line">        df: <span class="number">15</span></span><br><span class="line">         s: <span class="number">1.5138</span></span><br></pre></td></tr></table></figure><h3 id="双因素方差分析">双因素方差分析</h3><p>anova2(X,reps) reps——试验重复次数</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">X=[<span class="number">58.2</span>    <span class="number">52.6</span> <span class="number">56.2</span> <span class="number">41.2</span>    <span class="number">65.3</span> <span class="number">60.8</span>;<span class="number">49.1</span> <span class="number">42.8</span> <span class="number">54.1</span> <span class="number">50.5</span> <span class="number">51.6</span> <span class="number">48.4</span>;<span class="number">60.1</span> <span class="number">58.3</span>    <span class="number">70.9</span> <span class="number">73.2</span>    <span class="number">39.2</span> <span class="number">40.7</span>;<span class="number">75.8</span> <span class="number">71.5</span>    <span class="number">58.2</span> <span class="number">51</span>    <span class="number">48.7</span> <span class="number">41.4</span>];</span><br><span class="line">[p,<span class="built_in">table</span>,stats]=anova2(X&#x27;,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p =</span><br><span class="line">    <span class="number">0.0260</span>    <span class="number">0.0035</span>    <span class="number">0.0001</span></span><br><span class="line"><span class="built_in">table</span> =</span><br><span class="line">  <span class="number">6</span>×<span class="number">6</span> cell 数组</span><br><span class="line">    &#123;<span class="string">&#x27;来源&#x27;</span>   &#125;    &#123;<span class="string">&#x27;SS&#x27;</span>        &#125;    &#123;<span class="string">&#x27;df&#x27;</span>&#125;    &#123;<span class="string">&#x27;MS&#x27;</span>      &#125;    &#123;<span class="string">&#x27;F&#x27;</span>       &#125;    &#123;<span class="string">&#x27;p 值(F)&#x27;</span>   &#125;</span><br><span class="line">    &#123;<span class="string">&#x27;列&#x27;</span>     &#125;    &#123;[  <span class="number">261.6750</span>]&#125;    &#123;[ <span class="number">3</span>]&#125;    &#123;[ <span class="number">87.2250</span>]&#125;    &#123;[  <span class="number">4.4174</span>]&#125;    &#123;[    <span class="number">0.0260</span>]&#125;</span><br><span class="line">    &#123;<span class="string">&#x27;行&#x27;</span>     &#125;    &#123;[  <span class="number">370.9808</span>]&#125;    &#123;[ <span class="number">2</span>]&#125;    &#123;[<span class="number">185.4904</span>]&#125;    &#123;[  <span class="number">9.3939</span>]&#125;    &#123;[    <span class="number">0.0035</span>]&#125;</span><br><span class="line">    &#123;<span class="string">&#x27;交互效应&#x27;</span>&#125;    &#123;[<span class="number">1.7687e+03</span>]&#125;    &#123;[ <span class="number">6</span>]&#125;    &#123;[<span class="number">294.7821</span>]&#125;    &#123;[ <span class="number">14.9288</span>]&#125;    &#123;[<span class="number">6.1511e-05</span>]&#125;</span><br><span class="line">    &#123;<span class="string">&#x27;误差&#x27;</span>   &#125;    &#123;[  <span class="number">236.9500</span>]&#125;    &#123;[<span class="number">12</span>]&#125;    &#123;[ <span class="number">19.7458</span>]&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double  &#125;</span><br><span class="line">    &#123;<span class="string">&#x27;合计&#x27;</span>   &#125;    &#123;[<span class="number">2.6383e+03</span>]&#125;    &#123;[<span class="number">23</span>]&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double&#125;    &#123;<span class="number">0</span>×<span class="number">0</span> double  &#125;</span><br><span class="line">stats = </span><br><span class="line">  包含以下字段的 struct:</span><br><span class="line">      source: <span class="string">&#x27;anova2&#x27;</span></span><br><span class="line">     sigmasq: <span class="number">19.7458</span></span><br><span class="line">    colmeans: [<span class="number">55.7167</span> <span class="number">49.4167</span> <span class="number">57.0667</span> <span class="number">57.7667</span>]</span><br><span class="line">        coln: <span class="number">6</span></span><br><span class="line">    rowmeans: [<span class="number">58.5500</span> <span class="number">56.9125</span> <span class="number">49.5125</span>]</span><br><span class="line">        rown: <span class="number">8</span></span><br><span class="line">       inter: <span class="number">1</span></span><br><span class="line">        pval: <span class="number">6.1511e-05</span></span><br><span class="line">          df: <span class="number">12</span></span><br></pre></td></tr></table></figure><h1>数据拟合与插值</h1><h2 id="数据插值">数据插值</h2><h3 id="拉格朗日插值">拉格朗日插值</h3>]]></content>
      
      
      <categories>
          
          <category> 数模 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MATLAB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人类观察录前言</title>
      <link href="/2024/06/10/guancha/%E8%A7%82%E5%AF%9F%E5%BD%95%E5%89%8D%E8%A8%80/"/>
      <url>/2024/06/10/guancha/%E8%A7%82%E5%AF%9F%E5%BD%95%E5%89%8D%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h1>写在前面</h1><p>这里收集了各式各样的人~明媚的，深沉的，我真诚地想记录下来每一个有趣的灵魂（才不要在时间的长河里抹掉你们的印记），欢迎常来看看我的赛博收集手册~</p><blockquote><p>说不定你就是其中珍贵的一页呢？</p></blockquote><p>这个分类其实想写一些奇幻经历，会慢慢更新哒，包括但不限于一些恐怖故事，害怕的宝宝晚上慎看🍀</p><p>还有一本万言书（希望还有时间以连载的形式更完），颠沛流离的结局兴许不是繁花似锦，但起码不应当被遗忘。机械化的时代太过嘈杂，灵感也会随之枯竭，或许只有事无巨细地刻画下来，忘记的时候才不会那么怅然若失。愿未来某时的你，灵魂尚有余温。</p><p>还有还有，可能会夹杂一些寻人启事，人和人的相遇真的全凭缘分，有些人错过就是错过了，甚至连说再见的机会都没有，想在这里写下我仅存的印象，如果各位或者本人有幸能看到的话还请留下联系方式，这对我很重要，谢谢谢谢！！！</p><p>好像有点多？哈哈，因为这些同等重要💕</p><blockquote><p>声明：本人向来身体健康，精神状态正常</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 人类观猹录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 观猹 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++STL</title>
      <link href="/2024/05/24/shuju/c++STL/"/>
      <url>/2024/05/24/shuju/c++STL/</url>
      
        <content type="html"><![CDATA[<h1>&lt;vector&gt;</h1><p>可变长数组，倍增思想，支持随机访问，不支持任意位置O(1)插入</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; b[<span class="number">233</span>]; <span class="comment">//第一维长233，第二维动态变化</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rec</span>&#123;&#125;;</span><br><span class="line">vector&lt;rec&gt; c;<span class="comment">//自定义结构体</span></span><br></pre></td></tr></table></figure><p>size/empty，clear，push_back/pop_back</p><p>begin/end，容器[)，end返回第n个元素再往后的边界</p><p>front/back，front = *a.bsgin()/a[0]；back = *–a.end()/a[size() - 1]</p><blockquote><p>迭代器：指针</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; ::iterator it;<span class="comment">//保存int的迭代器</span></span><br></pre></td></tr></table></figure></blockquote><h1>&lt;queue&gt;</h1><h2 id="循环队列-queue">循环队列&lt;queue&gt;</h2><p>O(1)，push，pop，front，back</p><h2 id="优先队列-priority-queue">优先队列&lt;priority_queue&gt;</h2><p>较大元素在堆顶</p><table><thead><tr><th>方法</th><th>复杂度</th></tr></thead><tbody><tr><td>push</td><td>O(logn)</td></tr><tr><td>pop</td><td>O(logn)</td></tr><tr><td>top</td><td>O(1)</td></tr></tbody></table><h2 id="重载“-”运算符">重载“&lt;”运算符</h2><p>用于使用自定义的结构体类型</p><h2 id="懒惰删除法">懒惰删除法</h2><p>先给要删除的数打一个标记，等它到堆顶的时候，删除</p><h1>双端队列 &lt;deque&gt;</h1><p>支持随机访问</p><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">复杂度</th></tr></thead><tbody><tr><td style="text-align:center">front/back</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center">push_back</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center">push_front</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center">pop_front</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center">pop_back</td><td style="text-align:center">O(1)</td></tr><tr><td style="text-align:center">clear</td><td style="text-align:center">O(n)</td></tr></tbody></table><h1>头文件&lt;set&gt;</h1><h2 id="set-有序集合">set 有序集合</h2><p>元素不重复</p><h2 id="multiset-有序多重集">multiset 有序多重集</h2><p>元素可重复</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rec</span>&#123;...&#125;;</span><br><span class="line">set rec s;<span class="comment">//必须定义“小于号”运算符</span></span><br><span class="line">multiset&lt;<span class="type">double</span>&gt; s;</span><br></pre></td></tr></table></figure><p>双向迭代器：O(logn)，++指向下一名元素，不支持随机访问，支持<code>*</code>的解除引用</p><p>insert:O(logn)</p><p>find(x):找到x元素，返回指向该元素的迭代器，不存在就返回s.end()</p><p>lower_bound/upper_bound:O(logn)，查找&gt;=x元素中最小/最大的一个</p><p>erase:</p><ul><li>迭代器：删除该迭代器指向的元素O(logn)</li><li>元素：删除所有相同的元素O(logn+k)</li></ul><p>count</p><h1>&lt;map&gt;</h1><p>key-value，以key为关键字的红黑树，key定义“小于号”运算符</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;key_type,vlue_type&gt; name;</span><br></pre></td></tr></table></figure><p>迭代器：双向访问迭代器</p><p>set/empty/clear/begin/end</p><p>insert/erase :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pair&lt;key_type,vlue_type&gt;<span class="comment">//insert</span></span><br><span class="line"></span><br><span class="line">map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; h;</span><br><span class="line">h.<span class="built_in">insert</span>(meak_pair&lt;<span class="number">1</span>,<span class="number">2</span>&gt;),h.<span class="built_in">insert</span>(meak_pair&lt;<span class="number">2</span>,<span class="number">3</span>&gt;);</span><br><span class="line">map&lt;<span class="type">int</span>,<span class="type">int</span>&gt;::iterator it = h.<span class="built_in">begin</span>();</span><br><span class="line">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; p = * it;</span><br><span class="line">h.<span class="built_in">erase</span>(it),h.<span class="built_in">erase</span>(<span class="built_in">meak_pair</span>(<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line">cout &lt;&lt; p.first &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p.second &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>[]操作符：O(logn) h[key],返回key映射的value的引用，可进行赋值操作。若查找的value不存在，则创建一个(ket,zero)。可以先用find查询key的存在性。</p><blockquote><p>zero:广义0值</p></blockquote><h1>&lt;bitset&gt;</h1><p>多位二进制数，8位一字节</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitset&lt;10000&gt; s;<span class="comment">//1000位二进制数</span></span><br></pre></td></tr></table></figure><p>~s：返回对bitsset s按位取反的结果</p><p>&amp;,|,^：位数相同的bitset按位与，或，以或运算</p><p>&gt;&gt;,&lt;&lt;：右移/左移</p><p>==,!=：比较相等</p><p>s[k]：s的第k位，最低位为s[0]</p><p>count：返回有多少位为1</p><p>any/none：s所有位为0，s.none()=true;否则s.any()=true</p><p>set/reset/flip：</p><ul><li>s.set() 所有位置1</li><li>s.set(k,v) s[k] = v</li><li>s.reset(k) 第k位置0</li><li>s.flip(k) 第k位取反</li></ul><h1>&lt;algorithm&gt;</h1><p>用于序列</p><h2 id="reverse-翻转">reverse 翻转</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">reberse</span>(a.<span class="built_in">begin</span>(),a.<span class="built_in">end</span>());<span class="comment">//也可放数组下标</span></span><br></pre></td></tr></table></figure><h2 id="unique-去重">unique 去重</h2><p>返回去重之后末尾元素的下一个位置，用于离散化，指针加减计算去重后的个数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> m = <span class="built_in">unique</span>(a.<span class="built_in">begin</span>(),a.<span class="built_in">end</span>()) - a.<span class="built_in">begin</span>();</span><br></pre></td></tr></table></figure><h2 id="random-shuffle-随机打乱">random_shuffle 随机打乱</h2><p>用法同revsrse</p><h2 id="next-permutation-下一个排列">next_permutation 下一个排列</h2><p>两个指针的区域为一个排列，求这些元素构成的全排列中字典序排在下一个的序列，若不存在，返回false。prev_permutation同理。</p><h2 id="sort-快排">sort 快排</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>,cmp);</span><br></pre></td></tr></table></figure><h2 id="lower-bound-upper-bound-二分">lower_bound/upper_bound 二分</h2><p>lower_bound返回指向&gt;=x的元素位置的迭代器；</p><p>upper_bound返回指向=x的元素位置的迭代器。</p><blockquote><p>两指针指定的部分应该是提前排序好的</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Few-Shot代码</title>
      <link href="/2024/04/24/NER/Few-Shot%E4%BB%A3%E7%A0%81/"/>
      <url>/2024/04/24/NER/Few-Shot%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1>export_model.py 处理数据并转换成ONNX格式存储</h1><h2 id="validate-onnx">validate_onnx()</h2><p>确保将PyTorch模型转换为ONNX格式后，其输出与原始PyTorch模型的输出一致</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validate_onnx(tokenizer: PreTrainedTokenizerBase, pt_model: PreTrainedModel, onnx_path: Union[Path, str], strict: bool = True, atol: float = 1e-05)</span><br></pre></td></tr></table></figure><ol><li>首先，它使用<code>transformers</code>库中的<code>AutoTokenizer</code>来创建一个分词器，并使用它对一些示例文本进行编码，以生成输入张量。</li><li>使用<code>pt_model</code>（预训练的PyTorch模型）对这些输入进行前向传播，得到预测结果。</li><li>将这些结果转换为NumPy数组，以便与ONNX模型的结果进行比较。</li><li>创建一个ONNX Runtime会话（<code>InferenceSession</code>），加载由<code>onnx_path</code>指定的ONNX模型文件。</li><li>将PyTorch模型的输入张量转换为NumPy数组，并使用ONNX模型进行推理，得到ONNX模型的输出结果。</li><li>检查ONNX模型的输出名称是否与PyTorch模型的输出名称相匹配，以确保输出的一致性。</li><li>对每个输出，检查形状和值是否与PyTorch模型的输出相匹配。如果形状或值有任何差异，则抛出异常，否则输出验证通过的信息。</li></ol><h3 id="ONNX格式">ONNX格式</h3><p>ONNX（Open Neural Network Exchange）是一个开放的深度学习模型表示格式，由微软和Facebook共同开发。它旨在成为深度学习框架之间的通用模型表示标准，允许用户在不同的深度学习框架之间轻松迁移模型。</p><p>ONNX格式定义了一种通用的模型表示方法，可以描述神经网络的结构、参数和操作。这种通用性使得用户可以使用一个框架训练模型，然后将其转换为ONNX格式，并在另一个框架中加载和使用它，而无需重新训练模型。</p><h2 id="export-onnx">export_onnx()</h2><p>将预训练的PyTorch模型转换为ONNX格式，并保存为ONNX文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export_onnx(args: argparse.Namespace, tokenizer: PreTrainedTokenizerBase, model: PreTrainedModel, device: torch.device, input_names: List[str], output_names: List[str]):</span><br></pre></td></tr></table></figure><ol><li><code>with torch.no_grad():</code>：进入一个上下文管理器，确保在此范围内的计算不会跟踪梯度，以节省内存并提高性能。</li><li><code>model = model.to(device)</code>：将模型移动到指定的设备（GPU或CPU）上进行推理。</li><li><code>model.eval()</code>：将模型设置为评估模式，这通常会关闭模型中的dropout和batch normalization等层。</li><li><code>model.config.return_dict = True</code>和<code>model.config.use_cache = False</code>：设置模型配置，指示模型返回输出字典，并禁用缓存。</li><li><code>if not args.output_path.exists(): args.output_path.mkdir(parents=True)</code>：检查输出路径是否存在，如果不存在则创建。</li><li><code>dynamic_axes = &#123;name: &#123;0: 'batch', 1: 'sequence'&#125; for name in chain(input_names, output_names)&#125;</code>：创建一个动态轴字典，用于指定输入和输出的动态维度。</li><li>生成虚拟输入数据：<ul><li><code>batch_size</code>和<code>seq_length</code>确定了虚拟输入数据的批次大小和序列长度。</li><li><code>dummy_input</code>是一个包含了未知标记（<code>[UNK]</code>）的虚拟输入序列列表，用于生成模型输入。</li><li>使用tokenizer将虚拟输入数据编码为PyTorch张量。</li></ul></li><li><code>if save_path.exists(): save_path.unlink()</code>：检查是否已存在要保存的ONNX文件，如果存在则删除，以防止覆盖。</li><li><code>torch.onnx.export()</code>：使用<code>torch.onnx.export</code>函数将PyTorch模型转换为ONNX格式。<ul><li>第一个参数是模型对象。</li><li>第二个参数是模型的输入数据，以元组的形式传递。</li><li>第三个参数是要保存的ONNX文件路径。</li><li><code>input_names</code>和<code>output_names</code>分别指定了输入和输出的名称。</li><li><code>dynamic_axes</code>指定了动态维度的名称和位置。</li><li><code>do_constant_folding=True</code>用于执行常量折叠优化。</li><li><code>opset_version=11</code>指定了ONNX的操作集版本。</li></ul></li><li><code>if not os.path.exists(save_path): logger.error(f'Export Failed!')</code>：检查ONNX文件是否成功导出，如果失败则打印错误信息。</li><li>返回保存的ONNX文件路径。</li></ol><h2 id="main">main()</h2><p>执行模型导出和验证的整个流程，并打印成功导出的ONNX模型的路径</p><ol><li><p>解析命令行参数：</p><p>使用<code>argparse</code>库创建一个参数解析器<code>parser</code>。</p><p>添加两个参数：<code>--model_path</code>表示模型参数的路径，<code>--output_path</code>表示模型在静态图中的保存路径，默认为模型参数路径。</p><p>使用<code>parse_args()</code>方法解析命令行参数，得到<code>args</code>对象。</p></li><li><p>设置输出路径：</p><p>如果未提供<code>--output_path</code>参数，则将其设置为与<code>--model_path</code>相同的路径。</p></li><li><p>加载模型和分词器：</p><p>使用<code>BertTokenizer.from_pretrained()</code>方法加载BERT分词器。</p><p>使用<code>UIE.from_pretrained()</code>方法加载UIE模型。</p></li><li><p>设置设备和输入输出名称：</p><p>将设备设置为CPU。</p><p>定义输入和输出名称列表。</p></li><li><p>导出分词器配置：</p><p>调用<code>export_tokenizer()</code>函数导出分词器配置。</p></li><li><p>导出ONNX模型：</p><p>调用<code>export_onnx()</code>函数将模型导出为ONNX格式，并得到导出的ONNX文件的路径。</p></li><li><p>验证导出的ONNX模型：</p><p>调用<code>validate_onnx()</code>函数验证导出的ONNX模型是否正确。</p></li><li><p>打印输出路径：</p><p>打印成功导出的ONNX模型的路径。</p></li></ol><h2 id="export-tokenizer-args">export_tokenizer(args)</h2><p>将预训练分词器的配置文件（tokenizer_config.json）、特殊标记映射文件（special_tokens_map.json）和词汇表文件（vocab.txt）导出到指定路径</p><ol><li><code>for tokenizer_file in ['tokenizer_config.json', 'special_tokens_map.json', 'vocab.txt']:</code>：遍历预定义的文件列表，包括分词器配置文件、特殊标记映射文件和词汇表文件。</li><li><code>file_from = args.model_path / tokenizer_file</code>：构造源文件的路径，使用<code>args.model_path</code>作为根路径，以及遍历的文件名。</li><li><code>file_to = args.output_path / tokenizer_file</code>：构造目标文件的路径，使用<code>args.output_path</code>作为根路径，以及遍历的文件名。</li><li><code>if file_from.resolve() == file_to.resolve(): continue</code>：检查源文件和目标文件是否相同。如果相同，则跳过此次迭代，不进行复制操作。</li><li><code>shutil.copyfile(file_from, file_to)</code>：将源文件复制到目标文件。使用<code>shutil.copyfile()</code>函数完成复制操作。</li></ol><h1><a href="http://finetune.py">finetune.py</a> 训练过程</h1><h2 id="do-train">do_train()</h2><p>实现了模型的训练过程，包括数据准备、模型训练、评估和保存最佳模型</p><ol><li><p>设置随机种子：</p><p>使用<code>set_seed()</code>函数设置随机种子，以确保实验的可重复性。</p></li><li><p>加载分词器和模型：</p><p>使用<code>BertTokenizerFast.from_pretrained()</code>方法加载BERT分词器。</p><p>使用<code>UIE.from_pretrained()</code>方法加载UIE模型。</p></li><li><p>准备训练数据集和验证数据集：</p><p>使用<code>IEDataset</code>类加载训练集和验证集，并进行分词和编码，得到数据加载器。</p></li><li><p>定义优化器和损失函数：</p><p>使用AdamW优化器进行参数优化。</p><p>使用二元交叉熵损失函数计算损失。</p></li><li><p>定义评估指标：</p><p>使用<code>SpanEvaluator()</code>类定义评估指标，用于评估模型性能。</p></li><li><p>如果启用早停机制：</p><p>初始化<code>EarlyStopping</code>对象，设置早停参数，并指定保存路径和日志记录方法。</p></li><li><p>开始训练：</p><p>使用循环迭代训练集数据。</p><p>在每个迭代中，加载一个batch的训练数据。</p><p>将数据移到设备（GPU或CPU）上。</p><p>将数据输入模型进行前向传播，得到输出。</p><p>计算损失并反向传播，更新模型参数。</p><p>计算并记录训练损失。</p><p>每隔一定步数，打印训练信息，并保存模型。</p></li><li><p>在每个一定步数，进行验证：</p><p>加载验证集数据，评估模型性能。</p><p>打印验证结果，并保存性能最好的模型。</p></li><li><p>如果启用了早停机制：</p><p>在每个一定步数，进行验证。</p><p>如果验证损失没有改善，则更新早停计数器。</p><p>如果触发了早停条件，则保存模型并退出训练。</p></li></ol><h3 id="IEDataset（）">IEDataset（）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_ds = IEDataset(args.train_path, tokenizer=tokenizer,</span><br><span class="line">                     max_seq_len=args.max_seq_len)</span><br></pre></td></tr></table></figure><h3 id="SpanEvaluator-跨度评估器">SpanEvaluator() 跨度评估器</h3><p>用于评估信息提取任务中模型性能的评估器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric = SpanEvaluator()</span><br></pre></td></tr></table></figure><h3 id="EarlyStopping">EarlyStopping</h3><p>如果在给定的耐心后验证损失没有改善，则提前停止训练</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">early_stopping = EarlyStopping(</span><br><span class="line">    patience=<span class="number">7</span>, verbose=<span class="literal">True</span>, trace_func=trace_func,</span><br><span class="line">    save_dir=early_stopping_save_dir)</span><br></pre></td></tr></table></figure><h3 id="evaluate">evaluate()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dev_loss_avg, precision, recall, f1 = evaluate(</span><br><span class="line">    model, metric, data_loader=dev_data_loader, device=args.device, loss_fn=criterion)</span><br></pre></td></tr></table></figure><h2 id="do-train-fake">do_train_fake()</h2><p>实现了一个模型的训练过程，其中使用了早停机制</p><ol><li>首先，使用 <code>BertTokenizerFast.from_pretrained</code> 加载一个BERT分词器，并使用 <code>UIE.from_pretrained</code> 加载一个模型。如果设备为GPU，则将模型移至GPU上。</li><li>然后，分别创建训练集和验证集的数据加载器，同时初始化优化器、损失函数和评估指标。</li><li>如果启用了早停机制，则创建一个 <code>EarlyStopping</code> 对象。</li><li>进入训练循环，循环遍历每个epoch和每个batch。在每个batch中，执行模型的前向传播、计算损失、反向传播和优化器更新参数的步骤。</li><li>每隔一定步数（由 <code>args.logging_steps</code> 和 <code>args.valid_steps</code> 控制），执行模型在验证集上的评估，并根据评估结果保存模型。</li><li>如果启用了早停机制，在每个epoch结束时进行验证集的评估，并调用 <code>early_stopping</code> 对象进行早停判断。如果满足早停条件，则保存当前模型并终止训练。</li><li>最后，如果启用了早停机制并且早停触发，程序将保存当前的分词器并终止。</li></ol><h3 id="IEDatasetFake">IEDatasetFake()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_ds = IEDatasetFake(args.train_path, tokenizer=tokenizer, max_seq_len=args.max_seq_len)</span><br></pre></td></tr></table></figure><p>==和do_train()也就是数据集不同的区别==</p><h1><a href="http://utils.py">utils.py</a> 实用程序</h1><h2 id="class-IEDataset-Dataset">class IEDataset(Dataset)</h2><p>定义了一个<code>IEDataset</code>类，用于加载信息提取任务的数据集。该类继承自PyTorch的<code>Dataset</code>类，因此需要实现<code>__init__</code>、<code>__len__</code>和<code>__getitem__</code>方法。</p><ol><li><p><code>__init__(self, file_path, tokenizer, max_seq_len)</code>方法：</p><p>初始化数据集对象。</p><p><code>file_path</code>：数据集文件的路径。</p><p><code>tokenizer</code>：分词器对象，用于对文本进行分词和编码。</p><p><code>max_seq_len</code>：最大序列长度，用于控制输入文本的长度。</p><p>将文件路径、分词器和最大序列长度保存为对象属性。</p><p>使用<code>reader()</code>函数从文件中读取数据，并将其转换为列表</p></li><li><p><code>__len__(self)</code>方法：</p><p>返回数据集的长度，即数据集中样本的数量。</p></li><li><p><code>__getitem__(self, index)</code>方法：</p><p>根据给定的索引，获取数据集中对应位置的样本。</p><p>调用<code>convert_example()</code>函数，将原始数据转换为模型可以接受的格式，并返回转换后的样本。</p></li></ol><h3 id="convert-example">convert_example()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> convert_example(self.dataset[index], tokenizer=self.tokenizer, max_seq_len=self.max_seq_len)</span><br></pre></td></tr></table></figure><h2 id="def-convert-example-example-tokenizer-max-seq-len">def convert_example(example, tokenizer, max_seq_len)</h2><p>将原始样本转换为模型可以接受的格式，包括对文本进行分词和编码，以及构建起始和结束标记</p><ul><li><code>example</code>：原始样本，是一个包含标题、提示、内容和结果列表等字段的字典。</li><li><code>tokenizer</code>：分词器对象，用于对文本进行分词和编码。</li><li><code>max_seq_len</code>：最大序列长度，用于控制输入文本的长度。</li></ul><ol><li>使用分词器对提示和内容进行分词和编码，得到输入的编码序列。使用<code>tokenizer()</code>方法进行处理，设置了截断、最大长度和添加特殊标记等参数。</li><li>获取编码序列中每个字符的偏移量映射，并对其进行处理，将偏移量对齐到编码序列中的位置。</li><li>根据结果列表中的实体位置信息，将编码序列中对应位置的标记设置为起始标记和结束标记。</li><li>构建包含输入编码序列、类型编码序列、注意力掩码、起始标记和结束标记的输出列表。</li><li>对输出列表中的各项进行填充，保证它们的长度都为<code>max_seq_len</code>。</li><li>返回转换后的样本，作为模型的输入。</li></ol><h3 id="map-offset">map_offset()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start = map_offset(item[<span class="string">&quot;start&quot;</span>] + bias, offset_mapping)</span><br></pre></td></tr></table></figure><h2 id="map-offset-ori-offset-offset-mapping">map_offset(ori_offset, offset_mapping)</h2><p>将 ori 偏移量映射到令牌偏移量,在原始文本和令牌序列之间建立起一个映射关系，以便后续处理时能够正确地处理实体的位置信息</p><ol><li>遍历 <code>offset_mapping</code> 中的每个偏移量对，即每个子词的起始和结束位置在原始文本中的偏移量。</li><li>检查 <code>ori_offset</code> 是否落在当前偏移量对所表示的区间内。</li><li>如果 <code>ori_offset</code> 落在了某个区间内，则返回该区间对应的子词在令牌序列中的索引。</li><li>如果 <code>ori_offset</code> 不在任何一个区间内，则返回 -1，表示无法找到对应的子词。</li></ol><ul><li><code>ori_offset</code>：原始文本中的字符偏移量，即原始文本中的字符位置。</li><li><code>offset_mapping</code>：一个包含了每个子词的起始和结束字符在原始文本中的偏移量的列表，这个列表是由分词器生成的。</li></ul><h2 id="class-SpanEvaluator">class SpanEvaluator</h2><p>跨度评估器 计算跨度检测的精度、召回率和 F1 分数</p><h3 id="compute">compute()</h3><p>计算跨度检测的精度、召回率和 F1 分数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, start_probs, end_probs, gold_start_ids, gold_end_ids</span>)</span><br></pre></td></tr></table></figure><h3 id="accumulate">accumulate()</h3><p>返回所有累积小批量的平均精度、召回率和 f1 分数</p><h3 id="get-bool-ids-greater-than">get_bool_ids_greater_than()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pred_start_ids = get_bool_ids_greater_than(start_probs)</span><br></pre></td></tr></table></figure><h3 id="eval-span">eval_span()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[_correct, _infer, _label] = self.eval_span(</span><br><span class="line">    predict_start_ids, predict_end_ids, label_start_ids,</span><br><span class="line">    label_end_ids)</span><br></pre></td></tr></table></figure><h2 id="get-bool-ids-greater-than-2">get_bool_ids_greater_than()</h2><p>获取概率数组中最后一个维度的 idx，该维度大于限制。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_bool_ids_greater_than</span>(<span class="params">probs, limit=<span class="number">0.5</span>, return_prob=<span class="literal">False</span></span>)</span><br></pre></td></tr></table></figure><h2 id="eval-span-2">eval_span()</h2><p>评估位置提取（开始、结束）<br>返回 num_correct、num_infer、num_label<br>输入：[1， 2， 10] [4， 12] [2， 10] [4， 11]<br>输出：（1、2、2）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">eval_span</span>(<span class="params">self, predict_start_ids, predict_end_ids, label_start_ids,label_end_ids</span>)</span><br></pre></td></tr></table></figure><h3 id="get-span">get_span()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pred_set = get_span(predict_start_ids, predict_end_ids)</span><br></pre></td></tr></table></figure><h2 id="get-span-2">get_span()</h2><p>获取概率数组中最后一个维度的 idx，该维度大于限制(不准确)</p><p>将起始位置和结束位置的列表转换为跨度集合，并确保跨度集合中的区间没有重叠√</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_span</span>(<span class="params">start_ids, end_ids, with_prob=<span class="literal">False</span></span>)</span><br></pre></td></tr></table></figure><h2 id="class-EarlyStopping">class EarlyStopping</h2><p>如果在给定的耐心后验证损失没有改善，则提前停止训练，保存最佳模型状态。</p><h3 id="save-checkpoint">save_checkpoint()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.save_checkpoint</span><br></pre></td></tr></table></figure><h2 id="save-checkpoint-self-val-loss-model">save_checkpoint(self, val_loss, model)</h2><p>在验证损失减少时保存模型。</p><h2 id="class-IEDatasetFake-Dataset">class IEDatasetFake(Dataset)</h2><p>从一个假的jsonl文件中读取数据</p><h3 id="convert-example-fake">convert_example_fake()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> convert_example_fake(self.dataset[index], tokenizer=self.tokenizer, max_seq_len=self.max_seq_len)</span><br></pre></td></tr></table></figure><h2 id="convert-example-fake-2">convert_example_fake()</h2><p>将数据集中的每个样本转换为模型输入所需的格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">convert_example_fake</span>(<span class="params">example, tokenizer, max_seq_len</span>):</span><br></pre></td></tr></table></figure><h2 id="convert-example-2">convert_example()</h2><p>将数据集中的每个样本转换为模型输入所需的格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">convert_example</span>(<span class="params">example, tokenizer, max_seq_len</span>):</span><br></pre></td></tr></table></figure><h1><a href="http://evaluate.py">evaluate.py</a> 评估函数</h1><p>eval_base.py 和 <a href="http://evaluate.py">evaluate.py</a> 一样</p><p>@torch.no_grad()装饰器,表示在函数内部不会对梯度进行计算，这样可以节省内存和计算资源。</p><h2 id="evaluate-2">evaluate()</h2><p>给定一个数据集，评估模型并计算指标</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate</span>(<span class="params">model, metric, data_loader, device=<span class="string">&#x27;gpu&#x27;</span>, loss_fn=<span class="literal">None</span>, show_bar=<span class="literal">True</span></span>):</span><br></pre></td></tr></table></figure><h3 id="metric-compute——SpanEvaluator-compute">metric.compute——SpanEvaluator-compute()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_correct, num_infer, num_label = metric.compute(start_prob, end_prob,start_ids, end_ids)</span><br></pre></td></tr></table></figure><h3 id="accumulate-2">accumulate()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">precision, recall, f1 = metric.accumulate()</span><br></pre></td></tr></table></figure><p>给定一个数据集，它评估模型并计算指标。</p><h3 id="参数">参数</h3><p>​        model（obj：‘torch.nn.Module’）：对文本进行分类的模型。<br>​        metric（obj：‘Metric’）：评估指标。<br>​        data_loader（obj：‘torch.utils.data.DataLoader’）：生成批处理的数据集加载器。</p><ol><li>解包当前批次中的数据</li><li>提取开始标签和结束标签的概率预测,转换为torch.float32类型</li><li>计算损失函数</li><li>使用评估指标对象metric的compute方法，计算预测结果的正确数量、总预测数量和总标签数量</li></ol><h2 id="do-eval">do_eval()</h2><ol><li>从args.model_path中加载预训练的BERT模型和相应的tokenizer。UIE.from_pretrained(args.model_path)会加载保存的模型参数。</li><li>如果args.device为’gpu’，则将模型移动到GPU上。</li><li>创建一个IEDataset对象用于加载测试集数据，并将其封装成一个DataLoader对象test_data_loader，用于批处理数据。</li><li>使用SpanEvaluator评估指标初始化metric。</li><li>调用evaluate()函数评估模型在测试集上的性能，得到精确度、召回率和F1分数，并打印出来。</li></ol><h2 id="if-name-“main”">if <strong>name</strong> == “<strong>main</strong>”</h2><ol><li>通过argparse解析传入的参数，其中包括模型路径、测试集路径、批次大小、最大序列长度和设备类型。</li><li>调用do_eval()函数执行评估过程。</li></ol><h1><a href="http://model.py">model.py</a> 模型损失计算</h1><p>model_base.py 和 model.py差不多，模型加载被注释</p><p>二元交叉熵损失函数通常用于二分类任务，其中每个样本只有两个可能的类别。在自然语言处理中，序列标注任务（如命名实体识别、问答任务中的答案抽取等）通常被建模为一个二分类问题，即对每个位置（或标记）进行分类，判断该位置是否为目标实体的起始或结束位置。</p><p>因此，在命名实体识别等任务中，起始位置和结束位置的预测可以视为一个二分类问题，而二元交叉熵损失函数则是用于衡量模型的预测与真实标签之间的差异，是二分类任务中常用的损失函数之一。</p><p>具体来说，二元交叉熵损失函数将模型预测的概率与真实的标签进行比较，如果模型预测正确，则损失接近于零，否则损失较大。通过最小化损失函数，模型可以在训练过程中调整参数，以使得模型的预测更接近于真实标签，从而提高模型的性能。</p><p>因此，在起始位置和结束位置的预测任务中，使用二元交叉熵损失函数是为了使模型能够学习正确地预测实体的起始和结束位置，从而提高模型在序列标注任务中的性能。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kl_loss = use_kl(input_ids,token_type_ids,attention_mask, start_prob, end_prob)</span><br></pre></td></tr></table></figure><h2 id="use-kl">use_kl()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">use_kl</span>(<span class="params">input_ids,token_type_ids,attention_mask, start_prob, end_prob</span>):</span><br></pre></td></tr></table></figure><h1>modeling_layer.py 模型搭建</h1><p>模型搭建过程</p><p>ErnieLayoutModel: ErnieLayout模型的主要实现类。<br>ErnieLayoutPretrainedModel: 预训练的ErnieLayout模型。<br>ErnieLayoutForTokenClassification: 用于标记分类任务的ErnieLayout模型。<br>ErnieLayoutForSequenceClassification: 用于序列分类任务的ErnieLayout模型。<br>ErnieLayoutForPretraining: 用于预训练任务的ErnieLayout模型。<br>ErnieLayoutForQuestionAnswering: 用于问答任务的ErnieLayout模型。</p><h2 id="def-relative-position-bucket">def relative_position_bucket</h2><p>一个整数张量 relative_position 转换为相对注意力的桶号</p><h2 id="class-ErnieLayoutPooler-nn-Module">class ErnieLayoutPooler(nn.Module)</h2><p>池化操作 从模型的隐藏状态中提取汇总特征，以便用于下游任务的输入</p><h2 id="class-ErnieLayoutEmbeddings-nn-Module">class ErnieLayoutEmbeddings(nn.Module)</h2><p>包括来自单词、位置和token_type嵌入的嵌入</p><h2 id="class-ErnieLayoutPretrainedModel-PreTrainedModel">class ErnieLayoutPretrainedModel(PreTrainedModel)</h2><p>用于处理权重初始化，加入梯度检查点技术</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config_class = ErnieLayoutConfig  <span class="comment"># ErnieLayoutConfig 是模型的配置类，用于存储模型的各种参数</span></span><br></pre></td></tr></table></figure><p><img src="../../source/imgs/$%7Bfiilename%7D/image-20240406163003567.png" alt=""></p><p>==飘红，文件夹里面没有这个文件？找不到存储模型各种参数的地方~==</p><p>需要安装外部的包paddle和paddlenlp</p><h2 id="class-ErnieLayoutSelfOutput-nn-Module">class ErnieLayoutSelfOutput(nn.Module)</h2><p>定义了自注意力机制的输出部分</p><h2 id="class-ErnieLayoutSelfAttention-nn-Module">class ErnieLayoutSelfAttention(nn.Module)</h2><h1>stack_finetune.py 对抗匹配</h1><p>stack_finetune1.py和stack_finetune.py一样</p><h2 id="class-EMA-指数移动平均">class EMA() 指数移动平均</h2><h2 id="class-IEDDataset-Dataset">class IEDDataset(Dataset)</h2><p>用于在训练或测试深度学习模型时批量加载数据</p><h2 id="do-train-fake-2">do_train_fake()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">do_train_fake</span>(<span class="params">train_data_loader, dev_data_loader, model</span>)</span><br></pre></td></tr></table></figure><p>初始化相关的工具和参数，包括随机种子、EMA（Exponential Moving Average）对象、FGM（Fast Gradient Method）对象、分词器、优化器、损失函数、评估指标等。</p><p>使用循环迭代训练数据集的每一个epoch。在每个epoch中，使用循环迭代训练数据集的每一个batch。</p><p>对于每个batch，首先将数据传入模型进行前向传播，得到模型的预测结果和损失值。然后根据损失值进行反向传播，更新模型参数。</p><p>在每个epoch的训练过程中，记录并输出训练过程中的损失值和训练速度等信息。</p><p>在每个epoch结束后，进行模型的评估。评估过程包括使用验证集对模型进行评估，并计算评估指标（如精确度、召回率、F1值）。</p><p>根据评估指标的表现，选择是否保存模型。如果评估指标优于之前的最佳指标，则保存当前模型为最佳模型。</p><p>可选地进行早停策略。如果评估指标在一定的连续迭代中没有提升，则停止训练，并保存当前模型。</p><p>这段代码的逻辑比较清晰，主要包括模型的训练和评估过程，以及一些训练过程中的辅助操作，如EMA、FGM和早停策略。</p><p>//增加了EMA和FGM而已</p><h2 id="class-FGM-用于对抗训练，提升鲁棒性">class FGM() 用于对抗训练，提升鲁棒性</h2><p>使用方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fgm.attack()</span><br><span class="line">loss_adv = loss_func(x, lable)</span><br><span class="line">loss_adv.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">fgm.restore()</span><br></pre></td></tr></table></figure><h2 id="stacking-10-折交叉验证">stacking() 10 折交叉验证</h2><h2 id="do-train-2">do_train()</h2><p>//增加了EMA和FGM而已</p><h1>parse_data.py 读取NER数据集</h1><p>从给定的文件路径中读取NER数据集，将其重新解析为指定格式的数据，并将解析后的数据保存到新的文件中。</p><h1><a href="http://predict.py">predict.py</a> 信息提取</h1><ul><li>读取给定文件路径中的原始数据集文件，该文件应该是一个 JSON 格式的文件。</li><li>遍历数据集中的每个样本，并针对每个样本进行信息提取。</li><li>对于每个提取的结果，构造一个字典，包括当前任务的 ID、测试任务的 ID、样本 ID、文本、起始位置、结束位置和类型。</li><li>将所有提取的结果保存到一个新文件中。</li></ul><p>函数 <code>parse_data</code> 接受以下参数：</p><ul><li><code>file_path</code>：原始数据集文件的路径。</li><li><code>current_task</code>：当前任务的 ID。</li><li><code>test_task</code>：测试任务的 ID。</li><li><code>task_name</code>：任务名称，用于从信息提取结果中提取对应任务的信息。</li><li><code>write_name</code>：保存提取结果的文件路径。</li></ul><p>在函数内部，首先读取原始数据集文件，然后遍历其中的每个样本。对于每个样本，调用信息提取函数（假设为 <code>ie</code>）进行提取。提取的结果是一个字典列表，包含提取的文本片段及其位置等信息。然后，将提取的结果转换为指定格式的字典，并添加到 <code>data</code> 列表中。最后，将整个 <code>data</code> 列表保存到指定的文件中。</p><h1>uie_predictor.py</h1><h2 id="class-ONNXInferBackend-object">class ONNXInferBackend(object)</h2><p><img src="../../source/imgs/$%7Bfiilename%7D/image-20240409232724957.png" alt=""></p><p><img src="../../source/imgs/$%7Bfiilename%7D/image-20240409232803101.png" alt=""></p><p>==飘红，文件夹里面没有这个文件？==</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Few-shot代码梳理（粗略版）</title>
      <link href="/2024/04/24/NER/Few-shot%E4%BB%A3%E7%A0%81%E6%A2%B3%E7%90%86/"/>
      <url>/2024/04/24/NER/Few-shot%E4%BB%A3%E7%A0%81%E6%A2%B3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>我理解的关于代码的实现，可能不太准确，其中也有一些疑问：</p><p>运行stack_fintuine1.py实现微调，里面使用了EMA+FGM的模式</p><p>持续学习任务对于半监督数据比较敏感，避免使用半监督学习方式来进行微调，而是采用EMA（Exponential Moving Average）指数移动平均+FGM（Fast Gradient Method）对抗训练的方式。</p><p>通过10折交叉验证的方式对模型进行了训练，获得每个类别训练的最优模型（即F1分数最高的模型），这个模型会作为下一个类别模型蒸馏时使用的教师模型，由此实现类增量。</p><p>教师模型的路径需要指定，指定方式是改变model.py中model=…里面的路径。而model模型本身定义的是一个知识蒸馏的模型（里面计算了知识蒸馏损失即KL散度损失和二元交叉熵损失），这个模型在stack_fintuine1.py中经过反向传播、梯度下降，实现知识蒸馏。</p><p>主要的问题在下面的3.蒸馏代码微调里面，没搞懂这个教师模型具体是如何传递的（在操作部分有标记）</p><h1>原始数据处理为训练格式</h1><h2 id="parse-data-py">parse_data.py</h2><p>将原始数据集处理为id：统一设置成574714 data:即文本 label:[[开始位置, 结束位置, “类型”]]的格式<br>将处理完成的数据保存到{}_ner_train_data.json中<br>因为有6个训练任务 所以执行6次，最后得到6个{}_ner_train_data.json，标号1到6<br>文件夹已经给出处理好后的文件，但是没有原始文件raw_data</p><h2 id="doccano-py"><a href="http://doccano.py">doccano.py</a></h2><p>检查doccano_file文件和保存目录是否存在</p><p>验证数据集分割比例的数量，只接受3个，应该是训练集、验证集、测试集；创建一个函数</p><p>读取原始标注数据，这里的原始标注数据应该是从Doccano中导出的，Doccano是一个开源的文本标注工具，处理文本标注工作</p><p>定义 convert_ext_examples 函数将原始示例 examples 转换为实体（entities）和关系（relations）的格式，并将二者合并起来形成新的examples示例数据列表</p><p>定义 convert_cls_examples 函数将原始示例 examples 转换为适合分类任务的格式。在每个文本样本之间加上前缀，并准备分类标签</p><p>定义_save_examples函数将处理好的数据集保存到指定文件中</p><p>根据任务类别：外部实体识别任务、分类任务调用相应的函数（convert_ext_examples、convert_ext_examples）创建示例，划分数据集</p><p>使用时根据命令行指令<code>python3 doccano.py -d </code></p><p><code>./data/3_ner_train_data.json -save_p trains3.txt</code>这个文件就是将前面得到的<code>&#123;&#125;_ner_train_data.json</code>转成<code>trains.txt</code>形式，在文件<code>data</code>下可以见到相应的文件</p><h1>代码微调</h1><h2 id="从train-base-sh中获取六个任务顺序的第一个模型权重">从train_base.sh中获取六个任务顺序的第一个模型权重</h2><p>训练数据均在<code>../data/user_data/data/test_data</code>下 ，保存模型路径均在<code>../data/user_data/saved_model</code></p><p>训练数据<code>trains1.txt</code> 对应<code>model1---....---   trains6.txt</code>对应<code>model6 </code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行stack_fintuine1.py</span></span><br><span class="line"><span class="comment">#这里的model指定预训练模型为model_base</span></span><br><span class="line">python3 ../data/user_data/stack_fintuine1.py \</span><br><span class="line">    --train_path <span class="string">&quot;../data/user_data/data/test_data/trains1.txt&quot;</span> \</span><br><span class="line">    --dev_path <span class="string">&quot;./dev.txt&quot;</span> \</span><br><span class="line">    --save_dir <span class="string">&quot;../data/user_data/saved_model/model1&quot;</span> \</span><br><span class="line">    --learning_rate <span class="number">1e-5</span> \</span><br><span class="line">    --batch_size <span class="number">4</span> \</span><br><span class="line">    --max_seq_len <span class="number">512</span> \</span><br><span class="line">    --num_epochs <span class="number">2</span> \</span><br><span class="line">    --model <span class="string">&quot;../data/user_data/model_base&quot;</span> \</span><br><span class="line">    --seed <span class="number">1000</span> \</span><br><span class="line">    --logging_steps <span class="number">10</span> \</span><br><span class="line">    --valid_steps <span class="number">25</span> \</span><br><span class="line">    --device <span class="string">&quot;gpu&quot;</span></span><br></pre></td></tr></table></figure><h2 id="stack-fintuine1-py">stack_fintuine1.py</h2><p>微调方式：采用EMA（Exponential Moving Average）指数移动平均+FGM（Fast Gradient Method）对抗训练的方式</p><h3 id="首先定义EMA类">首先定义EMA类</h3><p>在深度学习中，经常会使用EMA（指数移动平均）这个方法对模型的参数做平均，以提高测试指标并增加模型鲁棒。通过使用 EMA，模型的参数会逐渐趋向于一个更稳定的值，有助于防止过拟合，并可能提高模型在未见数据上的表现。</p><p>普通的参数权重相当于一直累积更新整个训练过程的梯度，使用EMA的参数权重相当于使用训练过程梯度的加权平均（刚开始的梯度权值很小）。由于刚开始训练不稳定，得到的梯度给更小的权值更为合理，所以EMA会有效。</p><p>参考：<a href="http://t.csdnimg.cn/UA3qI">http://t.csdnimg.cn/UA3qI</a></p><h3 id="EMA代码实现">EMA代码实现</h3><h4 id="init"><strong>init</strong></h4><p>初始化</p><h4 id="register">register</h4><p>遍历模型的所有参数。<br>对于需要梯度的参数（param.requires_grad 为 True），在 self.shadow 中创建一个条目，并将其初始化为参数当前值的副本。</p><h4 id="update">update</h4><p>更新 self.shadow 中存储的每个参数的 EMA 值。<br>计算新的 EMA 值，使用当前参数值和旧的 EMA 值的加权平均，权重由 1.0 - self.decay 和 self.decay 决定。</p><h4 id="apply-shadow">apply_shadow</h4><p>将 self.shadow 中的 EMA 值应用到模型参数上。<br>同时备份原始参数值到 self.backup 中，以便之后可以恢复。</p><h4 id="restore">restore</h4><p>从 self.backup 中恢复模型的原始参数值。<br>清空 self.backup 字典。</p><h3 id="定义IEDDataset-类">定义IEDDataset 类</h3><p>用于在训练或测试深度学习模型时批量加载数据</p><h3 id="定义do-train-fake-train-data-loader-dev-data-loader-model-函数">定义do_train_fake(train_data_loader, dev_data_loader, model)函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#训练准备，初始化</span></span><br><span class="line">set_seed(args.seed)<span class="comment">#设置随机种子，以确保实验的可重复性。这样可以保证每次运行训练过程时，随机数生成的结果（如数据打乱、权重初始化等）是一致的。</span></span><br><span class="line">show_bar = <span class="literal">True</span></span><br><span class="line">ema = EMA(model, <span class="number">0.999</span>)<span class="comment">#使用EMA，衰减系数定为0.999</span></span><br><span class="line">ema.register()</span><br><span class="line">fgm = FGM(model)<span class="comment">#使用FGM对抗训练</span></span><br><span class="line">tokenizer = BertTokenizerFast.from_pretrained(args.model)</span><br><span class="line">optimizer = torch.optim.AdamW(</span><br><span class="line">    lr=args.learning_rate, params=model.parameters())</span><br><span class="line"></span><br><span class="line">criterion = torch.nn.functional.binary_cross_entropy<span class="comment">#二元交叉熵损失，用于二分类</span></span><br><span class="line">metric = SpanEvaluator()<span class="comment">#评价指标选取SpanEvaluator，用于评估命名实体识别的性能</span></span><br></pre></td></tr></table></figure><h3 id="早停法">早停法</h3><p>当我们训练深度学习神经网络的时候通常希望能获得最好的泛化性能（generalization performance，即可以很好地拟合数据）。但是所有的标准深度学习神经网络结构如全连接多层感知机都很容易过拟合：当网络在训练集上表现越来越好，错误率越来越低的时候，实际上在某一刻，它在测试集的表现已经开始变差。</p><p>早停法基本含义是在训练中计算模型在验证集上的表现，当模型在验证集上的表现开始下降的时候，停止训练，这样就能避免继续训练导致过拟合的问题。其主要步骤如下：</p><ol><li>将原始的训练数据集划分成训练集和验证集</li><li>只在训练集上进行训练，并每个一个周期计算模型在验证集上的误差，例如，每15次epoch（mini batch训练中的一个周期）</li><li>当模型在验证集上的误差比上一次训练结果差的时候停止训练</li><li>使用上一次迭代结果中的参数作为模型的最终参数</li></ol><p>参考：<a href="http://t.csdnimg.cn/OmWyy">http://t.csdnimg.cn/OmWyy</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#早停设置</span></span><br><span class="line"><span class="keyword">if</span> args.early_stopping:</span><br><span class="line">    early_stopping_save_dir = os.path.join(</span><br><span class="line">        args.save_dir, <span class="string">&quot;early_stopping&quot;</span>)<span class="comment">#定义早停机制使用的保存目录。这个目录将存储早停过程中的模型和相关数据。</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(early_stopping_save_dir):</span><br><span class="line">        os.makedirs(early_stopping_save_dir)</span><br><span class="line">    <span class="keyword">if</span> show_bar:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">trace_func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                logger.info(*args, **kwargs)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trace_func = logger.info</span><br><span class="line">    early_stopping = EarlyStopping(</span><br><span class="line">        patience=<span class="number">7</span>, verbose=<span class="literal">True</span>, trace_func=trace_func,<span class="comment">#patience=7: 早停的耐心值，表示在性能不再提升的情况下，训练可以继续进行的额外轮数。</span></span><br><span class="line">        save_dir=early_stopping_save_dir)<span class="comment">#创建一个 EarlyStopping 对象，它将监控验证集上的性能，并在性能不再提升时停止训练。</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#训练循环</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> epoch_iterator:</span><br><span class="line">        train_data_iterator = train_data_loader</span><br><span class="line">        <span class="keyword">if</span> show_bar:</span><br><span class="line">            train_data_iterator = tqdm(train_data_iterator,</span><br><span class="line">                                       desc=<span class="string">f&#x27;Training Epoch <span class="subst">&#123;epoch&#125;</span>&#x27;</span>, unit=<span class="string">&#x27;batch&#x27;</span>)</span><br><span class="line">            train_data_iterator.set_postfix(train_postfix_info)</span><br><span class="line">        <span class="keyword">for</span> batch <span class="keyword">in</span> train_data_iterator:</span><br><span class="line">            <span class="keyword">if</span> show_bar:</span><br><span class="line">                epoch_iterator.refresh()</span><br><span class="line">            input_ids, token_type_ids, att_mask, start_ids, end_ids = batch</span><br><span class="line">            <span class="comment">#for batch in train_data_iterator:</span></span><br><span class="line">            <span class="comment">#从批次中提取数据并根据需要将其移动到 GPU</span></span><br><span class="line">            <span class="comment"># input_ids, token_type_ids, att_mask, start_ids, end_ids = batch</span></span><br><span class="line">            <span class="keyword">if</span> args.device == <span class="string">&#x27;gpu&#x27;</span>:</span><br><span class="line">                input_ids = input_ids.cuda()</span><br><span class="line">                token_type_ids = token_type_ids.cuda()</span><br><span class="line">                att_mask = att_mask.cuda()</span><br><span class="line">                start_ids = start_ids.cuda()</span><br><span class="line">                end_ids = end_ids.cuda()</span><br><span class="line">            <span class="comment">#调用模型进行预测</span></span><br><span class="line">            outputs = model(input_ids=input_ids,</span><br><span class="line">                            token_type_ids=token_type_ids,</span><br><span class="line">                            attention_mask=att_mask,start_positions=start_ids,end_positions=end_ids)</span><br><span class="line">            <span class="comment">#计算损失并进行反向传播</span></span><br><span class="line">            loss, start_prob, end_prob = outputs[<span class="number">0</span>], outputs[<span class="number">1</span>], outputs[<span class="number">2</span>]</span><br><span class="line">            <span class="comment">#print(loss)</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            <span class="comment"># 增加对抗</span></span><br><span class="line">            fgm.attack()</span><br><span class="line">            outputs = model(input_ids=input_ids,</span><br><span class="line">                            token_type_ids=token_type_ids,</span><br><span class="line">                            attention_mask=att_mask, start_positions=start_ids, end_positions=end_ids)</span><br><span class="line">            loss_adv, start_prob, end_prob = outputs[<span class="number">0</span>], outputs[<span class="number">1</span>], outputs[<span class="number">2</span>]</span><br><span class="line">            loss_adv.backward()</span><br><span class="line">            fgm.restore()</span><br><span class="line"></span><br><span class="line">            ema.update() <span class="comment"># 增加ema</span></span><br><span class="line">            optimizer.step()</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            loss_list.append(<span class="built_in">float</span>(loss))</span><br><span class="line">            loss_sum += <span class="built_in">float</span>(loss)</span><br><span class="line">            loss_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> show_bar:</span><br><span class="line">                loss_avg = loss_sum / loss_num</span><br><span class="line">                train_postfix_info.update(&#123;</span><br><span class="line">                    <span class="string">&#x27;loss&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;loss_avg:<span class="number">.5</span>f&#125;</span>&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">                train_data_iterator.set_postfix(train_postfix_info)</span><br><span class="line">            <span class="comment">#每次训练迭代后，全局步骤计数器增加 1</span></span><br><span class="line">            global_step += <span class="number">1</span></span><br><span class="line">            <span class="comment">#日志记录：每隔 args.logging_steps 步，记录一次日志</span></span><br><span class="line">            <span class="keyword">if</span> global_step % args.logging_steps == <span class="number">0</span>:</span><br><span class="line">                time_diff = time.time() - tic_train</span><br><span class="line">                loss_avg = loss_sum / loss_num</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> show_bar:</span><br><span class="line">                    <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                        logger.info(</span><br><span class="line">                            <span class="string">&quot;global step %d, epoch: %d, loss: %.5f, speed: %.2f step/s&quot;</span></span><br><span class="line">                            % (global_step, epoch, loss_avg,</span><br><span class="line">                               args.logging_steps / time_diff))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.info(</span><br><span class="line">                        <span class="string">&quot;global step %d, epoch: %d, loss: %.5f, speed: %.2f step/s&quot;</span></span><br><span class="line">                        % (global_step, epoch, loss_avg,</span><br><span class="line">                           args.logging_steps / time_diff))</span><br><span class="line">                tic_train = time.time()</span><br><span class="line">            <span class="comment">#模型评估与保存</span></span><br><span class="line">            <span class="keyword">if</span> global_step % args.valid_steps == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#每隔 args.valid_steps 步，对模型在验证集上的性能进行评估，并保存模型和分词器的状态。</span></span><br><span class="line">                save_dir = os.path.join(</span><br><span class="line">                    args.save_dir, <span class="string">&quot;model_%d&quot;</span> % global_step)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_dir):</span><br><span class="line">                    os.makedirs(save_dir)</span><br><span class="line">                model_to_save = model</span><br><span class="line">                model_to_save.save_pretrained(save_dir)</span><br><span class="line">                tokenizer.save_pretrained(save_dir)</span><br><span class="line">                <span class="comment">#删除一些旧的模型</span></span><br><span class="line">                <span class="keyword">if</span> args.max_model_num:</span><br><span class="line">                    model_to_delete = global_step-args.max_model_num*args.valid_steps</span><br><span class="line">                    model_to_delete_path = os.path.join(</span><br><span class="line">                        args.save_dir, <span class="string">&quot;model_%d&quot;</span> % model_to_delete)</span><br><span class="line">                    <span class="keyword">if</span> model_to_delete &gt; <span class="number">0</span> <span class="keyword">and</span> os.path.exists(model_to_delete_path):</span><br><span class="line">                        shutil.rmtree(model_to_delete_path)</span><br><span class="line">                <span class="comment">#应用EMA的参数</span></span><br><span class="line">                ema.apply_shadow()</span><br><span class="line">                <span class="comment">#评估模型性能</span></span><br><span class="line">                dev_loss_avg, precision, recall, f1 = evaluate(</span><br><span class="line">                    model, metric, data_loader=dev_data_loader, device=args.device, loss_fn=criterion)</span><br><span class="line">                ema.restore()</span><br><span class="line">                <span class="keyword">if</span> show_bar:</span><br><span class="line">                    train_postfix_info.update(&#123;</span><br><span class="line">                        <span class="string">&#x27;F1&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;f1:<span class="number">.3</span>f&#125;</span>&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;dev loss&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;dev_loss_avg:<span class="number">.5</span>f&#125;</span>&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    train_data_iterator.set_postfix(train_postfix_info)</span><br><span class="line">                    <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                        logger.info(<span class="string">&quot;Evaluation precision: %.5f, recall: %.5f, F1: %.5f, dev loss: %.5f&quot;</span></span><br><span class="line">                                    % (precision, recall, f1, dev_loss_avg))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.info(<span class="string">&quot;Evaluation precision: %.5f, recall: %.5f, F1: %.5f, dev loss: %.5f&quot;</span></span><br><span class="line">                                % (precision, recall, f1, dev_loss_avg))</span><br><span class="line">                <span class="comment"># Save model which has best F1，如果当前模型在 F1 分数上超过了之前的最佳模型，则保存为最佳模型</span></span><br><span class="line">                <span class="keyword">if</span> f1 &gt; best_f1:</span><br><span class="line">                    <span class="keyword">if</span> show_bar:</span><br><span class="line">                        <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                            logger.info(</span><br><span class="line">                                <span class="string">f&quot;best F1 performence has been updated: <span class="subst">&#123;best_f1:<span class="number">.5</span>f&#125;</span> --&gt; <span class="subst">&#123;f1:<span class="number">.5</span>f&#125;</span>&quot;</span></span><br><span class="line">                            )</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        logger.info(</span><br><span class="line">                            <span class="string">f&quot;best F1 performence has been updated: <span class="subst">&#123;best_f1:<span class="number">.5</span>f&#125;</span> --&gt; <span class="subst">&#123;f1:<span class="number">.5</span>f&#125;</span>&quot;</span></span><br><span class="line">                        )</span><br><span class="line">                    best_f1 = f1</span><br><span class="line">                    save_dir = os.path.join(args.save_dir, <span class="string">&quot;model_best&quot;</span>)</span><br><span class="line">                    model_to_save = model</span><br><span class="line">                    model_to_save.save_pretrained(save_dir)</span><br><span class="line">                    tokenizer.save_pretrained(save_dir)</span><br><span class="line">                tic_train = time.time()</span><br><span class="line">        <span class="comment">#检查是否使用了早停</span></span><br><span class="line">        <span class="keyword">if</span> args.early_stopping:</span><br><span class="line">            <span class="comment">#评估模型性能</span></span><br><span class="line">            dev_loss_avg, precision, recall, f1 = evaluate(</span><br><span class="line">                model, metric, data_loader=dev_data_loader, device=args.device, loss_fn=criterion)</span><br><span class="line">            <span class="comment">#更新进度条</span></span><br><span class="line">            <span class="keyword">if</span> show_bar:</span><br><span class="line">                train_postfix_info.update(&#123;</span><br><span class="line">                    <span class="string">&#x27;F1&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;f1:<span class="number">.3</span>f&#125;</span>&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;dev loss&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;dev_loss_avg:<span class="number">.5</span>f&#125;</span>&#x27;</span></span><br><span class="line">                &#125;)</span><br><span class="line">                train_data_iterator.set_postfix(train_postfix_info)</span><br><span class="line">                <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                    logger.info(<span class="string">&quot;Evaluation precision: %.5f, recall: %.5f, F1: %.5f, dev loss: %.5f&quot;</span></span><br><span class="line">                                % (precision, recall, f1, dev_loss_avg))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                logger.info(<span class="string">&quot;Evaluation precision: %.5f, recall: %.5f, F1: %.5f, dev loss: %.5f&quot;</span></span><br><span class="line">                            % (precision, recall, f1, dev_loss_avg))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Early Stopping</span></span><br><span class="line">            early_stopping(dev_loss_avg, model)<span class="comment">#前面的早停设置过程中设置过</span></span><br><span class="line">            <span class="keyword">if</span> early_stopping.early_stop:</span><br><span class="line">                <span class="keyword">if</span> show_bar:</span><br><span class="line">                    <span class="keyword">with</span> logging_redirect_tqdm([logger.logger]):</span><br><span class="line">                        logger.info(<span class="string">&quot;Early stopping&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.info(<span class="string">&quot;Early stopping&quot;</span>)</span><br><span class="line">                tokenizer.save_pretrained(early_stopping_save_dir)</span><br><span class="line">                <span class="comment">#早停机制触发，退出训练过程</span></span><br><span class="line">                sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="定义FGM类">定义FGM类</h3><p>FGM代码实现<br><strong>init</strong><br>初始化<br>attack<br>对模型的嵌入层参数进行扰动，生成对抗样本<br>restore<br>恢复模型原始的参数数据，为下一次做准备</p><p>参考：</p><p><a href="https://zhuanlan.zhihu.com/p/91269728?utm_id=0">https://zhuanlan.zhihu.com/p/91269728?utm_id=0</a><br><a href="https://allenwind.github.io/blog/12833/">https://allenwind.github.io/blog/12833/</a></p><h3 id="定义stacking函数，实现10-折交叉验证（注释里写的）">定义stacking函数，实现10 折交叉验证（注释里写的）</h3><h4 id="10折交叉验证">10折交叉验证</h4><p>是常用的精度测试方法.将数据集分成十分，轮流将其中9份做训练1份做测试，10次的结果的均值作为对算法精度的估计</p><p>==但是kf = KFold(5, shuffle=True, random_state=789)里面设置为5，所以应该是5折交叉验证？==</p><p>在代码 <code>kf = KFold(5, shuffle=True, random_state=789)</code> 中，参数 <code>5</code> 表示将数据集分成5个折叠（或者称为“分组”），以进行10折交叉验证。这里的10折交叉验证指的是在每个折叠中，数据集被分成训练集和验证集，其中80%的数据用于训练，20%的数据用于验证。在整个过程中，每个模型都会被训练10次，每次使用不同的验证集进行验证。这有助于对模型的性能进行更全面的评估，并且可以减少由于数据集划分不同而引起的偶然性。</p><h4 id="KFold函数参数说明">KFold函数参数说明</h4><p>n_splits： 默认为3，表示将数据划分为多少份，即k折交叉验证中的k；</p><p>shuffle： 默认为False，表示是否需要打乱顺序，这个参数在很多的函数中都会涉及，如果设置为True，则会先打乱顺序再做划分，如果为False，会直接按照顺序做划分；</p><p>random_state： 默认为None，表示随机数的种子，只有当shuffle设置为True的时候才会生效。</p><h3 id="定义do-train函数">定义do_train函数</h3><p>设计与do_train_fake差不多，没有使用EMA</p><p>这样做的原因可能是在训练初期，使用 EMA 可以帮助模型更快地收敛，并减少训练过程中的波动，在模型已经相对稳定后，使用 FGM 进行对抗训练可以进一步增强模型对输入扰动的鲁棒性？</p><p>不过再这个文件里最后好像没有用上这个函数</p><h1>蒸馏代码微调</h1><p>1.根据持续学习的顺序 修改 train_path  以及save_dir  以及teacher模型路径：…/data/user_data/model.py第153行的路径</p><p>2.以第一序列为例 学习顺序为1-2-3-4-5-6，因为上述已经训练了任务1  所以此命令为蒸馏并得到2，3，4，5，6</p><p>3.加载任务2的训练数据（<code>--train_path ../data/user_data/data/test_data/train2.txt</code>）</p><p>将其保存到model1下为model2（<code>--save_dir &quot;../data/user_data/saved_model/model1/model2&quot;</code>）</p><p>修改<code>../data/user_data/model.py</code>第153行的蒸馏teacher路径为<code>../data/user_data/saved_model/model1/model_best</code></p><p>（注意 teacher模型的路径会发生变化）</p><p>4.完成任务2后 加载任务3的训练数据（<code>--train_path ../data/user_data/data/test_data/train3.txt</code>），</p><p>将其保存到model1下为model3（<code>--save_dir &quot;../data/user_data/saved_model/model1/model3&quot;</code>）</p><p>修改<code>../data/user_data/model.py</code>第153行的蒸馏teacher路径为<code>../data/user_data/saved_model/model1/model2/model_best </code></p><p>（注意 teacher模型的路径也会对应save_dir变化）</p><p>5、如果为其他序列均保存到其对应到例如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">序列1： --save_dir &quot;../data/user_data/saved_model/model1/model2  </span><br><span class="line">序列2：--save_dir &quot;../data/user_data/saved_model/model2/model4  </span><br><span class="line">    --train_path &quot;../data/user_data/data/test_data/train2.txt&quot; \  </span><br><span class="line">    --dev_path &quot;./dev.txt&quot; \  </span><br><span class="line">    --save_dir &quot;../data/user_data/saved_model/model1/model2&quot; \  </span><br><span class="line">    --learning_rate 1e-5 \  </span><br><span class="line">    --batch_size 4 \  </span><br><span class="line">    --max_seq_len 512 \  </span><br><span class="line">    --num_epochs 2 \  </span><br><span class="line">    --model &quot;../data/user_data/model_base&quot; \  不知道为什么这里设置的是model_base，前面又修改的是model.py里的路径，不过model_base也没有设置teacher模型路径</span><br><span class="line">    --seed 1000 \  </span><br><span class="line">    --logging_steps 10 \  </span><br><span class="line">    --valid_steps 25 \  </span><br><span class="line">    --device &quot;gpu&quot;  </span><br></pre></td></tr></table></figure><h2 id="model-py"><a href="http://model.py">model.py</a></h2><h2 id="定义UIEModelOutput类">定义UIEModelOutput类</h2><p>继承自ModelOutput类，扩展模型输出的结构</p><h2 id="定义了UIE类">定义了UIE类</h2><p>继承自BertPreTrainedModel类</p><h3 id="init："><strong>init</strong>：</h3><p>初始化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(config, <span class="string">&#x27;use_task_id&#x27;</span>) <span class="keyword">and</span> config.use_task_id</span><br></pre></td></tr></table></figure><p>如果配置中包含 use_task_id 并且为 True，则添加任务类型嵌入（task type embeddings）到 BERT 的词嵌入层中</p><p>//为 BERT 模型添加任务类型嵌入</p><h3 id="hook">hook()</h3><p>这个函数是一个前向钩子（forward hook），用于在模型的前向传播过程中动态地修改词嵌入层的输出</p><p>使用 task_type_embeddings 层生成任务类型嵌入。这里通过调用 torch.zeros 创建一个与输入张量形状相同的零张量，并将其转换为整数类型（dtype=torch.int64），然后指定设备（device=input.device）以确保嵌入与输入张量在同一设备上（CPU 或 GPU）。</p><p>将生成的任务类型嵌入加到原始的词嵌入输出上（return output+task_type_embeddings(…)），从而修改 BERT 模型的词嵌入层输出</p><p>==感觉这里是初始化嵌入序列？==</p><p>Emmm……感觉是把前一层的输出加到后一层的输入上（可以参考Attentionm模型），model_layer.py的ErnieLayoutEmbeddings类是初始化词嵌入序列？</p><h3 id="forward">forward</h3><p>定义初始参数，fake_: Optional[torch.Tensor]=None</p><p>==这里是伪标签？==</p><p>差不多，应该是合成数据的意思感觉，假的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">input_ids：输入文本的token IDs。</span><br><span class="line">token_type_ids：用于区分文本片段的token类型 IDs。</span><br><span class="line">position_ids：位置 IDs，用于标识每个token的位置。</span><br><span class="line">attention_mask：注意力掩码，用于指示哪些token是padding的。</span><br><span class="line">head_mask：用于遮蔽模型中的注意力头部。</span><br><span class="line">inputs_embeds：可选的输入嵌入。</span><br><span class="line">start_positions：开始位置的标签，用于训练序列标注任务。</span><br><span class="line">end_positions：结束位置的标签，用于训练序列标注任务。</span><br><span class="line">fake_：一个可选的张量，用于指示哪些token是假的。</span><br><span class="line">output_attentions：是否返回注意力权重。</span><br><span class="line">output_hidden_states：是否返回隐藏状态。</span><br><span class="line">return_dict：是否返回输出结果的字典形式。</span><br><span class="line">comput_kl：是否计算KL散度。</span><br></pre></td></tr></table></figure><p>定义模型输出</p><p>计算损失函数：total_loss由二元交叉熵损失和知识蒸馏损失共同构成</p><p>最后根据return_dict参数的值，返回模型的输出</p><p>如果return_dict为True，则返回一个UIEModelOutput实例，否则返回一个包含开始概率、结束概率和其他编码器输出的元组，如果计算了损失，则将损失值添加到输出中</p><h3 id="定义模型，并将模型迁移到设备上">定义模型，并将模型迁移到设备上</h3><p>这里就是上面提到的第153行，教师模型的路径</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = UIE.from_pretrained(<span class="string">&quot;../data/user_data/saved_model/model1/model_best&quot;</span>)</span><br><span class="line">model.to(<span class="string">&quot;cuda&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="定义KL损失函数：use-kl">定义KL损失函数：use_kl</h3><p>直接将teacher模型的输出概率与当前模型的概率做KL计算</p><h3 id="定义focal-loss类">定义focal_loss类</h3><p>Focal Loss 是一种用于解决类别不平衡问题的损失函数，它通过减少对易分类样本的关注，增加对难分类样本的关注，从而提高模型对少数类别的识别能力</p><h1>模型预测</h1><h2 id="predict-py"><a href="http://predict.py">predict.py</a></h2><p>(序列1 任务1)python3 <a href="http://predict.py">predict.py</a> --file_path “1_ner_test.json” --task_name 0 --write_name “./data/res_data1/1_1_ner_results.json” --current_task 1 --test_task 1 --model_path “./saved_model/model1/model_best”<br>参数说明：–file_path   需要预测的json文件存放在 raw_data下的（1_ner_test.json,2_ner_test.json…）<br>–task_name   任务的prompt ,index of list: [“装甲车辆”, “火炮”, “导弹”, “舰船舰艇”, “炸弹”, “太空装备”]  range(6)<br>–write_name  预测结果的存放位置以（./data/res_data1/1_1_ner_results.json）(1_1_ner_results.json以 （current_task下划线test_task） 为前缀<br>注意序列1 存放在res_data1,序列2存放在 res_data2<br>–current_task 目前刚学完任务的id<br>–test_task    测试样本所属任务的id<br>–model_path 预训练好的模型权重例如（序列一的任务一：./saved_model/model1/model_best<br>序列一的任务二：./saved_model/model1/model2/model_best<br>序列2任务1：./saved_model/model2/model1/model_best<br>序列2任务2：./saved_model/model2/model_best）</p><p>这里定义了一个parse_data函数</p><p>它的作用是从一个 JSON 文件中解析数据，并根据特定的任务名称（task_name）提取相关信息，然后将这些信息转换为一个新的格式并写入到另一个文件中<br>在最后调用了UIEPredictor，从uie_predictor.py中获取，是一个预测器</p><h1>合并预测结果为提交格式</h1><h2 id="demo-py"><a href="http://demo.py">demo.py</a></h2><p>定义了一个 <code>to_format_sub</code> 函数，它的作用是将某个目录下的所有 JSON 结果文件合并成一个统一格式的 JSON 文件<br>也就是将预测结果保存到<code>res_data</code>下，在data文件下一个示例{}1_ner_results.json</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning_O代码梳理</title>
      <link href="/2024/03/18/NER/Learing_o/"/>
      <url>/2024/03/18/NER/Learing_o/</url>
      
        <content type="html"><![CDATA[<h1>主函数</h1><h2 id="创建解释器，添加命令行参数">创建解释器，添加命令行参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(...)</span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure><h2 id="设置随机数种子以及每个任务包含的的标签数量">设置随机数种子以及每个任务包含的的标签数量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set_seed(args)</span><br><span class="line">per_types = args.per_types</span><br></pre></td></tr></table></figure><h2 id="持续学习">持续学习</h2><p>迭代每个任务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> step_id <span class="keyword">in</span> <span class="built_in">range</span>(args.start_step, args.nb_tasks)</span><br></pre></td></tr></table></figure><p>获取当前任务的标签集，标签数量和 PAD ids。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">labels = get_labels_dy(args.labels, per_types, step_id=step_id)</span><br><span class="line">num_labels = <span class="built_in">len</span>(labels)</span><br><span class="line">pad_token_label_id = CrossEntropyLoss().ignore_index</span><br></pre></td></tr></table></figure><p>设置 model_name_or_path</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果是第一轮，则加载 bert-base-uncased 模型</span></span><br><span class="line"><span class="keyword">if</span> step_id == <span class="number">0</span>:</span><br><span class="line">    model_name_or_path = <span class="string">&quot;bert-base-uncased&quot;</span> </span><br><span class="line"><span class="keyword">else</span>: <span class="comment"># 否则加载上一轮模型</span></span><br><span class="line">    model_name_or_path = os.path.join(args.output_dir, <span class="string">&quot;task_&quot;</span> + <span class="built_in">str</span>(step_id - <span class="number">1</span>))      </span><br></pre></td></tr></table></figure><p>训练和评价模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_and_eval(args, labels, num_labels, pad_token_label_id, model_name_or_path,output_dir, data_dir, step_id)</span><br></pre></td></tr></table></figure><h1>准备数据集</h1><h2 id="read-examples-from-file">read_examples_from_file()</h2><h2 id="convert-examples-to-features">convert_examples_to_features()</h2><h2 id="load-and-cache-examples">load_and_cache_examples()</h2><h3 id="从文件中加载样本特征">从文件中加载样本特征</h3><p>如果 cached_features_file 存在，则直接从该文件中加载特征</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">features = torch.load(cached_features_file)</span><br></pre></td></tr></table></figure><p>否则先处理原始数据，再加载特征</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">examples = read_examples_from_file(data_dir, mode)</span><br><span class="line">features = convert_examples_to_features(...)</span><br></pre></td></tr></table></figure><h3 id="提取features的属性并构建数据集">提取features的属性并构建数据集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">all_input_ids = torch.tensor([f.input_ids <span class="keyword">for</span> f <span class="keyword">in</span> features], dtype=torch.long)</span><br><span class="line">all_input_mask = torch.tensor([f.input_mask <span class="keyword">for</span> f <span class="keyword">in</span> features], dtype=torch.long)</span><br><span class="line">all_segment_ids = torch.tensor([f.segment_ids <span class="keyword">for</span> f <span class="keyword">in</span> features], dtype=torch.long)</span><br><span class="line">all_label_ids = torch.tensor([f.label_ids <span class="keyword">for</span> f <span class="keyword">in</span> features], dtype=torch.long)</span><br><span class="line">dataset = TensorDataset(all_input_ids, all_input_mask, all_segment_ids, all_label_ids)</span><br></pre></td></tr></table></figure><h3 id="返回该数据集">返回该数据集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> dataset</span><br></pre></td></tr></table></figure><h1>工具函数</h1><h2 id="get-exemplar-means">get_exemplar_means()</h2><p><strong>计算每个类别的原型，即均值向量</strong></p><h3 id="1-将每个样本按标签分类">1. 将每个样本按标签分类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建了一个字典，包含了所有可能的类别索引，每个类别对应一个空列表</span></span><br><span class="line">cls_exemplar = &#123;cls: [] <span class="keyword">for</span> cls <span class="keyword">in</span> <span class="built_in">range</span>(n_tags)&#125;  。</span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(support_reps, support_labels):</span><br><span class="line">    <span class="comment"># 将每个样本按照标签分类存储在cls_exemplar字典中</span></span><br><span class="line">    cls_exemplar[y.item()].append(x)</span><br></pre></td></tr></table></figure><h3 id="计算每个类别的原型">计算每个类别的原型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> cls, exemplar <span class="keyword">in</span> cls_exemplar.items():</span><br><span class="line">    features = []</span><br><span class="line">    <span class="keyword">for</span> feature <span class="keyword">in</span> exemplar:</span><br><span class="line">        feature.data = feature.data / feature.data.norm()  <span class="comment"># Normalize  </span></span><br><span class="line">        features.append(feature)</span><br><span class="line">        <span class="comment"># 如果当前类别下没有样本，则随机初始化一个与样本表示reps大小相同的张量作为该类别的原型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(features) == <span class="number">0</span>:</span><br><span class="line">            mu_y = torch.normal(<span class="number">0</span>, <span class="number">1</span>, size=<span class="built_in">tuple</span>(x.size())).to(args.device)</span><br><span class="line">            mu_y = mu_y.squeeze()  </span><br><span class="line">        <span class="comment"># 如果有，则计算当前类别的所有样本的reps的均值作为原型</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            features = torch.stack(features) </span><br><span class="line">            mu_y = features.mean(<span class="number">0</span>).squeeze()</span><br><span class="line">        mu_y.data = mu_y.data / mu_y.data.norm()  <span class="comment"># Normalize  </span></span><br><span class="line">        exemplar_means[cls] = mu_y</span><br></pre></td></tr></table></figure><h3 id="返回包含每个类别原型的列表">返回包含每个类别原型的列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> exemplar_means</span><br></pre></td></tr></table></figure><h2 id="get-support-encodings-and-labels-total">get_support_encodings_and_labels(_total)()</h2><p><strong>获取支持集的encodings和labels</strong></p><h3 id="获取train-loader，support-loader，support-o-loader中的encodings和labels">获取train_loader，support_loader，support_o_loader中的encodings和labels</h3><p>获取train_loader中每个批次的encodings和labels(仅get_support_encodings_and_labels_total)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">train_iterator = tqdm(train_loader, desc=<span class="string">&quot;Support data representations&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> index, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_iterator):</span><br><span class="line">    encodings, labels = get_token_encodings_and_labels(args, model, batch)</span><br><span class="line">    encodings = encodings.view(-<span class="number">1</span>, encodings.shape[-<span class="number">1</span>])</span><br><span class="line">    labels = labels.flatten()</span><br><span class="line">    <span class="comment"># 过滤掉标签为填充标记的部分</span></span><br><span class="line">    idx = torch.where((labels - pad_token_label_id) != <span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">    support_encodings.append(encodings[idx])</span><br><span class="line">    support_labels.append(labels[idx])</span><br></pre></td></tr></table></figure><p>同样的操作获取support_loader和support_o_loader中每个批次的encodings和labels</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">support_iterator = tqdm(support_loader, desc=<span class="string">&quot;Support data representations&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> index, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(support_iterator):</span><br><span class="line">        ...</span><br><span class="line">support_o_iterator = tqdm(support_o_loader, desc=<span class="string">&quot;Support data representations&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(support_o_iterator):</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><h3 id="返回所有的encodings和labels">返回所有的encodings和labels</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> torch.cat(support_encodings), torch.cat(support_labels)</span><br></pre></td></tr></table></figure><h2 id="get-token-logits-and-labels">get_token_logits_and_labels</h2><p><strong>使用原有的预训练BERT-NER模型获取预测分数和输出标签</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    inputs = &#123;<span class="string">&quot;input_ids&quot;</span>: batch[<span class="number">0</span>], <span class="string">&quot;attention_mask&quot;</span>: batch[<span class="number">1</span>], </span><br><span class="line">                <span class="string">&quot;output_hidden_states&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;dev&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> model.config.model_type != <span class="string">&quot;distilbert&quot;</span>:</span><br><span class="line">        inputs[<span class="string">&quot;token_type_ids&quot;</span>] = (batch[<span class="number">2</span>] <span class="keyword">if</span> model.config.model_type <span class="keyword">in</span> [<span class="string">&quot;bert&quot;</span>, <span class="string">&quot;xlnet&quot;</span>] </span><br><span class="line">                                    <span class="keyword">else</span> <span class="literal">None</span>)  <span class="comment"># XLM and RoBERTa don&quot;t use token_type_ids</span></span><br><span class="line">        outputs = model(**inputs)</span><br><span class="line">        logits = outputs[-<span class="number">1</span>] </span><br><span class="line"><span class="keyword">return</span> logits, label_batch</span><br></pre></td></tr></table></figure><h2 id="get-rehearsal-prototype">get_rehearsal_prototype()</h2><h3 id="加载支持集以及它们的encodings和labels">加载支持集以及它们的encodings和labels</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">support_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;memory&quot;</span>, data_dir=data_dir)</span><br><span class="line">support_o_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;memory_o&quot;</span>, data_dir=data_dir)</span><br><span class="line">support_sampler = SequentialSampler(support_dataset)</span><br><span class="line">support_dataloader = DataLoader(support_dataset, sampler=support_sampler, batch_size=args.eval_batch_size)</span><br><span class="line">support_o_dataloader = DataLoader(support_o_dataset, sampler=support_o_sampler, batch_size=args.eval_batch_size)</span><br><span class="line">support_encodings, support_labels = get_support_features_and_labels(args, model, support_dataloader, support_o_dataloader, pad_token_label_id)</span><br><span class="line"><span class="comment"># 将support_encodings归一化</span></span><br><span class="line">support_encodings = F.normalize(support_encodings)</span><br></pre></td></tr></table></figure><h3 id="计算类别相似度">计算类别相似度</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(labels)):  <span class="comment"># 迭代每个非&quot;O&quot;标签的类别</span></span><br><span class="line">    <span class="comment"># 计算类别i的样本之间的余弦相似度</span></span><br><span class="line">    support_reps_dists = torch.matmul(support_encodings[support_labels == i],</span><br><span class="line">                                          support_encodings[support_labels == i].T)</span><br><span class="line">    <span class="comment"># 将对角线上的元素（样本与自身的相似度）设置为0，以避免将自身视为原型。</span></span><br><span class="line">    support_reps_dists = torch.scatter(support_reps_dists, <span class="number">1</span>, torch.arange(support_reps_dists.shape[<span class="number">0</span>]).view(-<span class="number">1</span>, <span class="number">1</span>).to(args.device),<span class="number">0.</span>)</span><br><span class="line">    <span class="comment"># 计算类别i的类别相似度</span></span><br><span class="line">    prototype_dists.append(support_reps_dists[support_reps_dists &gt; <span class="number">0</span>].view(-<span class="number">1</span>).mean(-<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h3 id="返回类别相似度列表">返回类别相似度列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> prototype_dists</span><br></pre></td></tr></table></figure><h1>定义模型</h1><h2 id="MySftBertModel">MySftBertModel()</h2><h3 id="初始化-init">初始化 init</h3><p>接受Bert配置参数以及其他自定义参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.per_types = per_types  <span class="comment"># 设置每轮任务的类型数量。</span></span><br><span class="line">self.feat_dim = feat_dim  <span class="comment"># 设置特征维度。</span></span><br><span class="line">self.hidden_size = config.hidden_size  <span class="comment"># 设置隐藏状态的大小。</span></span><br><span class="line">self.num_labels = config.num_labels  <span class="comment"># 设置标签数量。</span></span><br><span class="line">self.bert = BertModel(config, add_pooling_layer=<span class="literal">False</span>) </span><br></pre></td></tr></table></figure><p>设置了分类器(classifier)和投影头(head)，根据mode选择性地设置分类器的输出层。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">classifier_dropout = (  <span class="comment"># 设置分类器的dropout概率</span></span><br><span class="line">            config.classifier_dropout <span class="keyword">if</span> config.classifier_dropout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> config.hidden_dropout_prob</span><br><span class="line">        )</span><br><span class="line"><span class="keyword">if</span> mode == <span class="string">&quot;train&quot;</span>:  <span class="comment"># 根据不同模式设置线性分类器的不同输出维度</span></span><br><span class="line">    <span class="keyword">if</span> self.num_labels-<span class="number">1</span> &gt; self.per_types:  <span class="comment"># 对“O”样本重新标记过</span></span><br><span class="line">        self.classifier = nn.Linear(config.hidden_size, config.num_labels - self.per_types)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.classifier = nn.Linear(config.hidden_size, config.num_labels)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self.classifier = nn.Linear(config.hidden_size, config.num_labels)</span><br></pre></td></tr></table></figure><p>设置不同的head（线性层或多层感知机）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> head == <span class="string">&#x27;linear&#x27;</span>:</span><br><span class="line">   self.head = nn.Linear(self.hidden_size, self.hidden_size)</span><br><span class="line"><span class="keyword">elif</span> head == <span class="string">&#x27;mlp&#x27;</span>:</span><br><span class="line">    self.head = nn.Sequential(</span><br><span class="line">        nn.Linear(self.hidden_size, self.hidden_size),</span><br><span class="line">        nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">        nn.Linear(self.hidden_size, self.feat_dim)</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">&#x27;head not supported: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(head))</span><br></pre></td></tr></table></figure><h3 id="前向传播-forward">前向传播 forward</h3><p><strong>提取特征</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调用原有的Bert模型初步提取出样本的特征</span></span><br><span class="line">outputs = self.bert(...)</span><br><span class="line">features_enc = outputs[<span class="number">0</span>]   </span><br><span class="line"><span class="comment"># 通过self.head对进一步提取出样本的特征并归一化。</span></span><br><span class="line">features = F.normalize(self.head(features_enc.view(-<span class="number">1</span>, self.hidden_size)), dim=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 使用初步特征进行预测</span></span><br><span class="line">sequence_output = outputs[<span class="number">0</span>]</span><br><span class="line">sequence_output = self.dropout(sequence_output)</span><br><span class="line">logits = self.classifier(sequence_output)</span><br></pre></td></tr></table></figure><p>如果不是训练模式，直接返回features_enc，features，logits</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loss = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> mode != <span class="string">&quot;train&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> loss, features_enc, features, logits</span><br></pre></td></tr></table></figure><p><strong>计算损失函数</strong><br>如果是第一轮训练</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> self.num_labels-<span class="number">1</span> == self.per_types:  </span><br><span class="line">    <span class="keyword">if</span> loss_name == <span class="string">&quot;supcon&quot;</span>:         loss = supcon_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o&quot;</span>:     loss = supcon_o_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o_ce&quot;</span>:  loss = supcon_o_loss+ce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o_bce&quot;</span>: loss = supcon_o_loss + bce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;ce&quot;</span>:           loss = ce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;bce_o&quot;</span>:        loss = bce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_ce&quot;</span>:    loss = supcon_loss + ce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_bce&quot;</span>:   loss = supcon_loss + bce_loss</span><br></pre></td></tr></table></figure><p>如果不是第一轮训练</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> self.num_labels &gt; self.per_types: </span><br><span class="line">    <span class="comment"># 整理新类别标签labels_new，新类别样本的logits：student_new 以及</span></span><br><span class="line">    <span class="comment"># 旧类别样本的logits：s_logits，teacher模型的logits：old_logits</span></span><br><span class="line">    labels_new, student_new, s_logits, old_logits = gather_rh_ce( labels, t_logits, </span><br><span class="line">                                            logits, self.num_labels - self.per_types)</span><br><span class="line">    <span class="keyword">if</span> loss_name == <span class="string">&quot;supcon&quot;</span>:        loss = supcon_loss+kd_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_nokd&quot;</span>: loss = supcon_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o&quot;</span>:    loss = supcon_o_loss+kd_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o_ce&quot;</span>: loss = supcon_o_loss+ce_loss+kd_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_o_bce&quot;</span>:loss = supcon_o_loss + bce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;ce&quot;</span>:          loss = ce_loss+kd_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;bce_o&quot;</span>:       loss = bce_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_ce&quot;</span>:   loss = supcon_loss+ce_loss+kd_loss</span><br><span class="line">    <span class="keyword">elif</span> loss_name == <span class="string">&quot;supcon_bce&quot;</span>:  loss = supcon_loss+bce_loss</span><br></pre></td></tr></table></figure><h3 id="3-返回-loss-features-enc-features-logits">3. 返回 loss, features_enc, features, logits</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> loss, features_enc, features, logits</span><br></pre></td></tr></table></figure><h1>训练和评估模型</h1><h2 id="train-and-eval">train_and_eval( )</h2><h3 id="加载上一轮预训练的参数配置、模型和分词器">加载上一轮预训练的参数配置、模型和分词器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建模型配置、模型类别和分词器类</span></span><br><span class="line">config_class, model_class, tokenizer_class = MODEL_CLASSES[args.model_type]</span><br><span class="line"><span class="comment"># 如果是第一轮，则直接加载 bert-base-uncased 模型</span></span><br><span class="line">config = config_class.from_pretrained(args.config_name <span class="keyword">if</span> args.config_name <span class="keyword">else</span> model_name_or_path，num_labels=num_labels)</span><br><span class="line">tokenizer = tokenizer_class.from_pretrained(args.tokenizer_name <span class="keyword">if</span> args.tokenizer_name <span class="keyword">else</span> model_name_or_path,do_lower_case=args.do_lower_case)</span><br><span class="line">model = model_class.from_pretrained(model_name_or_path, from_tf=<span class="built_in">bool</span>(<span class="string">&quot;.ckpt&quot;</span> <span class="keyword">in</span> model_name_or_path),config=config)</span><br></pre></td></tr></table></figure><h3 id="获取训练集">获取训练集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train_dataset=TensorDataset(all_input_ids, all_input_mask, all_segment_ids, all_label_ids)</span></span><br><span class="line">train_dataset=load_and_cache_examples(args,tokenizer,labels,pad_token_label_id,mode=<span class="string">&quot;rehearsal&quot;</span>,data_dir=data_dir)</span><br><span class="line"><span class="comment"># 顺序采样</span></span><br><span class="line">train_sampler = SequentialSampler(train_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(train_dataset)</span><br><span class="line"><span class="comment"># 创建训练数据加载器</span></span><br><span class="line">train_dataloader = DataLoader(train_dataset, sampler=train_sampler, batch_size=args.train_batch_size)  </span><br></pre></td></tr></table></figure><h3 id="获取旧模型的特征">获取旧模型的特征</h3><p><strong>teacher_evaluate()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果当前不是第一个任务，则需要对老师模型进行评估。</span></span><br><span class="line"><span class="keyword">if</span> step_id &gt; <span class="number">0</span>: </span><br><span class="line">    t_logits, out_new_labels = teacher_evaluate(args, train_dataloader, model, tokenizer,labels,</span><br><span class="line">                                                pad_token_label_id, mode=<span class="string">&quot;train&quot;</span>, data_dir=data_dir)</span><br><span class="line">    model.new_classifier()  <span class="comment"># 创建一个新的分类器</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    t_logits = <span class="literal">None</span></span><br><span class="line">    out_new_labels = <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="训练模型">训练模型</h3><p><strong>train()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">global_step, tr_loss = train(args, train_dataset, train_dataloader, model, tokenizer, labels,</span><br><span class="line">                                pad_token_label_id, data_dir=data_dir, output_dir=output_dir,</span><br><span class="line">                                t_logits=t_logits, out_new_labels=out_new_labels)</span><br><span class="line"><span class="comment"># 保存训练过程中得到的模型参数、配置和分词器    </span></span><br><span class="line">model_to_save.save_pretrained(output_dir)</span><br><span class="line">tokenizer.save_pretrained(output_dir)</span><br><span class="line">torch.save(args, os.path.join(output_dir, <span class="string">&quot;training_args.bin&quot;</span>))                            </span><br></pre></td></tr></table></figure><h3 id="在开发集上评估模型">在开发集上评估模型</h3><p><strong>evaluate()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于每个检查点，加载模型并进行评估</span></span><br><span class="line"><span class="keyword">for</span> checkpoint <span class="keyword">in</span> checkpoints:</span><br><span class="line">    model = model_class.from_pretrained(checkpoint, mode=<span class="string">&quot;dev&quot;</span>)</span><br><span class="line">    train_dataloader=<span class="literal">None</span></span><br><span class="line">     _, result,  _ = evaluate(args, model, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;dev&quot;</span>,</span><br><span class="line">                            data_dir=data_dir, prefix=global_step)</span><br></pre></td></tr></table></figure><h3 id="在测试集上进行预测">在测试集上进行预测</h3><p><strong>evaluate()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载模型和分词器</span></span><br><span class="line">tokenizer = tokenizer_class.from_pretrained(output_dir, do_lower_case=args.do_lower_case)</span><br><span class="line">model = model_class.from_pretrained(output_dir, mode=<span class="string">&quot;test&quot;</span>)</span><br><span class="line"><span class="comment"># 调用 evaluate 函数对测试集进行预测，获取macro-F1和micro-F1结果以及预测的标签。</span></span><br><span class="line">macro_results, micro_results, predictions = evaluate(args, model, tokenizer, labels,</span><br><span class="line">                                                    pad_token_label_id, mode=<span class="string">&quot;test&quot;</span>, data_dir=data_dir)</span><br></pre></td></tr></table></figure><h2 id="teacher-evaluate">teacher_evaluate()</h2><h3 id="根据不同模式设置数据集加载器">根据不同模式设置数据集加载器</h3><p>如果模式是 “train”，，则使用训练数集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> mode == <span class="string">&quot;train&quot;</span>:</span><br><span class="line">    eval_dataloader = train_dataloader</span><br></pre></td></tr></table></figure><p>如果模式是 “dev”，则使用开发集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> mode == <span class="string">&quot;dev&quot;</span>:</span><br><span class="line">    eval_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=mode,data_dir=data_dir)</span><br><span class="line">    eval_sampler = SequentialSampler(eval_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(eval_dataset)</span><br><span class="line">    eval_dataloader = DataLoader(eval_dataset, sampler=eval_sampler, batch_size=args.eval_batch_size)</span><br></pre></td></tr></table></figure><h3 id="评估模型">评估模型</h3><p>将模型设置为评估模式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure><p>使用 get_token_logits_and_labels 函数获取每个batch的预测分数 logits 和输出标签 out_labels</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> tqdm(eval_dataloader, desc=<span class="string">&quot;Evaluating&quot;</span>):</span><br><span class="line">    logits, out_labels = get_token_logits_and_labels(args, model, batch)</span><br><span class="line">    <span class="comment"># 对评估步骤计数，以便跟踪已评估的批次数量</span></span><br><span class="line">    nb_eval_steps += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 将每个批次的 logits 分数添加到 logits_list 列表中</span></span><br><span class="line">    logits_list.append(logits.detach().cpu())</span><br></pre></td></tr></table></figure><h3 id="用原型重新标记阈值重新标记旧实体类">用原型重新标记阈值重新标记旧实体类</h3><p>计算原型重新标记阈值和与每个样本的原型相似度最高的实体类别<br><strong>evaluate()</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算每个批次样本中原型相似度最大值所在的类别索引 preds</span></span><br><span class="line"><span class="comment"># 每个批次样本与每个类别的原型相似度的最大值 emissions</span></span><br><span class="line"><span class="comment"># 根据原有模型预测的标签索引序列 out_label_ids</span></span><br><span class="line"><span class="comment"># 每个旧类别的原型重新标记阈值列表（还未乘βi）prototype_dists</span></span><br><span class="line">preds, emissions, out_label_ids, prototype_dists = evaluate(args, model, tokenizer, labels, pad_token_label_id, </span><br><span class="line">                                                        mode=<span class="string">&quot;rehearsal&quot;</span>, data_dir=data_dir)</span><br><span class="line"><span class="comment"># 计算原型重新标记阈值 (根据不同的任务步骤i来调整超参数βi)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(current_task_id):</span><br><span class="line">    <span class="keyword">if</span> args.change_th:</span><br><span class="line">        task_para = th_para - (current_task_id - i - <span class="number">1</span>)*th_reduction  <span class="comment"># βi</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        task_para = th_para</span><br><span class="line">        prototype_dists[i*args.per_types+<span class="number">1</span>:(i+<span class="number">1</span>)*args.per_types+<span class="number">1</span>] *= task_para</span><br></pre></td></tr></table></figure><p>重新标记旧实体类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(out_label_ids.shape[<span class="number">0</span>]):  <span class="comment"># 迭代每个batch  </span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(out_label_ids.shape[<span class="number">1</span>]):  <span class="comment"># 迭代每个样本  </span></span><br><span class="line">        idx = preds[i][j]   <span class="comment"># 根据原型相似度预测的类别索引</span></span><br><span class="line">        <span class="comment"># 如果原型的相似度大于重新标记阈值并且预测的标签是旧实体类的标签</span></span><br><span class="line">        <span class="keyword">if</span> emissions[i][j] &gt; prototype_dists[idx].item() <span class="keyword">and</span> out_label_ids[i][j] &lt; <span class="built_in">len</span>(labels) - args.per_types: </span><br><span class="line">                out_label_new_list[i].append(preds[i][j])  <span class="comment"># 则将该“O”预测为这个旧实体类  </span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 否则，保持原始的标签不变</span></span><br><span class="line">            out_label_new_list[i].append(out_label_ids[i][j])</span><br></pre></td></tr></table></figure><h3 id="返回-logits-list-out-label-new-list">返回 logits_list, out_label_new_list</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> logits_list, out_label_new_list</span><br></pre></td></tr></table></figure><h2 id="evaluate">evaluate ()</h2><h3 id="读取数据集">读取数据集</h3><p>读取eval_dataset，support_dataset，support_o_dataset，train_dataset。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">eval_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=mode, data_dir=data_dir)</span><br><span class="line">support_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;memory&quot;</span>, data_dir=data_dir)</span><br><span class="line">support_o_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;memory_o&quot;</span>, data_dir=data_dir)</span><br><span class="line">train_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;train&quot;</span>, data_dir=data_dir)</span><br><span class="line"><span class="comment"># 顺序采样</span></span><br><span class="line">eval_sampler = SequentialSampler(eval_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(eval_dataset)</span><br><span class="line">eval_dataloader = DataLoader(eval_dataset, sampler=eval_sampler, batch_size=args.eval_batch_size)</span><br><span class="line">support_sampler = SequentialSampler(support_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(support_dataset)</span><br><span class="line">support_o_sampler = SequentialSampler(support_o_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(support_o_dataset)</span><br><span class="line">train_sampler = SequentialSampler(train_dataset) <span class="keyword">if</span> args.local_rank == -<span class="number">1</span> <span class="keyword">else</span> DistributedSampler(train_dataset)</span><br><span class="line"><span class="comment"># 数据集加载器</span></span><br><span class="line">support_dataloader = DataLoader(support_dataset, sampler=support_sampler, batch_size=args.eval_batch_size)</span><br><span class="line">support_o_dataloader = DataLoader(support_o_dataset, sampler=support_o_sampler, batch_size=args.eval_batch_size)</span><br><span class="line">train_dataloader = DataLoader(train_dataset, sampler=train_sampler, batch_size=args.eval_batch_size)</span><br></pre></td></tr></table></figure><h3 id="获取支持数据集的embbedings和labels">获取支持数据集的embbedings和labels</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">support_encodings, support_labels = get_support_encodings_and_labels_total(args, model, support_dataloader, support_o_dataloader, train_dataloader, pad_token_label_id)</span><br></pre></td></tr></table></figure><h3 id="三种重新标记来自旧类别的“O”的策略">三种重新标记来自旧类别的“O”的策略</h3><h4 id="使用原型重新标记">使用原型重新标记</h4><p>基于“O”样本与原型之间的距离<br><strong>计算每个类别的原型</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exemplar_means = get_exemplar_means(args, support_encodings, support_labels)</span><br></pre></td></tr></table></figure><p><strong>计算原型重新标记阈值以及“O”与原型的最高相似度</strong></p><p>利用 NNClassification() 计算nn_preds，nn_emissions，prototype_dists</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(eval_iterator):</span><br><span class="line">    batch = <span class="built_in">tuple</span>(t.to(args.device) <span class="keyword">for</span> t <span class="keyword">in</span> batch)</span><br><span class="line">    <span class="comment"># 循环迭代 eval_iterator，使用原有的模型获取每个批次的encodings和labels</span></span><br><span class="line">    encodings, encoding_labels = get_token_encodings_and_labels(args, model, batch)</span><br><span class="line">    <span class="comment"># 如果是rehearsal模式，则去除掉当前task样本的support_encodings和support_labels再进行预测。</span></span><br><span class="line">    <span class="keyword">if</span> mode==<span class="string">&quot;rehearsal&quot;</span>:</span><br><span class="line">        cls = NNClassification()</span><br><span class="line">        support_encodings = support_encodings[support_labels &lt; <span class="built_in">len</span>(labels) - args.per_types]</span><br><span class="line">        support_labels = support_labels[support_labels &lt; <span class="built_in">len</span>(labels) - args.per_types]</span><br><span class="line">        nn_preds(batch_size, sent_len) 包含每个样本中原型相似度最大值所在的类别索引</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        nn_preds(batch_size, sent_len) 包含每个样本中原型相似度最大值所在的类别索引</span></span><br><span class="line"><span class="string">        nn_emissions(batch_size, sent_len, ndim) 包含每个样本与每个类别的原型相似度的最大值</span></span><br><span class="line"><span class="string">        prototype_dists 每个旧类别的原型重新标记阈值列表（还未乘βi）</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        nn_preds, nn_emissions, prototype_dists = cls.nn_classifier_dot_prototype(encodings, support_encodings, support_labels, exemplar_means)</span><br></pre></td></tr></table></figure><h4 id="使用最近邻重新标记">使用最近邻重新标记</h4><p>基于“O”样本与每个类别示例之间的距离</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> args.cls_name == <span class="string">&quot;ncm_dot&quot;</span>:  </span><br><span class="line">    cls = NcmClassification()</span><br><span class="line">    nn_preds = cls.ncm_classifier_dot(encodings, support_encodings, support_labels, exemplar_means)</span><br></pre></td></tr></table></figure><h4 id="使用原有模型重新标记">使用原有模型重新标记</h4><p>作为前两种方法的参考标注</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> args.cls_name == <span class="string">&quot;linear&quot;</span>:</span><br><span class="line">    nn_preds, encoding_labels = get_token_logits_and_labels(args, model, batch)</span><br></pre></td></tr></table></figure><h3 id="保存预测结果">保存预测结果</h3><p>将每个批次的预测结果追加到 preds 中，并将作为参考标准的预测标签保存到 out_label_ids 中。如果当前模式是rehearsal模式，还会保存emissions。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> preds <span class="keyword">is</span> <span class="literal">None</span>: <span class="comment"># 第一次预测</span></span><br><span class="line">    preds = nn_preds.detach().cpu().numpy()</span><br><span class="line">    out_label_ids = encoding_labels.detach().cpu().numpy()</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;rehearsal&quot;</span>:</span><br><span class="line">        emissions = nn_emissions.detach().cpu().numpy()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    preds = np.append(preds, nn_preds.detach().cpu().numpy(), axis=<span class="number">0</span>)</span><br><span class="line">    out_label_ids = np.append(out_label_ids, encoding_labels.detach().cpu().numpy(), axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;rehearsal&quot;</span>:</span><br><span class="line">        emissions = np.append(emissions, nn_emissions.detach().cpu().numpy(), axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="预测结果">预测结果</h3><p>如果当前模式是rehearsal模式，那么函数直接将返回 preds、 emissions、out_label_ids 和prototype_dists。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> mode == <span class="string">&quot;rehearsal&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> preds, emissions, out_label_ids, prototype_dists</span><br></pre></td></tr></table></figure><p>如果使用的是线性分类器，根据 preds 得出预测的最大logits？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> args.cls_name == <span class="string">&quot;linear&quot;</span>:</span><br><span class="line">    preds = np.argmax(preds, axis=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>out_label_list 和 preds_list存储使用原有模型和使用自定义方法预测的标签字符串序列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 label_map 字典，将标签的索引映射到相应标签的字符串名称。</span></span><br><span class="line">label_map = &#123;i: <span class="string">&quot;I-&quot;</span>+label <span class="keyword">for</span> i, label <span class="keyword">in</span> <span class="built_in">enumerate</span>(labels)&#125;</span><br><span class="line">label_map[<span class="number">0</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(out_label_ids.shape[<span class="number">0</span>]):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(out_label_ids.shape[<span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">if</span> out_label_ids[i, j] != pad_token_label_id:</span><br><span class="line">            out_label_list[i].append(label_map[out_label_ids[i][j]])</span><br><span class="line">            preds_list[i].append(label_map[preds[i][j]])</span><br></pre></td></tr></table></figure><p>输出评价指标结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 seqeval 库计算 F1-score。</span></span><br><span class="line">metric = load_metric(<span class="string">&quot;seqeval&quot;</span>)</span><br><span class="line">metric.add_batch(predictions=preds_list, references=out_label_list)</span><br><span class="line">macro_results, micro_results, _ = compute_metrics(metric)</span><br></pre></td></tr></table></figure><p>返回评价指标结果以及预测的标签序列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> macro_results, micro_results, preds_list</span><br></pre></td></tr></table></figure><h2 id="train">train()</h2><h3 id="计算训练总步数t-total和训练轮数num-train-epochs">计算训练总步数t_total和训练轮数num_train_epochs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果设置了训练最大步数max_steps，则t_total = args.max_steps，并计算num_train_epochs，否则根据num_train_epochs计算t_total。</span></span><br><span class="line"><span class="keyword">if</span> args.max_steps &gt; <span class="number">0</span>:</span><br><span class="line">    t_total = args.max_steps</span><br><span class="line">    args.num_train_epochs = args.max_steps // (<span class="built_in">len</span>(train_dataloader) // args.gradient_accumulation_steps) + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    t_total = <span class="built_in">len</span>(train_dataloader) // args.gradient_accumulation_steps * args.num_train_epochs</span><br></pre></td></tr></table></figure><h3 id="配置优化器">配置优化器</h3><p>使用AdamW优化器，使用了。权重衰减和学习率调节器。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">no_decay = [<span class="string">&quot;bias&quot;</span>, <span class="string">&quot;LayerNorm.weight&quot;</span>]  <span class="comment"># 不需要衰减的参数</span></span><br><span class="line">optimizer_grouped_parameters = [</span><br><span class="line">    &#123;<span class="string">&quot;params&quot;</span>: [p <span class="keyword">for</span> n, p <span class="keyword">in</span> model.named_parameters() <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(nd <span class="keyword">in</span> n <span class="keyword">for</span> nd <span class="keyword">in</span> no_decay)],</span><br><span class="line">    <span class="string">&quot;weight_decay&quot;</span>: args.weight_decay&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;params&quot;</span>: [p <span class="keyword">for</span> n, p <span class="keyword">in</span> model.named_parameters() <span class="keyword">if</span> <span class="built_in">any</span>(nd <span class="keyword">in</span> n <span class="keyword">for</span> nd <span class="keyword">in</span> no_decay)], <span class="string">&quot;weight_decay&quot;</span>: <span class="number">0.0</span>&#125;</span><br><span class="line">]</span><br><span class="line">optimizer = AdamW(optimizer_grouped_parameters, lr=args.learning_rate, eps=args.adam_epsilon)</span><br><span class="line">scheduler = get_linear_schedule_with_warmup(optimizer, num_warmup_steps=args.warmup_steps, num_training_steps=t_total)</span><br></pre></td></tr></table></figure><h3 id="训练">训练</h3><p>迭代每一轮</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> train_iterator:</span><br><span class="line">    <span class="keyword">if</span> epoch &gt;= args.start_train_o_epoch:</span><br></pre></td></tr></table></figure><p>获取每个类别的类别相似度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prototype_dists = get_rehearsal_prototype(args, model, tokenizer, labels,</span><br><span class="line">                                   pad_token_label_id, mode=<span class="string">&quot;rehearsal&quot;</span>,</span><br><span class="line">                                   data_dir=data_dir)</span><br></pre></td></tr></table></figure><p>获取样本的logits和标签</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按批次遍历训练集中的数据</span></span><br><span class="line"><span class="keyword">for</span> step, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(epoch_iterator):</span><br><span class="line">    model.train()  <span class="comment"># 将模型切换到训练模式</span></span><br><span class="line">    <span class="keyword">if</span> num_labels-<span class="number">1</span> &gt; args.per_types:  <span class="comment"># 如果不是第一轮训练</span></span><br><span class="line">        t_logits_step = t_logits[step]</span><br><span class="line">        new_labels = out_new_labels[step * args.train_batch_size:step * args.train_batch_size + <span class="built_in">len</span>(batch[<span class="number">3</span>])]</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 如果是第一轮训练，使用训练集的原始标签</span></span><br><span class="line">        t_logits_step = <span class="literal">None</span></span><br><span class="line">        new_labels = batch[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">if</span> epoch &gt;= args.start_train_o_epoch:</span><br><span class="line">        loss_name = args.loss_name2  <span class="comment"># 实体和“O”的联合损失函数</span></span><br><span class="line">        cls = NNClassification()</span><br><span class="line">        encodings, encoding_labels = get_token_features_and_labels(args, model, batch)</span><br></pre></td></tr></table></figure><p>计算样本之间的余弦相似度分数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    # top_emissions_step(batch_size*set_len, batch_size*set_len):存储样本之间大于实体阈值的余弦相似度分数</span><br><span class="line">    # 选择类别相似度的中位数作为实体阈值 th_dists</span><br><span class="line">    top_emissions_step, _ = cls.get_top_emissions_with_th(encodings, encoding_labels, </span><br><span class="line">                                                        th_dists=torch.median(prototype_dists).item())</span><br><span class="line">else:</span><br><span class="line">    top_emissions_step = top_emissions</span><br></pre></td></tr></table></figure><p>用自定义的模型进行训练，获取损失值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">inputs = &#123;<span class="string">&quot;input_ids&quot;</span>: batch[<span class="number">0</span>],  </span><br><span class="line">        <span class="string">&quot;attention_mask&quot;</span>: batch[<span class="number">1</span>],  </span><br><span class="line">        <span class="string">&quot;token_type_ids&quot;</span>: batch[<span class="number">2</span>] <span class="keyword">if</span> args.model_type <span class="keyword">in</span> [<span class="string">&quot;bert&quot;</span>, <span class="string">&quot;xlnet&quot;</span>] <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">        <span class="comment"># XLM and RoBERTa don&quot;t use segment_ids</span></span><br><span class="line">        <span class="string">&quot;labels&quot;</span>: new_labels,  </span><br><span class="line">        <span class="string">&quot;t_logits&quot;</span>: t_logits_step,  </span><br><span class="line">        <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;train&quot;</span>,  </span><br><span class="line">        <span class="string">&quot;loss_name&quot;</span>: loss_name,  </span><br><span class="line">        <span class="string">&quot;top_emissions&quot;</span>: top_emissions_step,</span><br><span class="line">        <span class="string">&quot;topk_th&quot;</span>: <span class="literal">True</span>  </span><br><span class="line">        &#125;</span><br><span class="line">outputs = model(**inputs)  </span><br><span class="line">loss = outputs[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 如果设置了梯度累积步数，则需要对损失值进行除以梯度累积步数，以得到平均损失值</span></span><br><span class="line"><span class="keyword">if</span> args.gradient_accumulation_steps &gt; <span class="number">1</span>:</span><br><span class="line">    loss = loss / args.gradient_accumulation_steps</span><br></pre></td></tr></table></figure><p>更新参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">loss.backward()  <span class="comment"># 后向传播</span></span><br><span class="line">tr_loss += loss.item()</span><br><span class="line"><span class="comment"># 如果达到梯度累计步数</span></span><br><span class="line"><span class="keyword">if</span> (step + <span class="number">1</span>) % args.gradient_accumulation_steps == <span class="number">0</span>:</span><br><span class="line">    torch.nn.utils.clip_grad_norm_(model.parameters(), args.max_grad_norm) </span><br><span class="line">    optimizer.step()  </span><br><span class="line">    scheduler.step()  </span><br><span class="line">    optimizer.zero_grad()  <span class="comment"># 清除优化器中所有参数的梯度</span></span><br><span class="line">    global_step += <span class="number">1</span>  <span class="comment"># 更新全局步数</span></span><br></pre></td></tr></table></figure><h3 id="评估">评估</h3><p>在开发集上评估模型性能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_, results, _ = evaluate(args, model, tokenizer, labels, pad_token_label_id, mode=<span class="string">&quot;dev&quot;</span>,</span><br><span class="line">                                     data_dir=data_dir)</span><br></pre></td></tr></table></figure><p>保存模型及参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model_to_save.save_pretrained(output_dir)</span><br><span class="line">torch.save(args, os.path.join(output_dir, <span class="string">&quot;training_args.bin&quot;</span>)) </span><br></pre></td></tr></table></figure><p>达到最大步数时停止训练</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if args.max_steps &gt; 0 and global_step &gt; args.max_steps:  </span><br><span class="line">    epoch_iterator.close()  # 关闭当前的 epoch 迭代器</span><br><span class="line">    break</span><br></pre></td></tr></table></figure><h3 id="返回全局步数和平均损失">返回全局步数和平均损失</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> global_step, tr_loss / global_step  </span><br></pre></td></tr></table></figure><h1>分类器</h1><h2 id="NNClassification">NNClassification()</h2><h3 id="nn-classifier-dot-prototype">nn_classifier_dot_prototype()</h3><p><strong>根据原型进行重新标记来自旧实体类别的“O”</strong><br>计算“O”与每个类别原型的最大相似度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将输入的表示 reps 重塑为二维张量，并对其进行归一化处理。</span></span><br><span class="line">feature = reps.view(-<span class="number">1</span>, reps.shape[-<span class="number">1</span>])  <span class="comment"># (batch_size, ndim)</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(feature.size(<span class="number">0</span>)):  <span class="comment"># Normalize</span></span><br><span class="line">    feature.data[j] = feature.data[j] / feature.data[j].norm()</span><br><span class="line">    means = torch.stack([exemplar_means[cls] <span class="keyword">for</span> cls <span class="keyword">in</span> <span class="built_in">range</span>(n_tags)])  <span class="comment"># (n_classes, ndim)</span></span><br><span class="line">    dists = torch.matmul(feature, means.T)  <span class="comment"># (batch_size, n_classes)</span></span><br><span class="line">    dists[:, <span class="number">0</span>] = torch.zeros(<span class="number">1</span>).to(reps.device)  <span class="comment"># 将第一列真正的“O” 类别的相似度设为0</span></span><br><span class="line">    <span class="comment"># emissions 包含每个样本中原型相似度的最大值，tags 包含每个样本中原型相似度最大值所在的类别索引。</span></span><br><span class="line">    emissions, tags = dists.<span class="built_in">max</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>计算每个类别的原型重新标记阈值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将support_reps 重塑为二维张量，并对其进行归一化处理。</span></span><br><span class="line">support_reps = support_reps.view(-<span class="number">1</span>, support_reps.shape[-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(support_reps.size(<span class="number">0</span>)):  <span class="comment"># Normalize</span></span><br><span class="line">    support_reps.data[j] = support_reps.data[j] / support_reps.data[j].norm()</span><br><span class="line">support_reps = F.normalize(support_reps)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_tags):</span><br><span class="line">    <span class="comment"># 计算每个类别原型与支持集中对应类别的样本的相似度</span></span><br><span class="line">    support_reps_dists = torch.matmul(support_reps[support_tags==i], means[i].T)</span><br><span class="line">    <span class="comment"># 沿着最后一个维度（即特征维度）寻找最小值，并返回这些最小值以及对应的索引</span></span><br><span class="line">    prototype_dists.append(support_reps_dists.<span class="built_in">min</span>(-<span class="number">1</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h3 id="get-top-emissions-with-th">get_top_emissions_with_th()</h3><p>计算样本之间的余弦相似度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scores = self._euclidean_metric_dot_2(reps.view(-<span class="number">1</span>, ndim), reps.view(-<span class="number">1</span>, ndim), <span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># 排除“O”样本的分数（第二维）</span></span><br><span class="line">        scores = torch.where(reps_labels == <span class="number">0</span>, scores.double(), -<span class="number">100.</span>)  </span><br><span class="line">        <span class="comment"># 排除样本与自身的分数</span></span><br><span class="line">        scores = torch.scatter(scores, <span class="number">1</span>,</span><br><span class="line">                               torch.arange(scores.shape[<span class="number">0</span>]).view(-<span class="number">1</span>, <span class="number">1</span>).to(device), -<span class="number">100.</span>)</span><br></pre></td></tr></table></figure><p>筛选出大于实体阈值的分数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_emissions = scores &gt; th_dists</span><br></pre></td></tr></table></figure><p>返回 top_emissions, scores</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> top_emissions, scores</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning_O说明文档</title>
      <link href="/2024/03/18/NER/O%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/"/>
      <url>/2024/03/18/NER/O%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<p>整理自：<a href="https://siljing.github.io/2024/07/21/%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/">J</a></p><h1>概述</h1><h2 id="工具函数">工具函数</h2><table><thead><tr><th>功能</th><th>类/函数</th><th>描述</th></tr></thead><tbody><tr><td>计算类别相似度</td><td><a href="#get_rehearsal_prototype">get_rehearsal_prototype()</a></td><td>根据 memory 和 memory_o 数据集预测的特征和标签计算每个类别的余弦相似度</td></tr><tr><td>预测特征</td><td><a href="#get_token_features_and_labels">get_token_features_and_labels()</a></td><td>使用上一轮的模型预测特征</td></tr><tr><td>预测隐藏状态序列</td><td><a href="#get_token_encodings_and_labels">get_token_encodings_and_labels()</a></td><td>使用上一轮的模型预测最后一层输出端的隐藏状态序列</td></tr><tr><td>计算类别的原型</td><td><a href="#get_exemplar_means">get_exemplar_means()</a></td><td>根据支持集的 encoding 计算每个类别的原型，即均值</td></tr></tbody></table><h2 id="准备数据集">准备数据集</h2><table><thead><tr><th>功能</th><th>类/函数</th><th>描述</th></tr></thead><tbody><tr><td>表示训练/测试样本的对象</td><td><a href="#InputExample">InputExample(object)</a></td><td>包含每个样本的编号，单词序列，标签序列</td></tr><tr><td>表示样本特征集的对象</td><td><a href="#InputFeatures">InputFeatures(object)</a></td><td>包含每个样本特征的 input_ids，input_mask，segment_ids，label_ids</td></tr><tr><td>从文件中读取数据</td><td><a href="#read_examples_from_file">read_examples_from_file()</a></td><td>返回 InputExample 对象的列表</td></tr><tr><td>提取标签集</td><td><a href="#get_labels_dy">get_labels_dy()</a></td><td>提取当前任务及之前的所有标签集</td></tr><tr><td>提取每个样本的 InputFeatures 对象</td><td><a href="#convert_examples_to_features">convert_examples_to_features</a></td><td>将输入的文本样本（通过 InputExample 对象表示）转换为模型输入的特征表示（通过 InputFeatures 对象表示）</td></tr><tr><td>加载并处理数据集样本</td><td><a href="#load_and_cache_examples">load_and_cache_examples()</a></td><td>调用前两个函数从原始数据集中提取特征</td></tr></tbody></table><h2 id="训练和评估">训练和评估</h2><table><thead><tr><th>功能</th><th>类/函数</th><th>描述</th></tr></thead><tbody><tr><td>老师模型函数</td><td><a href="#teacher_evaluate">teacher_evaluate()</a></td><td>使用老师模型预测 logits 分数和进行重新标记旧实体类</td></tr><tr><td>评估及重新标记函数</td><td><a href="#evaluate">evaluate()</a></td><td>评估模型性能以及使用原型对评估集进行重新标记</td></tr><tr><td>训练函数</td><td><a href="#train">train()</a></td><td>训练模型，更新参数</td></tr><tr><td>训练和评估函数</td><td><a href="#train_and_eval">train_and_eval()</a></td><td>调用 teacher_evaluate()，evaluate() 和 train() 进行训练和评估</td></tr></tbody></table><h2 id="损失函数">损失函数</h2><table><thead><tr><th>功能</th><th>类/函数</th><th>描述</th></tr></thead><tbody><tr><td>监督对比损失函数</td><td><a href="#SupConLoss">SupConLoss()</a></td><td>实体的监督对比损失函数</td></tr><tr><td>监督对比损失函数</td><td><a href="#SupConLoss_o">SupConLoss_o()</a></td><td>实体和“O”的联合监督对比损失函数</td></tr></tbody></table><h2 id="自定义模型">自定义模型</h2><p><a href="#MySftBertModel">MySftBertModel()</a></p><h2 id="主函数">主函数</h2><p><a href="#mian">main()</a></p><h1>工具函数</h1><hr><p><a id="get_rehearsal_prototype"> </a></p><h2 id="get-rehearsal-prototype">get_rehearsal_prototype()</h2><h4 id="参数说明：">参数说明：</h4><p>get_rehearsal_prototype(args, model, tokenizer, labels, pad_token_label_id, mode, data_dir)</p><ul><li>labels：当前任务及之前的所有标签集</li><li>pad_token_label_id：PAD 标记的索引</li></ul><h4 id="用法：">用法：</h4><ul><li>加载当前任务的 memory 和 memory_o 数据集，并用当前模型预测特征和标签。</li><li>根据预测特征和标签计算当前任务及之前的所有类别的余弦相似度。</li></ul><h4 id="测试：对-task0-的-memory-和-memory-o-数据集进行测试：">测试：对 task0 的 memory 和 memory_o 数据集进行测试：</h4><p><a id="get_token_features_and_labels"> </a></p><h2 id="get-token-features-and-labels">get_token_features_and_labels()</h2><h4 id="参数说明：-2">参数说明：</h4><p>get_token_features_and_labels(args, model, batch)</p><ul><li>model：当前加载的上一轮的模型</li><li>btach：要预测的批次</li></ul><h4 id="功能：">功能：</h4><p>使用上一轮的模型预测特征，并提取出原数据集的标签。<br><a id="get_token_encodings_and_labels"> </a></p><h2 id="get-token-encodings-and-labels">get_token_encodings_and_labels()</h2><h4 id="功能：-2">功能：</h4><p>同 get_token_features_and_labels()，使用上一轮的模型预测最后一层输出端的隐藏状态序列，并提取出原数据集的标签。<br><a id="get_exemplar_means"> </a></p><h2 id="get-exemplar-means">get_exemplar_means()</h2><h4 id="功能：-3">功能：</h4><p>将每个 label 的所有样本的 encoding 取均值后归一化作为该类别的原型。</p><h1>准备数据集</h1><hr><p><a id="InputExample"></a></p><h2 id="InputExample-object">InputExample(object)</h2><p>表示一个训练或测试的样本的对象，该类包含以下属性：</p><ul><li>guid：句子的编号，用作句子的唯一标识符。</li><li>words：句子中的单词序列，以列表形式存储。</li><li>labels：(可选)序列中每个单词的标签，以列表形式存储。对于测试句子，不需要提供标签列表。</li></ul><p><a id="InputFeatures"></a></p><h2 id="InputFeatures-object">InputFeatures(object)</h2><p>表示一个样本特征集的对象，该类包含以下属性：</p><ul><li>input_ids：表示单词在词汇表中的索引，是模型输入的主要部分。</li><li>input_mask：用于指示哪些部分是真实的输入，哪些部分是填充的。</li><li>segment_ids：在BERT处理句子对中，用于区分不同句子的标识，0表示属于第一个句子，1表示属于第二个句子。</li><li>label_ids：标签的索引。</li></ul><p><a id="get_labels_dy"></a></p><h2 id="get-labels-dy">get_labels_dy()</h2><p>get_labels_dy(path, per_types, step_id)</p><h4 id="参数说明：-3">参数说明：</h4><ul><li>path：标签集的存储路径</li><li>per_types：每个任务要学习的标签数量</li><li>step_id：当前任务的索引</li></ul><h4 id="功能：-4">功能：</h4><p>返回包含当前任务及之前的所有标签的列表。</p><p><a id="read_examples_from_file"></a></p><h2 id="read-examples-from-file">read_examples_from_file()</h2><h4 id="参数说明：-4">参数说明：</h4><p>read_examples_from_file(data_dir, mode)</p><ul><li>data_dir: 数据文件存储的目录，文件读取的路径格式为&quot;data_dir/{mode}.txt&quot;</li><li>mode：根据不同的模式读取不同的样本<ul><li>train：读取 train.txt。</li><li>memory：读取 memory.txt。</li><li>dev：读取 dev.txt。</li><li>rehearsal：同时读取 train.txt 和 memory.txt，并将它们合并成一个列表返回。</li></ul></li></ul><h4 id="用法">用法:</h4><ul><li>使用 os.path.join 构造文件路径，该路径由 data_dir 和 mode 组成。</li><li>打开文件并逐行读取数据。</li><li>对于每一行：<ul><li>如果行以 “-DOCSTART-” 开头或为空行，则表示前一个句子的结束。此时，将累积的words和labels作为一个样本添加到 examples 列表中，并清空 words 和 labels 列表。</li><li>否则，将行按制表符分割，获取单词和标签，并将它们添加到 words 和 labels 列表中。</li></ul></li><li>返回 examples 列表，其中每个元素都是一个 InputExample 对象，代表一个句子。</li></ul><p><a id="convert_examples_to_features"></a></p><h2 id="convert-examples-to-features">convert_examples_to_features()</h2><h4 id="参数说明：-5">参数说明：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">convert_examples_to_features(examples, label_list, max_seq_length, tokenizer, cls_token_at_end=<span class="literal">False</span>, cls_token=<span class="string">&quot;[CLS]&quot;</span>, </span><br><span class="line">                        cls_token_segment_id=<span class="number">1</span>, sep_token=<span class="string">&quot;[SEP]&quot;</span>, sep_token_extra=<span class="literal">False</span>, pad_on_left=<span class="literal">False</span>, pad_token=<span class="number">0</span>, </span><br><span class="line">                        pad_token_segment_id=<span class="number">0</span>, pad_token_label_id=-<span class="number">1</span>, sequence_a_segment_id=<span class="number">0</span>, mask_padding_with_zero=<span class="literal">True</span>):</span><br></pre></td></tr></table></figure><ul><li>examples：经过 read_example_from_file() 函数处理的 InputExample 对象列表</li><li>label_list：当前增量学习任务的标签</li><li>max_seq_length：tokenization 后的最大序列长度，比这个长的会被截断，比这个短的会被填充。</li><li>cls_token_at_end：是否在序列最后加一个 CLS token：<ul><li>False (Default, BERT/XLM pattern): [CLS] + A + [SEP] + B + [SEP]</li><li>True (XLNet/GPT pattern): A + [SEP] + B + [SEP] + [CLS]</li></ul></li><li>cls_token_segment_id：定义关于 CLS token 的段id (0 for BERT, 2 for XLNet)。</li><li>sep_token_extra：是否在结尾再添加 SEP token( for RoBERTa pattern)。</li><li>pad_on_left：是否在句子左边填充 PAD。</li></ul><h4 id="用法-2">用法</h4><ul><li>将增量学习任务的标签从0编号，构建标签到索引映射 label_map。</li><li>遍历每个 example:<ul><li>使用分词器 tokenizer 对句子的每个单词进行分词，并在 label_ids 列表中添加它们的标签编号。</li><li>根据序列的长度和特殊标记的数量，截断序列，使其长度符合 max_seq_length 的要求。</li><li>添加特殊标记 [CLS] 和 [SEP]，以及相应的标签编号。</li><li>构建 segment_ids (全为0) 表示句子的段落编号。</li><li>构建 input_ids 列表，将 tokens 序列映射为其对应的 ID。</li><li>构建输入掩码 input_mask，1 for real tokens and 0 for padding tokens。</li><li>对不足长度的序列进行填充。</li><li>将每个 example 的处理结果存储为一个 InputFeatures 对象，并添加到 features 列表中。</li></ul></li><li>返回 features 列表。</li></ul><p><a id="load_and_cache_examples"></a></p><h2 id="load-and-cache-examples">load_and_cache_examples()</h2><h4 id="参数说明：-6">参数说明：</h4><p>load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode, data_dir)</p><ul><li>tokenizer：分词器</li><li>labels: 当前增量学习任务的标签</li><li>pad_token_label_id：PAD 位置的掩码</li><li>mode：指定当前的模式，可能为 train，dev，rehears。</li><li>data_dir: 数据文件存储的目录。</li></ul><p>data_dir，mode 传入 read_examples_from_file 函数读取样本。<br>tokenizer，传入 convert_examples_to_features 函数将样本转换为特征。</p><h4 id="功能：-5">功能：</h4><ol><li>调用 read_examples_from_file() 和 convert_examples_to_features() 函数，根据不同的模式从 data_dir 中读取样本并转换为特征，如果是’rehearsal’模式，则读取 train.txt 和 memory.txt，如果是开发，训练，测试模式，则读取相应的dev.txt，train.txt，test.txt。</li><li>如果是分布式训练的非主进程，直接从缓存文件中加载特征。</li><li>返回一个 TensorDataset 对象 dataset(all_input_ids, all_input_mask, all_segment_ids, all_label_ids)。</li></ol><h4 id="测试">测试</h4><p>对 task0 的训练集的句子进行测试：<br><strong>获取标签集</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">labels = get_labels_dy(path=<span class="string">&quot;../data/labels.txt&quot;</span>, per_types=<span class="number">6</span>, step_id=<span class="number">0</span>)</span><br><span class="line">labels</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;O&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;building-library&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;organization-showorganization&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;other-award&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;building-other&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;organization-religion&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;organization-sportsteam&#x27;</span>]</span><br></pre></td></tr></table></figure><p><strong>运行 load_and_cache_examples() 函数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_dataset = load_and_cache_examples(args, tokenizer, labels, pad_token_label_id, mode=mode, data_dir=data_dir)</span><br></pre></td></tr></table></figure><p>输出日志()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">03/28/2024 13:38:28 - INFO - __main__ -   Creating features from dataset file at ../data/tasks/task_0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   Writing example 0 of 100</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   *** Example ***</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   guid: train-1</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   tokens: [CLS] this rivalry intensified in 1919 when arsenal were unexpectedly promoted to the first division , taking a place that tottenham believed should be theirs . [SEP]</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   input_ids: 101 2023 10685 15767 1999 4529 2043 9433 2020 14153 3755 2000 1996 2034 2407 1010 2635 1037 2173 2008 18127 3373 2323 2022 17156 1012 102 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   input_mask: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   segment_ids: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   label_ids: -100 0 0 0 0 0 0 6 0 0 0 0 0 0 0 0 0 0 0 0 6 0 0 0 0 0 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   *** Example ***</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   guid: train-2</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   tokens: [CLS] only one of four entered corvette ##s - gt ##1 c ##6 ##r of luc alpha ##nd ave ##nt ##ures - eventually finished the race , taking second place in class . [SEP]</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   input_ids: 101 2069 2028 1997 2176 3133 22687 2015 1011 14181 2487 1039 2575 2099 1997 12776 6541 4859 13642 3372 14900 1011 2776 2736 1996 2679 1010 2635 2117 2173 1999 2465 1012 102 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   input_mask: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   segment_ids: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line">03/28/2024 13:38:28 - INFO - util.supervised_util -   label_ids: -100 0 0 0 0 0 0 -100 0 0 -100 0 -100 -100 0 6 6 -100 6 -100 -100 0 0 0 0 0 0 0 0 0 0 0 0 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100 -100</span><br><span class="line">......仅展示前两个句子</span><br><span class="line">03/28/2024 13:38:28 - INFO - __main__ -   Saving features into cached file ../data/tasks/task_0\cached_rehearsal_output_nerd_128</span><br></pre></td></tr></table></figure><h1>训练和评估</h1><p><a id="teacher_evaluate"> </a></p><h2 id="teacher-evaluate">teacher_evaluate()</h2><h4 id="用法：-2">用法：</h4><ol><li>使用老师模型，即上一轮的模型预测训练集的 <code>logits_list</code> 和获取真实标签 <code>out_labels</code>。</li><li>调用 <a href="#evaluate">evaluate(mode=“rehearsal”)</a> 获取训练集的 <code>preds</code>, <code>emissions</code>, <code>out_label_ids</code>, 以及重新标记阈值 <code>prototype_dists</code>。</li><li>重新标记旧实体类：对于训练集的每个样本，如果它的原型的相似度大于重新标记阈值，则将该样本预测为这个旧实体类，否则保持原来的预测标签不变。</li><li>返回 <code>logits_list</code> 和重新标记过的标签列表 <code>out_label_new_list</code>。</li></ol><p><a id="evaluate"> </a></p><h2 id="evaluate">evaluate()</h2><h4 id="用法：-3">用法：</h4><ol><li>加载数据集：调用 <a href="#load_and_cache_examples">load_and_cache_examples()</a> 根据不同模式加载评估集，support 集（提取实体样本），support_o 集（提取“O”样本），训练集。</li><li>计算类别原型：</li></ol><ul><li>使用上一轮模型预测支持集的 encoding 和label。</li><li>调用 <a href="#get_exemplar_means">get_exemplar_means()</a> 根据支持集的 encoding 和label 计算每个类别的原型。</li></ul><ol start="3"><li>调用 <a href="#get_token_encodings_and_labels">get_token_encodings_and_labels()</a> 使用上一轮模型预测评估集的 encoding 和 标签 <code>out_label_ids</code>。</li><li>如果是’rehearsal’模式，则剔除掉支持集中当前任务标签的样本，并调用 NNClassification 的 <a href="#nn_classifier_dot_prototype">nn_classifier_dot_prototype()</a> 计算：</li></ol><ul><li><code>preds</code>：评估集每个样本中原型相似度最大值所在的类别索引</li><li><code>emissions</code>：评估集每个样本与每个类别的原型相似度的最大值</li><li><code>prototype_dists</code>：根据支持集计算的每个旧类别的原型重新标记阈值列表</li></ul><ol start="5"><li>如果是’rehearsal’模式，则直接返回 <code>preds</code>, <code>emissions</code>, <code>out_label_ids</code>, <code>prototype_dists</code>。</li><li>将 <code>out_label_ids</code>，<code>preds</code> 的标签从索引形式转换为真实的字符串形式。</li><li>将评估集的 <code>out_label_list</code> 作为真实标签，将 <code>preds_list</code> 作为预测标签，使用 seqeval 库计算 F1 分数 <code>macro_results</code>,<br><code>micro_results</code>。</li><li>返回 <code>macro_results</code>， <code>micro_results</code>，<code>preds_list</code>。</li></ol><p><a id="train"> </a></p><h2 id="train">train()</h2><h4 id="参数说明：-7">参数说明：</h4><p>train(args, train_dataset, train_dataloader, model, tokenizer, labels, pad_token_label_id, data_dir, output_dir, t_logits, out_new_labels):</p><ul><li>train_dataset：训练集</li><li>train_dataloader：训练集加载器</li><li>labels：当前任务及之前的所有真实标签集</li><li>pad_token_label_id：PAD 标记的索引</li><li>data_dir：输入数据集的文件路径</li><li>output_dir：保存模型的检查点的文件路径</li><li>t_logits：老师模型预测的 logits 分数</li><li>out_new_labels：老师模型预测的标签</li></ul><h4 id="用法：-4">用法：</h4><h6 id="参数配置">参数配置</h6><ol><li>设置训练总步数 t_total（用于传入 warmup 中）：</li></ol><ul><li>通过 <code>args.max_steps</code> 可以指定 t_total，并覆盖 <code>arg.num_train_epochs</code>。</li><li>否则通过 <code>t_total = len(train_dataloader) // args.gradient_accumulation_steps * args.num_train_epochs</code> 计算 t_total。</li></ul><ol start="2"><li>配置优化器：使用AdamW优化器，使用了权重衰减,学习率调节器。</li></ol><ul><li><code>args.learning_rate</code>(default=5e-5) 和 <code>args.adam_epsilon</code>(default=1e-8) 可修改AdamW的学习率和模糊因子。</li><li><code>args.warmup_steps</code>(default=0) 可修改 warmup 的初始预热步数。</li></ul><ol start="3"><li>根据 <code>args.fp16</code> 选择是否启用混合精度训练。</li></ol><h6 id="训练模型：">训练模型：</h6><p>迭代每一轮：</p><ol><li>如果当前轮次 &gt;=  <code>args.start_train_o_epoch</code>：<ul><li>利用 <a href="#get_rehearsal_prototype">get_rehearsal_prototype()</a> 函数计算类别相似度</li><li>将 <code>loss_name</code> 设为 实体和“O”联合损失函数。</li><li>调用 <a href="#get_token_features_and_labels">get_token_features_and_labels()</a> 函数使用当前模型预测特征和标签。</li><li>调用 <a href="#get_top_emissions_with_th">get_top_emissions_with_th()</a> 选择“O”的正样本。</li></ul></li><li>如果是第一个任务，使用原始数据集的标签。</li><li>如果不是第一个任务，使用老师模型 <a href="#tearch_evaluate">tearch_evaluate()</a> 预测 logits 分数 <code>t_logits</code> 和标签 <code>out_new_labels</code>。</li><li>模型前向传播，获取模型输出的损失值。</li><li>模型反向传播。</li><li>更新参数</li><li>调用 <a href="#evaluate">evaluate()</a> 的开发模式对开发集进行评估</li><li>达到 <code>args.save_steps</code> 时保存 checkpoint 文件和模型。</li><li>返回训练总步数和平均损失值。</li></ol><p><a id="train_and_eval"> </a></p><h2 id="train-and-eval">train_and_eval()</h2><h4 id="参数说明：-8">参数说明：</h4><p>train_and_eval(args, labels, num_labels, pad_token_label_id, model_name_or_path, output_dir, data_dir, step_id)</p><ul><li>labels：当前任务及之前的所有标签集</li><li>num_labels：labels 的数量</li><li>pad_token_label_id：PAD 标记的索引</li><li>model_name_or_path：加载模型的路径</li><li>output_dir：输出结果的文件路径</li><li>data_dir：读取数据集的文件路径</li><li>step_id：当前任务的 id</li></ul><h4 id="用法：-5">用法：</h4><ol><li>加载上一个任务的模型参数，分词器，模型。</li><li>调用 <a href="#load_and_cache_examples">load_and_cache_examples(mode=“rehearsal”)</a> 加载训练集（由当前任务的 train.txt 和 memory.txt 组成）</li><li>如果不是第一个任务，则调用 <a href="#teacher_evaluate">teacher_evaluate(mode=“train”)</a> 使用老师模型预测训练集的 logits 分数 <code>t_logits</code> 和 <code>out_new_labels</code>。</li><li>调用 <a href="#train">train()</a> 进行训练。</li><li>存储模型的参数，分词器，模型。</li><li>如果 <code>args.do_eval</code> 为 Ture，对每个 checkpoint 调用 <a href="#evaluate">evaluate()</a> 的开发模式对开发集进行评估，并存储进 eval_results.txt 文件。</li><li>如果 <code>args.do_predict</code> 为 Ture，调用 <a href="#evaluate">evaluate()</a> 的测试模式对测试集进行评估和预测，并保存评估和预测结果。</li></ol><h1>损失函数</h1><p><a id="SupConLoss"> </a></p><h2 id="SupConLoss">SupConLoss()</h2><h4 id="init"><strong>init</strong>():</h4><h6 id="参数说明：-9">参数说明：</h6><p><strong>init</strong>(self, temperature=0.07, contrast_mode=‘all’, base_temperature=0.07, topk_th=False)</p><ul><li>temperature：温度参数，用于调整对比损失函数中余弦相似度的尺度。</li><li>contrast_mod：</li><li>base_temperature：基准温度参数，用于调整对比损失函数的基准尺度。</li><li>topk_th：</li></ul><h4 id="forward">forward():</h4><h6 id="参数说明：-10">参数说明：</h6><p>forward(self, features, labels=None, mask=None, entity_topk=None, ignore_index=CrossEntropyLoss(), per_types=6, aug_feature=None)</p><ul><li>mask：对比损失的掩码，同一标签的样本设为1，不同为0。</li><li>entity_topk: 实体 Top K，表示每个类别的前 K 个样本在对比中的重要性。</li><li>ignore_index: 忽略索引，默认为 CrossEntropyLoss()，表示在计算损失时需要忽略的标签索引。</li></ul><h6 id="用法：-6">用法：</h6><ol><li>根据输入的 <code>labels</code> 和 <code>mask</code> 构建 <code>mask</code>：不同标签的设为0，与自身的设为0，ignore_index 所对应的行设为0，“O”样本所在行设为0。</li><li>选择 Anchor：根据 <code>contrast_mode</code> 选择 anchor 样本，如果 <code>contrast_mode</code> 为 ‘one’, 则将第一个样本设为 anchor，如果 <code>contrast_mode</code> 为 ‘all’, 则将所有样本设为 anchor。</li><li>计算对比损失的 Logits：计算 anchor 和其他样本之间的余弦相似度。</li><li><code>entity_topk</code> 非空: 将 <code>mask</code> 中所有样本与 entity_topk样本设为1，与当前任务训练集的“O”样本设为 0。</li><li>根据监督对比损失函数公式计算损失值，返回所有 anchor 的平均损失值。</li></ol><h1>模型</h1><p><a id="MySftBertModel"> </a></p><h2 id="MySftBertModel">MySftBertModel()</h2><h4 id="forward-2">forward():</h4><ol><li>使用 BertModel 模型前向传播</li><li>提取特征 <code>features </code>：将 <code>ast_hidden_state</code> 通过一个 <code>mlp(Linear-ReLU-Linear)</code> 层变换并归一化后赋给 <code>features </code>。</li><li>提取 <code>logits</code>：将 <code>last_hidden_state</code> 依次通过dropout 层，线性分类器层后赋给 <code>logits</code>。</li><li>如果是非训练模式，直接返回 loss, features_enc, features, logits，其中 <code>loss = None</code>，<code>features_enc = last_hidden_state</code></li><li>计算损失值 <code>loss</code>。：<ul><li>根据 <code>loss_name</code> 计算损失函数的值。</li><li>如果不是第一个任务，计算当前任务样本的 logits 与真实标签的交叉熵损失，当前模型与老师模型 logits 的KL散度。将交叉熵损失或KL散度添加到 <code>loss</code> 中。</li></ul></li><li>返回 loss, features_enc, features, logits。</li></ol><h1>主函数</h1><p><a id="main"> </a></p><h2 id="main">main()</h2><h4 id="功能：-6">功能：</h4><ul><li>创建解释器，添加命令行参数。</li><li>迭代每个任务，调用 <a href="#get_labels_dy">get_labels_dy()</a> 获取当前任务及之前的所有标签集 <code>labels</code>，然后调用 <a href="#train_and_eval">train_and_eval()</a> 进行训练和评估。</li></ul>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各分类简介</title>
      <link href="/2024/02/16/%E5%90%84%E9%A1%B9%E4%BA%8B%E5%AE%9C/"/>
      <url>/2024/02/16/%E5%90%84%E9%A1%B9%E4%BA%8B%E5%AE%9C/</url>
      
        <content type="html"><![CDATA[<h1>关于本站</h1><p>本站几经辗转，目前基于安知鱼主题1.6.12（是 heo的改版），这一版主题有两处可能导致博客崩溃的BUG（遇到同样问题的uu可以看一下我写的详细解决方案），总体还是非常美丽！！（狠狠心动了哈哈）</p><p>本站原用于星火杯比赛，拟作为校园开源平台——慧试使用，现作为个人博客，欢迎闯入我的小世界~👋</p><h1>XDU-CS-lab(月更)</h1><p><a href="https://github.com/Alive0103/XDU-CS-lab">https://github.com/Alive0103/XDU-CS-lab</a></p><p>西电计科软件方向课程资料，试卷，实验通关秘籍</p><p>仓库为本人(22级)计科资料存储地，涵盖自大一开始的部分课程设置，实验，期末试卷，学习心得以及部分速通技巧，只此盏灯，为你长明不息。</p><p>部分PPT已转为PDF格式，需要PPT源文件的uu可以给我发邮件</p><p>仅用于学术交流，内容仅供参考，请勿抄袭，否则后果自负。</p><p>⭐觉得有用的话点个星星~不迷路！你的星星就是我持续上传的动力！！！</p><h1>NER</h1><p>nlp领域的ner命名实体识别方向，我们的项目旨在解决机器学习灾难性遗忘问题，现已成功把SOTA的0.71的F1提高到0.75，好耶！感兴趣的uu可以移步瞧瞧，收获蛮多的（虽然感觉做起来还是挺痛苦的哈哈），强推李沐老师的《动手学深度学习》！！！</p><p>祝大家学深度学习一切顺利，不掉头发！🤯</p><p>另有NLP-NER方向相关学习成果(智慧典藏——面向动态互联网环境的持续记忆系统)，欢迎<a href="https://github.com/Alive0103/NLP-NER">移步探讨</a></p><h1>人类观察录（周更）</h1><p>这里收集了各式各样的人~明媚的，深沉的，我真诚地想记录下来每一个有趣的灵魂（才不要在时间的长河里抹掉你们的印记），欢迎常来看看我的赛博收集手册~</p><blockquote><p>说不定你就是其中珍贵的一页呢？</p></blockquote><p>这个分类其实想写一些我的奇幻经历，会慢慢更新哒，包括但不限于一些恐怖故事，还有一份万言书（希望还有时间以连载的形式更完）哈哈，害怕的宝宝晚上慎看🍀</p><p>还有还有，可能会夹杂一些寻人启事，人和人的相遇真的全凭缘分，有些人错过就是错过了，甚至连说再见的机会都没有，想在这里写下我仅存的印象，如果各位或者本人有幸能看到的话还请留下联系方式，这对我很重要，谢谢谢谢！！！</p><p>好像有点多？哈哈，因为这些同等重要💕</p><h1>技能点</h1><p>AI时代，何去何从，这是个问题，选“工程性技术”狠赚一笔，还是大热的人工智能，亦或是更加机械重复的方向，孰好孰坏？似乎没人能给出标准答案，大学的可能性在于尝试，于是乎，我的大学几乎尝试了计算机传统路线的所有可能。</p><p>前端三大件，Vue，深度学习，Pytorch，数模，烧板子，ACM……本博客技能点板块会记录学习过程中的所思所想，在精不在多，很高兴我的每一分努力都能被你看在眼里💕</p><blockquote><p>才不是万千替代品般的中庸者，欢迎来到我的风暴中心</p></blockquote><h2 id="前端（Vue）">前端（Vue）</h2><p>资料参考于尚硅谷和黑马，个人学习笔记，仅供参考</p><h2 id="数据结构（周更）">数据结构（周更）</h2><p>跟着<a href="https://programmercarl.com/">代码随想录</a>以刷题笔记呈现（C++/Java都有），不会的题可以来瞧瞧~共勉兄弟们！</p><h2 id="深度学习">深度学习</h2><p>记录了NER大模型开发微调的一些心得，比较小白向，希望对你有帮助，也希望路过的高手给出一些意见（不玻璃心）💪</p><h2 id="Java学习笔记（持续更新）">Java学习笔记（持续更新）</h2><p>速成向，预计2025/3左右会更新相关项目，可以多多关注~</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RNN模型</title>
      <link href="/2024/02/15/NER/RNN%E6%A8%A1%E5%9E%8B/"/>
      <url>/2024/02/15/NER/RNN%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1>认识RNN模型</h1><blockquote><p>RNN(Recurrent Neural Network),中文称作循环神经网络，它一般以序列数据为输入，通过网络内部的结构设计有效捕捉序列之间的关系特征，一般也是以序列形式进行输出。</p></blockquote><ul><li><p>一般单层神经网络结构</p></li><li><p>RNN单层结构</p></li><li><p>以时间步对RNN进行展开后的单层网络结构</p></li></ul><p>RNN的循环机制使模型隐层上一时间步产生的结果能够作为当下时间步输入的一部分(当下时间步的输入<strong>除了正常的输入外还包括上一步的隐层输出</strong>)对当下时间步的输出产生影响。</p><ul><li>RNN模型的作用</li></ul><p>因为RNN结构能够很好利用序列之间的关系，因此针对自然界具有连续性的输入序列，如人类的语言，语音等进行很好的处理，广泛应用于NLP领域的各项任务，如文本分类，情感分析，意图识别，机器翻译等。</p><h2 id="分类、">分类、</h2><ul><li><p>按照输入和输出的结构进行分类：</p><ul><li>NvsN-RNN</li><li>Nvs1-RNN</li><li>1vsN-RNN</li><li>NvsM-RNN</li></ul></li><li><p>按照RNN的内部构造进行分类：</p><ul><li>传统RNN</li><li>LSTM</li><li>Bi-LSTM</li><li>GRU</li><li>Bi-GRU</li></ul></li></ul><h3 id="NvsN-RNN">NvsN-RNN</h3><p>它是RNN最基础的结构形式，最大的特点就是：输入和输出序列是等长的.由于这个限制的存在，使其适用范围比较小，可用于生成等长度的合辙诗句。</p><h3 id="Nvs1-RNN">Nvs1-RNN</h3><p>时候我们要处理的向题输入是一个序列，而要求输出是一个单独的值而不是序列，应该怎样建模呢？我们只要在最后一个隐层输出上进行线性变换就可以了，大部分情况下，为了更好的明确结果，还要使用sigmoid或者softmaxi进行处理.这种结构经常被应用在文本分类问题上。</p><h3 id="1vsN-RNN">1vsN-RNN</h3><p>如果输入不是序列而输出为序列的情况怎么处理呢？我们最常采用的一种方式就是使该输入作用于每次的输出之上.这种结构可用于将图片生成文字任务等。</p><h3 id="NvsM-RNN">NvsM-RNN</h3><p>这是一种不限输入输出长度的RNN结构，它由编码器和解码器两部分组成，两者的内部结构都是某类RNN,它也被称为seq2seq架构.输入数据首先通过编码器，最终输出一个隐含变量C,之后最常用的做法是使用这个隐含变量c作用在解码器进行解码的每一步上，以保证输入信息被有效利用。</p><h1>传统RNN模型</h1><ul><li>传统RNN的内部结构图：</li></ul><h2 id="内部结构分析">内部结构分析</h2><p>我们把目光集中在中间的方块部分，它的输入有两部分，分别是h(t-1)以及x(t),代表上一时间步的隐层输出，以及此时间步的输入，它们进入RNN结构体后，会&quot;融合&quot;到一起，这种融合我们根据结构解释可知，是将二者进行拼接，形成新的张量[x(t),h(t1)],<code>行不变，列变</code>之后这个新的张量将通过一个全连接层（线性层），该层使用<code>tanh</code>作为激活函数，最终得到该时间步的输出h(t),它将作为下一个时间步的输入和x(t+1)一起进入结构体.以此类推。</p><ul><li>内部计算公式：</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo stretchy="false">(</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy="false">[</mo><msub><mi>X</mi><mi>t</mi></msub><mo separator="true">,</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">]</mo><mo>+</mo><msub><mi>b</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h_t=tanh(W_t[X_t,h_{t-1}]+b_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><ul><li>激活函数tanh的作用：</li></ul><p>用于帮助调节流经网络的值，tanh函数将值压缩在-1和1之间。</p><ul><li>Pytorch中传统RNN工具的使用：</li></ul><p>位置：在torch.nn工具包之中，通过torch.nn.RNN可调用。</p><p>实现过程略</p><h2 id="传统RNN的优势">传统RNN的优势</h2><p>由于内部结构简单，对计算资源要求低，相比之后我们要学习的RNN变体：LSTM和GRU模型参数总量少了很多，在<code>短序列任务</code>上性能和效果都表现优异。</p><h2 id="传统RNN的缺点">传统RNN的缺点</h2><p>传统RNN在解决长序列之间的关联时，通过实践，证明经典RNN表现很差，原因是在进行反向传播的时候，过长的序列导致梯度的计算异常，发生梯度消失或爆炸。</p><blockquote><p>什么是梯度消失或爆炸呢？</p><p>根据反向传播算法和链式法则，梯度的计算可以简化为以下公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mi>n</mi></msub><mo>=</mo><msup><mi>σ</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>w</mi><mn>1</mn></msub><mo>⋅</mo><msup><mi>σ</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo><msub><mi>w</mi><mn>2</mn></msub><mo>⋅</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>⋅</mo><msup><mi>σ</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><msub><mi>z</mi><mi>n</mi></msub><mo stretchy="false">)</mo><msub><mi>w</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">D_n=\sigma&#x27;(z_1)w_1\cdot\sigma&#x27;(z_2)w_2\cdot...\cdot\sigma&#x27;(z_n)w_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中sigmoid的导数值域是固定的，在[0,0.25]之间，而一旦公式中的w也小于1，那么通过这样的公式连乘后，最终的梯度就会变得非常非常小，这种现象称作梯度消失.反之，如果我们人为的增大w的值，使其大于1，那么连乘够就可能造成梯度过大，称作梯度爆炸。</p></blockquote><ul><li>梯度消失或爆炸的危害：</li></ul><p>如果在训练过程中发生了梯度消失，权重无法被更新，最终导致训练失败：梯度爆炸所带来的梯度过大，大幅度更新网络参数，在极端情况下，结果会溢出(NaN值)。</p><h1>LSTM模型</h1><p>LSTM(Long Short-Term Memory)，也称长短时记忆结构，它是传统RNN的变体，与经典RNN相比能够有效捕捉长序列之间的语义关联，缓解梯度消失或爆炸现象.同时LSTM的结构更复杂，它的核心结构可以分为四个都分去解析：</p><ul><li>遗忘门</li><li>输入门</li><li>细胞状态</li><li>输出门</li></ul><h2 id="内部结构">内部结构</h2><h3 id="遗忘门部分结构图与计算公式">遗忘门部分结构图与计算公式</h3><p>公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mrow><mo fence="true">(</mo><msub><mi>W</mi><mi>f</mi></msub><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">[</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">]</mo><mo>+</mo><msub><mi>b</mi><mi>f</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_{t}=\sigma\left(W_{f}{\cdot}[h_{t-1},x_{t}]+b_{f}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">⋅</span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><ul><li>遗忘门结构分析：</li></ul><p>与传统RNN的内部结构计算非常相似首先将当前时间步输入x(t)与上一个时间步隐含状态h(t-1)拼接，得到[x(t),h(1)]，然后通过一个全连接层做变换，最后通过sigmoidi函数进行激活得到f(t)，我们可以将f(t)看作是门值，好比一扇门开合的大小程度，门值都将作用在通过该扇门的张量，遗忘门门值将作用的上一层的细胞状态上，代表遗忘过去的多少信息，又因为遗忘门门值是由f(t)，h(t1)计算得来的，因此整个公式意味着==根据当前时间步输入和上一个时间步隐含状态h(t-1)来决定遗忘多少上一层的细胞状态所携带的过往信息==</p><ul><li>激活函数sigmiod的作用：</li></ul><p>用于帮助调节流经网络的值，sigmoid函数将债压缩在0和1之间。</p><h3 id="输入门部分结构图与计算公式">输入门部分结构图与计算公式</h3><p>公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>it</mtext><mo>=</mo><mi>σ</mi><mrow><mo fence="true">(</mo><msub><mi>W</mi><mi>i</mi></msub><mo separator="true">⋅</mo><mo stretchy="false">[</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">]</mo><mo>+</mo><msub><mi>b</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mover accent="true"><mi>C</mi><mo>~</mo></mover><mi>t</mi></msub><mo>=</mo><mi>tanh</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>W</mi><mi>C</mi></msub><mo>⋅</mo><mo stretchy="false">[</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">]</mo><mo>+</mo><msub><mi>b</mi><mi>C</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;\text{it} =\sigma\left(W_{i}\cdotp[h_{t-1},x_{t}]+b_{i}\right)  \\&amp;\tilde{C}_{t} =\tanh(W_C\cdot[h_{t-1},x_t]+b_C) \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0802em;vertical-align:-1.2901em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7901em;"><span style="top:-3.8703em;"><span class="pstrut" style="height:2.9202em;"></span><span class="mord"></span></span><span style="top:-2.2901em;"><span class="pstrut" style="height:2.9202em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2901em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7901em;"><span style="top:-3.9501em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord text"><span class="mord">it</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-2.3699em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2901em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><ul><li>输入门结构分析：</li></ul><p>我们看到输入门的计算公式有两个，第一个就是产生输入门门值的公式，它和遗忘门公式几乎相同，区别只是在于它们之后要作用的目标上.这个公式意味着输入信息有多少需要进行过滤。输入门的第二个公式是与传统RNN的内部结构计算相同.对于LSTM来讲，它得到的是当前的细胞状态，而不是像经典RNN一样得到的是隐含状态。</p><h3 id="细胞状态更新">细胞状态更新</h3><p>公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mi>t</mi></msub><mo>=</mo><msub><mi>f</mi><mi>t</mi></msub><mo>∗</mo><msub><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>i</mi><mi>t</mi></msub><mo>∗</mo><msub><mover accent="true"><mi>C</mi><mo>~</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">C_t=f_t*C_{t-1}+i_t*\tilde{C}_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0702em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li>细胞状态更新分析：</li></ul><p>细胞更新的结构与计算公式非常容易理解，这里没有全连接层，只是将刚刚得到的遗忘门门值与上一个时间步得到的C(t-1)相乘，再加上输入门门值与当前时间步得到的未更新C(t)相乘的结果，最终得到更新后的C(t)作为下一个时间步输入的一部分.整个细胞状态更新过程就是对遗忘门和输入门的应用。</p><h3 id="输出门部分结构图与计算公式">输出门部分结构图与计算公式</h3><p>公式:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>o</mi><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mrow><mo fence="true">(</mo><msub><mi>W</mi><mi>o</mi></msub><mrow><mo fence="true">[</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>t</mi></msub><mo fence="true">]</mo></mrow><mo>+</mo><msub><mi>b</mi><mi>o</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><msub><mi>o</mi><mi>t</mi></msub><mo>∗</mo><mi>tanh</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>C</mi><mi>t</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{c}o_t=\sigma\left(W_o\left[h_{t-1},x_t\right]+b_o\right)\\h_t=o_t*\tanh\left(C_t\right)\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">tanh</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><ul><li>输出门结构分析：</li></ul><p>输出门部分的公式也是两个，第一个即是计算输出门的门值，它和遗忘门，输入门计算方式相同.第二个即是使用这个门值产生隐含状态h(t)，他将作用在更新后的细胞状态C(t)上，并做tanh激活，最终得到h(t)作为下一时间步输入的一部分.整个输出门的过程，就是为了产生隐含状态h(t)。</p><h2 id="Bi-LSTM">Bi-LSTM</h2><p>Bi-LSTM即双向LSTM,它没有改变LSTM本身任何的内部结构，只是将LSTM应用两次且方向不同，再将两次得到的LSTM结果进行拼接作为最终输出。</p><ul><li>Bi-LSTM结构分析：</li></ul><p>我们看到图中对我爱中雨这句话或者叫这个输入序列，进行了从左到右和从右到左两次LSTM处理，将得到的结果张量进行了拼接作为最终输出.这种结构能够捕捉语言语法中一些特定的前置或后置特征，增强语义关联但是模型参数和计算复杂度也随之增加了一倍，一般需要对语料和计算资源进行评估后决定是否使用该结构。</p><ul><li>Pytorch中LSTM工具的使用：</li></ul><p>位置：在torch.nn工具包之中，通过torch.nn.LSTM可调用。</p><h1>注意力机制</h1><h2 id="什么是注意力">什么是注意力</h2><p>我们观察事物时，之所以能够快速判断一种事物（当然允许判断是错误的），是因为我们大脑能够很快把注意力放在事物最具有辨识度的部分从而作出判断，而并非是从头到尾的观察一遍事物后，才能有判断结果.正是基于这样的理论，就产生了注意力机制。</p><blockquote><p>NLP领域中，当前的注意力机制大多数应用与seq2seq架构，即编码器和解码模型</p></blockquote><h2 id="注意力计算规则">注意力计算规则</h2><blockquote><p>它需要三个指定的输入Q(query),K(key),V(value),然后通过计算公式得到注意力的结果，这个结果代表query（查询）在key和value作用下的注意力表示.当输入的Q=K=V时，称作自注意力计算规则。</p></blockquote><ul><li>常见的注意力计算规则：</li></ul><ol><li>将Q,K进行纵轴拼接，做一次线性变化，再使用softmax处理获得结果最后与V做张量乘法。</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋅</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Attention(Q,K,V)=Softmax(Linear([Q,K]))\cdot V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">([</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">]))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><ol start="2"><li>将Q,K进行纵轴拼接，做一次线性变化后再使用tanh函数激活，然后再进行内部求和，最后使用softmax处理获得结果再与V做张量乘法。</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">(</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo stretchy="false">(</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mo stretchy="false">[</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋅</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Attention(Q,K,V)=Softmax(sum(tanh(Linear([Q,K]))))\cdot V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">([</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">]))))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><ol start="3"><li>将Q与K的转置做点积运算，然后除以一个缩放系数，再使用softmax处理获得结果最后与V做张量乘法。</li></ol><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><mo>⋅</mo><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy="false">)</mo><mo>⋅</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Attention(Q,K,V)=Softmax(\frac{Q\cdot K^{T}}{\sqrt{d_{k}}})\cdot V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4483em;vertical-align:-0.93em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.2528em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><blockquote><p>说明：++当注意力权重矩阵和V都是三维张量且第一维代表为batch条数时++，则做bmm运算.bmm是一种特殊的张量乘法运算。</p></blockquote><ul><li>bmm运算演示：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果参数1形状是(b×n×m),参数2形状是(b×m×p)，则输出为(b×n×p)</span></span><br><span class="line">&gt;&gt;<span class="built_in">input</span> torch.randn(<span class="number">10</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">&gt;&gt;mat2 torch.randn(<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">&gt;&gt;res torch.bmm(<span class="built_in">input</span>,mat2)</span><br><span class="line">&gt;&gt;&gt;res.size()</span><br><span class="line">torch.Size([<span class="number">10</span>,<span class="number">3</span>,<span class="number">5</span>])</span><br></pre></td></tr></table></figure><h3 id="注意力机制的作用">注意力机制的作用</h3><ul><li>在解码器端的注意力机制：</li></ul><p>能够根据模型目标有效的聚焦编码器的输出结果，当其作为解码器的输入时提升效果.改善以往编码器输出是单一定长张量，无法存储过多信息的情况<br>在编码器端的注意力机制：主要解决表征问题，相当于特征提取过程，得到输入的注意力表示。一般使用自注意力(self-attention)。</p><ul><li>注意力机制实现步骤<ul><li>根据注意力计算规则对Q,K,V进行相应的计算。</li><li>根据第一步采用的计算方法，如果是拼接方法，则需要将Q与第二步的计算结果再<br>进行拼接，如果是转置点积一般是自注意力，Q与V相同，则不需要进行与Q的拼接。</li><li>最后为了使整个attention机制按照指定尺寸输出，使用线性层作用在第二步的结果上做一个线性变换，得到最终对Q的注意力表示。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BERT &amp; Transformer &amp; CRF</title>
      <link href="/2024/02/15/NER/BERT&amp;Transformer/"/>
      <url>/2024/02/15/NER/BERT&amp;Transformer/</url>
      
        <content type="html"><![CDATA[<h1>BERT</h1><h2 id="什么是BERT">什么是BERT</h2><ul><li>BERT是2018年10月由Google Al研究院提出的一种预训练模型</li><li>BERT的全称是Bidirectional Encoder Representation from Transformers</li><li>BERT在机器阅读理解顶级水平测试SQuAD1.1中表现出惊人的成绩：全部两个衡量指标上全面超越人类，并且在11种不同NLP测试中创出S0TA表现.包括将GLUE基准推高至80.4%<br>(绝对改进7.6%)，MultiNL准确度达到86.7%（绝对改进5.6%）.成为NLP发展史上的里程碑式的模型成就</li></ul><h2 id="BERT的架构">BERT的架构</h2><p>总体架构：BERT采用了Transformer Encoder block进行连接，因为是一个典型的双向编码模型。</p><ul><li>从上面的架构图中可以看到，宏观上BERT分三个主要模块：<ul><li>最底层黄色标记的Embedding模块</li><li>中间层蓝色标记的Transformer模块</li><li>最上层绿色标记的预微调模块</li></ul></li></ul><h3 id="Embedding模块">Embedding模块</h3><p>BERT中的该模块是由三种Embedding共同组成而成:</p><ul><li>Token Embeddings是词嵌入张量，第一个单词是CLS标志，可以用于之后的分类任务</li><li>Segment Embeddings是句子分段嵌入张量，是为了服务后续的两个句子为输入的预训练任务</li><li>Position Embeddings是位置编码张量，此处注意和传统的Transformer不同，不是三角函数计算的固定位置编码，而是通过学习得出来的</li><li>整个Embedding模块的输出张量就是这3个张量的直接加和结果</li></ul><h3 id="双向Transformer模块">双向Transformer模块</h3><p>BERT中只使用了经典Transformer架构中的Encoder部分，完全舍弃了Decoder部分，而两大预训练任务也集中体现在训练Transformer模块中。</p><h3 id="预微调模块">预微调模块</h3><p>经过中间层Transformer的处理后，BERT的最后一层根据任务的不同需求而做不同的调整<br>即可，比如对于sequence-levelf的分类任务，BERT直接取第一个[CLS]token的final hidden state,再加一层全连接层后进行softmax来预测最终的标签。</p><blockquote><p>对于不同的任务，微调都集中在预微调模块，几种重要的NLP微调任务架构图展示如下</p></blockquote><p>在面对特定任务时，只需要对预微调层进行微调，就可以利用Transformer强大的注意力机制来模拟很多下游任务，并得到SOTA的结果.（句子对关系判断，单文本主题分类，问答任务——句子理解(QA),单句贴标签(NER)。</p><p>若干可选的超参数建议如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Batch size:16,32</span><br><span class="line">Learning rate (Adam):5e-5,3e-5,2e-5</span><br><span class="line">Epochs:3,4</span><br></pre></td></tr></table></figure><h2 id="BERT的预训练任务">BERT的预训练任务</h2><p>BERT包含两个预训练任务</p><ul><li>任务一：Masked LM(带mask的语言模型训练)</li><li>任务二：Next Sentence Prediction(下一句话预测任务)</li></ul><h3 id="任务一：Masked-LM-带mask的语言模型训练">任务一：Masked LM(带mask的语言模型训练)</h3><blockquote><p>关于传统的语言模型训练，都是采用left-to-right,或者left-to-right+right-to-left结合的方式，但这种单向方式或者拼接的方式提取特征的能力有限.为此BET提出一个深度双向表达模型(deep bidirectional representation).即采用MASK任务来训练模型。</p></blockquote><ul><li>在原始训练文本中，随机的抽取15%的tokn作为参与MASK任务的对象。</li><li>在这些被选中的tokn中，数据生成器并不是把它们全部变成[MASK],而是有下列3种情<br>况。<ul><li>在80%的概率下，用MASK标记替换该token,比如my dog is hairy&gt;my dog is<br>[MASK]</li><li>在10%的概率下，用一个随机的单词替换token,比如my dog is hairy&gt;my dog is<br>apple。</li><li>在10%的概率下，保持该token不变，比如my dog is hairy-&gt;my dog is hairy。</li></ul></li><li>模型在训练的过程中，并不知道它将要预测哪些单词？哪些单词是原始的样子？哪些单词被遮掩成了[MASK]?哪些单词被替换成了其他单词？正是在这样一种高度不确定的情况下，反倒逼着模型快速学习该tokn的分布式上下文的语义，尽最大努力学习原始语言说话的样子.同时因为原始文本中只有15%的tokn参与了MASK操作，并不会破坏原语言的表达能力和语言规则。</li></ul><h3 id="任务二：Next-Sentence-Prediction-下一句话预测任务">任务二：Next Sentence Prediction(下一句话预测任务)</h3><blockquote><p>在NLP中有一类重要的问题比如QA(Quention-Answer),NLI(Natural Language Inference),需要模型能够很好的理解两个句子之间的关系，从而需要在模型的训练中引入对应的任务，在BERT中引入的就是Next Sentence Prediction任务.采用的方式是输入句子对(A,B),模型来预测句子B是不是句子A的真实的下一句话。</p></blockquote><ul><li>所有参与任务训练的语句都被选中作为句子A。<ul><li>其中50%的B是原始文本中真实跟随A的下一句话。（标记为IsNext,代表正样本）</li><li>其中50%的B是原始文本中随机抽取的一句话。（标记为NotNext,代表负样本）</li></ul></li><li>在任务二中，BERT模型可以在测试集上取得97%-98%的准确率。</li></ul><h1>Transformer</h1><h2 id="Encoder模块">Encoder模块</h2><h3 id="Encoder模块的结构和作用">Encoder模块的结构和作用</h3><ul><li>经典的Transformer结构中的Encoder模块包含6个Encoder Block</li><li>每个Encoder Block包含一个多头自注意力层，和一个前馈全连接层，</li></ul><h3 id="关于Encoder-Block">关于Encoder Block</h3><p>在Transformer架构中，6个一模一样的Encoder Block层层堆叠在一起，共同组成完整的Encoder,因此剖析一个Block就可以对整个Encoder的内部结构有清晰的认识。</p><h3 id="多头自注意力层-self-attention">多头自注意力层(self-attention)</h3><ul><li>self-attention的计算规则：</li></ul><blockquote><p>上述attention可以被描述为将quey和key-value键值对的一组集合映射到输出，输出被计算为values的加权和，其中分配给每个value的权重由quey与对应key的相似性函数计算得来。这种attention的形式被称为Scaled Dot-Product Attention,对应的数学公式形式如下：</p></blockquote><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Attention</mtext><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy="false">)</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">\text{Attention}(Q,K,V)=\text{softmax}(\frac{QK^T}{\sqrt{d_k}})V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4483em;vertical-align:-0.93em;"></span><span class="mord text"><span class="mord">softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.2528em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>MultiHead</mtext><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy="false">(</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mi>h</mi></msub><mo stretchy="false">)</mo><msup><mi>W</mi><mi>O</mi></msup></mrow><annotation encoding="application/x-tex">\text{MultiHead}(Q,K,V)= Concat (head_1,...,head_h)W^O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">MultiHead</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mi>i</mi></msub><mo>=</mo><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mrow><mo fence="true">(</mo><mi>Q</mi><msubsup><mi>W</mi><mi>i</mi><mi>Q</mi></msubsup><mo separator="true">,</mo><mi>K</mi><msubsup><mi>W</mi><mi>i</mi><mi>K</mi></msubsup><mo separator="true">,</mo><mi>V</mi><msubsup><mi>W</mi><mi>i</mi><mi>V</mi></msubsup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">where head_i = Attention \left(QW_{i}^{Q},KW_{i}^{K},VW_{i}^{V}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4231em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>W</mi><mi>i</mi><mi>Q</mi></msubsup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><msub><mi>d</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi></mrow></msub><mo>×</mo><msub><mi>d</mi><mi>k</mi></msub></mrow></msup><mo separator="true">,</mo><msubsup><mi>W</mi><mi>i</mi><mi>K</mi></msubsup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><msub><mi>d</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi></mrow></msub><mo>×</mo><msub><mi>d</mi><mi>k</mi></msub></mrow></msup><mo separator="true">,</mo><msubsup><mi>W</mi><mi>i</mi><mi>V</mi></msubsup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><msub><mi>d</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi></mrow></msub><mo>×</mo><msub><mi>d</mi><mi>v</mi></msub></mrow></msup><mo separator="true">,</mo><msup><mi>W</mi><mi>O</mi></msup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>h</mi><msub><mi>d</mi><mi>v</mi></msub><mo>×</mo><msub><mi>d</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">l</mi></mrow></msub></mrow></msup></mrow><annotation encoding="application/x-tex">W_i^Q\in\mathbb{R}^{d_{\mathrm{model}}\times d_k},W_i^K\in\mathbb{R}^{d_{\mathrm{model}}\times d_k},W_i^V\in\mathbb{R}^{d_{\mathrm{model}}\times d_v},W^O\in\mathbb{R}^{hd_v\times d_{\mathrm{model}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2361em;vertical-align:-0.2769em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9592em;"><span style="top:-2.4231em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.1809em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1461em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">model</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1461em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">model</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0935em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">model</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8991em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">model</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><blockquote><p>多头self-attention,层的作用：实验结果表明，Multi–head可以在更细致的层面上提取不同head的特征，总体计算量和单一head相同的情况下，提取特征的效果更佳。</p></blockquote><h3 id="前馈全连接层模块">前馈全连接层模块</h3><p>前馈全连接层模块，由两个线性变换组成，中间有一个Relu激活函数（max()），对应的数学公式形式如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">F</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">N</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm{FFN}(x)=\max\left(0,xW_1+b_1\right)W_2+b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">FFN</span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><ul><li>注意：原版论文中的前馈全连接层，输入和输出的维度均为d_model=512,层内的连接维度df仟=2048，均采用4倍的大小关系。</li></ul><blockquote><p>前馈全连接层的作用：单纯的多头注意力机制并不足以提取到理想的特征，因此增加全连接层来提升网络的能力。</p></blockquote><h2 id="剩下的视频看完了还在写……">剩下的视频看完了还在写……</h2><h1>CRF</h1><h2 id="CRF模型的输入和输出">CRF模型的输入和输出</h2><p>CRF(Conditional Random Fields),中文称作条件随机场，同HMM一样，它一般也以文本序列数据为输入，以该序列对应的隐含序列为输出。</p><h2 id="CRF模型的作用：">CRF模型的作用：</h2><p>同HMM一样，在NLP领域，CRF用来解决文本序列标注问题.如分词，词性标注，命名实体识别。</p><h2 id="CRF模型使用过程简述">CRF模型使用过程简述</h2><ul><li>首先，CRF模型表示为：lambda=CRF(w1,w2,wn),其中w1到wn是模型参数</li><li>接着，我们开始训练CRF模型，语料同样是事先准备好的一定数量的观测序列及其对应的隐含序列</li><li>与此同时我们还需要做人工特征工程，然后通过不断训练求得一组参数，使由观测序列到对应隐含序列的概率最大</li><li>训练后，我们就得到了具备预测能力的新模型：lambda=CRF(w1,w2,.,wn),其中的模型参数已经改变</li><li>之后给定输入序列(x1,x2,n),经过模型计算lambda(x1,x2,n)得到对应隐含序列的<br>条件概率分布</li><li>最后，还是使用维特比算法从隐含序列的条件概率分布中找出概率最大的一条序列路径就是我们需要的隐含序列：(y1,y2,yn)</li></ul><h2 id="HMM与CRF模型之间差异">HMM与CRF模型之间差异</h2><ul><li>HMM模型存在隐马假设，而CRF不存在，因此HMM的计算速度要比CRF模型快很多，适用于对预测性能要求较高的场合</li><li>同样因为隐马假设，当预测问题中隐含序列单元并不是只与上一个单元有关时，HMM的准确率会大大降低，而CRF不受这样限制，准确率明显高于HMM</li></ul><h2 id="HMM和CRF的发展现状">HMM和CRF的发展现状</h2><ul><li>HMM和CRF模型曾在多种序列任务中表现出色，伴随NLP工程师度过漫长的一段时期</li><li>但由于近年来深度学习发展迅速，经典序列模型，如HMM和CRE已经开始慢慢淡出人们的<br>视野</li><li>因此，我们这里也是对其做了简洁的总结知识，让大家对其有一定的基本认识</li></ul>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch安装环境问题</title>
      <link href="/2024/02/07/NER/pytorch%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98/"/>
      <url>/2024/02/07/NER/pytorch%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1>自己安</h1><p>突然兴起想重装Anaconda和Pycharm,好家伙,整整两天才给全部整明白,最大的原因见文末，在此记录一下我踩的坑。</p><p>参考【PyTorch深度学习快速入门教程（绝对通俗易懂！）【小土堆】】 <a href="https://www.bilibili.com/video/BV1hE411t7RN/?share_source=copy_web&amp;vd_source=4bd852f834f2d9a6a8ce0609a36001d4">https://www.bilibili.com/video/BV1hE411t7RN/?share_source=copy_web&amp;vd_source=4bd852f834f2d9a6a8ce0609a36001d4</a></p><p>Anaconda（<code>Anaconda3-2023.09-0-Windows-x86 64.exe</code>）,pycharm，pytorch已下好且pytorch（本机没有满足要求的GPU，选的CPU）可正常激活，中文路径问题可参考CSDN通过配置环境变量解决，仅最后一步不对。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(pytorch) PS C:\Users\王越洋&gt; python</span><br><span class="line">Python 3.6.13 |Anaconda, Inc.| (default, Mar 16 2021, 11:37:27) [MSC v.1916 64 bit (AMD64)] on win32</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import torch</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>但配置时报错如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py:21: UserWarning: mkl-service package failed to import, therefore Intel(R) MKL initialization ensuring its correct out-of-the box operation under condition when Gnu OpenMP had already been loaded by Python process is not assured. Please install mkl-service package, see http://github.com/IntelPython/mkl-service</span><br><span class="line">  module = self._system_import(name, *args, **kwargs)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\numpy\core\__init__.py&quot;, line 22, in &lt;module&gt;</span><br><span class="line">    from . import multiarray</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\numpy\core\multiarray.py&quot;, line 12, in &lt;module&gt;</span><br><span class="line">    from . import overrides</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\numpy\core\overrides.py&quot;, line 7, in &lt;module&gt;</span><br><span class="line">    from numpy.core._multiarray_umath import (</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">ImportError: DLL load failed: 找不到指定的模块。</span><br><span class="line">During handling of the above exception, another exception occurred:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\code.py&quot;, line 91, in runcode</span><br><span class="line">    exec(code, self.locals)</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\torch\__init__.py&quot;, line 613, in &lt;module&gt;</span><br><span class="line">    _C._initExtension(manager_path())</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\torch\cuda\__init__.py&quot;, line 685, in &lt;module&gt;</span><br><span class="line">    from . import amp</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\torch\cuda\amp\__init__.py&quot;, line 1, in &lt;module&gt;</span><br><span class="line">    from .autocast_mode import autocast, custom_fwd, custom_bwd  # noqa: F401</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\torch\cuda\amp\autocast_mode.py&quot;, line 5, in &lt;module&gt;</span><br><span class="line">    import numpy as np</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\numpy\__init__.py&quot;, line 140, in &lt;module&gt;</span><br><span class="line">    from . import core</span><br><span class="line">  File &quot;D:\ruanjian\Pycharm\PyCharm 2023.3.2\plugins\python\helpers\pydev\_pydev_bundle\pydev_import_hook.py&quot;, line 21, in do_import</span><br><span class="line">    module = self._system_import(name, *args, **kwargs)</span><br><span class="line">  File &quot;C:\Users\王越洋\.conda\envs\pytorch\lib\site-packages\numpy\core\__init__.py&quot;, line 48, in &lt;module&gt;</span><br><span class="line">    raise ImportError(msg)</span><br><span class="line">ImportError: </span><br><span class="line">IMPORTANT: PLEASE READ THIS FOR ADVICE ON HOW TO SOLVE THIS ISSUE!</span><br><span class="line">Importing the numpy C-extensions failed. This error can happen for</span><br><span class="line">many reasons, often due to issues with your setup or how NumPy was</span><br><span class="line">installed.</span><br><span class="line">We have compiled some common reasons and troubleshooting tips at:</span><br><span class="line">    https://numpy.org/devdocs/user/troubleshooting-importerror.html</span><br><span class="line">Please note and check the following:</span><br><span class="line">  * The Python version is: Python3.6 from &quot;C:\Users\王越洋\.conda\envs\pytorch\python.exe&quot;</span><br><span class="line">  * The NumPy version is: &quot;1.19.2&quot;</span><br><span class="line">and make sure that they are the versions you expect.</span><br><span class="line">Please carefully study the documentation linked above for further help.</span><br><span class="line">Original error was: DLL load failed: 找不到指定的模块。</span><br></pre></td></tr></table></figure><p><s>初步怀疑问题在于</s>（是小白没错了，后面人家说和这个没关系，看到这个报错的uu不要惊慌）</p><p>但当时我不知道啊，遂运行提示命令，无果，约半小时后提示某文件没有admission，CSDN有文指出该问题可以重新更新conda，下载一小时没下完。两个都运行了两次左右，各种重装Anaconda，结果人家输出我没有admission，如果你和我一样装Anaconda时选的<code>给所有人装</code>的选项，记得在权限里设置<code>所有人可修改</code>即可解决。当然，不设置也可以。</p><p>最后，这个错无伤大雅，重点不在这，不要运行<code>conda update -n base -c defaults conda</code> 就是了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(pytorch) PS C:\Users\王越洋&gt; conda install pytorch torchvision torchaudio cpuonly -c pytorch</span><br><span class="line">Collecting package metadata (current_repodata.json): done</span><br><span class="line">Solving environment: done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==&gt; WARNING: A newer version of conda exists. &lt;==</span><br><span class="line">  current version: 23.7.4</span><br><span class="line">  latest version: 24.1.0</span><br><span class="line"></span><br><span class="line">Please update conda by running</span><br><span class="line"></span><br><span class="line">    $ conda update -n base -c defaults conda</span><br><span class="line"></span><br><span class="line">Or to minimize the number of packages updated during conda update use</span><br><span class="line"></span><br><span class="line">     conda install conda=24.1.0</span><br><span class="line"></span><br><span class="line"># All requested packages already installed.</span><br></pre></td></tr></table></figure><p>这个报错的意思是你有库安了，但是没安全。</p><h1>深夜寻求某宝</h1><p>凌晨00:23，解决无果，遂面向某宝解决（cost20￥），次日早，某阿里员工给我一波各种操作，两小时后告诉我问题是numpy库没安全，然后各种调试，找版本，然后安，解决！</p><p>下午，感觉自己又行了，于是自己重新建了一个虚拟环境，把人家建的删了，报错依旧，重装numpy无果，<s>发疯发疯</s>，感觉这个人解决问题不能一劳永逸（其实是我没学会。。。人家还是很厉害滴）~</p><h1>晚上寻求拼夕夕🌟</h1><p>已是晚10：20,继第10次左右重新安装调试后，随便捞了个能安的人（cost15￥），看得出来他也很焦灼，甚至还出现了新错误:</p><p>(1)Environment创建失败（这个和库没关系，是说你的源或者网络问题，建议换源即可）</p><p>(2)系统找不到指定路径。这个就比较棘手了，人家配了环境变量，各种调试，无果。通过装<code>Anaconda3-2020.11 Windows-x86 64.exe</code>，再来一遍pip配置，成功！！！</p><p>通过pip安装就不会像通过conda安装报错，成功解决！！！</p><p>小问题：conda安装的虚拟环境位置在<code>C:/User/XXX/.conda/env/</code>下的,但这种方式安装的虚拟环境位置在Anaconda3的安装目录下，其他运行均正常，虽然还是会报版本不一致的错，但无碍。本次配置终于完成！！</p><h1>结果</h1><p>综上，出现此类错误的人建议装低版本一点的Anaconda(卸的时候记得用自带的工具卸，写完检查环境变量删干净没)，安装时记得把PATH选项勾上（要不然要自己配，容易配错），最新版的Anaconda应该是有小毛病（库不全），[谨慎安装！！！]{.red}</p><p>祝看到这里的各位PyTorch学习顺利！🌟</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文本预处理</title>
      <link href="/2024/02/07/NER/%E6%96%87%E6%9C%AC%E9%A2%84%E5%A4%84%E7%90%86/"/>
      <url>/2024/02/07/NER/%E6%96%87%E6%9C%AC%E9%A2%84%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1>文本处理的基本方法</h1><h2 id="分词">分词</h2><h3 id="什么是分词？">什么是分词？</h3><blockquote><p>分词就是将连续的字序列按照一定的规范重新组合成词序列的过程。我们知道，在英文的<br>行文中，单词之间是以空格作为自然分界符的，而中文只是字、句和段能通过明显的分界<br>符来简单划界，唯独词没有一个形式上的分界符，分词过程就是找到这样分界符的过程，</p></blockquote><ul><li>举例：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">女干事每月经过下属科室都</span><br><span class="line">==&gt;</span><br><span class="line">[<span class="string">&#x27;女干事&#x27;</span>，<span class="string">&#x27;每月&#x27;</span>，<span class="string">&#x27;经过&#x27;</span>，<span class="string">&#x27;下属&#x27;</span>，<span class="string">&#x27;科室&#x27;</span>，<span class="string">&#x27;都&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="分词的作用">分词的作用</h3><ul><li>词作为语言语义理解的最小单元，是人类理解文本语言的基础.因此也是AI解决NLP领域高阶任务，如自动问答，机器翻译，文本生成的重要基础环节。</li></ul><h3 id="流行中文分词工具jieba">流行中文分词工具jieba</h3><blockquote><p>&quot;结巴&quot;中文分词，做最好的Python中文分词组件。</p></blockquote><ul><li><p>jiebal的特性：</p><ul><li>支持多种分词模式</li><li>精确模式</li><li>全模式</li><li>搜索引擎摸式</li><li>支持中文繁体分词</li><li>支持用户自定义词典</li></ul></li><li><p>jieba使用</p></li></ul><blockquote><p>精确模式分词：试图将句子最精确地切开，适合文本分析</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> jieba</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">&quot;女干事每月经过下属科室都&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.cut(content,cut_all=<span class="literal">False</span>)(默认为<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成器对象</span></span><br><span class="line">&lt;generator <span class="built_in">object</span> Tokenizer.cut at <span class="number">0x000001ED13237350</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.lcut(content,cut_all=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#列表内容</span></span><br><span class="line">Building prefix <span class="built_in">dict</span> <span class="keyword">from</span> the default dictionary ...</span><br><span class="line">Dumping model to file cache C:\WINDOWS\TEMP\jieba.cache</span><br><span class="line">Loading model cost <span class="number">0.607</span> seconds.</span><br><span class="line">Prefix <span class="built_in">dict</span> has been built successfully.</span><br><span class="line">Out[<span class="number">9</span>]: [<span class="string">&#x27;女干事&#x27;</span>, <span class="string">&#x27;每月&#x27;</span>, <span class="string">&#x27;经过&#x27;</span>, <span class="string">&#x27;下属&#x27;</span>, <span class="string">&#x27;科室&#x27;</span>, <span class="string">&#x27;都&#x27;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>全模式分词：把句子中所有的可以成词的词语都扫描出来，速度非常快，但是不能消除歧义。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">&quot;女干事每月经过下属科室都&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.cut(content,cut_all=<span class="literal">True</span>)</span><br><span class="line"> &lt;generator <span class="built_in">object</span> Tokenizer.cut at <span class="number">0x000001ED13237D60</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.lcut(content,cut_all=<span class="literal">True</span>)</span><br><span class="line"> [<span class="string">&#x27;女干事&#x27;</span>, <span class="string">&#x27;干事&#x27;</span>, <span class="string">&#x27;每月&#x27;</span>, <span class="string">&#x27;月经&#x27;</span>, <span class="string">&#x27;经过&#x27;</span>, <span class="string">&#x27;下属&#x27;</span>, <span class="string">&#x27;科室&#x27;</span>, <span class="string">&#x27;都&#x27;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>搜索引擎模式分词：在精确模式的基础上，对长词再次切分，提高召回率，适合用于搜索引擎分词。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">&quot;女干事每月经过下属科室都&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.cut_for_search(content)</span><br><span class="line"> &lt;generator <span class="built_in">object</span> Tokenizer.cut_for_search at <span class="number">0x000001ED14A014A0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.lcut_for_search(content)</span><br><span class="line">[<span class="string">&#x27;干事&#x27;</span>, <span class="string">&#x27;女干事&#x27;</span>, <span class="string">&#x27;每月&#x27;</span>, <span class="string">&#x27;经过&#x27;</span>, <span class="string">&#x27;下属&#x27;</span>, <span class="string">&#x27;科室&#x27;</span>, <span class="string">&#x27;都&#x27;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>中文繁体分词：针对中国香港，台湾地区的繁体文本进行分词</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>content = <span class="string">&quot;烦惱即是菩提，我暂且不提&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba.lcut_for_search(content)</span><br><span class="line"> [<span class="string">&#x27;烦惱&#x27;</span>, <span class="string">&#x27;即&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;菩提&#x27;</span>, <span class="string">&#x27;，&#x27;</span>, <span class="string">&#x27;我&#x27;</span>, <span class="string">&#x27;暂且&#x27;</span>, <span class="string">&#x27;不提&#x27;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>使用用户自定义词典</p></blockquote><ul><li>添加自定义词典后，jieba能够准确识别词典中出现的词汇，提升整体的识别准确率，</li><li>词典格式：每一行分三部分：词语、词频（可省略）、词性（可省略），用空格隔开<br>顺序不可颠倒</li><li>词典样式如下，具体词性含义请参照附录：jieba词性对照表，将该词典存userdict.txt,方便之后加载使用。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">云计算5n</span><br><span class="line">李小福2nr</span><br><span class="line">easy_install <span class="number">3</span> eng</span><br><span class="line">好用<span class="number">300</span></span><br><span class="line">韩玉赏鉴3nZ</span><br><span class="line">八一双鹿3nz</span><br></pre></td></tr></table></figure><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="keyword">import</span> jieba</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>jieba<span class="number">.1</span>cut(<span class="string">&quot;八一双鹿更名为八一南昌篮球队！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#没有使用用户自定义词典前的结果：</span></span><br><span class="line">&gt;&gt;&gt;[<span class="string">&#x27;八一双鹿&#x27;</span>，<span class="string">&#x27;更名&#x27;</span>，<span class="string">&#x27;为&#x27;</span>，<span class="string">&#x27;八一&#x27;</span>，<span class="string">&#x27;南昌&#x27;</span>，<span class="string">&#x27;篮球队&#x27;</span>，<span class="string">&#x27;!&#x27;</span>]</span><br><span class="line"></span><br><span class="line">&gt;&gt;jieba.load_userdict(<span class="string">&quot;./userdict.txt&quot;</span>)</span><br><span class="line"><span class="comment">#使用了用户自定义词典后的结果：</span></span><br><span class="line">[<span class="string">&#x27;八一双鹿&#x27;</span>，<span class="string">&#x27;更名&#x27;</span>，<span class="string">&#x27;为&#x27;</span>,<span class="string">&#x27;八一&#x27;</span>,<span class="string">&#x27;南昌&#x27;</span>，<span class="string">&#x27;篮球队&#x27;</span>，<span class="string">&#x27;!&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="命名实体识别">命名实体识别</h2><p>顾名思义，命名实体识别(Named Entity Recognition,简称NER)就是识别出一段文本中可能存在的命名实体。</p><ul><li>命名实体识别的作用：</li></ul><p>同词汇一样，命名实体也是人类理解文本的基础单元，因此也是A解决NLP领域高阶任务的重要基础环节</p><h2 id="词性标注">词性标注</h2><blockquote><p>词性：语言中对词的一种分类方法，以语法特征为主要依据、兼顾词汇意义对词进行划分的结果，常见的词性有143如：名词，动词，形容词等</p></blockquote><p>顾名思义，词性标注(Part-Of-Speech tagging,简称POS)就是标注出一段文本中每个词汇的词性。</p><ul><li>词性标注的作用</li></ul><p>词性标注以分词为基础，是对文本语言的另一个角度的理解，因此也常常成为A解决NLP领域高阶任务的重要基础环节。</p><ul><li>使用jieba进行中文词性标注</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> jieba.posseg <span class="keyword">as</span> pseg</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pseg.lcut(<span class="string">&quot;我爱北京天安门&quot;</span>)</span><br><span class="line">[pair(<span class="string">&#x27;我&#x27;</span>, <span class="string">&#x27;r&#x27;</span>), pair(<span class="string">&#x27;爱&#x27;</span>, <span class="string">&#x27;v&#x27;</span>), pair(<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;ns&#x27;</span>), pair(<span class="string">&#x27;天安门&#x27;</span>, <span class="string">&#x27;ns&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">rr:人称代词</span><br><span class="line">v:动词</span><br><span class="line">n:名词</span><br><span class="line">vn:动名词</span><br></pre></td></tr></table></figure><h1>文本张量表示方法</h1><ul><li>什么是文本张量表示</li></ul><p>将一段文本使用张量进行表示，其中一般将词汇为表示成向量，称作词向量，再由各个词向量按顺序组成矩阵形成文本表示。</p><p>举个栗子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;人生&quot;</span>，<span class="string">&quot;该&quot;</span>，<span class="string">&quot;如何&quot;</span>，<span class="string">&quot;起头&quot;</span>]</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#每个词对应矩阵中的一个向量</span></span><br><span class="line">[[<span class="number">1.32</span>,<span class="number">4</span>,<span class="number">32</span>,<span class="number">6</span>,<span class="number">32</span>,<span class="number">5.2</span>],</span><br><span class="line">[<span class="number">3.1</span>,<span class="number">5.43</span>,<span class="number">0.34</span>,<span class="number">3.2</span>],</span><br><span class="line">[<span class="number">3.21</span>,<span class="number">5.32</span>,<span class="number">2</span>,<span class="number">4.32</span>],</span><br><span class="line">[<span class="number">2.54</span>,<span class="number">7.32</span>,<span class="number">5.12</span>,<span class="number">9.54</span>]]</span><br></pre></td></tr></table></figure><ul><li>文本张量表示的作用</li></ul><p>将文本表示成张量（矩阵）形式，能够使语言文本可以作为计算机处理程序的输入，进行接下来一系列的解析工作。</p><blockquote><ul><li>文本张量表示的方法：<ul><li>one-hot编码</li><li>Word2vec</li><li>Word Embedding</li></ul></li></ul></blockquote><h2 id="one-hot-独热编码">one-hot(独热编码)</h2><ul><li>什么是one-hot(独热编码)词向量表示</li></ul><p>又称独热编码，将每个词表示成具有个元素的向量，这个词向量中只有一个元素是1，其他元素都是0，不同词汇元素为0的位置不同，其中的大小是整个语料中不同词汇的总数。</p><p>举个栗子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;改变&quot;</span>，<span class="string">&quot;要&quot;</span>，<span class="string">&quot;如何&quot;</span>，<span class="string">&quot;起手&quot;</span>]</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>],</span><br><span class="line">[<span class="number">6</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">0</span>],</span><br><span class="line">[<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">6</span>],</span><br><span class="line">[<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]]</span><br></pre></td></tr></table></figure><ul><li>实现</li></ul><ol><li>进行one-hot(独热编码)</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入用于对象保存与加载的job11b</span></span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"><span class="comment">#导入keras中的词汇映射器Tokenizer</span></span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.text <span class="keyword">import</span> Tokenizer</span><br><span class="line"><span class="comment">#假定vocab为语料集所有不同词汇集合</span></span><br><span class="line">vocab = &#123;<span class="string">&quot;周杰伦&quot;</span>,<span class="string">&quot;陈奕迅&quot;</span>,<span class="string">&quot;王力宏&quot;</span>,<span class="string">&quot;李宗盛&quot;</span>,<span class="string">&quot;吴亦凡&quot;</span>,<span class="string">&quot;鹿晗&quot;</span>&#125;</span><br><span class="line"><span class="comment">#实例化一个词汇映射器对象</span></span><br><span class="line">t = Tokenizer(num_words=<span class="literal">None</span>,char_level=<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#使用映射器拟合现有文本数据</span></span><br><span class="line">t.fit_on_texts(vocab)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> token <span class="keyword">in</span> vocab:</span><br><span class="line">    zero_list = [<span class="number">0</span>]*<span class="built_in">len</span>(vocab)</span><br><span class="line">    <span class="comment">#使用映射器转化现有文本数据，**每个词汇对应从1开始的自然数</span></span><br><span class="line">    <span class="comment">#返回样式如：[[2]]，取出其中的数字需要使用[0][0]</span></span><br><span class="line">    token_index = t.texts_to_sequences([token])[<span class="number">0</span>][<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line">    zero_list[token_index] = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(token,<span class="string">&quot;的one-hot编码为：&quot;</span>,zero_list)</span><br><span class="line"></span><br><span class="line">李宗盛 的one-hot编码为： [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">王力宏 的one-hot编码为： [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">鹿晗 的one-hot编码为： [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">吴亦凡 的one-hot编码为： [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">陈奕迅 的one-hot编码为： [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">周杰伦 的one-hot编码为： [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用jobl1b工具保存映射器，以便之后使用</span></span><br><span class="line">tokenizer_path <span class="string">&quot;./Tokenizer&quot;</span></span><br><span class="line">joblib.dump(t,tokenizer_path)</span><br></pre></td></tr></table></figure><blockquote><p>注意 ！！！ 务必用conda安装tensorflow,会自动匹配对应的版本，pip会有不兼容问题。<br>cpu的直接<code>conda install tensorflow</code>即可，不要指定版本，会找不到包。然后根据对应的报错进行<code>conda install chardet</code>,大功告成！</p></blockquote><ol start="2"><li>使用</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入用于对象保存与加载的job11b</span></span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"><span class="comment">#加载之前保存的Tokenizer,实例化一个t对象</span></span><br><span class="line">t = joblib.load(tokenizer_path)</span><br><span class="line"></span><br><span class="line"><span class="comment">#编码token为&quot;李宗盛&quot;</span></span><br><span class="line">token=<span class="string">&quot;李宗盛&quot;</span></span><br><span class="line"><span class="comment">#使用t获得token-index</span></span><br><span class="line">token_index = t.texts_to_sequences([token])[<span class="number">0</span>][<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line"><span class="comment">#初始化一个zero-11st</span></span><br><span class="line">zero_list = [<span class="number">0</span>]*<span class="built_in">len</span>(vocab)</span><br><span class="line"><span class="comment">#令zero-L1st的对应索引为1</span></span><br><span class="line">zero_list[token_index] = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(token,<span class="string">&quot;的one-hot编码为：&quot;</span>，zero_list)</span><br></pre></td></tr></table></figure><ol start="3"><li>输出效果</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">李宗盛的one-hot编码为：[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>]</span><br></pre></td></tr></table></figure><ol start="4"><li>one-hot编码的优劣势：</li></ol><p>优势：摄作简单，容易理解。</p><p>劣势：完全割裂了词与词之间的联系，而且在大语料集下，每个向量的长度过大，占据大量内存。</p><blockquote><p>说明</p></blockquote><p>正因为one-hot编码明显的劣势，这种编码方式被应用的地方越来越少，取而代之的是<br>接下来我们要学习的稠密向量的表示方法word2vec和word embedding。</p><h2 id="Word2vec">Word2vec</h2><p>是一种流行的将词汇表示成向量的无监督训练方法，该过程将构建神经网络模型，将网络参<br>数作为词汇的向量表示，它包含CBOW和skipgram两种训练模式。</p><h3 id="CBOW-Continuous-bag-of-words-模式">CBOW(Continuous bag of words)模式</h3><p>给定一段用于训练的文本语料，再选定某段长度（窗口）作为研究对象，使用上下文词汇预测目标词汇。</p><h4 id="Word2vec过程">Word2vec过程</h4><p>假设我们给定的训练语料只有一句话：<code>Hope can set you free</code>(愿你自由成长)，窗口大小为<br>3,因此模型的第一个训练样本来自<code>Hope can set</code>,因为是CBOW模式，所以将使用<code>Hope</code>和<br><code>set</code>作为输入，<code>can</code>作为输出，在模型训练时，<code>Hope</code>,<code>can</code>,<code>set</code>等词汇都使用它们的one-hot编码。如图所示：每个one-hot编码的单词与各自的变换矩阵(即参数矩阵3x5,这里的3是指最后得到的词向量维度)相乘之后再相加，得到上下文表示矩阵(3x1)。</p><p>接着，将上下文表示矩阵与变换矩阵（参数矩阵5x3,所有的变换矩阵共享参数）相乘，得到5x1的结果矩阵，它将与我们真正的目标矩阵即can的one-hot编码矩阵(5x1)进行损失的计算，然后更新网络参数完成一次模型迭代。</p><p>最后窗口按序向后移动，重新更新参数，直到所有语料被遍历完成，得到最终的变换矩阵<br>(3x5),这个变换矩阵与每个词汇的one-hot编码(5x1)相乘，得到的3x1的矩阵就是该词汇的Word2Vec张量表示。</p><h3 id="skipgram模式">skipgram模式</h3><p>给定一段用于训练的文本语料，再选定某段长度（窗口）作为研究对象，使用目标词汇预测上下文词汇。</p><p>可设窗口大小为9，使用目标词汇对前后4个词汇进行预测。</p><h4 id="Word2vec过程-2">Word2vec过程</h4><p>假设我们给定的训练语料只有一句话：<code>Hope can set you free</code>(愿你自由成长)，窗口大小为3,因此模型的第一个训练样本来自Hope can set,因为是skipgram模式，所以将使用<code>can</code>作为输入，<code>Hope</code>和<code>set</code>作为输出，在模型训练时，<code>Hope</code>,<code>can</code>,<code>set</code>等词汇都使用它们的one-hot编码。如图所示：将<code>can</code>的one-hot编码与变换矩阵(即参数矩阵3x5,这里的3是指最后得到的词向量维度)相乘，得到目标词汇表示矩阵(3x1)。</p><p>接着，将目标词汇表示矩阵与多个变换矩阵(参数矩阵5x3)相乘，得到多个5x1的结果矩阵，它将与我们Hope和set对应的one-hot编码矩阵(5x1)进行损失的计算，然后更新网络参数完成一次模型迭代。</p><p>最后窗口按序向后移动，重新更新参数，直到所有语料被追历完成，得到最终的变换矩阵即参数矩阵(3x5),这个变换矩阵与每个词汇的one-hot编码(5x1)相乘，得到的3x1的矩阵就是该词汇的word2vec张量表示。</p><h3 id="使用fasttext工具实现word2vec的训练和使用：">使用fasttext工具实现word2vec的训练和使用：</h3><p>第一步：获取训练数据</p><p>第二步：训练词向量</p><p>第三步：模型超参数设定</p><p>第四步：模型效果检验</p><p>第五步：模型的保存与重加载</p><p>实现过程有待补充</p><h2 id="word-embedding-词嵌入">word embedding(词嵌入)</h2><blockquote><p>通过一定的方式将词汇映射到指定维度（一般是更高维度）的空间.</p></blockquote><ul><li>广义的word embedding包括所有密集词汇向量的表示方法，如之前学习的word2vec,即可认为是word embedding的一种。</li><li>狭义的word embedding是指在神经网络中加入的embedding层，对整个网络进行训练的同时产生的embedding矩阵(embedding层的参数)，这个embedding矩阵就是训练过程中所有输入词汇的向量表示组成的矩阵。</li></ul><h1>文本数据分析</h1><h2 id="作用">作用</h2><p>文本数据分析能够有效帮助我们理解数据语料，快速检查递语料可能存在的问题，并指导之后模型训练过程中一些超参数的选择</p><ul><li>常用的几种文本数据分析方法<ul><li>标签数量分布</li><li>句子长度分布</li><li>词频统计与关键词词云</li></ul></li></ul><h1>文本特征处理</h1><h2 id="作用-2">作用</h2><p>文本特征处理包括为语料添加具有普适性的文本特征，如：n-gram特征，以及对加入特征之后的文本语料进行必要的处理，如：长度规范.这些特征处理工作能够有效的将重要的文本特征加入模型训练中，增强模型评估指标。</p><ul><li>常见的文本特征处理方法<ul><li>添加n-gram特征</li><li>文本长度规范</li></ul></li></ul><h3 id="n-gram特征">n-gram特征</h3><blockquote><p>给定一段文本序列，其中n个词或字的相邻共现特征即n-gram特征，常用的n-gram特征是bigram和tri-gram特征，分别对应n为2和3。</p></blockquote><h3 id="文本长度规范及其作用（padding函数）">文本长度规范及其作用（padding函数）</h3><p>一般模型的输入需要等尺寸大小的矩阵，因此在进入模型前需要对每条文本数值映射后的<br>长度进行规范，此时将根据句子长度分布分析出覆盖绝大多数文本的合理长度，对超长文本进行截断，对不足文本进行补齐（一般使用数字0），这个过程就是仪本长度规范。</p><h1>文本数据增强</h1><blockquote><p>常见的文本数据增强方法:回译数据增强法</p></blockquote><h2 id="回译数据增强法">回译数据增强法</h2><p>回译数据增强目前是文本数据增强方面效果较好的增强方法，一般基于goog翻译接口，将文本数据翻译成另外一种语言（一般选择小语种），之后再翻译回原语言，即可认为得到与与原语料同标签的新语料，新语料加入到原数据集中即可认为是对原数据集数据增强。</p><blockquote><p>优势：操作简便，获得新语料质量高。</p></blockquote><blockquote><ul><li>问题<ul><li>在短文本回译过程中，新语料与原语料可能存在很高的重复率，并不能有效增大样本的特征空间。</li></ul></li></ul></blockquote><blockquote><ul><li>解决办法<ul><li>进行连续的多语言翻译，如：中文-&gt;韩文一&gt;日语-&gt;英文-&gt;中文，根据经验，最多只采用3次连续翻译，更多的翻译次数将产生效率低下，语义失真等问题。</li></ul></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>统计语言模型（n元语言模型）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/04%20%E7%BB%9F%E8%AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88n%E5%85%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/04%20%E7%BB%9F%E8%AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88n%E5%85%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>预训练</h1><p>预先训练</p><p>我们有两个相似的任务 A 和 B，任务 A 已经完成了得到了一个模型 A</p><p>任务 B（数据量小）</p><p>用到了一个特性：CNN 浅层参数通用</p><p>任务 B 就可以使用模型 A 的浅层参数，后面的参数通过任务 B 训练–》1. 冻结（浅层参数不变）2. 微调（变）</p><p>任务 B（大数据）可以训练出模型 B（我还可以使用模型 A 的浅层参数，节省训练时间，节省成本）</p><h1>统计语言模型</h1><h2 id="语言模型">语言模型</h2><p>语言（人说的话）+模型（表示某个东西，完成某个任务）</p><ol><li>P(“判断这个词的词性”)，P(“判断这个词的磁性”)</li><li>“判断这个词的<code>______</code>”</li></ol><h2 id="统计语言模型">统计语言模型</h2><p>用统计的方法去解决上述两个问题</p><p>“判断这个词的词性” = “判断”，“这个”，“词”，“的”，“词性”</p><p>这句话是序列（有顺序的）</p><p>用了一个条件概率的链式法则（概率论）</p><p>通过这个法则，我们可以求出每一个词出现的概率，然后连乘，就是这句话出现的概率</p><p>解决第二个问题：</p><p>“判断这个词的<code>__</code>”</p><p>P(w_next | “判断”，“这个”，“词”，“的”)  （1）</p><p>词库（词典）V–》新华字典，高处一个集合，把所有词装到集合 V 里</p><p>把集合里的每一个词，都进行上一步（1）的计算</p><p>词库 V = { “词性”， “火星”}</p><p>P(词性| “判断”，“这个”，“词”，“的”)</p><p>P(火星| “判断”，“这个”，“词”，“的”)</p><p>P(词性| “判断”，“这个”，“词”，“的”，……， “……”)</p><h2 id="n-元统计语言模型">n 元统计语言模型</h2><p>P(词性|“这个”，“词”，“的”)</p><p>P(火星| “这个”，“词”，“的”)</p><p>P(词性|“词”，“的”)</p><p>P(火星|“词”，“的”)</p><p>P(词性|“的”)</p><p>P(火星|“的”)</p><p>把 n 个词，取 2 个词（2 元），取 3 个词（3 元）</p><h1>如何去计算</h1><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">“词性是动词”</span><br><span class="line">“判断单词的词性”</span><br><span class="line">“磁性很强的磁铁”</span><br><span class="line">“北京的词性是名词”</span><br></pre></td></tr></table></figure><p>𝑃(词性|的) = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>词性，的</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>的</mtext><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{cout(词性，的)}{count(的)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord cjk_fallback mtight">的</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord cjk_fallback mtight">词性，的</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>2</mn><mn>3</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{2}{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><h1>平滑策略</h1><p>P(策略|平滑) = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0</mn><mn>0</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{0}{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><h1>统计语言模型</h1><p>语言模型：计算一句话的概率，计算下一个词可能是什么</p><p>统计语言模型：统计的方法去解决语言模型的问题（条件概率）</p><p>a 元语言模型：只取 a 个词（马尔科夫链）</p><p>平滑策略：</p><h1>下节课：神经网络语言模型</h1><p>统计语言模型：神经网络的方法去解决语言模型的问题</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是预训练（Transformer 前奏）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/03%20%E4%BB%80%E4%B9%88%E6%98%AF%E9%A2%84%E8%AE%AD%E7%BB%83%EF%BC%88Transformer%20%E5%89%8D%E5%A5%8F%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/03%20%E4%BB%80%E4%B9%88%E6%98%AF%E9%A2%84%E8%AE%AD%E7%BB%83%EF%BC%88Transformer%20%E5%89%8D%E5%A5%8F%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>预训练有什么用</h1><p>机器学习：偏数学（《统计学习方法》-李航）</p><p>深度学习（人工智能）的项目：大数据支持（主流）</p><p>我们很多项目没有大数据支持（小数据）</p><p>猫狗分类任务：100 张猫和狗的图片 --》给你一张图片，分出是猫还是狗（无法解决的一个问题，精度很低）</p><p>100000 张鹅和鸭的图片（已知，有人做过的，通过这10w 张图片做了一个模型 A）</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E5%9B%BE%E5%83%8F%E9%A2%84%E8%AE%AD%E7%BB%83%E7%A4%BA%E4%BE%8B.jpg" alt="img"></p><p>有人发现，浅层通用的（横竖撇捺）</p><p>我通过10w个鹅和鸭训练了一个模型 A，100 层的 CNN</p><p>任务 B：100 张猫和狗的图片，分类 --》 训练处 100层的 CNN，不可能实现的</p><p>尝试使用 A 的前 50 层，使用 100 层去完成任务 B</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E5%BA%94%E7%94%A8.jpg" alt="img"></p><ol><li>冻结：浅层参数不变</li><li>微调：浅层参数会跟着任务 B 训练而改变</li></ol><h1>预训练是什么</h1><p>通过一个已经训练好的模型 A，去完成一个小数据量的任务 B（使用了模型 A 的浅层参数）</p><p>任务 A 和任务 B 极其相似</p><h1>预训练怎么用</h1><p>fairseq 、transformers 库</p><h1>总结</h1><p>一个任务 A，一个任务 B，两者极其相似，任务 A 已经训练处一个模型 A，使用模型 A 的浅层参数去训练任务 B，得到模型 B’。</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>预训练语言模型的前世今生</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/00%20%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E5%85%A8%E6%96%87%2024854%20%E4%B8%AA%E8%AF%8D%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/00%20%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E5%85%A8%E6%96%87%2024854%20%E4%B8%AA%E8%AF%8D%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 style='text-align:center;'>预训练语言模型的前世今生 - 从Word Embedding到BERT</h1><p>本篇文章共 25027 个词，一个字一个字手码的不容易，转载请标明出处：<br><a href='https://www.cnblogs.com/nickchen121/p/15105048.html'>预训练语言模型的前世今生 - 从Word Embedding到BERT - 二十三岁的有德</a></p><p>[TOC]</p><p>Bert 最近很火，应该是最近最火爆的 AI 进展，网上的评价很高，从模型创新角度看一般，创新不算大。但是架不住效果太好了，基本刷新了很多 NLP 的任务的最好性能，有些任务还被刷爆了，这个才是关键。另外一点是 Bert 具备广泛的通用性，就是说绝大部分 NLP 任务都可以采用类似的两阶段模式直接去提升效果，这个第二关键。客观的说，把 Bert 当做最近两年 NLP 重大进展的集大成者更符合事实。</p><p>本文的主题是预训练语言模型的前世今生，会大致说下 NLP 中的预训练技术是一步一步如何发展到 Bert 模型的，从中可以很自然地看到 Bert 的思路是如何逐渐形成的，Bert 的历史沿革是什么，继承了什么，创新了什么，为什么效果那么好，主要原因是什么，以及为何说模型创新不算太大，为何说 Bert 是近年来 NLP 重大进展的集大成者。</p><p>预训练语言模型的发展并不是一蹴而就的，而是伴随着诸如词嵌入、序列到序列模型及 Attention 的发展而产生的。</p><p>DeepMind 的计算机科学家 Sebastian Ruder 给出了 21 世纪以来，从神经网络技术的角度分析，自然语言处理的里程碑式进展，如下表所示：</p><table><thead><tr><th>年份</th><th>2013 年</th><th>2014 年</th><th>2015 年</th><th>2016 年</th><th>2017 年</th></tr></thead><tbody><tr><td>技术</td><td>word2vec</td><td>GloVe</td><td>LSTM/Attention</td><td>Self-Attention</td><td>Transformer</td></tr></tbody></table><table><thead><tr><th>年份</th><th>2018 年</th><th>2019 年</th><th>2020 年</th></tr></thead><tbody><tr><td>技术</td><td>GPT/ELMo/BERT/GNN</td><td>XLNet/BoBERTa/GPT-2/ERNIE/T5</td><td>GPT-3/ELECTRA/ALBERT</td></tr></tbody></table><p>本篇文章将会通过上表显示的 NLP 中技术的发展史一一叙述，由于 19 年后的技术大都是 BERT 的变体，在这里不会多加叙述，读者可以自行加以了解。</p><h1>一、预训练</h1><h2 id="1-1-图像领域的预训练">1.1 图像领域的预训练</h2><p>在介绍图像领域的预训练之前，我们首先介绍下卷积神经网络（CNN），CNN 一般用于图片分类任务，并且CNN 由多个层级结构组成，不同层学到的图像特征也不同，<strong>越浅的层学到的特征越通用（横竖撇捺），越深的层学到的特征和具体任务的关联性越强（人脸-人脸轮廓、汽车-汽车轮廓）</strong>，如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/图像预训练示例.jpg" style="zoom:50%;" /><p>由此，当领导给我们一个任务：阿猫、阿狗、阿虎的图片各十张，然后让我们设计一个深度神经网络，通过该网络把它们三者的图片进行分类。</p><p>对于上述任务，如果我们亲手设计一个深度神经网络基本是不可能的，<strong>因为深度学习一个弱项就是在训练阶段对于数据量的需求特别大</strong>，而领导只给我们合计三十张图片，显然这是不够的。</p><p>虽然领导给我们的数据量很少，<strong>但是我们是否可以利用网上现有的大量已做好分类标注的图片</strong>。比如 ImageNet 中有 1400 万张图片，并且这些图片都已经做好了分类标注。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/预训练的应用.jpg" style="zoom:50%;" /><p>上述利用网络上现有图片的思想就是预训练的思想，具体做法就是：</p><ol><li>通过 ImageNet 数据集我们训练出一个模型 A</li><li>由于上面提到 CNN 的浅层学到的特征通用性特别强，我们可以对模型 A 做出一部分改进得到模型 B（两种方法）：<ol><li>冻结：浅层参数使用模型 A 的参数，高层参数随机初始化，<strong>浅层参数一直不变</strong>，然后利用领导给出的 30 张图片训练参数</li><li>微调：浅层参数使用模型 A 的参数，高层参数随机初始化，然后利用领导给出的 30 张图片训练参数，<strong>但是在这里浅层参数会随着任务的训练不断发生变化</strong></li></ol></li></ol><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/预训练在图像领域的应用.jpg" style="zoom:50%;" /><p>通过上述的讲解，对图像预训练做个总结（可参照上图）：对于一个具有少量数据的任务 A，首先通过一个现有的大量数据搭建一个 CNN 模型 A，由于 CNN的浅层学到的特征通用性特别强，因此在搭建一个 CNN 模型 B，其中模型 B 的浅层参数使用模型 A 的浅层参数，模型 B 的高层参数随机初始化，然后通过冻结或微调的方式利用任务 A 的数据训练模型 B，模型 B 就是对应任务 A 的模型。</p><h2 id="1-2-预训练的思想">1.2 预训练的思想</h2><p>有了图像领域预训练的引入，我们在此给出预训练的思想：任务 A 对应的模型 A 的参数不再是随机初始化的，而是通过任务 B 进行预先训练得到模型 B，然后利用模型 B 的参数对模型 A 进行初始化，再通过任务 A 的数据对模型 A 进行训练。注：模型 B 的参数是随机初始化的。</p><h1>二、语言模型</h1><p>想了解预训练语言模型，首先得了解什么是语言模型。</p><p>语言模型通俗点讲就是**计算一个句子的概率。**也就是说，对于语言序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">w_1,w_2,\cdots,w_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，语言模型就是计算该序列的概率，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_1,w_2,\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。</p><p>下面通过两个实例具体了解上述所描述的意思：</p><ol><li>假设给定两句话 “判断这个词的磁性” 和 “判断这个词的词性”，语言模型会认为后者更自然。转化成数学语言也就是：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>判断，这个，词，的，词性</mtext><mo stretchy="false">)</mo><mo>&gt;</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>判断，这个，词，的，磁性</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(判断，这个，词，的，词性) \gt P(判断，这个，词，的，磁性)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">判断，这个，词，的，词性</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">判断，这个，词，的，磁性</span><span class="mclose">)</span></span></span></span></li><li>假设给定一句话做填空 “判断这个词的____”，则问题就变成了给定前面的词，找出后面的一个词是什么，转化成数学语言就是：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>词性</mtext><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo><mo>&gt;</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>磁性</mtext><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(词性|判断，这个，词，的) \gt P(磁性|判断，这个，词，的)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">词性</span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">磁性</span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span></span></span></span></li></ol><p>通过上述两个实例，可以给出语言模型更加具体的描述：给定一句由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个词组成的句子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">W=w_1,w_2,\cdots,w_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，计算这个句子的概率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_1,w_2,\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，或者计算根据上文计算下一个词的概率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_n|w_1,w_2,\cdots,w_{n-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。</p><p>下面将介绍语言模型的两个分支，统计语言模型和神经网络语言模型。</p><h2 id="2-1-统计语言模型">2.1 统计语言模型</h2><p>统计语言模型的基本思想就是<strong>计算条件概率</strong>。</p><p>给定一句由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个词组成的句子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">W=w_1,w_2,\cdots,w_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，计算这个句子的概率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_1,w_2,\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的公式如下（条件概率乘法公式的推广，链式法则）：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>2</mn></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>3</mn></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>⋯</mo><mi>p</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∏</mo><mi>i</mi></munder><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><mi>w</mi><mn>1</mn><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}P(w_1,w_2,\cdots,w_n) &amp; =  P(w_1)P(w_2|w_1)P(w_3|w_1,w_2)\cdots p(w_n|w_1,w_2,\cdots,w_{n-1}) \\&amp; = \prod_i P(w_i|w1,w_2,\cdots,w_{i-1})\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.1277em;vertical-align:-1.8138em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3138em;"><span style="top:-4.5238em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.8138em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8138em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3138em;"><span style="top:-4.5238em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.8138em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8138em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>对于上一节提到的 “判断这个词的词性” 这句话，利用上述的公式，可以得到：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>判断，这个，词，的，词性</mtext><mo stretchy="false">)</mo><mo>=</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>判断</mtext><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>这个</mtext><mi mathvariant="normal">∣</mi><mtext>判断</mtext><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>词</mtext><mi mathvariant="normal">∣</mi><mtext>判断，这个</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>的</mtext><mi mathvariant="normal">∣</mi><mtext>判断，这个，词</mtext><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>词性</mtext><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mtext>判断，这个，词，的，词性</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}&amp; P(判断，这个，词，的，词性) = \\&amp; P(判断)P(这个|判断)P(词|判断，这个) \\&amp; P(的|判断，这个，词)P(词性|判断，这个，词，的)P(判断，这个，词，的，词性)\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.5em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-3em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-1.5em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">判断，这个，词，的，词性</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">判断</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">这个</span><span class="mord">∣</span><span class="mord cjk_fallback">判断</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">词</span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">的</span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">词性</span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">判断，这个，词，的，词性</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>对于上一节提到的另外一个问题，当给定前面词的序列 “判断，这个，词，的” 时，想要知道下一个词是什么，可以直接计算如下概率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo><mspace width="1em"/><mtext>公式(1)</mtext></mrow><annotation encoding="application/x-tex">P(w_{next}|判断，这个，词，的)\quad\text{公式(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(1)</span></span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">w_{next} \in V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 表示词序列的下一个词，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 是一个具有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|V|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">∣</span></span></span></span> 个词的词典（词集合）。</p><p>对于公式（1），可以展开成如下形式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mtext>，判断，这个，词，的</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo></mrow></mfrac><mspace width="1em"/><mtext>公式(2)</mtext></mrow><annotation encoding="application/x-tex">P(w_{next}|判断，这个，词，的) = \frac{count(w_{next}，判断，这个，词，的)}{count(判断，这个，词，的)} \quad\text{公式(2)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，判断，这个，词，的</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(2)</span></span></span></span></span></span></p><p>对于公式（2），可以把字典 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 中的多有单词，逐一作为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{next}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，带入计算，最后取最大概率的词作为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{next}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的候选词。</p><p>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|V|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">∣</span></span></span></span> 特别大，公式（2）的计算将会非常困难，但是我们可以引入马尔科夫链的概念（当然，在这里只是简单讲讲如何做，关于马尔科夫链的数学理论知识可以自行查看其他参考资料）。</p><p>假设字典 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 中有 “火星” 一词，可以明显发现 “火星” 不可能出现在 “判断这个词的” 后面，因此（火星，判断，这个，词，的）这个组合是不存在的，并且词典中会存在很多类似于 “火星” 这样的词。</p><p>进一步，可以发现我们把（火星，判断，这个，词，的）这个组合判断为不存在，是因为 “火星” 不可能出现在 “词的” 后面，也就是说我们可以考虑是否把公式（1）转化为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">∣</mi><mtext>判断，这个，词，的</mtext><mo stretchy="false">)</mo><mo>≈</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">∣</mi><mtext>词，的</mtext><mo stretchy="false">)</mo><mspace width="1em"/><mtext>公式(3)</mtext></mrow><annotation encoding="application/x-tex">P(w_{next}|判断，这个，词，的) \approx P(w_{next}|词，的)\quad\text{公式(3)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord cjk_fallback">判断，这个，词，的</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord cjk_fallback">词，的</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(3)</span></span></span></span></span></span></p><p>公式（3）就是马尔科夫链的思想：假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{next}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 只和它之前的 <strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个词有相关性</strong>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 时称作一个单元语言模型，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">k=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 时称为二元语言模型。</p><p>可以发现通过马尔科夫链后改写的公式计算起来将会简单很多，下面我们举个简单的例子介绍下如何计算一个二元语言模型的概率。</p><p>其中二元语言模型的公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mfrac><mspace width="1em"/><mtext>公式(4)</mtext></mrow><annotation encoding="application/x-tex">P(w_i|w_{i-1})=\frac{count(w_{i-1},w_i)}{count(w_{i-1})}\quad\text{公式(4)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(4)</span></span></span></span></span></span></p><p>假设有一个文本集合：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">“词性是动词”</span><br><span class="line">“判断单词的词性”</span><br><span class="line">“磁性很强的磁铁”</span><br><span class="line">“北京的词性是名词”</span><br></pre></td></tr></table></figure><p>对于上述文本，如果要计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>词性</mtext><mi mathvariant="normal">∣</mi><mtext>的</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(词性|的)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">词性</span><span class="mord">∣</span><span class="mord cjk_fallback">的</span><span class="mclose">)</span></span></span></span> 的概率，通过公式（4），需要统计 “的，词性” 同时按序出现的次数，再除以 “的” 出现的次数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>词性</mtext><mi mathvariant="normal">∣</mi><mtext>的</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>的，词性</mtext><mo stretchy="false">)</mo></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>的</mtext><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mspace width="1em"/><mtext>公式(5)</mtext></mrow><annotation encoding="application/x-tex">P(词性|的) = \frac{count(的，词性)}{count(的)} = \frac{2}{3}\quad\text{公式(5)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord cjk_fallback">词性</span><span class="mord">∣</span><span class="mord cjk_fallback">的</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord cjk_fallback">的</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord cjk_fallback">的，词性</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(5)</span></span></span></span></span></span></p><p>上述文本集合是我们自定制的，然而对于绝大多数具有现实意义的文本，会出现数据稀疏的情况，例如<strong>训练时未出现，测试时出现了的未登录单词</strong>。</p><p>由于数据稀疏问题，则会出现概率值为 0 的情况（填空题将无法从词典中选择一个词填入），为了避免 0 值的出现，会使用一种平滑的策略——分子和分母都加入一个非 0 正数，例如可以把公式（4）改为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mspace width="1em"/><mtext>公式(6)</mtext></mrow><annotation encoding="application/x-tex">P(w_i|w_{i-1}) = \frac{count(w_{i-1},w_i)+1}{count(w_{i-1})+|V|}\quad\text{公式(6)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">co</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(6)</span></span></span></span></span></span></p><p>##2.2 神经网络语言模型</p><p>上一节简单的介绍了统计语言模型，并且在结尾处讲到统计语言模型存在数据稀疏问题，针对该问题，我们也提出了平滑方法来应对这个问题。</p><p>神经网络语言模型则引入神经网络架构来估计单词的分布，<strong>并且通过词向量的距离衡量单词之间的相似度，因此，对于未登录单词，也可以通过相似词进行估计，进而避免出现数据稀疏问题</strong>。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/神经网络语言模型.jpg" style="zoom:50%;" /><p>上图为神经网络语言模型结构图，它的学习任务是输入某个句中单词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>t</mi></msub><mo>=</mo><mi>b</mi><mi>e</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">w_t = bert</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">t</span></span></span></span> 前的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个单词，要求网络正确预测单词 “bert”，即最大化：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>t</mi></msub><mo>=</mo><mi>b</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo><mspace width="1em"/><mtext>公式(7)</mtext></mrow><annotation encoding="application/x-tex">P(w_t=bert|w_1,w_2,\cdots,w_{t-1};\theta)\quad\text{公式(7)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(7)</span></span></span></span></span></span></p><p>上图所示的神经网络语言模型分为三层，接下来我们详细讲解这三层的作用：</p><ol><li>神经网络语言模型的第一层，为输入层。首先将前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个单词用 Onehot 编码（例如：0001000）作为原始单词输入，之后乘以一个随机初始化的矩阵 Q 后获得词向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(w_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，对这 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个词向量处理后得到输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo stretchy="false">(</mo><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x=(C(w_1),C(w_2),\cdots,C(w_{t-1}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></li><li>神经网络语言模型的第二层，为隐层，包含 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> 个隐变量，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> 代表权重矩阵，因此隐层的输出为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>x</mi><mo>+</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">Hx+d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> 为偏置项。并且在此之后使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span></span></span></span> 作为激活函数。</li><li>神经网络语言模型的第三层，为输出层，一共有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|V|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">∣</span></span></span></span>  个输出节点（字典大小），直观上讲，每个输出节点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是词典中每一个单词概率值。最终得到的计算公式为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>b</mi><mo>+</mo><mi>W</mi><mi>x</mi><mo>+</mo><mi>U</mi><mi>tanh</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>d</mi><mo>+</mo><mi>H</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = softmax(b+Wx+U\tanh(d+Hx))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 是直接从输入层到输出层的权重矩阵，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span> 是隐层到输出层的参数矩阵。</li></ol><h1>三、词向量</h1><p>在描述神经网络语言模型的时候，提到 Onehot 编码和词向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(w_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，但是并没有具体提及他们到底是什么玩意。</p><p>由于他们对于未来 BERT 的讲解非常重要，所以在这里重开一章来描述词向量到底是什么，如何表示。</p><h2 id="3-1-独热（Onehot）编码">3.1 独热（Onehot）编码</h2><p><strong>把单词用向量表示，是把深度神经网络语言模型引入自然语言处理领域的一个核心技术。</strong></p><p>在自然语言处理任务中，训练集大多为一个字或者一个词，把他们转化为计算机适合处理的数值类数据非常重要。</p><p>早期，人们想到的方法是使用独热（Onehot）编码，如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/单词的独热表示.jpg" style="zoom:50%;" /><p>对于上图的解释，假设有一个包含 8 个次的字典 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>，“time” 位于字典的第 1 个位置，“banana” 位于字典的第 8 个位置，因此，采用独热表示方法，对于 “time” 的向量来说，除了第 1 个位置为 1，其余位置为 0；对于 “banana” 的向量来说，除了第 8 个位置为 1，其余位置为 0。</p><p>但是，对于独热表示的向量，如果采用余弦相似度计算向量间的相似度，<strong>可以明显的发现任意两者向量的相似度结果都为 0</strong>，即任意二者都不相关，也就是说独热表示无法解决词之间的相似性问题。</p><h2 id="3-2-Word-Embedding">3.2 Word Embedding</h2><p>由于独热表示无法解决词之间相似性问题，这种表示很快就被词向量表示给替代了，这个时候聪明的你可能想到了在神经网络语言模型中出现的一个词向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(w_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，对的，<strong>这个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(w_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 其实就是单词对应的 Word Embedding 值，也就是我们这节的核心——词向量。</strong></p><p>在神经网络语言模型中，我们并没有详细解释词向量是如何计算的，现在让我们重看神经网络语言模型的架构图：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/神经网络语言模型.jpg" style="zoom:50%;" /><p>上图所示有一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">V×m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 的矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>，这个矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 包含 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 行，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 代表词典大小，每一行的内容代表对应单词的 Word Embedding 值。</p><p>只不过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 的内容也是网络参数，需要学习获得，训练刚开始用随机值初始化矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>，当这个网络训练好之后，矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 的内容被正确赋值，每一行代表一个单词对应的 Word embedding 值。</p><p>但是这个词向量有没有解决词之间的相似度问题呢？为了回答这个问题，我们可以看看词向量的计算过程：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>17</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>24</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>23</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>7</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>6</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>13</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>10</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>12</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>19</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>11</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>18</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>25</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>10</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>12</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>19</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mspace width="1em"/><mtext>公式(8)</mtext></mrow><annotation encoding="application/x-tex">\begin{bmatrix}0&amp;0&amp;0&amp;1&amp;0\end{bmatrix}\begin{bmatrix}17&amp;24&amp;1\\23&amp;5&amp;7\\4&amp;6&amp;13\\10&amp;12&amp;19\\11&amp;18&amp;25\end{bmatrix}=\begin{bmatrix}10&amp;12&amp;19\end{bmatrix}\quad\text{公式(8)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.25em;"><span class="pstrut" style="height:8em;"></span><span style="width:0.667em;height:6.000em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="6.000em" viewBox="0 0 667 6000"><path d="M403 1759 V84 H666 V0 H319 V1759 v2400 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v2400 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">17</span></span></span><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">23</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span><span style="top:-0.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">11</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">24</span></span></span><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">6</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">12</span></span></span><span style="top:-0.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">18</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">13</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">19</span></span></span><span style="top:-0.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">25</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.25em;"><span class="pstrut" style="height:8em;"></span><span style="width:0.667em;height:6.000em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="6.000em" viewBox="0 0 667 6000"><path d="M347 1759 V0 H0 V84 H263 V1759 v2400 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v2400 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">10</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">12</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">19</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(8)</span></span></span></span></span></span></p><p>通过上述词向量的计算，可以发现第 4 个词的词向量表示为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>10</mn><mtext> </mtext><mn>12</mn><mtext> </mtext><mn>19</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[10\,12\,19]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">10</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">12</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">19</span><span class="mclose">]</span></span></span></span>。</p><p>如果再次采用余弦相似度计算两个词之间的相似度，结果不再是 0 ，既可以一定程度上描述两个词之间的相似度。</p><p>下图给了网上找的几个例子，可以看出有些例子效果还是很不错的，一个单词表达成 Word Embedding 后，很容易找出语义相近的其它词汇。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/wordembedding例子.jpg" style="zoom:50%;" /><h1>四、Word2Vec 模型</h1><p>2013 年最火的用语言模型做 Word Embedding 的工具是 Word2Vec ，后来又出了Glove（由于 Glove 和 Word2Vec 的作用类似，并对 BERT 的讲解没有什么帮助，之后不再多加叙述），Word2Vec是怎么工作的呢？看下图：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/word2vec.jpg" style="zoom:50%;" /><p>Word2Vec 的网络结构其实和神经网络语言模型（NNLM）是基本类似的，只是这个图长得清晰度差了点，看上去不像，其实它们是亲兄弟。不过这里需要指出：尽管网络结构相近，而且都是做语言模型任务，但是他们训练方法不太一样。</p><p>Word2Vec 有两种训练方法：</p><ol><li>第一种叫 CBOW，<strong>核心思想是从一个句子里面把一个词抠掉</strong>，用这个词的上文和下文去预测被抠掉的这个词；</li><li>第二种叫做 Skip-gram，和 CBOW 正好反过来，输入某个单词，要求网络预测它的上下文单词。</li></ol><p>而你回头看看，NNLM 是怎么训练的？是输入一个单词的上文，去预测这个单词。这是有显著差异的。</p><p>为什么 Word2Vec 这么处理？原因很简单，因为 Word2Vec 和 NNLM 不一样，NNLM 的主要任务是要学习一个解决语言模型任务的网络结构，语言模型就是要看到上文预测下文，而 Word Embedding只是 NNLM 无心插柳的一个副产品；但是 Word2Vec 目标不一样，它单纯就是要 Word Embedding 的，这是主产品，所以它完全可以随性地这么去训练网络。</p><p>为什么要讲 Word2Vec 呢？这里主要是要引出 CBOW 的训练方法，BERT 其实跟它有关系，后面会讲解它们之间的关系，当然它们的关系 BERT 作者没说，是我猜的，至于我猜的对不对，你看完这篇文章之后可以自行判断。</p><h1>五、自然语言处理的预训练模型</h1><p>突然在文章中插入这一段，其实就是给出一个问题：Word Embedding 这种做法能算是预训练吗？这其实就是标准的预训练过程。要理解这一点要看看学会 Word Embedding 后下游任务是怎么使用它的。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/we模式下的预训练.jpg" style="zoom:50%;" /><p>假设如上图所示，我们有个NLP的下游任务，比如 QA，就是问答问题，所谓问答问题，指的是给定一个问题 X，给定另外一个句子 Y，要判断句子 Y 是否是问题 X 的正确答案。</p><p>问答问题假设设计的网络结构如上图所示，这里不展开讲了，懂得自然懂，不懂的也没关系，因为这点对于本文主旨来说不关键，关键是网络如何使用训练好的 Word Embedding 的。</p><p>它的使用方法其实和前面讲的 NNLM 是一样的，句子中每个单词以 Onehot 形式作为输入，然后乘上学好的 Word Embedding 矩阵 Q，就直接取出单词对应的 Word Embedding 了。</p><p>这乍看上去好像是个查表操作，不像是预训练的做法是吧？其实不然，<strong>那个Word Embedding矩阵Q其实就是网络 Onehot 层到 embedding 层映射的网络参数矩阵。</strong></p><p>所以你看到了，使用 Word Embedding 等价于什么？等价于把 Onehot 层到 embedding 层的网络用预训练好的参数矩阵 Q 初始化了。这跟前面讲的图像领域的低层预训练过程其实是一样的，<strong>区别无非 Word Embedding 只能初始化第一层网络参数，再高层的参数就无能为力了</strong>。</p><p>下游NLP任务在使用 Word Embedding 的时候也类似图像有两种做法，一种是 Frozen，就是 Word Embedding 那层网络参数固定不动；另外一种是 Fine-Tuning，就是 Word Embedding 这层参数使用新的训练集合训练也需要跟着训练过程更新掉。</p><p>上面这种做法就是18年之前NLP领域里面采用预训练的典型做法，并且 Word Embedding 其实对于很多下游 NLP 任务是有帮助的，只是帮助没有大到闪瞎忘记戴墨镜的围观群众的双眼而已。</p><h1>六、RNN 和 LSTM</h1><p>为什么要在这里穿插一个 RNN（Recurrent Neural Network） 和 LSTM（Long Short-Term Memory） 呢？</p><p>因为接下来要介绍的 ELMo（Embeddings from Language Models） 模型在训练过程中使用了双向长短期记忆网络（Bi-LSTM）。</p><p>当然，这里只是简单地介绍，想要详细了解的可以去查看网上铺天盖地的参考资料。</p><h2 id="6-1-RNN">6.1 RNN</h2><p>传统的神经网络无法获取时序信息，然而<strong>时序信息在自然语言处理任务中非常重要</strong>。</p><p>例如对于这一句话 “我吃了一个苹果”，“苹果” 的词性和意思，在这里取决于前面词的信息，如果没有 “我吃了一个” 这些词，“苹果” 也可以翻译为乔布斯搞出来的那个被咬了一口的苹果。</p><p>也就是说，RNN 的出现，让处理时序信息变为可能。</p><p>RNN 的基本单元结构如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/RNN-unrolled.png" style="zoom:36%;" /><p>上图左边部分称作 RNN 的一个 timestep，在这个 timestep 中可以看到，在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 时刻，输入变量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，通过 RNN 的一个基础模块 A，输出变量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 时刻的信息，将会传递到下一个时刻 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>。</p><p>如果把模块按照时序展开，则会如上图右边部分所示，<strong>由此可以看到 RNN 为多个基础模块 A 的互连，每一个模块都会把当前信息传递给下一个模块</strong>。</p><p>RNN 解决了时序依赖问题，但这里的时序一般指的是短距离的，首先我们先介绍下短距离依赖和长距离依赖的区别：</p><ul><li>短距离依赖：对于这个填空题 “我想看一场篮球____”，我们很容易就判断出 “篮球” 后面跟的是 “比赛”，这种短距离依赖问题非常适合 RNN。</li><li>长距离依赖：对于这个填空题 “我出生在中国的瓷都景德镇，小学和中学离家都很近，……，我的母语是____”，对于短距离依赖，“我的母语是” 后面可以紧跟着 “汉语”、“英语”、“法语”，但是如果我们想精确答案，则必须回到上文中很长距离之前的表述 “我出生在中国的瓷都景德镇”，进而判断答案为 “汉语”，而 RNN 是很难学习到这些信息的。</li></ul><h2 id="6-2-RNN-的梯度消失问题">6.2 RNN 的梯度消失问题</h2><p>在这里我简单讲解下 RNN 为什么不适合长距离依赖问题。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/RNN模型结构.jpg" style="zoom:50%;" /><p>如上图所示，为RNN模型结构，前向传播过程包括：</p><ul><li><strong>隐藏状态：</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>U</mi><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>W</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{(t)} = \sigma (z^{(t)}) = \sigma(Ux^{(t)} + Wh^{(t-1)} + b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9713em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span> ，此处激活函数一般为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span></span></span></span> 。</li><li><strong>模型输出：</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>V</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">o^{(t)} = Vh^{(t)} + c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9713em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></li><li><strong>预测输出：</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{y}^{(t)} = \sigma(o^{(t)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0824em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ，此处激活函数一般为softmax。</li><li><strong>模型损失：</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></msubsup><msup><mi>L</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">L = \sum_{t = 1}^{T} L^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></li></ul><p>RNN 所有的 timestep 共享一套参数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo separator="true">,</mo><mi>W</mi></mrow><annotation encoding="application/x-tex">U,V,W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>，在 RNN 反向传播过程中，需要计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo separator="true">,</mo><mi>W</mi></mrow><annotation encoding="application/x-tex">U,V,W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 等参数的梯度，以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 的梯度表达式为例（假设 RNN 模型的损失函数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>）：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>W</mi></mrow></mfrac><mo>=</mo><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mrow><mo fence="true">(</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></munderover><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mo fence="true">)</mo></mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><mi>W</mi></mrow></mfrac><mtext> </mtext><mspace linebreak="newline"></mspace><mo>=</mo><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>o</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mrow><mo fence="true">(</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></munderover><mi>t</mi><mi>a</mi><mi>n</mi><msup><mi>h</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msup><mo stretchy="false">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mi>W</mi><mo fence="true">)</mo></mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><mi>W</mi></mrow></mfrac><mtext> </mtext><mspace linebreak="newline"></mspace><mspace width="1em"/><mtext>公式(9)</mtext></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial W} = \sum_{t = 1}^{T} \frac{\partial L}{\partial y^{(T)}} \frac{\partial y^{(T)}}{\partial o^{(T)}} \frac{\partial o^{(T)}}{\partial h^{(T)}} \left( \prod_{k=t + 1}^{T} \frac{\partial h^{(k)}}{\partial h^{(k - 1)}} \right) \frac{\partial h^{(t)}}{\partial W} \  \\ = \sum_{t = 1}^{T} \frac{\partial L}{\partial y^{(T)}} \frac{\partial y^{(T)}}{\partial o^{(T)}} \frac{\partial o^{(T)}}{\partial h^{(T)}} \left( \prod_{k=t+1}^{T} tanh^{&#x27;}(z^{(k)}) W \right) \frac{\partial h^{(t)}}{\partial W} \  \\\quad\text{公式(9)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1888em;vertical-align:-1.3604em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3604em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace"> </span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1888em;vertical-align:-1.3604em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3604em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9925em;"><span style="top:-2.9925em;margin-right:0.05em;"><span class="pstrut" style="height:2.5795em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace"> </span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">公式</span><span class="mord">(9)</span></span></span></span></span></span></p><p>对于公式（9）中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">(</mo><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mi>t</mi><mi>a</mi><mi>n</mi><msup><mi>h</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msup><mo stretchy="false">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mi>W</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left( \prod_{k=t + 1}^{T} \frac{\partial h^{(k)}}{\partial h^{(k - 1)}} \right) = \left( \prod_{k=t+1}^{T} tanh^{&#x27;}(z^{(k)}) W \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0707em;"><span style="top:-2.6146em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.822em;"><span style="top:-2.822em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5357em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9667em;"><span style="top:-2.9667em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5357em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3854em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.9425em;margin-right:0.05em;"><span class="pstrut" style="height:2.5795em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop">tanh</span></span></span></span> 的导数总是小于 1 的，由于是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>−</mo><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T-(t+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 个 timestep 参数的连乘，<strong>如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 的主特征值小于 1，梯度便会消失；如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> 的特征值大于 1，梯度便会爆炸。</strong></p><p>需要注意的是，RNN和DNN梯度消失和梯度爆炸含义并不相同。</p><p>RNN中权重在各时间步内共享，最终的梯度是各个时间步的梯度和，梯度和会越来越大。因此，RNN中总的梯度是不会消失的，即使梯度越传越弱，也只是远距离的梯度消失。 从公式（9）中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">(</mo><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mi>t</mi><mi>a</mi><mi>n</mi><msup><mi>h</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msup><mo stretchy="false">(</mo><msup><mi>z</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mi>W</mi><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\left( \prod_{k=t+1}^{T} tanh^{&#x27;}(z^{(k)}) W \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.9425em;margin-right:0.05em;"><span class="pstrut" style="height:2.5795em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span> 可以看到，<strong>RNN所谓梯度消失的真正含义是，梯度被近距离（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mtext>趋向于</mtext><mi>T</mi></mrow><annotation encoding="application/x-tex">t+1 趋向于 T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord cjk_fallback">趋向于</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>）梯度主导，远距离（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mtext>远离</mtext><mi>T</mi></mrow><annotation encoding="application/x-tex">t+1 远离 T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord cjk_fallback">远离</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>）梯度很小，导致模型难以学到远距离的信息。</strong></p><h2 id="6-3-LSTM">6.3 LSTM</h2><p>为了解决 RNN 缺乏的序列长距离依赖问题，LSTM 被提了出来，首先我们来看看 LSTM 相对于 RNN 做了哪些改进：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/LSTM模型结构.jpg" style="zoom:50%;" /><p>如上图所示，为 LSTM 的 RNN 门控结构（LSTM 的 timestep），LSTM 前向传播过程包括：</p><ul><li>**遗忘门：**决定了丢弃哪些信息，遗忘门接收 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 时刻的状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">h_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>，以及当前的输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，经过 Sigmoid 函数后输出一个 0 到 1 之间的值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">f_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><ul><li>输出： <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><msub><mi>W</mi><mi>f</mi></msub><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>U</mi><mi>f</mi></msub><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>f</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_{t} = \sigma(W_fh_{t-1} + U_fx_{t} + b_f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li></ul></li><li>**输入门：**决定了哪些新信息被保留，并更新细胞状态，输入们的取值由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">h_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 决定，通过 Sigmoid 函数得到一个 0 到 1 之间的值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">i_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop">tanh</span></span></span></span> 函数则创造了一个当前细胞状态的候选 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">a_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><ul><li>输出：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><msub><mi>W</mi><mi>i</mi></msub><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>U</mi><mi>i</mi></msub><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">i_{t} = \sigma(W_ih_{t-1} + U_ix_{t} + b_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><msub><mi>C</mi><mi>t</mi></msub><mo>~</mo></mover><mo>=</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><msub><mi>W</mi><mi>a</mi></msub><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>U</mi><mi>a</mi></msub><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{C_{t} }= tanhW_ah_{t-1} + U_ax_{t} + b_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0702em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li></ul></li><li>**细胞状态：**旧细胞状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">C_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> 被更新到新的细胞状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">C_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 上，<ul><li>输出：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>t</mi></msub><mo>=</mo><msub><mi>C</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⊙</mo><msub><mi>f</mi><mi>t</mi></msub><mo>+</mo><msub><mi>i</mi><mi>t</mi></msub><mo>⊙</mo><mover accent="true"><msub><mi>C</mi><mi>t</mi></msub><mo>~</mo></mover></mrow><annotation encoding="application/x-tex">C_{t} = C_{t-1}\odot f_{t} + i_{t}\odot \tilde{C_{t} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0702em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></li></ul></li><li>**输出门：**决定了最后输出的信息，输出门取值由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">h_{t-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 决定，通过 Sigmoid 函数得到一个 0 到 1 之间的值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">o_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，最后通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop">tanh</span></span></span></span> 函数决定最后输出的信息<ul><li>输出：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><msub><mi>W</mi><mi>o</mi></msub><msub><mi>h</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>U</mi><mi>o</mi></msub><msub><mi>x</mi><mi>t</mi></msub><mo>+</mo><msub><mi>b</mi><mi>o</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">o_{t} = \sigma(W_oh_{t-1} + U_ox_{t} + b_o)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><msub><mi>o</mi><mi>t</mi></msub><mo>⊙</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><msub><mi>C</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_{t} = o_{t}\odot tanhC_{t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li></ul></li><li><strong>预测输出：</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>t</mi></msub><mo>=</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>V</mi><msub><mi>h</mi><mi>t</mi></msub><mo>+</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat{y}_{t} = \sigma(Vh_{t}+c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></li></ul><h2 id="6-4-LSTM-解决-RNN-的梯度消失问题">6.4 LSTM 解决 RNN 的梯度消失问题</h2><p>明白了 RNN 梯度消失的原因之后，我们看 LSTM 如何解决问题的呢？</p><p>RNN 梯度消失的原因是，随着梯度的传导，梯度被近距离梯度主导，模型难以学习到远距离的信息。具体原因也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>h</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>h</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\prod_{k=t+1}^{T}\frac{\partial h_{k}}{\partial h_{k - 1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4738em;vertical-align:-0.4925em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 部分，在迭代过程中，每一步 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>h</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>h</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial h_{k}}{\partial h_{k - 1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3945em;vertical-align:-0.4925em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> <strong>始终在 [0,1) 之间或者始终大于 1。</strong></p><p>而对于 LSTM 模型而言，针对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\prod _{k=t+1}^{T} \frac{\partial C_{k}}{\partial C_{k-1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4738em;vertical-align:-0.4925em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 求得：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac><mo>=</mo><msub><mi>f</mi><mi>k</mi></msub><mo>+</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr><mtr><mtd class ="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></munderover><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac><mo>=</mo><msub><mi>f</mi><mi>k</mi></msub><msub><mi>f</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>f</mi><mi>T</mi></msub><mo>+</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi></mrow></mstyle></mtd><mtd class ="mtr-glue"></mtd><mtd class ="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}&amp; \frac{\partial C_{k}}{\partial C_{k-1}} = f_k + other \\&amp; \prod _{k=t+1}^{T} \frac{\partial C_{k}}{\partial C_{k-1}} = f_{k}f_{k+1}...f_{T} + other  \\\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.0546em;vertical-align:-2.7773em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2773em;"><span style="top:-5.7342em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"></span></span><span style="top:-2.7115em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7773em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2773em;"><span style="top:-5.7342em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8943em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span><span style="top:-2.7115em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3604em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8943em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mord">...</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7773em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2773em;"><span style="top:-5.7342em;"><span class="pstrut" style="height:3.8283em;"></span><span class="eqn-num"></span></span><span style="top:-2.7115em;"><span class="pstrut" style="height:3.8283em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7773em;"><span></span></span></span></span></span></span></span></span></p><p>在 LSTM 迭代过程中，针对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\prod_{k=t+1}^{T} \frac{\partial C_{k}}{\partial C_{k-1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4738em;vertical-align:-0.4925em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 而言，每一步<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial C_{k}}{\partial C_{k-1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3945em;vertical-align:-0.4925em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> <strong>可以自主的选择在 [0,1] 之间，或者大于1</strong>，因为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">f_{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是可训练学习的。那么整体 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mi>T</mi></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>C</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\prod _{k=t+1}^{T} \frac{\partial C_{k}}{\partial C_{k-1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4738em;vertical-align:-0.4925em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4925em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 也就不会一直减小，远距离梯度不至于完全消失，也就能够解决 RNN 中存在的梯度消失问题。</p><p>LSTM 遗忘门值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">f_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 可以选择在 [0,1] 之间，让 LSTM 来改善梯度消失的情况。也可以选择接近 1，让遗忘门饱和，此时远距离信息梯度不消失；也可以选择接近 0，此时模型是故意阻断梯度流，遗忘之前信息。</p><p>另外需要强调的是LSTM搞的这么复杂，<strong>除了在结构上天然地克服了梯度消失的问题，更重要的是具有更多的参数来控制模型</strong>；通过四倍于RNN的参数量，可以更加精细地预测时间序列变量。</p><p>此外，我记得有一篇文章讲到，<strong>LSTM 在 200左右长度的文本上，就已经捉襟见肘了</strong>。</p><h1>七、ELMo 模型</h1><h2 id="7-1-ELMo-的预训练">7.1 ELMo 的预训练</h2><p>在讲解 Word Embedding 时，细心地读者一定已经发现，这些词表示方法本质上是静态的，每一个词都有一个唯一确定的词向量，不能根据句子的不同而改变，无法处理自然语言处理任务中的多义词问题。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/we多义词问题.jpg" style="zoom:50%;" /><p>如上图所示，例如多义词 Bank，有两个常用含义，但是 Word Embedding 在对 bank 这个单词进行编码的时候，是区分不开这两个含义的。</p><p>因为尽管这两句含有 bank 的句子中 bank 上下文环境中出现的单词不同，但是在用语言模型训练的时候，不论什么上下文的句子经过 Word2Vec，都是预测相同的单词 bank，而同一个单词占用的是同一行的参数空间，这会导致两种不同的上下文信息都会编码到相同的 Word Embedding 空间里，进而导致Word Embedding 无法区分多义词的不同语义。</p><p>所以对于比如 Bank 这个词，它事先学好的 Word Embedding 中混合了几种语义 ，在应用中来了个新句子，即使从上下文中（比如句子包含 money 等词）明显可以看出它代表的是 “银行” 的含义，但是对应的 Word Embedding 内容也不会变，它还是混合了多种语义。</p><p>针对 Word Embedding 中出现的多义词问题，ELMo 提供了一个简洁优雅的解决方案。</p><p>ELMo 的本质思想是：我事先用语言模型学好一个单词的 Word Embedding，此时多义词无法区分，不过这没关系。在我实际使用 Word Embedding 的时候，单词已经具备了特定的上下文了，这个时候我可以根据上下文单词的语义再去调整单词的 Word Embedding 表示，这样经过调整后的 Word Embedding 更能表达在这个上下文中的具体含义，自然也就解决了多义词的问题了。所以 ELMo 本身是个根据当前上下文对 Word Embedding 动态调整的思路。</p><p>ELMo 采用了典型的两阶段过程：</p><ol><li>第一个阶段是利用语言模型进行预训练；</li><li>第二个阶段是在做下游任务时，从预训练网络中提取对应单词的网络各层的 Word Embedding 作为新特征补充到下游任务中。</li></ol><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/基于上下文的emedding.jpg" style="zoom:50%;" /><p>上图展示的是其第一阶段预训练过程，它的网络结构采用了双层双向 LSTM，目前语言模型训练的任务目标是根据单词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的上下文去正确预测单词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 之前的单词序列 Context-before 称为上文，之后的单词序列 Context-after 称为下文。</p><p>图中左端的前向双层 LSTM 代表正方向编码器，输入的是从左到右顺序的除了预测单词外 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的上文 Context-before；右端的逆向双层 LSTM 代表反方向编码器，输入的是从右到左的逆序的句子下文Context-after；每个编码器的深度都是两层 LSTM 叠加。</p><p>这个网络结构其实在 NLP 中是很常用的。使用这个网络结构利用大量语料做语言模型任务就能预先训练好这个网络，如果训练好这个网络后，输入一个新句子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">s_{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，句子中每个单词都能得到对应的三个 Embedding：</p><ul><li>最底层是单词的 Word Embedding；</li><li>往上走是第一层双向 LSTM 中对应单词位置的 Embedding，这层编码单词的句法信息更多一些；</li><li>再往上走是第二层 LSTM 中对应单词位置的 Embedding，这层编码单词的语义信息更多一些。</li></ul><p>也就是说，ELMo 的预训练过程不仅仅学会单词的 Word Embedding，还学会了一个双层双向的 LSTM 网络结构，而这两者后面都有用。</p><h2 id="7-2-ELMo-的-Feature-based-Pre-Training">7.2 ELMo 的 Feature-based Pre-Training</h2><p>上面介绍的是 ELMo 的第一阶段：预训练阶段。那么预训练好网络结构后，如何给下游任务使用呢？</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/elmo训练后的使用.jpg" style="zoom:50%;" /><p>上图展示了下游任务的使用过程，比如我们的下游任务仍然是 QA 问题，此时对于问句 X：</p><ol><li>我们可以先将句子 X 作为预训练好的 ELMo 网络的输入，这样句子 X 中每个单词在 ELMO 网络中都能获得对应的三个 Embedding；</li><li>之后给予这三个 Embedding 中的每一个 Embedding 一个权重 a，这个权重可以学习得来，根据各自权重累加求和，将三个 Embedding 整合成一个；</li><li>然后将整合后的这个 Embedding 作为 X 句在自己任务的那个网络结构中对应单词的输入，以此作为补充的新特征给下游任务使用。</li><li>对于上图所示下游任务 QA 中的回答句子 Y 来说也是如此处理。</li></ol><p><strong>因为 ELMo 给下游提供的是每个单词的特征形式，所以这一类预训练的方法被称为 “Feature-based Pre-Training”。</strong></p><p>至于为何这么做能够达到区分多义词的效果，原因在于在训练好 ELMo 后，<strong>在特征提取的时候，每个单词在两层 LSTM 上都会有对应的节点，这两个节点会编码单词的一些句法特征和语义特征，并且它们的 Embedding 编码是动态改变的</strong>，会受到上下文单词的影响，周围单词的上下文不同应该会强化某种语义，弱化其它语义，进而就解决了多义词的问题。</p><h1>八、Attention</h1><p>上面巴拉巴拉了一堆，都在为 BERT 的讲解做铺垫，而接下来要叙述的 Attention 和 Transformer 同样如此，它们都只是 BERT 构成的一部分。</p><h2 id="8-1-人类的视觉注意力">8.1 人类的视觉注意力</h2><p>Attention 是注意力的意思，从它的命名方式看，很明显借鉴了人类的注意力机制，因此，我们首先介绍人类的视觉注意力。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/人类的视觉注意力.jpg" style="zoom:50%;" /><p>视觉注意力机制是人类视觉所特有的大脑信号处理机制。人类视觉通过快速扫描全局图像，获得需要重点关注的目标区域，也就是一般所说的注意力焦点，而后对这一区域投入更多注意力资源，以获取更多所需要关注目标的细节信息，而抑制其他无用信息。</p><p>这是人类利用有限的注意力资源从大量信息中快速筛选出高价值信息的手段，是人类在长期进化中形成的一种生存机制，人类视觉注意力机制极大地提高了视觉信息处理的效率与准确性。</p><p>上图形象化展示了人类在看到一副图像时是如何高效分配有限的注意力资源的，<strong>其中红色区域表明视觉系统更关注的目标</strong>，很明显对于上图所示的场景，人们会把注意力更多投入到人的脸部，文本的标题以及文章首句等位置。</p><p>深度学习中的注意力机制从本质上讲和人类的选择性视觉注意力机制类似，<strong>核心目标也是从众多信息中选择出对当前任务目标更关键的信息。</strong></p><h2 id="8-2-Attention-的本质思想">8.2 Attention 的本质思想</h2><p>从人类的视觉注意力可以看出，注意力模型 Attention 的本质思想为：从大量信息中有选择地筛选出少量重要信息并聚焦到这些重要信息上，忽略不重要的信息。</p><p>在详细讲解 Attention之前，我们在讲讲 Attention的其他作用。之前我们讲解 LSTM 的时候说到，虽然 LSTM 解决了序列长距离依赖问题，但是单词超过 200 的时候就会失效。<strong>而 Attention 机制可以更加好的解决序列长距离依赖问题，并且具有并行计算能力</strong>。现在不明白这点不重要，随着我们对 Attention 的慢慢深入，相信你会明白。</p><p>首先我们得明确一个点，注意力模型从大量信息 Values 中筛选出少量重要信息，这些重要信息一定是相对于另外一个信息 Query 而言是重要的，例如对于上面那张婴儿图，Query 就是观察者。也就是说，我们要搭建一个注意力模型，我们必须得要有一个 Query 和一个 Values，然后通过 Query 这个信息从 Values 中筛选出重要信息。</p><p>通过 Query 这个信息从 Values 中筛选出重要信息，简单点说，<strong>就是计算 Query 和 Values 中每个信息的相关程度。</strong></p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/attention-计算图.png" style="zoom:50%;" /><p>再具体点，通过上图，Attention 通常可以进行如下描述，表示为将 Query(Q) 和 key-value pairs（<strong>把 Values 拆分成了键值对的形式</strong>） 映射到输出上，其中 query、每个 key、每个 value 都是向量，输出是 V 中所有 values 的加权，其中权重是由 Query 和每个 key 计算出来的，计算方法分为三步：</p><ol><li>第一步：计算比较 Q 和 K 的相似度，用 f 来表示：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mspace width="1em"/><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">f(Q,K_i)\quad i=1,2,\cdots,m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span></span></span></span>，一般第一步计算方法包括四种<ol><li>点乘（<strong>Transformer 使用</strong>）：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msup><mi>Q</mi><mi>T</mi></msup><msub><mi>K</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f(Q,K_i) = Q^T K_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li><li>权重：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msup><mi>Q</mi><mi>T</mi></msup><mi>W</mi><msub><mi>K</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">f(Q,K_i) = Q^TWK_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li><li>拼接权重：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>W</mi><mo stretchy="false">[</mo><msup><mi>Q</mi><mi>T</mi></msup><mo separator="true">;</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">f(Q,K_i) = W[Q^T;K_i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></li><li>感知器：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msup><mi>V</mi><mi>T</mi></msup><mi>tanh</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>W</mi><mi>Q</mi><mo>+</mo><mi>U</mi><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(Q,K_i)=V^T \tanh(WQ+UK_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li></ol></li><li>第二步：将得到的相似度进行 softmax 操作，进行归一化：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>i</mi></msub><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msub><msqrt><mi>d</mi></msqrt><mi>k</mi></msub></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\alpha_i = softmax(\frac{f(Q,K_i)}{\sqrt d_k})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.598em;vertical-align:-0.588em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.5335em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9378em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal mtight" style="padding-left:0.833em;">d</span></span><span style="top:-2.8978em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1022em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3224em;"><span style="top:-2.3264em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1736em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">Q</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.588em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span><ol><li>这里简单讲解除以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><msqrt><mi>d</mi></msqrt><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\sqrt d_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0897em;vertical-align:-0.1575em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">d</span></span><span style="top:-2.8922em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1078em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3286em;"><span style="top:-2.5425em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1575em;"><span></span></span></span></span></span></span></span></span></span> 的作用：假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> 里的元素的均值为0，方差为 1，那么 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup><mo>=</mo><msup><mi>Q</mi><mi>T</mi></msup><mi>K</mi></mrow><annotation encoding="application/x-tex">A^T=Q^TK</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> 中元素的均值为 0，方差为 d。当 d 变得很大时， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 中的元素的方差也会变得很大，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 中的元素方差很大(分布的方差大，分布集中在绝对值大的区域)，<strong>在数量级较大时， softmax 将几乎全部的概率分布都分配给了最大值对应的标签</strong>，由于某一维度的数量级较大，进而会导致 softmax 未来求梯度时会消失。总结一下就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">softmax</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>A</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\operatorname{softmax}\left(A\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">softmax</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">A</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span> 的分布会和d有关。因此 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 中每一个元素乘上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{\sqrt{d_k}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3831em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.5864em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8622em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8222em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1778em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 后，方差又变为 1，并且 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> 的数量级也将会变小。</li></ol></li><li>第三步：针对计算出来的权重 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> 中的所有 values 进行加权求和计算，得到 Attention 向量：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msub><mi>α</mi><mi>i</mi></msub><msub><mi>V</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Attention = \sum_{i=1}^m \alpha_i V_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li></ol><h2 id="8-3-Self-Attention-模型">8.3 Self Attention 模型</h2><p>上面已经讲了 Attention 就是从一堆信息中筛选出重要的信息，现在我们来通过 Self Attention 模型来详细讲解如何找到这些重要的信息。</p><p>Self Attention 模型的架构如下图所示，接下来我们将按照这个模型架构的顺序来逐一解释。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention.jpg" style="zoom:50%;" /><p>首先可以看到 Self Attention 有三个输入 Q、K、V：<strong>对于 Self Attention，Q、K、V 来自句子 X 的 词向量 x 的线性转化，即对于词向量 x，给定三个可学习的矩阵参数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>Q</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">W_Q,W_k,W_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，x 分别右乘上述矩阵得到 Q、K、V</strong>。</p><p>接下来为了表示的方便，我们先通过向量的计算叙述 Self Attention 计算的流程，然后再描述 Self Attention 的矩阵计算过程</p><ol><li><p>第一步，Q、K、V 的获取</p><ol><li></li></ol>   <img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qkv.jpg" style="zoom:50%;" /><p>上图操作：两个单词 Thinking 和 Machines。通过线性变换，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 两个向量分别与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>q</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">W_q,W_k,W_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 三个矩阵点乘得到 ${q_1,q_2},{k_1,k_2},{v_1,v_2} $ 共 6 个向量。矩阵 Q 则是向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">q_1,q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的拼接，K、V 同理。</p></li><li><p>第二步，MatMul</p><ol><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/Q-K乘积.jpg" style="zoom:50%;" /><p>上图操作：向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">{q_1,k_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 做点乘得到得分 112， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">{q_1,k_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 做点乘得到得分96。注意：<strong>这里是通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 这个信息找到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_1,x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中的重要信息。</strong></p></li></ol></li><li><p>第三步和第四步，Scale + Softmax</p><ol><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qk-scale.jpg" style="zoom:50%;" /></li></ol><p>上图操作：对该得分进行规范，除以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">\sqrt {d_k} = 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1828em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span></p></li><li><p>第五步，MatMul</p><ol><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qk-softmax.jpg" style="zoom:50%;" /></li></ol></li></ol><p>用得分比例 [0.88，0.12] 乘以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[v_1,v_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> 值得到一个加权后的值，将这些值加起来得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><p>上述所说就是 Self Attention 模型所做的事，仔细感受一下，用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">K=[k_1,k_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> 去计算一个 Thinking 相对于 Thinking 和 Machine 的权重，再用权重乘以 Thinking 和 Machine 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">V=[v_1,v_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> 得到加权后的 Thinking 和 Machine 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">V=[v_1,v_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，最后求和得到针对各单词的输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><p>同理可以计算出 Machine 相对于 Thinking 和 Machine 的加权输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，拼接 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">z_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 即可得到 Attention 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">Z=[z_1,z_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，这就是 Self Attention 的矩阵计算，如下所示。</p><p>之前的例子是单个向量的运算例子。这张图展示的是矩阵运算的例子，输入是一个 [2x4] 的矩阵（句子中每个单词的词向量的拼接），每个运算是 [4x3] 的矩阵，求得 Q、K、V。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/QKV-矩阵表示.jpg" style="zoom:50%;" /><p>Q 对 K 转制做点乘，除以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><msqrt><mi>d</mi></msqrt><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\sqrt d_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0897em;vertical-align:-0.1575em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">d</span></span><span style="top:-2.8922em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1078em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3286em;"><span style="top:-2.5425em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1575em;"><span></span></span></span></span></span></span></span></span></span>，做一个 softmax 得到合为 1 的比例，对 V 做点乘得到输出 Z。那么这个 Z 就是一个考虑过 Thinking 周围单词 Machine 的输出。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/QKVZ-结果.jpg" style="zoom:50%;" /><p>注意看这个公式，<strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 其实就会组成一个 word2word 的 attention map！</strong>（加了 softmax 之后就是一个合为 1 的权重了）。比如说你的输入是一句话 “i have a dream” 总共 4 个单词，这里就会形成一张 4x4 的注意力机制的图：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/注意力机制矩阵图.jpg" style="zoom:50%;" /><p>这样一来，每一个单词对应每一个单词都会有一个权重，<strong>这也是 Self Attention 名字的来源，即 Attention 的计算来源于 Source（源句） 和 Source 本身，通俗点讲就是 Q、K、V 都来源于输入 X 本身。</strong></p><h2 id="8-4-Self-Attention-和-RNN、LSTM-的区别">8.4 Self Attention 和 RNN、LSTM 的区别</h2><p>引入 Self Attention 有什么好处呢？或者说通过 Self Attention 到底学到了哪些规律或者抽取出了哪些特征呢？我们可以通过下述两幅图来讲解：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention-好处1.jpg" style="zoom:50%;" /><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention-好处2.jpg" style="zoom:50%;" /><p>从上述两张图可以看出，Self Attention 可以捕获同一个句子中单词之间的一些句法特征（例如第一张图展示的有一定距离的短语结构）或者语义特征（例如第二张图展示的 its 的指代对象为 Law）。</p><p>有了上述的讲解，我们现在可以来看看 Self Attention 和 RNN、LSTM 的区别：</p><ul><li>RNN、LSTM：如果是 RNN 或者 LSTM，需要依次序列计算，对于远距离的相互依赖的特征，<strong>要经过若干时间步步骤的信息累积才能将两者联系起来，而距离越远，有效捕获的可能性越小</strong>。</li><li>Self Attention：<ul><li>通过上述两幅图，很明显的可以看出，引入 Self Attention 后会更容易捕获句子中长距离的相互依赖的特征，<strong>因为 Self Attention 在计算过程中会直接将句子中任意两个单词的联系通过一个计算步骤直接联系起来，所以远距离依赖特征之间的距离被极大缩短，有利于有效地利用这些特征</strong>；</li><li>除此之外，Self<br>Attention 对于<strong>一句话中的每个单词都可以单独的进行 Attention 值的计算</strong>，也就是说 Self Attention 对计算的并行性也有直接帮助作用，而对于必须得依次序列计算的 RNN 而言，是无法做到并行计算的。</li></ul></li></ul><p>从上面的计算步骤和图片可以看出，<strong>无论句子序列多长，都可以充分捕获近距离上往下问中的任何依赖关系，进而可以很好的提取句法特征还可以提取语义特征</strong>；而且对于一个句子而言，<strong>每个单词的计算是可以并行处理的</strong>。</p><p>理论上 Self-Attention （Transformer 50 个左右的单词效果最好）解决了 RNN 模型的长序列依赖问题，但是由于文本长度增加时，训练时间也将会呈指数增长，因此在处理长文本任务时可能不一定比 LSTM（200 个左右的单词效果最好） 等传统的 RNN 模型的效果好。</p><p>上述所说的，则是为何 Self Attention 逐渐替代 RNN、LSTM 被广泛使用的原因所在。</p><h2 id="8-5-Masked-Self-Attention-模型">8.5 Masked Self Attention 模型</h2><p>趁热打铁，我们讲讲 Transformer 未来会用到的 Masked Self Attention 模型，这里的 Masked 就是要在做语言模型（或者像翻译）的时候，不给模型看到未来的信息，它的结构如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/masked-attention.jpg" style="zoom:50%;" /><p>上图中和 Self Attention 重复的部分此处就不讲了，主要讲讲 Mask 这一块。</p><p>假设在此之前我们已经通过 scale 之前的步骤得到了一个 attention map，<strong>而 mask 就是沿着对角线把灰色的区域用0覆盖掉，不给模型看到未来的信息</strong>，如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/mask-attention-map.jpg" style="zoom:50%;" /><p>详细来说：</p><ol><li>“i” 作为第一个单词，只能有和 “i” 自己的 attention；</li><li>“have” 作为第二个单词，有和 “i、have” 前面两个单词的 attention；</li><li>“a” 作为第三个单词，有和 “i、have、a” 前面三个单词的 attention；</li><li>“dream” 作为最后一个单词，才有对整个句子 4 个单词的 attention。</li></ol><p>并且在做完 softmax 之后，横轴结果合为 1。如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/mask-attention-map-softmax.jpg" style="zoom:50%;" /><p>具体为什么要 mask，未来再讲解 Transformer 的时候我们会详细解释。</p><h2 id="8-6-Multi-head-Self-Attention-模型">8.6 Multi-head Self Attention 模型</h2><p>由于 Transformer 使用的都是 Self Attention 的进阶版 Multi-head Self Attention，我们简单讲讲  Multi-head Self Attention 的架构，并且在该小节结尾处讲讲它的优点。</p><p>Multi-Head Attention 就是把 Self Attention 得到的注意力值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span> 切分成 n 个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>Z</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>Z</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">Z_1,Z_2,\cdots,Z_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，然后通过全连接层获得新的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">Z&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/multi-head-attention.png" style="zoom:50%;" /><p>我们还是以上面的形式来解释，我们对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span> 进行 8 等份的切分得到 8 个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Z_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/8-head-attention.jpg" style="zoom:50%;" /><p>为了使得输出与输入结构相同，拼接矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Z_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 后乘以一个线性 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">W_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 得到最终的Z：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/8-z-拼接.jpg" style="zoom:50%;" /><p>可以通过下图看看 multi-head attention 的整个流程：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/multi-head-拼接.jpg" style="zoom:50%;" /><p>上述操作有什么好处呢？<strong>多头相当于把原始信息 Source 放入了多个子空间中，也就是捕捉了多个信息，对于使用 multi-head（多头） attention 的简单回答就是，多头保证了 attention 可以注意到不同子空间的信息，捕捉到更加丰富的特征信息</strong>。其实本质上是论文原作者发现这样效果确实好。</p><h1>九、Position Embedding</h1><p>在 Attention 和 RNN、LSTM 的对比中，我们说到 Attention 解决了长距离依赖问题，并且可以支持并行化，但是它就真的百利而无一害了吗？</p><p>其实不然，我们往前回顾，Self Attention 的 Q、K、V 三个矩阵是由同一个输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X_1=(x_1,x_2,\cdots,x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 线性转换而来，也就是说对于这样的一个被打乱序列顺序的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">X_2=(x_2,x_1,\cdots,x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 而言，<strong>由于 Attention 值的计算最终会被加权求和，也就是说两者最终计算的 Attention 值都是一样的，进而也就表明了 Attention 丢掉了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">X_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的序列顺序信息。</strong></p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/位置向量.jpg" style="zoom:50%;" /><p>如上图所示，为了解决 Attention 丢失的序列顺序信息，Transformer 的提出者提出了 Position Embedding，也就是对于输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 进行 Attention 计算之前，在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的词向量中加上位置信息，也就是说 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的词向量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">_</mi><mi>e</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></msub><mo>=</mo><mi>E</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>+</mo><mi>P</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>E</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">X_{final\_embedding} = Embedding + Positional\, Embedding</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0503em;vertical-align:-0.367em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ina</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">mb</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">mb</span><span class="mord mathnormal">e</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">os</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">na</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">mb</span><span class="mord mathnormal">e</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span></p><p>但是如何得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> 的位置向量呢？</p><p>其中位置编码公式如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/位置编码公式.png" style="zoom:33%;" /><p>其中 pos 表示位置、i 表示维度、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">d_{model}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示位置向量的向量维度 、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>i</mi><mtext>、</mtext><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2i、2i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mord cjk_fallback">、</span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 表示的是奇偶数（奇偶维度），上图所示就是偶数位置使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mop">sin</span></span></span></span> 函数，奇数位置使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mop">cos</span></span></span></span> 函数。</p><p>有了位置编码，我们再来看看位置编码是如何嵌入单词编码的（其中 512 表示编码维度），<strong>通过把单词的词向量和位置向量进行叠加，这种方式就称作位置嵌入</strong>，如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/位置编码和词向量之和.png" style="zoom:50%;" /><p><strong>Position Embedding 本身是一个绝对位置的信息</strong>，但在语言模型中，相对位置也很重要。那么为什么位置嵌入机制有用呢？</p><p>我们不要去关心三角函数公式，可以看看下图公式（3）中的第一行，我们做如下的解释，对于 “我爱吃苹果” 这一句话，有 5 个单词，假设序号分别为 1、2、3、4、5。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/位置嵌入解释.png" style="zoom:50%;" /><p>假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>1</mn><mo>=</mo><mtext>我、</mtext><mi>k</mi><mo>=</mo><mn>2</mn><mo>=</mo><mtext>爱、</mtext><mi>p</mi><mi>o</mi><mi>s</mi><mo>+</mo><mi>k</mi><mo>=</mo><mn>3</mn><mo>=</mo><mtext>吃</mtext></mrow><annotation encoding="application/x-tex">pos=1=我、k=2=爱、pos+k=3=吃</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord cjk_fallback">我、</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord cjk_fallback">爱、</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">吃</span></span></span></span>，也就是说 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mo>+</mo><mi>k</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">pos+k=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> 位置的位置向量的某一维可以通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">pos=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 位置的位置向量的某一维线性组合加以线性表示，通过该线性表示可以得出 “吃” 的位置编码信息蕴含了相对于前两个字 “我” 的位置编码信息。</p><p>总而言之就是，<strong>某个单词的位置信息是其他单词位置信息的线性组合，这种线性组合就意味着位置向量中蕴含了相对位置信息。</strong></p><h1>十、Transformer</h1><h2 id="10-1-Transformer-的结构">10.1 Transformer 的结构</h2><p>万事俱备，只欠东风，下面我们来讲讲我们的重点之一，Transformer，你可以先记住这一句话：<strong>Transformer 简单点看其实就是 self-attention 模型的叠加</strong>，首先我们来看看 Transformer 的整体框架。</p><p>Transformer 的整体框架如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-整体框架.jpg" style="zoom:50%;" /><p>上图所示的整体框架乍一眼一看非常复杂，由于 Transformer 起初是作为翻译模型，因此我们以翻译举例，简化一下上述的整体框架：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-框架简化.jpg" style="zoom:50%;" /><p>从上图可以看出 Transformer 相当于一个黑箱，左边输入 “Je suis etudiant”，右边会得到一个翻译结果 “I am a student”。</p><p>再往细里讲，Transformer 也是一个 Seq2Seq 模型（Encoder-Decoder 框架的模型），左边一个 Encoders 把输入读进去，右边一个 Decoders 得到输出，如下所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-ed-框架.jpg" style="zoom:50%;" /><blockquote><p>在这里，我们穿插描述下 Encoder-Decoder 框架的模型是如何进行文本翻译的：</p><ol><li>将序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_1,x_2,\cdots,x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 作为 Encoders 的输入，得到输出序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>z</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(z_1,z_2,\cdots,z_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li><li>把 Encoders 的输出序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>z</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>z</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>z</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(z_1,z_2,\cdots,z_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 作为 Decoders 的输入，生成一个输出序列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>y</mi><mi>m</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(y_1,y_2,\cdots,y_m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。注：<strong>Decoders 每个时刻输出一个结果</strong></li></ol></blockquote><p>第一眼看到上述的 Encodes-Decoders 框架图，随之产生问题就是 Transformer 中 左边 Encoders 的输出是怎么和右边 Decoders 结合的。因为decoders 里面是有N层的，再画张图直观的看就是这样：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-ed-复杂.jpg" style="zoom:50%;" /><p>也就是说，Encoders 的输出，会和<strong>每一层的 Decoder 进行结合</strong>。</p><p>现在我们取其中一层进行详细的展示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-细分.jpg" style="zoom:50%;" /><p>通过上述分析，发现我们想要详细了解 Transformer，只要了解 Transformer 中的 Encoder 和 Decoder 单元即可，接下来我们将详细阐述这两个单元。</p><h2 id="10-2-Encoder">10.2 Encoder</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-细分.jpg" style="zoom:50%;" /><p>有了上述那么多知识的铺垫，我们知道 Eecoders 是 N=6 层，通过上图我们可以看到每层 Encoder 包括两个 sub-layers：</p><ul><li>第一个 sub-layer 是 multi-head self-attention，用来计算输入的 self-attention；</li><li>第二个 sub-layer 是简单的前馈神经网络层 Feed Forward；</li></ul><p>注意：在每个 sub-layer 我们都模拟了残差网络（在下面的数据流示意图中会细讲），每个sub-layer的输出都是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>S</mi><mi>u</mi><mi>b</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">LayerNorm(x+Sub\_layer(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">yer</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">yer</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">sub\_layer</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">yer</span></span></span></span> 表示的是该层的上一层的输出</p><p>现在我们给出 Encoder 的数据流示意图，一步一步去剖析</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/encoder-详细图.png" style="zoom:50%;" /><ol><li>深绿色的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示 Embedding 层的输出，加上代表 Positional Embedding 的向量之后，得到最后输入 Encoder 中的特征向量，也就是浅绿色向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；</li><li>浅绿色向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示单词 “Thinking” 的特征向量，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 经过 Self-Attention 层，变成浅粉色向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 作为残差结构的直连向量，直接和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 相加，之后进行 Layer Norm 操作，得到粉色向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；<ol><li>残差结构的作用：避免出现梯度消失的情况</li><li>Layer Norm 的作用：为了保证数据特征分布的稳定性，并且可以加速模型的收敛</li></ol></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 经过前馈神经网络（Feed Forward）层，经过残差结构与自身相加，之后经过 LN 层，得到一个输出向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">r_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；<ol><li>该前馈神经网络包括两个线性变换和一个ReLU激活函数：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>F</mi><mi>N</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><mi>b</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">FFN(x) = max(0,xW_1+b_1)W_2+b2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">FFN</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord">2</span></span></span></span></li></ol></li><li>由于 Transformer 的 Encoders 具有 6 个 Encoder，<strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">r_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 也将会作为下一层 Encoder 的输入，代替 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的角色</strong>，如此循环，直至最后一层 Encoder。</li></ol><p>需要注意的是，<strong>上述的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mtext>、</mtext><mi>z</mi><mtext>、</mtext><mi>r</mi></mrow><annotation encoding="application/x-tex">x、z、r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> 都具有相同的维数</strong>，论文中为 512 维。</p><h2 id="10-3-Decoder">10.3 Decoder</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-细分.jpg" style="zoom:50%;" /><p>Decoders 也是 N=6 层，通过上图我们可以看到每层 Decoder 包括 3 个 sub-layers：</p><ul><li>第一个 sub-layer 是 Masked multi-head self-attention，也是计算输入的 self-attention；<ul><li>在这里，先不解释为什么要做 Masked，后面在 “Transformer 动态流程展示” 这一小节会解释</li></ul></li><li>第二个 sub-layer 是 Encoder-Decoder Attention 计算，对 Encoder 的输入和 Decoder 的Masked multi-head self-attention 的输出进行 attention 计算；<ul><li>在这里，同样不解释为什么要对 Encoder 和 Decoder 的输出一同做 attention 计算，后面在 “Transformer 动态流程展示” 这一小节会解释</li></ul></li><li>第三个 sub-layer 是前馈神经网络层，与 Encoder 相同。</li></ul><h2 id="10-4-Transformer-输出结果">10.4 Transformer 输出结果</h2><p>以上，就讲完了 Transformer 编码和解码两大模块，那么我们回归最初的问题，将 “机器学习” 翻译成 “machine learing”，解码器的输出是一个浮点型的向量，怎么转化成 “machine learing” 这两个词呢？让我们来看看 Encoders 和 Decoders 交互的过程寻找答案：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-交互.jpg" style="zoom:50%;" /><p>从上图可以看出，Transformer 最后的工作是让解码器的输出通过线性层 Linear 后接上一个 softmax</p><ul><li>其中线性层是一个简单的全连接神经网络，它将解码器产生的向量 A 投影到一个更高维度的向量 B 上，假设我们模型的词汇表是10000个词，那么向量 B 就有10000个维度，每个维度对应一个惟一的词的得分。</li><li>之后的softmax层将这些分数转换为概率。选择概率最大的维度，并对应地生成与之关联的单词作为此时间步的输出就是最终的输出啦！</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-最后输出.jpg" style="zoom:50%;" /><p>假设词汇表维度是 6，那么输出最大概率词汇的过程如下：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-最终输出结果.jpg" style="zoom:50%;" /><h1>十一、Transformer 动态流程展示</h1><p>首先我们来看看拿 Transformer 作翻译时，如何生成翻译结果的：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-动态生成.gif" style="zoom:50%;" /><p>继续进行：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-动态结果-2.gif" style="zoom:50%;" /><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-整体框架.jpg" style="zoom:33%;" /><p>假设上图是训练模型的某一个阶段，我们来结合 Transformer 的完整框架描述下这个动态的流程图：</p><ol><li>输入 “je suis etudiant” 到 Encoders，然后得到一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">K_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">V_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵；</li><li>输入 “I am a student” 到 Decoders ，首先通过 Masked Multi-head Attention 层得到 “I am a student” 的 attention 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，然后用 attention 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 Encoders 的输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">K_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">V_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵进行 attention 计算，得到第 1 个输出 “I”；</li><li>输入 “I am a student” 到 Decoders ，首先通过 Masked Multi-head Attention 层得到 “I am a student” 的 attention 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，然后用 attention 值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 Encoders 的输出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">K_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">V_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵进行 attention 计算，得到第 2 个输出 “am”；</li><li>……</li></ol><p>现在我们来解释我们之前遗留的两个问题。</p><h2 id="11-1-为什么-Decoder-需要做-Mask">11.1 为什么 Decoder 需要做 Mask</h2><ul><li><p>训练阶段：我们知道 “je suis etudiant” 的翻译结果为 “I am a student”，我们把 “I am a student” 的 Embedding 输入到 Decoders 里面，翻译第一个词 “I” 时</p><ul><li>如果对 “I am a student”  attention 计算不做 mask，“am，a，student” 对 “I” 的翻译将会有一定的贡献</li><li>如果对 “I am a student”  attention 计算做 mask，“am，a，student” 对 “I” 的翻译将没有贡献</li></ul></li><li><p>测试阶段：我们不知道 “我爱中国” 的翻译结果为 “I love China”，我们只能随机初始化一个 Embedding 输入到 Decoders 里面，翻译第一个词 “I” 时：</p><ul><li>无论是否做 mask，“love，China” 对 “I” 的翻译都不会产生贡献</li><li>但是翻译了第一个词 “I” 后，随机初始化的 Embedding 有了 “I” 的 Embedding，也就是说在翻译第二词 “love” 的时候，“I” 的 Embedding 将有一定的贡献，但是 “China” 对 “love” 的翻译毫无贡献，随之翻译的进行，<strong>已经翻译的结果将会对下一个要翻译的词都会有一定的贡献，这就和做了 mask 的训练阶段做到了一种匹配</strong></li></ul></li></ul><p>总结下就是：Decoder 做 Mask，是为了让训练阶段和测试阶段行为一致，不会出现间隙，避免过拟合</p><h2 id="11-2-为什么-Encoder-给予-Decoders-的是-K、V-矩阵">11.2 为什么 Encoder 给予 Decoders 的是 K、V 矩阵</h2><p>我们在讲解 Attention 机制中曾提到，Query 的目的是借助它从一堆信息中找到重要的信息。</p><p>现在 Encoder 提供了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>e</mi></msub><mtext>、</mtext><msub><mi>V</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">K_e、V_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵，Decoder 提供了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵，通过  “我爱中国” 翻译为 “I love China” 这句话详细解释下。</p><p>当我们翻译 “I” 的时候，由于 Decoder 提供了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">Q_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵，通过与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>e</mi></msub><mtext>、</mtext><msub><mi>V</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">K_e、V_e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 矩阵的计算，它可以在 “我爱中国” 这四个字中找到对 “I” 翻译最有用的单词是哪几个，并以此为依据翻译出 “I” 这个单词，这就很好的体现了注意力机制想要达到的目的，把焦点放在对自己而言更为重要的信息上。</p><ul><li>其实上述说的就是 Attention 里的 soft attention机制，解决了曾经的 Encoder-Decoder 框架的一个问题，在这里不多做叙述，有兴趣的可以参考网上的一些资料。<ul><li>早期的 Encoder-Decoder 框架中的 Encoder 通过 LSTM 提取出源句（Source） “我爱中国” 的特征信息 C，然后 Decoder 做翻译的时候，目标句（Target）“I love China” 中的任何一个单词的翻译都来源于相同特征信息 C，这种做法是极其不合理的，例如翻译 “I” 时应该着眼于 “我”，翻译 “China” 应该着眼于 “中国”，而早期的这种做法并没有体现出，然而 Transformer 却通过 Attention 的做法解决了这个问题。</li></ul></li></ul><h1>十二、GPT 模型</h1><h2 id="12-1-GPT-模型的预训练">12.1 GPT 模型的预训练</h2><p>在讲解 ELMo 的时候，我们说到 ELMo 这一类预训练的方法被称为 “Feature-based Pre-Training”。并且如果把 ELMo 这种预训练方法和图像领域的预训练方法对比，发现两者模式看上去还是有很大差异的。</p><p>除了以 ELMo 为代表的这种基于特征融合的预训练方法外，NLP 里还有一种典型做法，这种做法和图像领域的方式就是看上去一致的了，一般将这种方法称为 “基于Fine-tuning的模式”，而 GPT 就是这一模式的典型开创者，下面先让我们看看 GPT 的网络结构。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/gpt-模型.jpg" style="zoom:50%;" /><p>GPT 是 “Generative Pre-Training” 的简称，从名字看其含义是指的生成式的预训练。</p><p>GPT也采用两阶段过程：</p><ol><li>第一个阶段：利用语言模型进行预训练；</li><li>第二个阶段：通过 Fine-tuning 的模式解决下游任务。</li></ol><p>上图展示了 GPT 的预训练过程，其实和 ELMo 是类似的，主要不同在于两点：</p><ol><li>首先，特征抽取器用的不是 RNN，而是用的 Transformer，它的特征抽取能力要强于RNN，这个选择很明显是很明智的；</li><li>其次，<ol><li>GPT 的预训练虽然仍然是以语言模型作为目标任务，但是采用的是单向的语言模型，所谓 “单向” 的含义是指：语言模型训练的任务目标是根据 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 单词的上下文去正确预测单词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 之前的单词序列Context-before称为上文，之后的单词序列Context-after称为下文。</li><li>ELMo 在做语言模型预训练的时候，预测单词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 同时使用了上文和下文，而 GPT 则只采用 Context-before 这个单词的上文来进行预测，而抛开了下文。</li><li>GPT 这个选择现在看不是个太好的选择，原因很简单，它没有把单词的下文融合进来，这限制了其在更多应用场景的效果，比如阅读理解这种任务，在做任务的时候是可以允许同时看到上文和下文一起做决策的。如果预训练时候不把单词的下文嵌入到 Word Embedding 中，是很吃亏的，白白丢掉了很多信息。</li></ol></li></ol><h2 id="12-2-GPT-模型的-Fine-tuning">12.2 GPT 模型的 Fine-tuning</h2><p>上面讲的是 GPT 如何进行第一阶段的预训练，那么假设预训练好了网络模型，后面下游任务怎么用？它有自己的个性，和 ELMO 的方式大有不同。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/gpt-fine.jpg" style="zoom:50%;" /><p>上图展示了 GPT 在第二阶段如何使用：</p><ol><li><p>首先，对于不同的下游任务来说，本来你可以任意设计自己的网络结构，现在不行了，你要向 GPT 的网络结构看齐，把任务的网络结构改造成和 GPT 一样的网络结构。</p></li><li><p>然后，在做下游任务的时候，利用第一步预训练好的参数初始化 GPT 的网络结构，这样通过预训练学到的语言学知识就被引入到你手头的任务里来了。</p></li><li><p>再次，你可以用手头的任务去训练这个网络，对网络参数进行 Fine-tuning，使得这个网络更适合解决手头的问题。就是这样。</p></li></ol><p>这有没有让你想起最开始提到的图像领域如何做预训练的过程，对，这跟那个预训练的模式是一模一样的。</p><p>对于 NLP 各种花样的不同任务，怎么改造才能靠近 GPT 的网络结构呢？由于 GPT 对下游任务的改造过程和 BERT 对下游任务的改造极其类似，并且我们主要目的是为了讲解 BERT，所以这个问题将会在 BERT 那里得到回答。</p><h1>十三、BERT 模型</h1><h2 id="13-1-BERT：公认的里程碑">13.1 BERT：公认的里程碑</h2><p>BERT 模型可以作为公认的里程碑式的模型，但是它最大的优点不是创新，而是集大成者，并且这个集大成者有了各项突破，下面让我们看看 BERT 是怎么集大成者的。</p><ul><li>BERT 的意义在于：从大量无标记数据集中训练得到的深度模型，可以显著提高各项自然语言处理任务的准确率。</li><li>近年来优秀预训练语言模型的集大成者：参考了 ELMO 模型的双向编码思想、借鉴了 GPT 用 Transformer 作为特征提取器的思路、采用了 word2vec 所使用的 CBOW 方法</li><li>BERT 和 GPT 之间的区别：<ul><li>GPT：<strong>GPT 使用 Transformer Decoder 作为特征提取器、具有良好的文本生成能力</strong>，然而当前词的语义只能由其前序词决定，并且在语义理解上不足</li><li>BERT：使用了 Transformer Encoder 作为特征提取器，并使用了与其配套的掩码训练方法。<strong>虽然使用双向编码让 BERT 不再具有文本生成能力，但是 BERT 的语义信息提取能力更强</strong></li></ul></li><li>单向编码和双向编码的差异，以该句话举例 “今天天气很{}，我们不得不取消户外运动”，分别从单向编码和双向编码的角度去考虑 {} 中应该填什么词：<ul><li>单向编码：单向编码只会考虑 “今天天气很”，以人类的经验，大概率会从 “好”、“不错”、“差”、“糟糕” 这几个词中选择，这些词可以被划为截然不同的两类</li><li>双向编码：<strong>双向编码会同时考虑上下文的信息</strong>，即除了会考虑 “今天天气很” 这五个字，还会考虑 “我们不得不取消户外运动” 来帮助模型判断，则大概率会从 “差”、“糟糕” 这一类词中选择</li></ul></li></ul><h2 id="13-2-BERT-的结构：强大的特征提取能力">13.2 BERT 的结构：强大的特征提取能力</h2><ul><li><p>如下图所示，我们来看看 ELMo、GPT 和 BERT 三者的区别</p><ul><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/BERT-GPT-比较.png" style="zoom:50%;" /></li><li>ELMo 使用自左向右编码和自右向左编码的两个 LSTM 网络，分别以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_1,\cdots,w_{i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_{i+1},\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 为目标函数独立训练，<strong>将训练得到的特征向量以拼接的形式实现双向编码，本质上还是单向编码，只不过是两个方向上的单向编码的拼接而成的双向编码</strong>。</li><li>GPT 使用 Transformer Decoder 作为 Transformer Block，以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_1,\cdots,w_{i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 为目标函数进行训练，<strong>用 Transformer Block 取代 LSTM 作为特征提取器，实现了单向编码，是一个标准的预训练语言模型，即使用 Fine-Tuning 模式解决下游任务。</strong></li><li>BERT 也是一个标准的预训练语言模型，<strong>它以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_1,\cdots,w_{i-1},w_{i+1},\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 为目标函数进行训练，BERT 使用的编码器属于双向编码器</strong>。<ul><li>BERT 和 ELMo 的区别在于使用 Transformer Block 作为特征提取器，加强了语义特征提取的能力；</li><li>BERT 和 GPT 的区别在于使用 Transformer Encoder 作为 Transformer Block，并且将 GPT 的单向编码改成双向编码，也就是说 BERT 舍弃了文本生成能力，换来了更强的语义理解能力。</li></ul></li></ul></li></ul><p>BERT 的模型结构如下图所示：</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/bert-模型结构.jpg" style="zoom:51%;" /><p>从上图可以发现，BERT 的模型结构其实就是 Transformer Encoder 模块的堆叠。在模型参数选择上，论文给出了两套大小不一致的模型。</p><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mrow><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi></mrow></msub></mrow><annotation encoding="application/x-tex">BERT_{BASE}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">BER</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">SE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ：L = 12，H = 768，A = 12，总参数量为 1.1 亿</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>E</mi><mi>R</mi><msub><mi>T</mi><mrow><mi>L</mi><mi>A</mi><mi>R</mi><mi>G</mi><mi>E</mi></mrow></msub></mrow><annotation encoding="application/x-tex">BERT_{LARGE}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">BER</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">RGE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：L = 24，H = 1024，A = 16，总参数量为 3.4 亿</p></blockquote><p>其中 L 代表 Transformer Block 的层数；H 代表特征向量的维数（此处默认 Feed Forward 层中的中间隐层的维数为 4H）；A 表示 Self-Attention 的头数，使用这三个参数基本可以定义 BERT的量级。</p><p>BERT 参数量级的计算公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>词向量参数</mtext><mo>+</mo><mn>12</mn><mo>∗</mo><mtext>（</mtext><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mo>−</mo><mi>H</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mtext>参数</mtext><mo>+</mo><mtext>全连接层参数</mtext><mo>+</mo><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mtext>参数）</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mtext>（</mtext><mn>30522</mn><mo>+</mo><mn>512</mn><mo>+</mo><mn>2</mn><mtext>）</mtext><mo>∗</mo><mn>768</mn><mo>+</mo><mn>768</mn><mo>∗</mo><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mn>12</mn><mo>∗</mo><mtext>（</mtext><mn>768</mn><mo>∗</mo><mn>768</mn><mi mathvariant="normal">/</mi><mn>12</mn><mo>∗</mo><mn>3</mn><mo>∗</mo><mn>12</mn><mo>+</mo><mn>768</mn><mo>∗</mo><mn>768</mn><mo>+</mo><mn>768</mn><mo>∗</mo><mn>3072</mn><mo>∗</mo><mn>2</mn><mo>+</mo><mn>768</mn><mo>∗</mo><mn>2</mn><mo>∗</mo><mn>2</mn><mtext>）</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>108808704.0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≈</mo><mn>110</mn><mi>M</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}&amp; 词向量参数+ 12 * （Multi-Heads参数 + 全连接层参数 + layernorm参数）\\ &amp; = （30522+512 + 2）* 768 + 768 * 2 \\&amp; + 12 * （768 * 768 / 12 * 3 * 12 + 768 * 768 + 768 * 3072 * 2 + 768 * 2 * 2） \\ &amp; = 108808704.0 \\ &amp; \approx 110M\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-4.5em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-3em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:-1.5em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span><span style="top:0em;"><span class="pstrut" style="height:2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord cjk_fallback">词向量参数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">12</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">u</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">He</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">参数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">全连接层参数</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">yer</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">m</span><span class="mord cjk_fallback">参数）</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord cjk_fallback">（</span><span class="mord">30522</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">512</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">12</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">（</span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768/12</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">12</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">3072</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">768</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord cjk_fallback">）</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">108808704.0</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">110</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>训练过程也是很花费计算资源和时间的，<strong>总之表示膜拜，普通人即便有 idea 没有算力也只能跪着。</strong></p><h2 id="13-3-BERT-之无监督训练">13.3 BERT 之无监督训练</h2><p>和 GPT 一样，BERT 也采用二段式训练方法：</p><ol><li>第一阶段：使用易获取的大规模无标签余料，来训练基础语言模型；</li><li>第二阶段：根据指定任务的少量带标签训练数据进行微调训练。</li></ol><p>不同于 GPT 等标准语言模型使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_1,\cdots,w_{i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 为目标函数进行训练，能看到全局信息的 BERT 使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>w</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(w_i|w_1,\cdots,w_{i-1},w_{i+1},\cdots,w_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 为目标函数进行训练。</p><p>并且 BERT 用语言掩码模型（MLM）方法训练词的语义理解能力；用下句预测（NSP）方法训练句子之间的理解能力，从而更好地支持下游任务。</p><h2 id="13-4-BERT之语言掩码模型（MLM）">13.4 BERT之语言掩码模型（MLM）</h2><p>BERT 作者认为，<strong>使用自左向右编码和自右向左编码的单向编码器拼接而成的双向编码器，在性能、参数规模和效率等方面，都不如直接使用深度双向编码器强大</strong>，这也是为什么 BERT 使用 Transformer Encoder 作为特征提取器，而不使用自左向右编码和自右向左编码的两个 Transformer Decoder作为特征提取器的原因。</p><p>由于无法使用标准语言模型的训练模式，<strong>BERT 借鉴完形填空任务和 CBOW 的思想</strong>，使用语言掩码模型（MLM ）方法训练模型。</p><p>MLM 方法也就是随机去掉句子中的部分 token（单词），然后模型来预测被去掉的 token 是什么。<strong>这样实际上已经不是传统的神经网络语言模型(类似于生成模型)了，而是单纯作为分类问题</strong>，根据这个时刻的 hidden state 来预测这个时刻的 token 应该是什么，而不是预测下一个时刻的词的概率分布了。</p><p>随机去掉的 token 被称作掩码词，在训练中，掩码词将以 15% 的概率被替换成 [MASK]，也就是说随机 mask 语料中 15% 的 token，这个操作则称为掩码操作。注意：<strong>在CBOW 模型中，每个词都会被预测一遍。</strong></p><p>但是这样设计 MLM 的训练方法会引入弊端：<strong>在模型微调训练阶段或模型推理（测试）阶段，输入的文本中将没有 [MASK]，进而导致产生由训练和预测数据偏差导致的性能损失。</strong></p><p>考虑到上述的弊端，BERT 并没有总用 [MASK] 替换掩码词，而是按照一定比例选取替换词。在选择 15% 的词作为掩码词后这些掩码词有三类替换选项：</p><ul><li>80% 练样本中：将选中的词用 [MASK] 来代替，例如：</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“地球是[MASK]八大行星之一”</span><br></pre></td></tr></table></figure><ul><li>10% 的训练样本中：选中的词不发生变化，<strong>该做法是为了缓解训练文本和预测文本的偏差带来的性能损失</strong>，例如：</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“地球是太阳系八大行星之一”</span><br></pre></td></tr></table></figure><ul><li>10% 的训练样本中：将选中的词用任意的词来进行代替，<strong>该做法是为了让 BERT 学会根据上下文信息自动纠错</strong>，例如：</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“地球是苹果八大行星之一”</span><br></pre></td></tr></table></figure><p>作者在论文中提到这样做的好处是，编码器不知道哪些词需要预测的，哪些词是错误的，因此<strong>被迫需要学习每一个 token 的表示向量</strong>，另外作者也<strong>表示双向编码器比单项编码器训练要慢</strong>，进而导致BERT 的训练效率低了很多，但是实验也证明 MLM 训练方法可以让 BERT 获得超出同期所有预训练语言模型的语义理解能力，牺牲训练效率是值得的。</p><h2 id="13-5-BERT-之下句预测（NSP）">13.5 BERT 之下句预测（NSP）</h2><p>在很多自然语言处理的下游任务中，如问答和自然语言推断，都基于两个句子做逻辑推理，而语言模型并不具备直接捕获句子之间的语义联系的能力，或者可以说成<strong>单词预测粒度的训练到不了句子关系这个层级</strong>，为了<strong>学会捕捉句子之间的语义联系</strong>，BERT 采用了下句预测（NSP ）作为无监督预训练的一部分。</p><p>NSP 的具体做法是，BERT 输入的语句将由两个句子构成，其中，50% 的概率将语义连贯的两个连续句子作为训练文本（<strong>连续句对一般选自篇章级别的语料，以此确保前后语句的语义强相关</strong>），另外 50% 的概率将完全随机抽取两个句子作为训练文本。</p><blockquote><p>连续句对：[CLS]今天天气很糟糕[SEP]下午的体育课取消了[SEP]</p><p>随机句对：[CLS]今天天气很糟糕[SEP]鱼快被烤焦啦[SEP]</p></blockquote><p>其中 [SEP]  标签表示分隔符。 [CLS] 表示标签用于类别预测，结果为 1，表示输入为连续句对；结果为 0，表示输入为随机句对。</p><p>通过训练 [CLS] 编码后的输出标签，<strong>BERT 可以学会捕捉两个输入句对的文本语义</strong>，在连续句对的预测任务中，BERT 的正确率可以达到 97%-98%。</p><h2 id="13-6-BERT-之输入表示">13.6 BERT 之输入表示</h2><p>BERT 在预训练阶段使用了前文所述的两种训练方法，<strong>在真实训练中一般是两种方法混合使用</strong>。</p><p>由于 BERT 通过 Transformer 模型堆叠而成，所以 BERT 的输入需要两套 Embedding 操作：</p><ol><li>一套为 One-hot 词表映射编码（对应下图的 Token Embeddings）；</li><li>另一套为位置编码（对应下图的 Position Embeddings），<strong>不同于 Transformer 的位置编码用三角函数表示，BERT 的位置编码将在预训练过程中训练得到（训练思想类似于Word Embedding 的 Q 矩阵）</strong></li><li>由于在 MLM 的训练过程中，存在单句输入和双句输入的情况，因此 BERT 还需要一套区分输入语句的分割编码（对应下图的 Segment Embeddings），BERT 的分割编码也将在预训练过程中训练得到</li></ol><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/BERT-输入.jpg" style="zoom:51%;" /><p>对于分割编码，Segment Embeddings 层只有两种向量表示。前一个向量是把 0 赋给第一个句子中的各个 token，后一个向量是把 1 赋给第二个句子中的各个 token ；如果输入仅仅只有一个句子，那么它的 segment embedding 就是全 0，下面我们简单举个例子描述下：</p><blockquote><p>[CLS]I like dogs[SEP]I like cats[SEP] 对应编码 0 0 0 0 0 1 1 1 1</p><p>[SEP]I Iike dogs and cats[SEP] 对应编码 0 0 0 0 0 0 0</p></blockquote><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/segment-embeddings.jpg" style="zoom:50%;" /><h1>十四、BERT 下游任务改造</h1><p>BERT 根据自然语言处理下游任务的输入和输出的形式，将微调训练支持的任务分为四类，分别是句对分类、单句分类、文本问答和单句标注，接下来我们将简要的介绍下 BERT 如何通过微调训练适应这四类任务的要求。</p><h2 id="14-1-句对分类">14.1 句对分类</h2><p>给定两个句子，判断它们的关系，称为句对分类，例如判断句对是否相似、判断后者是否为前者的答案。</p><p>针对句对分类任务，BERT 在预训练过程中就使用了 NSP 训练方法获得了直接捕获句对语义关系的能力。</p><p><strong>如下图所示，句对用 [SEP] 分隔符拼接成文本序列，在句首加入标签 [CLS]，将句首标签所对应的输出值作为分类标签，计算预测分类标签与真实分类标签的交叉熵，将其作为优化目标，在任务数据上进行微调训练。</strong></p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/句对分类.jpg" style="zoom:80%;" /><p>针对二分类任务，BERT 不需要对输入数据和输出数据的结构做任何改动，直接使用与 NSP 训练方法一样的输入和输出结构就行。</p><p>针对多分类任务，需要在句首标签 [CLS] 的输出特征向量后接一个全连接层和 Softmax 层，保证输出维数与类别数目一致，最后通过 arg max 操作（取最大值时对应的索引序号）得到相对应的类别结果。</p><p>下面给出句对分相似性任务的实例：</p><blockquote><p>任务：判断句子 “我很喜欢你” 和句子 “我很中意你” 是否相似</p><p>输入改写：“[CLS]我很喜欢你[SEP]我很中意你”</p><p>取 “[CLS]” 标签对应输出：[0.02, 0.98]</p><p>通过 arg max 操作得到相似类别为 1（类别索引从 0 开始），即两个句子相似</p></blockquote><h2 id="14-2-单句分类">14.2 单句分类</h2><p>给定一个句子，判断该句子的类别，统称为单句分类，例如判断情感类别、判断是否为语义连贯的句子。</p><p>针对单句二分类任务，也无须对 BERT 的输入数据和输出数据的结构做任何改动。</p><p><strong>如下图所示，单句分类在句首加入标签 [CLS]，将句首标签所对应的输出值作为分类标签，计算预测分类标签与真实分类标签的交叉熵，将其作为优化目标，在任务数据上进行微调训练。</strong></p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/单句分类.jpg" style="zoom:80%;" /><p>同样，针对多分类任务，需要在句首标签 [CLS] 的输出特征向量后接一个全连接层和 Softmax 层，保证输出维数与类别数目一致，最后通过 argmax 操作得到相对应的类别结果。</p><p>下面给出语义连贯性判断任务的实例：</p><blockquote><p>任务：判断句子“海大球星饭茶吃” 是否为一句话</p><p>输入改写：“[CLS]海大球星饭茶吃”</p><p>取 “[CLS]” 标签对应输出：[0.99, 0.01]</p><p>通过 arg max 操作得到相似类别为 0，即这个句子不是一个语义连贯的句子</p></blockquote><h2 id="14-3-文本问答">14.3 文本问答</h2><p>给定一个问句和一个蕴含答案的句子，找出答案在后这种的位置，称为文本问答，例如给定一个问题（句子 A），在给定的段落（句子 B）中标注答案的其实位置和终止位置。</p><p><strong>文本问答任何和前面讲的其他任务有较大的差别，无论是在优化目标上，还是在输入数据和输出数据的形式上，都需要做一些特殊的处理。</strong></p><p>为了标注答案的起始位置和终止位置，BERT 引入两个辅助向量 s（start，判断答案的起始位置） 和 e（end，判断答案的终止位置）。</p><p><strong>如下图所示，BERT 判断句子 B 中答案位置的做法是，将句子 B 中的每一个次得到的最终特征向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>T</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">T_i&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span> 经过全连接层（利用全连接层将词的抽象语义特征转化为任务指向的特征）后，分别与向量 s 和 e 求内积，对所有内积分别进行 softmax 操作，即可得到词 Tok m（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>M</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">m\in [1,M]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">]</span></span></span></span>）作为答案其实位置和终止位置的概率。最后，去概率最大的片段作为最终的答案</strong>。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/文本问答.jpg" style="zoom:80%;" /><p>文本回答任务的微调训练使用了两个技巧：</p><ol><li>用全连接层把 BERT 提取后的深层特征向量转化为用于判断答案位置的特征向量</li><li>引入辅助向量 s 和 e 作为答案其实位置和终止位置的基准向量，明确优化目标的方向和度量方法</li></ol><p>下面给出文本问答任务的实例：</p><blockquote><p>任务：给定问句 “今天的最高温度是多少”，在文本 “天气预报显示今天最高温度 37 摄氏度” 中标注答案的起始位置和终止位置</p><p>输入改写：“[CLS]今天的最高温度是多少[SEP]天气预报显示今天最高温度 37 摄氏度”</p><p>BERT Softmax 结果：</p><table><thead><tr><th style="text-align:center">篇章文本</th><th style="text-align:center">天气</th><th style="text-align:center">预报</th><th style="text-align:center">显示</th><th style="text-align:center">今天</th><th style="text-align:center">最高温</th><th style="text-align:center">37</th><th style="text-align:center">摄氏度</th></tr></thead><tbody><tr><td style="text-align:center">起始位置概率</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.04</td><td style="text-align:center">0.10</td><td style="text-align:center">0.80</td><td style="text-align:center">0.03</td></tr><tr><td style="text-align:center">终止位置概率</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.03</td><td style="text-align:center">0.04</td><td style="text-align:center">0.10</td><td style="text-align:center">0.80</td></tr></tbody></table><p>对 Softmax 的结果取 arg max，得到答案的起始位置为 6，终止位置为 7，即答案为 “37 摄氏度”</p></blockquote><h2 id="14-4-单句标注">14.4 单句标注</h2><p>给定一个句子，标注每个次的标签，称为单句标注。例如给定一个句子，标注句子中的人名、地名和机构名。</p><p>单句标注任务和 BERT 预训练任务具有较大差异，但与文本问答任务较为相似。</p><p><strong>如下图所示，在进行单句标注任务时，需要在每个词的最终语义特征向量之后添加全连接层，将语义特征转化为序列标注任务所需的特征，单句标注任务需要对每个词都做标注，因此不需要引入辅助向量，直接对经过全连接层后的结果做 Softmax 操作，即可得到各类标签的概率分布。</strong></p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/单句标注.jpg" style="zoom:50%;" /><p>由于 BERT 需要对输入文本进行分词操作，独立词将会被分成若干子词，因此 BERT 预测的结果将会是 5 类（细分为 13 小类）：</p><ul><li>O（非人名地名机构名，O 表示 Other）</li><li>B-PER/LOC/ORG（人名/地名/机构名初始单词，B 表示 Begin）</li><li>I-PER/LOC/ORG（人名/地名/机构名中间单词，I 表示 Intermediate）</li><li>E-PER/LOC/ORG（人名/地名/机构名终止单词，E 表示 End）</li><li>S-PER/LOC/ORG（人名/地名/机构名独立单词，S 表示 Single）</li></ul><p>将 5 大类的首字母结合，可得 IOBES，这是序列标注最常用的标注方法。</p><p>下面给出命名实体识别（NER）任务的示例：</p><blockquote><p>任务：给定句子 “爱因斯坦在柏林发表演讲”，根据 IOBES 标注 NER 结果</p><p>输入改写：“[CLS]爱 因 斯坦 在 柏林 发表 演讲”</p><p>BERT Softmax 结果：</p><table><thead><tr><th style="text-align:center">BOBES</th><th style="text-align:center">爱</th><th style="text-align:center">因</th><th style="text-align:center">斯坦</th><th style="text-align:center">在</th><th style="text-align:center">柏林</th><th style="text-align:center">发表</th><th style="text-align:center">演讲</th></tr></thead><tbody><tr><td style="text-align:center">O</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.90</td><td style="text-align:center">0.01</td><td style="text-align:center">0.90</td><td style="text-align:center">0.90</td></tr><tr><td style="text-align:center">B-PER</td><td style="text-align:center">0.90</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td></tr><tr><td style="text-align:center">I-PER</td><td style="text-align:center">0.01</td><td style="text-align:center">0.90</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td></tr><tr><td style="text-align:center">E-PER</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.90</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td></tr><tr><td style="text-align:center">S-LOC</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td><td style="text-align:center">0.01</td></tr></tbody></table><p>对 Softmax 的结果取 arg max，得到最终地 NER 标注结果为：“爱因斯坦” 是人名；“柏林” 是地名</p></blockquote><h2 id="14-5-BERT效果展示">14.5 BERT效果展示</h2><p>无论如何，从上述讲解可以看出，NLP 四大类任务都可以比较方便地改造成 Bert 能够接受的方式，总之不同类型的任务需要对模型做不同的修改，但是修改都是非常简单的，最多加一层神经网络即可。这其实是 Bert 的非常大的优点，这意味着它几乎可以做任何NLP的下游任务，具备普适性，这是很强的。</p><p>但是讲了这么多，**一个新模型好不好，效果才是王道。**那么Bert 采用这种两阶段方式解决各种 NLP 任务效果如何？</p><p>在 11 个各种类型的 NLP 任务中达到目前最好的效果，某些任务性能有极大的提升。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/bert-效果.jpg" style="zoom:50%;" /><h1>十五、预训练语言模型总结</h1><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/总结.jpg" style="zoom:50%;" /><p>到这里我们可以再梳理下几个模型之间的演进关系。</p><p>从上图可见，Bert 其实和 ELMO 及 GPT 存在千丝万缕的关系，比如如果我们把 GPT 预训练阶段换成双向语言模型，那么就得到了 Bert；而如果我们把 ELMO 的特征抽取器换成 Transformer，那么我们也会得到Bert。</p><p>所以你可以看出：Bert最关键两点，一点是特征抽取器采用 Transformer；第二点是预训练的时候采用双向语言模型。</p><p>那么新问题来了：对于 Transformer 来说，怎么才能在这个结构上做双向语言模型任务呢？乍一看上去好像不太好搞。我觉得吧，其实有一种很直观的思路，怎么办？看看 ELMO 的网络结构图，只需要把两个 LSTM 替换成两个 Transformer，一个负责正向，一个负责反向特征提取，其实应该就可以。</p><p>当然这是我自己的改造，Bert 没这么做。那么 Bert 是怎么做的呢？我们前面不是提过 Word2Vec 吗？我前面肯定不是漫无目的地提到它，提它是为了在这里引出那个 CBOW 训练方法，所谓写作时候埋伏笔的 “草蛇灰线，伏脉千里”，大概就是这个意思吧？</p><p>前面提到了 CBOW 方法，它的核心思想是：在做语言模型任务的时候，我把要预测的单词抠掉，然后根据它的上文 Context-Before 和下文 Context-afte r去预测单词。</p><p>其实 Bert 怎么做的？Bert 就是这么做的。从这里可以看到方法间的继承关系。当然 Bert 作者没提 Word2Vec 及 CBOW 方法，这是我的判断，Bert 作者说是受到完形填空任务的启发，这也很可能，但是我觉得他们要是没想到过 CBOW 估计是不太可能的。</p><p>从这里可以看出，在文章开始我说过 Bert 在模型方面其实没有太大创新，更像一个最近几年 NLP 重要技术的集大成者，原因在于此，当然我不确定你怎么看，是否认同这种看法，而且我也不关心你怎么看。其实 Bert 本身的效果好和普适性强才是最大的亮点。</p><p><strong>最后，我讲讲我对Bert的评价和看法</strong>，我觉得 Bert 是 NLP 里里程碑式的工作，对于后面 NLP 的研究和工业应用会产生长久的影响，这点毫无疑问。但是从上文介绍也可以看出，从模型或者方法角度看，Bert 借鉴了 ELMO，GPT 及 CBOW，主要提出了 Masked 语言模型及 Next Sentence Prediction，但是这里 Next Sentence Prediction 基本不影响大局，而 Masked LM 明显借鉴了 CBOW 的思想。所以说 Bert 的模型没什么大的创新，更像最近几年 NLP 重要进展的集大成者，这点如果你看懂了上文估计也没有太大异议，如果你有大的异议，杠精这个大帽子我随时准备戴给你。</p><p>如果归纳一下这些进展就是：首先是两阶段模型，第一阶段双向语言模型预训练，这里注意要用双向而不是单向，第二阶段采用具体任务 Fine-tuning 或者做特征集成；第二是特征抽取要用Transformer 作为特征提取器而不是 RNN 或者 CNN；第三，双向语言模型可以采取 CBOW 的方法去做（当然我觉得这个是个细节问题，不算太关键，前两个因素比较关键）。Bert 最大的亮点在于效果好及普适性强，几乎所有 NLP 任务都可以套用 Bert 这种两阶段解决思路，而且效果应该会有明显提升。可以预见的是，未来一段时间在 NLP 应用领域，Transformer 将占据主导地位，而且这种两阶段预训练方法也会主导各种应用。</p><p>另外，我们应该弄清楚预训练这个过程本质上是在做什么事情，本质上预训练是通过设计好一个网络结构来做语言模型任务，然后把大量甚至是无穷尽的无标注的自然语言文本利用起来，预训练任务把大量语言学知识抽取出来编码到网络结构中，当手头任务带有标注信息的数据有限时，这些先验的语言学特征当然会对手头任务有极大的特征补充作用，因为当数据有限的时候，很多语言学现象是覆盖不到的，泛化能力就弱，集成尽量通用的语言学知识自然会加强模型的泛化能力。如何引入先验的语言学知识其实一直是 NLP 尤其是深度学习场景下的 NLP 的主要目标之一，不过一直没有太好的解决办法，而 ELMO/GPT/Bert 的这种两阶段模式看起来无疑是解决这个问题自然又简洁的方法，这也是这些方法的主要价值所在。</p><p>对于当前 NLP 的发展方向，我个人觉得有两点非常重要：</p><ol><li>一个是需要更强的特征抽取器，目前看 Transformer 会逐渐担当大任，但是肯定还是不够强的，需要发展更强的特征抽取器；</li><li>第二个就是如何优雅地引入大量无监督数据中包含的语言学知识，注意我这里强调地是优雅，而不是引入，此前相当多的工作试图做各种语言学知识的嫁接或者引入，但是很多方法看着让人牙疼，就是我说的不优雅。</li></ol><p>目前看预训练这种两阶段方法还是很有效的，也非常简洁，当然后面肯定还会有更好的模型出现。</p><p>完了，这就是预训练语言模型的前世今生。</p><p>由于个人刚入门 NLP 方向，就不妄自总结，上述总结全部来自知乎文章：<a href='https://zhuanlan.zhihu.com/p/49271699' target='_blank'>从Word Embedding到Bert模型—自然语言处理中的预训练技术发展史-<a href="https://www.zhihu.com/people/zhang-jun-lin-76">张俊林</a></a></p><h1>十六、参考资料</h1><p>我只是知识的搬运工，想详细了解各个知识点的读者可以自行选择参考下列资料。</p><blockquote><ul><li><p>参考书籍：</p><ul><li><p>《预训练语言模型》- 卲浩、刘一烽</p></li><li><p>《基于 BERT 模型的自然语言处理实战》- 李金洪</p></li></ul></li><li><p>参考论文：</p><ul><li><a href='https://arxiv.org/abs/1706.03762' target='_blank'>Attention Is All You Need</a></li><li><a href='https://tooob.com/api/objs/read/noteid/28717995/' target='_blank'>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</a></li></ul></li><li><p>参考博客：</p><ul><li><a href='https://zhuanlan.zhihu.com/p/37601161' target='_blank'>深度学习中的注意力模型（2017版）</a></li><li><a href='https://mp.weixin.qq.com/s/RLxWevVWHXgX-UcoxDS70w' target='_blank'>细讲 | Attention Is All You Need</a></li><li><a href='https://zhuanlan.zhihu.com/p/49271699' target='_blank'>从Word Embedding到Bert模型—自然语言处理中的预训练技术发展史</a></li><li><a href='https://www.cnblogs.com/nickchen121/p/15071844.html' target='_blank'>Attention和Transformer详解</a></li><li><a href='https://zhuanlan.zhihu.com/p/44121378' target='_blank'>【NLP】Transformer模型原理详解</a></li><li><a href='https://zhuanlan.zhihu.com/p/136223550' target='_blank'>LSTM如何解决RNN带来的梯度消失问题</a></li><li><a href='http://jalammar.github.io/illustrated-transformer/' target='_blank'>The Illustrated Transformer</a></li></ul></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>预训练语言模型的下游任务改造简介（如何使用词向量）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/07%20%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%8B%E6%B8%B8%E4%BB%BB%E5%8A%A1%E6%94%B9%E9%80%A0%E7%AE%80%E4%BB%8B%EF%BC%88%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%AF%8D%E5%90%91%E9%87%8F%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/07%20%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%8B%E6%B8%B8%E4%BB%BB%E5%8A%A1%E6%94%B9%E9%80%A0%E7%AE%80%E4%BB%8B%EF%BC%88%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%AF%8D%E5%90%91%E9%87%8F%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>Word2Vec --》 是一个神经网络语言模型，其次他的主要任务是做（生成词向量，Q）</h1><p>Word2Vec 模型是不是预训练模型？（是）</p><p>一定是</p><p>什么是预训练？</p><p>给出两个任务 A 和 B，任务 A 已经做出了模型 A，任务 B 无法解决（通过使用模型 A，加快任务的解决）</p><p>给你一个 NLP 里面的任务，给一个问题 X（Ni+ck），给出一个回答 Y（handsome）</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/we%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E9%A2%84%E8%AE%AD%E7%BB%83.jpg" alt="img"></p><p>预训练语言模型终于出来（给出一句话，我们先使用独热编码（一一对应的一种表查询），再使用Word2Vec 预训练好的 Q 矩阵直接得到词向量，然后进行接下来的任务）</p><ol><li>冻结：可以不改变 Q 矩阵</li><li>微调：随着任务的改变，改变 Q 矩阵</li></ol>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>神经网络语言模型（独热编码+词向量的起源）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/05%20%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%8B%AC%E7%83%AD%E7%BC%96%E7%A0%81+%E8%AF%8D%E5%90%91%E9%87%8F%E7%9A%84%E8%B5%B7%E6%BA%90%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/05%20%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%8B%AC%E7%83%AD%E7%BC%96%E7%A0%81+%E8%AF%8D%E5%90%91%E9%87%8F%E7%9A%84%E8%B5%B7%E6%BA%90%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>统计语言模型</h1><p>统计+语言模型–》用统计的方法去完成以下两个和人说的话相关的任务</p><p>语言模型 = 语言（人说的话） + 模型（去完成两个任务）</p><ol><li>比较，“词性”，“磁性”</li><li>预测下一个单词（填空）</li></ol><h2 id="n-元语言模型">n 元语言模型</h2><p>取 a（2，3，4） 个词</p><h1>神经网络语言模型</h1><p>神经网络+语言模型–》用神经网络的方法去完成以下两个和人说的话相关的任务。</p><p>第二个任务：</p><p>“判断”，“一个”，“词”，“的”，“<code>___</code>”</p><p>假设词库里有“词性”和“火星”</p><p>P(<code>__</code>|“判断”，“一个”，“词”，“的”)</p><p>词性</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B.jpg" alt="img" style="zoom:67%;" /><p>w1,w2,w3,w4（上述 4 个单词的独热编码）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">w1*Q=c1,</span><br><span class="line">w2*Q=c2,</span><br><span class="line">w3*Q=c3,</span><br><span class="line">w4*Q=c4,</span><br><span class="line"></span><br><span class="line">C=[c1,c2,c3,c4]</span><br><span class="line">Q就是一个随机矩阵，是一个参数（可学习）</span><br></pre></td></tr></table></figure><p>“判断”，“这个”，“词”，“的”，“词性”</p><p>softmax（U[tanh(WC+b1)]+b2）== [0.1, 0.1, 0.2, 0.2, 0.4] <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>V</mi><mi>L</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\in[1,V_L]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></p><h2 id="独热编码-（one-hot-编码）">独热编码 （one-hot 编码）</h2><p>独热编码：让计算机认识单词</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E5%8D%95%E8%AF%8D%E7%9A%84%E7%8B%AC%E7%83%AD%E8%A1%A8%E7%A4%BA.jpg" alt="img" style="zoom:50%;" /><p>词典 V（新华字典里面把所有词集合成一个集合 V）</p><p>假设词典里面只有 8 个单词</p><p>计算机不认识单词的</p><p>但是我们要计算机认识单词</p><p>“fruit”</p><p>独热编码：给出一个 8*8 的矩阵</p><p>“time” --》 10000000</p><p>“fruit” --》 01000000</p><p>“banana” --》 00000001</p><p>余弦相似度 去计算两者的相似度（0）–词向量（矩阵乘法）</p><h1>词向量（神经网络语言模型的副产品 Q）</h1><p>给我任何一个词，</p><p>“判断” --》 独热编码w1 [1,0,0,0,0]</p><p>w1*Q =c1  （“判断”这个词的词向量）</p><p>词向量：就是用一个向量来表示一个单词</p><p>可以控制词向量的维度（大小）</p><p>如果我们得到的词向量，第一个问题也被解决了，（下游任务）</p><h1>总结</h1><p>神经网络语言模型：通过神经网络解决两个人说的话的问题</p><p>有一个副产品：Q 矩阵–》新的词向量（词向量可以选择词向量的维度，可以求两个词之间的相似程度）</p><p>下游任务</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ELMo模型（双向LSTM模型解决词向量多义问题）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/08%20ELMo%E6%A8%A1%E5%9E%8B%EF%BC%88%E5%8F%8C%E5%90%91LSTM%E6%A8%A1%E5%9E%8B%E8%A7%A3%E5%86%B3%E8%AF%8D%E5%90%91%E9%87%8F%E5%A4%9A%E4%B9%89%E9%97%AE%E9%A2%98%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/08%20ELMo%E6%A8%A1%E5%9E%8B%EF%BC%88%E5%8F%8C%E5%90%91LSTM%E6%A8%A1%E5%9E%8B%E8%A7%A3%E5%86%B3%E8%AF%8D%E5%90%91%E9%87%8F%E5%A4%9A%E4%B9%89%E9%97%AE%E9%A2%98%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>Word2Vec 模型</h1><p>NNLM 模型（是不是在预测下一个词，副产品是词向量）</p><p>Word2Vec 模型：专门做词向量</p><ol><li>CBOW</li><li>Skip-gram</li></ol><h1>ELMo</h1><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/we%E5%A4%9A%E4%B9%89%E8%AF%8D%E9%97%AE%E9%A2%98.jpg" alt="img"></p><p>elmo 解决多义词问题</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/word2vec.jpg" alt="img"></p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E5%9F%BA%E4%BA%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84emedding.jpg" alt="img"></p><p>ELMo（专门做词向量，通过预训练）</p><p>不只是训练一个 Q 矩阵，我还可以把这个次的上下文信息融入到这个 Q 矩阵中</p><p>左边的 LSTM 获取 E2 的上文信息，右边就是下文信息</p><p>x1,x2, x4,x5 --&gt; Word2Vec x1+x2+x4+x5 —&gt; 预测那一个词</p><p>获取上下文信息后，把三层的信息进行一个叠加</p><p>E1+E2+E3 = K1 一个新的词向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mrel">≈</span></span></span></span> E1</p><p>E2,E3 相当于两个上下文信息</p><p>E1+E2+E3+E4</p><p>K1 包含了第一个词的词向量包含单词特征、句法特征、语义特征</p><p>怎么用</p><p>E2，E3 不同，E1+E2+E3 不同</p><p>apple --》 我吃了一个 苹果 – 》 [1,20,10]</p><p>apple --》我在用苹果手机 --》[1,10,20]</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/elmo%E8%AE%AD%E7%BB%83%E5%90%8E%E7%9A%84%E4%BD%BF%E7%94%A8.jpg" alt="img"></p><p>LSTM 无法并行，长期依赖</p><p>Attention</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Transformer</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/Transformer/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/Transformer/</url>
      
        <content type="html"><![CDATA[<h1>框架概述</h1><p>1000*0.04=40–&gt;10</p><p>5000*0.04=200–&gt;20</p><p>预训练–》NNLM–》word2Vec–》ELMo–》Attention</p><p>NLP 中预训练的目的，其实就是为了生成词向量</p><p>顺水推舟，transformer 其实就是 attention 的一个堆叠</p><p>从一个宏观的角度，去看 transformer 到底在干嘛，然后在细分，再作总结</p><p>总分总</p><p>seq2seq</p><p>一句话，一个视频</p><p>序列（编码器）到序列（解码器）</p><p>分成两部分，编码器和解码器</p><h2 id="整体框架">整体框架</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6.jpg" alt="img" style="zoom:33%;" /><h2 id="机器翻译流程（Transformer）">机器翻译流程（Transformer）</h2><p>通过机器翻译来做解释</p><p>给一个输入，给出一个输出（输出是输入的翻译的结果）</p><p>“我是一个学生”  --》（通过 Transformer） I am a student</p><p>流程 1</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%A1%86%E6%9E%B6%E7%AE%80%E5%8C%96.jpg" alt="img"></p><p>编码器和解码器</p><p>编码器：把输入变成一个词向量（Self-Attetion）</p><p>解码器：得到编码器输出的词向量后，生成翻译的结果</p><p>流程 2</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-ed-%E6%A1%86%E6%9E%B6.jpg" alt="img" style="zoom:80%;" /><p>Nx 的意思是，编码器里面又有 N 个小编码器（默认 N=6）</p><p>通过 6 个编码器，对词向量一步又一步的强化（增强）</p><p>流程 3</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-ed-%E5%A4%8D%E6%9D%82.jpg" alt="img" style="zoom:80%;" /><p>说了这么多，了解 Transformer 就是了解 Transformer 里的小的编码器（Encoder）和小的解码器（Decoder）</p><p>FFN（Feed Forward）：w2(（w1x+b1）)+b2</p><p>流程 4</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-%E7%BB%86%E5%88%86.jpg" alt="img" style="zoom:80%;" /><h1>Transformer 的编码器（Encodes）——我在做更优秀的词向量</h1><h2 id="Transformer-框架">Transformer 框架</h2><p>seq（编码器）2seq（解码器）</p><ol><li>通过编码器对序列进行向量化（词向量）</li><li>把词向量输入到解码器，得到结果（生成单词）</li></ol><h2 id="编码器概略图">编码器概略图</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-%E7%BB%86%E5%88%86.jpg" alt="img" style="zoom:80%;" /><p>编码器包括两个子层，Self-Attention、Feed Forward</p><p>每一个子层的传输过程中都会有一个（残差网络+归一化）</p><h2 id="编码器详细图">编码器详细图</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/encoder-%E8%AF%A6%E7%BB%86%E5%9B%BE.png" alt="img" style="zoom:80%;" /><p>Thinking</p><p>–》得到绿色的 x1（词向量，可以通过 one-hot、word2vec 得到）+ 叠加位置编码（给 x1 赋予位置属性）得到黄色的 x1</p><p>–》输入到 Self-Attention 子层中，做注意力机制（x1、x2 拼接起来的一句话做），得到 z1（x1 与 x1，x2拼接起来的句子做了自注意力机制的词向量，表征的仍然是 thinking），也就是说 z1 拥有了位置特征、句法特征、语义特征的词向量</p><p>–》残差网络（避免梯度消失，w3(w2(w1x+b1)+b2)+b3，如果 w1，w2，w3 特别小，0.0000000000000000……1，x 就没了，【w3(w2(w1x+b1)+b2)+b3+x】），归一化（LayerNorm），做标准化（避免梯度爆炸），得到了深粉色的 z1</p><p>–》Feed Forward，Relu（w2(w1x+b1)+b2），（前面每一步都在做线性变换，wx+b，线性变化的叠加永远都是线性变化（线性变化就是空间中平移和扩大缩小），通过 Feed Forward中的 Relu 做一次非线性变换，这样的空间变换可以无限拟合任何一种状态了），得到 r1（是 thinking 的新的表征）</p><p>总结下（这是重点，上面听不懂都没关系）：做词向量，只不过这个词向量更加优秀，让这个词向量能够更加精准的表示这个单词、这句话。</p><h1>Transformer 的解码器（Decoders）——我要生成一个又一个单词</h1><h2 id="Transformer-编码器">Transformer 编码器</h2><p>编码器在干吗：词向量、图片向量，总而言之，编码器就是让计算机能够更合理地（不确定性的）认识人类世界客观存在的一些东西</p><h2 id="Transformer-解码器">Transformer 解码器</h2><p>解码器会接收编码器生成的词向量，然后通过这个词向量去生成翻译的结果。</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/ed-%E7%BB%86%E5%88%86.jpg" alt="img" style="zoom:80%;" /><p>解码器的 Self-Attention 在编码已经生成的单词</p><p>假如目标词“我是一个学生”—》masked Self-Attention</p><p>训练阶段：目标词“我是一个学生”是已知的，然后 Self-Attention 是对“我是一个学生” 做计算</p><p>如果不做 masked，每次训练阶段，都会获得全部的信息</p><p>如果做 masked，Self-Attention 第一次对“我”做计算</p><p>Self-Attention 第二次对“我是”做计算</p><p>……</p><p>测试阶段：</p><ol><li>目标词未知，假设目标词是“我是一个学生”（未知），Self-Attention 第一次对“我”做计算</li><li>第二次对“我是”做计算</li><li>……</li></ol><p>而测试阶段，没生成一点，获得一点</p><h2 id="生成词">生成词</h2><img src="../../ed-交互.jpg" alt="img" style="zoom:80%;" /><p>Linear 层转换成词表的维度</p><p>softmax 得到最大词的概率</p><p>softmax 细话</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%9C%80%E5%90%8E%E8%BE%93%E5%87%BA.jpg" alt="img" style="zoom:80%;" /><p>单词表</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%9C%80%E7%BB%88%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C.jpg" alt="img" style="zoom:80%;" /><h1>Transformer 的动态流程</h1><p>机器翻译：德语（中文）翻译成英文</p><h2 id="生成一个词">生成一个词</h2><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90.gif" alt="img"></p><h2 id="生成所有词">生成所有词</h2><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E5%8A%A8%E6%80%81%E7%BB%93%E6%9E%9C-2.gif" alt="img"></p><h2 id="Transformer-框架-2">Transformer 框架</h2><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6.jpg" alt="img"></p><h1>Transformer 解码器的两个为什么（为什么做掩码、为什么用编码器-解码器注意力）</h1><h2 id="Transformer-的编码器和解码器">Transformer 的编码器和解码器</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/tf-%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6.jpg" alt="img" style="zoom:50%;" /><h2 id="问题一：为什么-Decoder-需要做-Mask">问题一：为什么 Decoder 需要做 Mask</h2><p>机器翻译：源语句（我爱中国），目标语句（I love China）</p><p>为了解决训练阶段和测试阶段的 gap（不匹配）</p><p>训练阶段：解码器会有输入，这个输入是目标语句，就是 I love China，通过已经生成的词，去让解码器更好的生成（每一次都会把所有信息告诉解码器）</p><p>测试阶段：解码器也会有输入，但是此时，测试的时候是不知道目标语句是什么的，这个时候，你每生成一个词，就会有多一个词放入目标语句中，每次生成的时候，都是已经生成的词（测试阶段只会把已经生成的词告诉解码器）</p><p>为了匹配，为了解决这个 gap，masked Self-Attention 就登场了，我在训练阶段，我就做一个 masked，当你生成第一个词，我啥也不告诉你，当你生成第二个词，我告诉第一个词</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/mask-attention-map.jpg" alt="img" style="zoom:50%;" /><h2 id="问题二：为什么-Encoder-给予-Decoders-的是-K、V-矩阵">问题二：为什么 Encoder 给予 Decoders 的是 K、V 矩阵</h2><p>Q来源解码器，K=V来源于编码器</p><p>Q是查询变量，Q 是已经生成的词</p><p>K=V 是源语句</p><p>当我们生成这个词的时候，通过已经生成的词和源语句做自注意力，就是确定源语句中哪些词对接下来的词的生成更有作用，首先他就能找到当前生成词</p><p>我爱中国</p><p>通过部分（生成的词）去全部（源语句）的里面挑重点</p><p>Q 是源语句，K，V 是已经生成的词，源语句去已经生成的词里找重点 ，找信息，已经生成的词里面压根就没有下一个词</p><p>解决了以前的 seq2seq 框架的问题</p><p>lstm 做编码器（得到词向量 C），再用 lstm 做解码器做生成</p><p>用这种方法去生成词，每一次生成词，都是通过 C 的全部信息去生成</p><p>很多信息对于当前生成词而言都是没有意义的</p><p>用 Pytorch 去构建 Transformer 的源码（）</p><h1>位置编码公式详细理解补充</h1><p>Self-Attention：对于每个词而言都是无位置关系，把每个词的顺序打乱，得到的注意力值依然不变</p><p>通过 t1 告诉你，x1 是在前面，x2 在 x1 的后面</p><ul><li>位置编码</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E5%90%91%E9%87%8F.jpg" alt="img" style="zoom:50%;" /><ul><li>位置编码公式</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E5%85%AC%E5%BC%8F.png" alt="img" style="zoom:50%;" /><p>位置编码怎么用</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E5%92%8C%E8%AF%8D%E5%90%91%E9%87%8F%E4%B9%8B%E5%92%8C.png" alt="img" style="zoom:50%;" /><ul><li>位置编码底层解释</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E8%A7%A3%E9%87%8A.png" alt="img" style="zoom:50%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sin(pos+k) = sin(pos)*cos(k) + cos(pos)*sin(k)  # sin 表示的是偶数维度</span><br><span class="line">cos(pos+k) = cos(pos)cos(k) - sin(pos)*sin(k)  # cos 表示的是奇数维度</span><br><span class="line"></span><br><span class="line">他特别在 pos+k 是 pos 和 k 的线性组合</span><br><span class="line"></span><br><span class="line">我爱你 ，现在我做第三个词 “你” 的位置编码</span><br><span class="line"></span><br><span class="line">pos = 3 = 1+2</span><br><span class="line">pos + k = 3 =  1+2 = 1*2+1*2</span><br><span class="line"></span><br><span class="line">pos = 10</span><br><span class="line">1+9，2+8，3+7</span><br><span class="line"></span><br><span class="line">这句话变成 “你爱我”，现在我们仍然做第三个词 “我” 的位置编码</span><br><span class="line"></span><br><span class="line">pos = 3 = 1+2</span><br><span class="line">pos + k = 3 =  1+2 = 1*2+1*2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>注意力机制（Attention ）</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%EF%BC%88Attention%20%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%EF%BC%88Attention%20%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>Attention（注意力机制）</h1><p>你会注意什么？</p><p>大数据（什么数据都有，重要的，不重要的）</p><p>对于重要的数据，我们要使用</p><p>对于不重要的数据，我们不太想使用</p><p>但是，对于一个模型而言（CNN、LSTM），很难决定什么重要，什么不重要</p><p>由此，注意力机制诞生了（有人发现了如何去在深度学习的模型上做注意力）</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BA%BA%E7%B1%BB%E7%9A%84%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B.jpg" alt="img"></p><p>红色的是科学家们发现，如果给你一张这个图，你眼睛的重点会聚焦在红色区域</p><p>人–》看脸</p><p>文章看标题</p><p>段落看开头</p><p>后面的落款</p><p>这些红色区域可能包含更多的信息，更重要的信息</p><p>注意力机制：我们会把我们的焦点聚焦在比较重要的事物上</p><h1>怎么做注意力</h1><p>我（查询对象 Q），这张图（被查询对象 V）</p><p>我看这张图，第一眼，我就会去判断哪些东西对我而言更重要，哪些对我而言又更不重要（去计算 Q 和 V 里的事物的重要度）</p><p>重要度计算，其实是不是就是相似度计算（更接近），点乘其实是求内积（不要关心为什么可以）</p><p>Q，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>k</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">K =k_1,k_2,\cdots,k_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，我们一般使用点乘的方式</p><p>通过点乘的方法计算Q 和 K 里的每一个事物的相似度，就可以拿到 Q 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">k_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的相似值<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">s_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，Q 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">k_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的相似值<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">s_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，Q 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">k_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的相似值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">s_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>做一层 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">softmax(s_1,s_2,\cdots,s_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 就可以得到概率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a_1,a_2,\cdots,a_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>进而就可以找出哪个对Q 而言更重要了</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/attention-%E8%AE%A1%E7%AE%97%E5%9B%BE.png" alt="img"></p><p>我们还得进行一个汇总，当你使用 Q 查询结束了后，Q 已经失去了它的使用价值了，我们最终还是要拿到这张图片的，只不过现在的这张图片，它多了一些信息（多了于我而言更重要，更不重要的信息在这里）</p><p>V = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>v</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_1,v_2,\cdots,v_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>∗</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>v</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>∗</mo><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mo>∗</mo><msub><mi>v</mi><mn>2</mn></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><mo>∗</mo><msub><mi>v</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a_1,a_2,\cdots,a_n)*+(v_1,v_2,\cdots,v_n)=(a_1*v_1+a_2*v_2+\cdots+a_n*v_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">+</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> = V’</p><p>这样的话，就得到了一个新的 V’，这个新的 V’ 就包含了，哪些更重要，哪些不重要的信息在里面，然后用 V’ 代替 V</p><p>一般 K=V，在 Transformer 里，K!=V 可不可以，可以的，但是 K 和 V 之间一定具有某种联系，这样的 QK 点乘才能指导 V 哪些重要，哪些不重要</p><p>51， 49—》 0.51，0.49</p><p>80/8，20/8 --》 0.9999999999， 0.0000000001</p><h3 id="10-3-0-9-0-1">10 / 3 --&gt; 0.9, 0.1</h3><p>a1 和 a2 之间的差额越大，这个概率就越离谱</p><h1>Self-Attention（自注意力机制）</h1><h2 id="注意力机制">注意力机制</h2><p>看一个物体的时候，我们倾向于一些重点，把我们的焦点放到更重要的信息上</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BA%BA%E7%B1%BB%E7%9A%84%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B.jpg" alt="img" style="zoom:50%;" /><p>第一眼看到这个图，不会说把所有的信息全部看完</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention.jpg" alt="img" style="zoom:50%;" /><p>QK 相乘求相似度，做一个 scale（未来做 softmax 的时候避免出现极端情况）</p><p>然后做 Softmax 得到概率</p><p>新的向量表示了K 和 V（K==V），然后这种表示还暗含了 Q 的信息（于 Q 而言，K 里面重要的信息），也就是说，挑出了 K 里面的关键点</p><h2 id="自-注意力机制（Self-Attention）（向量）">自-注意力机制（Self-Attention）（向量）</h2><p>Self-Attention 的关键点再于，不仅仅是 K<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mrel">≈</span></span></span></span>V<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mrel">≈</span></span></span></span>Q 来源于同一个 X，这三者是同源的</p><p>通过 X 找到 X 里面的关键点</p><p>并不是 K=V=Q=X，而是通过三个参数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>Q</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>K</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>V</mi></msub></mrow><annotation encoding="application/x-tex">W_Q,W_K,W_V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>接下来的步骤和注意力机制一模一样</p><ol><li><p>Q、K、V的获取</p><ol><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qkv.jpg" alt="img" style="zoom:50%;" /></li></ol></li><li><p>Matmul：</p></li><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/Q-K%E4%B9%98%E7%A7%AF.jpg" alt="img" style="zoom:50%;" /></li><li><p>Scale+Softmax：</p></li><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qk-scale.jpg" alt="img" style="zoom:50%;" /></li><li><h3 id="Matmul：">Matmul：</h3><ol><li><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qk-softmax.jpg" alt="img" style="zoom:50%;" /></li></ol></li></ol><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示的就是 thinking 的新的向量表示</p><p>对于 thinking，初始词向量为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>现在我通过 thinking  machines 这句话去查询这句话里的每一个单词和 thinking 之间的相似度</p><p>新的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">z_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>依然是 thinking 的词向量表示，只不过这个词向量的表示蕴含了 thinking machines 这句话对于 thinking 而言哪个更重要的信息</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention-%E5%A5%BD%E5%A4%842.jpg" alt="img" style="zoom:67%;" /><p>不做注意力，its 的词向量就是单纯的 its，没有任何附加信息</p><blockquote><p>也就是说 its 有 law 这层意思，而通过自注意力机制得到新的 its 的词向量，则会包含一定的 laws 和 application 的信息</p></blockquote><h2 id="自注意力机制（矩阵）">自注意力机制（矩阵）</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/QKV-%E7%9F%A9%E9%98%B5%E8%A1%A8%E7%A4%BA.jpg" alt="img" style="zoom:50%;" /><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/QKVZ-%E7%BB%93%E6%9E%9C.jpg" alt="img" style="zoom:50%;" /><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E7%9F%A9%E9%98%B5%E5%9B%BE.jpg" alt="img" style="zoom:50%;" /><h1>Self-Attention相比较 RNN和LSTM的优缺点</h1><h2 id="RNN">RNN</h2><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/RNN-unrolled.png" alt="img"></p><p>无法做长序列，当一段话达到 50 个字，效果很差了</p><h2 id="LSTM">LSTM</h2><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/LSTM%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84.jpg" alt="img"></p><p>LSTM 通过各种门，遗忘门，选择性的可以记忆之前的信息（200 词）</p><h2 id="Self-Attention-和-RNNs-的区别">Self-Attention 和 RNNs 的区别</h2><p>RNNs 长序列依赖问题，无法做并行</p><p>Self-Attention 得到的新的词向量具有句法特征和语义特征（词向量的表征更完善）</p><h3 id="句法特征">句法特征</h3><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention-%E5%A5%BD%E5%A4%841.jpg" alt="img" style="zoom:67%;" /><h3 id="语义特征">语义特征</h3><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/self-attention-%E5%A5%BD%E5%A4%842.jpg" alt="img" style="zoom:50%;" /><h2 id="并行计算">并行计算</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/qk-softmax.jpg" alt="img" style="zoom:50%;" /><h1>Masked Self-Attention（掩码自注意力机制）</h1><h2 id="Masked（掩码）-Self-Attention–》在自注意力模型上面做了改进">Masked（掩码） Self-Attention–》在自注意力模型上面做了改进</h2><p>为什么要做这个改进：生成模型，生成单词，一个一个生成的</p><p>当我们做生成任务的时候，我们也想对生成的这个单词做注意力计算，但是，生成的句子是一个一个单词生成的</p><p>I have a dream</p><ol><li><p>I  第一次注意力计算，只有 I</p></li><li><p>I have 第二次，只有 I 和 have</p></li><li><p>I have a</p></li><li><p>I have a dream</p></li><li><p>I have a dream &lt;eos&gt;</p></li></ol><p>掩码自注意力机制应运而生</p><p>掩码后 1</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/mask-attention-map.jpg" alt="img" style="zoom:50%;" /><p>掩码后2</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/mask-attention-map-softmax.jpg" alt="img" style="zoom:50%;" /><p>未来我们讲 Transformer 的时候会详细讲！</p><p>Multi-head Self-Attention。</p><h1>Multi-Head Self-Attention（从空间角度解释为什么做多头）</h1><h2 id="Multi-Head-Self-Attention（多头自注意力）">Multi-Head Self-Attention（多头自注意力）</h2><p>Z 相比较 X 有了提升，通过 Multi-Head Self-Attention，得到的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">Z{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mord"><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 相比较 Z 又有了进一步提升</p><p>多头自注意力，问题来了，多头是什么，多头的个数用 h 表示，一般<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">h=8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span>，我们通常使用的是 8 头自注意力</p><p>什么是多头</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/multi-head-attention.png" alt="img" style="zoom:50%;" /><p>如何多头 1</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/8-head-attention.jpg" alt="img" style="zoom:50%;" /><p>对于 X，我们不是说，直接拿 X 去得到 Z，而是把 X 分成了 8 块（8 头），得到 Z0-Z7</p><p>如何多头 2</p><p>然后把 Z0-Z7 拼接起来，再做一次线性变换（改变维度）得到 Z</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/8-z-%E6%8B%BC%E6%8E%A5.jpg" alt="img"></p><p>有什么作用？</p><p>机器学习的本质是什么：y=<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>(wx+b)，在做一件什么事情，非线性变换（把一个看起来不合理的东西，通过某个手段（训练模型），让这个东西变得合理）</p><p>非线性变换的本质又是什么？改变空间上的位置坐标，任何一个点都可以在维度空间上找到，通过某个手段，让一个不合理的点（位置不合理），变得合理</p><p>这就是词向量的本质</p><p>one-hot 编码（0101010）</p><p>word2vec（11，222，33）</p><p>emlo（15，3，2）</p><p>attention（124，2，32）</p><p>multi-head attention（1231，23，3），把 X 切分成 8 块（8 个子空间），这样一个原先在一个位置上的 X，去了空间上 8 个位置，通过对 8 个点进行寻找，找到更合适的位置</p><p>词向量的大小是 512</p><p>假设你的任务，视频向量是 5120，80</p><p>对计算机的性能提出了要求</p><h2 id="多头流程图">多头流程图</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/multi-head-%E6%8B%BC%E6%8E%A5.jpg" alt="img" style="zoom:50%;" /><h1>Positional Encoding （为什么 Self-Attention 需要位置编码）</h1><h2 id="Attention">Attention</h2><p>优点：</p><ol><li>解决了长序列依赖问题</li><li>可以并行</li></ol><p>缺点：</p><ol><li><p>开销变大了</p></li><li><p>既然可以并行，也就是说，词与词之间不存在顺序关系（打乱一句话，这句话里的每个词的词向量依然不会变），即无位置关系（既然没有，我就加一个，通过位置编码的形式加）</p></li></ol><p>位置编码的问题</p><h2 id="为什么需要位置编码">为什么需要位置编码</h2><h2 id="位置编码怎么做的">位置编码怎么做的</h2><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E5%90%91%E9%87%8F.jpg" alt="img" style="zoom:50%;" /><h2 id="具体做法">具体做法</h2><ul><li>做法 1</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E5%85%AC%E5%BC%8F.png" alt="img" style="zoom:50%;" /><ul><li>做法 2</li></ul><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E5%92%8C%E8%AF%8D%E5%90%91%E9%87%8F%E4%B9%8B%E5%92%8C.png" alt="img" style="zoom:50%;" /><h2 id="为什么这么做有用">为什么这么做有用</h2><p>pos+K=5，我在计算第 5 个单词的位置编码的时候</p><p>pos=1，k=4</p><p>pos=2，k=3</p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E4%BD%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E8%A7%A3%E9%87%8A.png" alt="img" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Word2Vec模型</title>
      <link href="/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/06%20Word2Vec%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%93%E9%97%A8%E5%81%9A%E8%AF%8D%E5%90%91%E9%87%8F%E7%9A%84%E6%A8%A1%E5%9E%8B%EF%BC%8CCBOW%E5%92%8CSkip-gram%EF%BC%89/"/>
      <url>/2024/02/07/NER/Pre-training-language-model-main/%E7%AC%AC%E4%B8%80%E7%AF%87%20Transformer%E3%80%81GPT%E3%80%81BERT%EF%BC%8C%E9%A2%84%E8%AE%AD%E7%BB%83%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%EF%BC%88%E7%90%86%E8%AE%BA%EF%BC%89/06%20Word2Vec%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%93%E9%97%A8%E5%81%9A%E8%AF%8D%E5%90%91%E9%87%8F%E7%9A%84%E6%A8%A1%E5%9E%8B%EF%BC%8CCBOW%E5%92%8CSkip-gram%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1>神经网络语言模型（NNLM）–》为了预测下一个词</h1><p>NNLM（）–》预测下一个词</p><p>神经网络+语言模型：用神经网络去解决和人说话有关的两个任务的一个东西</p><p>softmax(w2(tanh(（w1x+b1）))+b2)</p><p>得到一个副产品（词向量）</p><p>Q 矩阵，对于任何一个独热编码的词向量都可以通过 Q 矩阵得到新的词向量</p><ol><li>可以转换维度</li><li>相似词之间的词向量之间也有了关系</li></ol><h1>Word2Vec --》 为了得到词向量</h1><p>神经网络语言模型–》主要目的就是为了得到词向量</p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B.jpg" alt="img"></p><p><img src="https://imgmd.oss-cn-shanghai.aliyuncs.com/BERT_IMG/word2vec.jpg" alt="img"></p><p>NNLM 和 Word2Vec 基本一致（一模一样），不考虑细节，网络架构就是一模一样</p><h2 id="CBOW">CBOW</h2><p>给出一个词的==上下文==，得到这个词</p><p>“我是最<code>_</code>的Nick”</p><p>“帅” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><h2 id="Skip-gram">Skip-gram</h2><p>给出一个词，得到这个词的上下文</p><p>“帅”</p><p>“我是<code>_</code>的Nick”</p><h1>NNLM 和 Word2Vec 的区别</h1><p>NNNL --》 重点是预测下一词，双层感知机softmax(w2(tanh(（w1(xQ)+b1）))+b2)</p><p>Word2Vec --》 CBOW 和 Skip-gram 的两种架构的重点都是得到一个 Q 矩阵，softmax(w1 (xQ) +b1)</p><ol><li>CBOW：一个老师告诉多个学生，Q 矩阵怎么变</li><li>Skip：多个老师告诉一个学生，Q 矩阵怎么变</li></ol><h1>Word2Vec的缺点</h1><p>Q 矩阵的设计</p><p>00010 代表 apple × Q = 10，12，19</p><p>apple（苹果，）</p><p>假设数据集里面的 apple 只有苹果这个意思，没有这个意思（训练）</p><p>（测试，应用）10，12，19 apple, 无法表示这个意思</p><p>词向量不能进行多意 —》 ELMO</p>]]></content>
      
      
      <categories>
          
          <category> NER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NER </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大创命题清单（2024）</title>
      <link href="/2023/11/23/jike/%E5%A4%A7%E5%88%9B%E9%A1%B9%E7%9B%AE%E5%90%88%E9%9B%86/"/>
      <url>/2023/11/23/jike/%E5%A4%A7%E5%88%9B%E9%A1%B9%E7%9B%AE%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>慧试遗产~内有各老师联系方式，可以踊跃联系！</p><p>【腾讯文档】2024年度西电大学生创新创业训练计划命题清单<br><a href="https://docs.qq.com/sheet/DVWRVRWFKU0FwYlpS?tab=BB08J2">https://docs.qq.com/sheet/DVWRVRWFKU0FwYlpS?tab=BB08J2</a></p>]]></content>
      
      
      <categories>
          
          <category> 计科资料 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计科 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
